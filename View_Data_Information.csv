SchemaName;SchemaID;DataCORELayer;ObjectName;ObjectID;ObjectType;ObjectTypeDescription;ObjectSQLCode_Anzahl_Character;ObjectSQLCode_First_32767_Characters
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_Plant_V1_IDIM1;979330;V ;VIEW;1332;/**/ /* View: V_Plant_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Plant Code for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface #0227 https://inside-docupedia.bosch.com/confluence/x/HsYxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_D4;1083440;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_D4 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_D4] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G4;1643299;V ;VIEW;2634;/**/ /* View: V_FactActualCostMaintenanceOrder_G4 */ /**/ /**/ /* V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P81 */ /* Changes: */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_O1;4507395;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_O1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_B2;8087515;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_B2 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_C3;11511470;V ;VIEW;15157;"/**/ /* View: V_INTF_PnL_C3 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G4;12579133;V ;VIEW;663;
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G4_ME;14219401;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17177;CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G4_ME] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,x.DebitCreditCode as [DebitCreditCode] --,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,y.StatisticalIndicator as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator --,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci -- ON rdci.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] -- AND rdci.[COBusinessTransaction] = pcp_ws.[COBusinessTransaction] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s -- ON rdci_s.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] -- AND rdci_s.[COBusinessTransaction] IS NULL --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi -- ON rsi.[ValueType] = pcp_ws.[ValueType] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator_ME] ([DebitCreditCode],[COBusinessTransaction]) as x CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator_ME] (pcp_ws.[ValueType]) as y UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,x.DebitCreditCode as [DebitCreditCode] --,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,y.StatisticalIndicator as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator --,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci -- ON rdci.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] -- AND rdci.[COBusinessTransaction] = pcs_ws.[COBusinessTransaction] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s -- ON rdci_s.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] -- AND rdci_s.[COBusinessTransaction] IS NULL --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi -- ON rsi.[ValueType] = pcs_ws.[ValueType] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator_ME] ([DebitCreditCode],[COBusinessTransaction]) as x CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator_ME] (pcs_ws.[ValueType]) as y ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_A3;16367473;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16928;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 18.01.2023 10:59:14 */ /**/ /**/ /* V01.04.00 2023-01-18 Yannick Sigwalt GS/BDD1 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* #FBI-SR-xxxxxxxxx CostElement conform to nonConform */ /* Update: */ /* Copied from ufn_Get Plan Cost_V3_IFCT0_D7 as of V01.04.00 2022-08-09 */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_A3 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_A3_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_A3_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] --non-conform ,v_sr_ccentnc2ccent.[CostCenter_HK] as [CostCenter_HK_nonConform] ,v_sr_ccentnc2ccent.[CostCenter_BK] as [CostCenter_BK_nonConform] ,v_sr_ccentnc2ccent.[ControllingArea] as [ControllingArea_nonConform] --conform ,v_sr_ccentnc2ccent.[CostCenterConform_HK] as [CostCenterConform_HK] ,v_sr_ccentnc2ccent.[CostCenterConform_BK] as [CostCenterConform_BK] ,v_sr_ccentnc2ccent.[ControllingAreaConform] as [ControllingAreaConform] --Dimension ID ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccoll_wh.SourceSystem_BK = N'SAPEP1' inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent --#FBI-SR-000000069 on v_sr_ccentnc2ccent.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] --,cte_ccoll2ccent.[CostCenter_BK_nonConform] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_wh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh_c.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] ,cte_ccoll2ccentSource.[CostCenter_BK_nonConform] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_nonConform] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenter_BK_nonConform] and (cte_ccoll2ccent.[SourceSytem] = cte_prio.[SourceSystem] or '%' = cte_prio.[SourceSystem] ) /*CostElement conform to nonConform */ inner join [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl on cenc2ce_bl.[CostElementNonConform_HK] = pc.[CostElementByControllingArea_HK] inner join RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c on cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_ProfitCenter_V1_IDIM1;16979387;V ;VIEW;1955;/**/ /* View: V_ProfitCenter_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Profit Center Code for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface #0228 https://inside-docupedia.bosch.com/confluence/x/KcYxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_D7;17083497;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_D7 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_D7] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G4_DemoSystem;17643356;V ;VIEW;4559;/**/ /* View: V_FactActualCostMaintenanceOrder_G4_DemoSystem */ /**/ /**/ /* V01.00.03 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P81, but anonimized for DemoSystem purposes */ /* Changes: */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.02 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_O2;20507452;V ;VIEW;2115;/**/ /* View: V_COCostActualLineItemDelta_O2 */ /**/ /* =*/ /* V01.00.00 2022-07-06 Yannick Sigwalt GS/BDD2 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_O2_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Initial version copied from V_COCostActualLineItemDelta_O1 (V01.00.00) */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G0;24087572;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G0 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G0;27511527;V ;VIEW;15142;"/**/ /* View: V_INTF_PnL_G0 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_CorePredictivePnL_CSC2;92;INFormation Mart as Interface;V_INTF_DimDate;28071386;V ;VIEW;1240;/**/ /* View: V_INTF_DimDate */ /**/ /* =*/ /* V01.00.00 2021-12-20 Sanja Mihalic CI/XTD3 */ /* Data.CORE Outgoing Interface #0186 https://inside-docupedia.bosch.com/confluence/x/xujie */ /* Restrictions: */ /* Changes: */ /* V01.00.00 2021-12-20 Sanja Mihalic CI/XTD3 - initial */ /* =*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G4_DemoSystem;28579190;V ;VIEW;1104;
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_A4;32367530;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16586;"/**/ /* V01.04.00 2023-01-18 Yannick Sigwalt GS/BDD1 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* #FBI-SR-xxxxxxxxx CostElement conform to nonConform */ /* Update: */ /* Copied from ufn_Get Plan Cost_V3_IFCT0_D7 as of V01.04.00 2022-08-09 */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_A4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_A4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_A4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] --non-conform ,v_sr_ccentnc2ccent.[CostCenter_HK] as [CostCenter_HK_nonConform] ,v_sr_ccentnc2ccent.[CostCenter_BK] as [CostCenter_BK_nonConform] ,v_sr_ccentnc2ccent.[ControllingArea] as [ControllingArea_nonConform] --conform ,v_sr_ccentnc2ccent.[CostCenterConform_HK] as [CostCenterConform_HK] ,v_sr_ccentnc2ccent.[CostCenterConform_BK] as [CostCenterConform_BK] ,v_sr_ccentnc2ccent.[ControllingAreaConform] as [ControllingAreaConform] --Dimension ID ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccoll_wh.SourceSystem_BK = N'SAPP78' inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent --#FBI-SR-000000069 on v_sr_ccentnc2ccent.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] --,cte_ccoll2ccent.[CostCenter_BK_nonConform] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_wh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh_c.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] ,cte_ccoll2ccentSource.[CostCenter_BK_nonConform] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_nonConform] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenter_BK_nonConform] and (cte_ccoll2ccent.[SourceSytem] = cte_prio.[SourceSystem] or '%' = cte_prio.[SourceSystem] ) /*CostElement conform to nonConform */ inner join [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl on cenc2ce_bl.[CostElementNonConform_HK] = pc.[CostElementByControllingArea_HK] inner join RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c on cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G0;33083554;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G0 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G0] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G5;33643413;V ;VIEW;2634;/**/ /* View: V_FactActualCostMaintenanceOrder_G5 */ /**/ /**/ /* V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P87 */ /* Changes: */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_B2;36507509;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_B2 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G3_DemoSystem;37679282;V ;VIEW;1169;
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G1;40087629;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G1 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G1;43511584;V ;VIEW;15142;"/**/ /* View: V_INTF_PnL_G1 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_CorePredictivePnL_CSC2;92;INFormation Mart as Interface;V_INTF_REF_ExchangeRates_M2;44071443;V ;VIEW;10176;/**/ /* View: V_INTF_REF_ExchangeRates_M2 */ /**/ /* =*/ /* V01.00.00 2021-12-20 Sanja Mihalic CI/XTD3 */ /* Combination of views: */ /* 1. [BUSV_Reference_CSC1].[V_SR_CurrencyMgmtRates] V01.01.02 as of 2020-08-06 */ /* 2. [INFI_GSAccounting_CSC1].[V_INTF_REF_ExchangeRatesToEuro_M2] V01.00.00 as of 2020-08-18 */ /* This view delivers the exchange rates to PredictiveP&L */ /* Data.CORE Outgoing Interface #0185 https://inside-docupedia.bosch.com/confluence/x/lOTie */ /* Restrictions: */ /* Changes: */ /* V01.00.00 2021-12-20 Sanja Mihalic CI/XTD3 - initial */ /* =*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G5;44579247;V ;VIEW;663;
INFM_CorePredictivePnL_CSC2;28;INFormation Mart;V_AA_Output1;46167460;V ;VIEW;4013;/**/ /* View: V_TT_Output */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_H1;48367587;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16586;"/**/ /* V01.04.00 2023-01-18 Yannick Sigwalt GS/BDD1 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* #FBI-SR-xxxxxxxxx CostElement conform to nonConform */ /* Update: */ /* Copied from ufn_Get Plan Cost_V3_IFCT0_D7 as of V01.04.00 2022-08-09 */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_H1 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_H1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_H1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] --non-conform ,v_sr_ccentnc2ccent.[CostCenter_HK] as [CostCenter_HK_nonConform] ,v_sr_ccentnc2ccent.[CostCenter_BK] as [CostCenter_BK_nonConform] ,v_sr_ccentnc2ccent.[ControllingArea] as [ControllingArea_nonConform] --conform ,v_sr_ccentnc2ccent.[CostCenterConform_HK] as [CostCenterConform_HK] ,v_sr_ccentnc2ccent.[CostCenterConform_BK] as [CostCenterConform_BK] ,v_sr_ccentnc2ccent.[ControllingAreaConform] as [ControllingAreaConform] --Dimension ID ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccoll_wh.SourceSystem_BK = N'SAPPTH' inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent --#FBI-SR-000000069 on v_sr_ccentnc2ccent.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] --,cte_ccoll2ccent.[CostCenter_BK_nonConform] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_wh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh_c.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] ,cte_ccoll2ccentSource.[CostCenter_BK_nonConform] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_nonConform] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenter_BK_nonConform] and (cte_ccoll2ccent.[SourceSytem] = cte_prio.[SourceSystem] or '%' = cte_prio.[SourceSystem] ) /*CostElement conform to nonConform */ inner join [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl on cenc2ce_bl.[CostElementNonConform_HK] = pc.[CostElementByControllingArea_HK] inner join RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c on cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G1;49083611;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G1 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G1] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G6;49643470;V ;VIEW;2634;/**/ /* View: V_FactActualCostMaintenanceOrder_G6 */ /**/ /**/ /* V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P99 */ /* Changes: */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_OrganizationalOffice;50919353;V ;VIEW;2022;/**/ /* View: V_INTF_COOM_Costs_DIM_OrganizationalOffice */ /**/ /* =*/ /* V01.00.01 2020-11-30 Yannick Sigwalt GS/BDO12 */ /* This view provides the parent child hierarchy of Organization Office for TM1 */ /* Restriction: */ /* - only the actual Parent/child hierarchy is provided */ /* Changes: */ /* V01.00.01 : Ensured Dummy Value is available only once */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G0;52507566;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G0 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G1;54499473;V ;VIEW;1281;/**/ /* View: V_BridgeSparePartToFact_IDIM1_G1 */ /**/ /**/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P45 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G1] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Bridge Spare Part To Fact_IDIM1_G0 */ /**/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G2;56087686;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G2 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G2;59511641;V ;VIEW;15463;"/**/ /* View: V_INTF_PnL_G2 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G5_DemoSystem;60579304;V ;VIEW;1104;
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G0;62935596;V ;VIEW;2952;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 08.09.2022 13:52:56 */ /**/ /**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G0 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_LanguageCode_V2_IDIM1;64211479;V ;VIEW;1044;/**/ /* View: V_LanguageCode_V2_IDIM1 */ /**/ /* =*/ /* V01.00.01 2021-09-03 Yannick Sigwalt GS/BDD2 */ /* This view provide the list of LanguageCode for Costs Application */ /* Restriction: */ /* Update: */ /* V01.00.01 Switched view from fixed values to [MEAM_DataCORE_CSC1].[V_DataCOREDimensionLanguageCode] */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_A2;64367644;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17251;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_A2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_A2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_A2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) --,cte_SourceSystem as ( -- select top(1) [SourceSystem] -- from cte_PlanCost --) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G2;65083668;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G2 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G2] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_C7;65135723;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_C7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_OrganizationalOffice_ATTR;66919410;V ;VIEW;4969;/**/ /* View: V_INTF_COOM_Costs_DIM_OrganizationalOffice_ATTR */ /**/ /* =*/ /* V01.00.01 2020-11-30 Yannick Sigwalt GS/BDO12 */ /* This view provides the attributes of Organization Office for TM1 */ /* Restriction: */ /* Changes: */ /* V01.00.01 : Reworked View due to issues with Identification of correct description */ /* Ensured Dummy Value is available only once */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G1;68507623;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G1 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G2;70499530;V ;VIEW;1281;/**/ /* View: V_BridgeSparePartToFact_IDIM1_G2 */ /**/ /**/ /* V01.00.00 - 2021-11-25 Stephan Wund GS/BDD2 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P72 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G2] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Bridge Spare Part To Fact_IDIM1_G0 */ /**/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G3;72087743;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G3 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G3;75511698;V ;VIEW;15142;"/**/ /* View: V_INTF_PnL_G3 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_INTF_REF_ExchangeRatesToEuro_M2;78831543;V ;VIEW;2604;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 10/5/2021 8:34:26 PM */ /**/ /**/ /* View: V_INTF_REF_ExchangeRatesToEuro_M2 */ /**/ /* */ /* V01.00.00 2020-10-05 Sanja Mihalic CI/XTD3 */ /* This view delivers the exchange rates from X to EURO to GS SGnA */ /* Data.CORE Outgoing Interface #0175 https://inside-docupedia.bosch.com/confluence/x/nYWSd */ /* Restrictions: */ /* The exchanges Rates Type are read dynamically from */ /* Changes: */ /* - Copied from [INFI_GSAccounting_CSC1].[V_INTF_REF_ExchangeRatesToEuro_M2] V01.00.00 as of 2020-08-18*/ /* */
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G2;78935653;V ;VIEW;2604;/**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G2 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_B2;80367701;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17161;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_B2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G3;81083725;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G3 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G3] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_O5;81135780;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_O5 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G2;84507680;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G2 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G1;86499587;V ;VIEW;8044;/**/ /* View: V_Equipment_V3_IDIM1_G1 */ /**/ /*=*/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-09 Initial version copied from V_Equipment_V3_IDIM1_G0 */ /*=*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G4;88087800;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G4 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G4;91511755;V ;VIEW;15464;"/**/ /* View: V_INTF_PnL_G4 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G3;94935710;V ;VIEW;2604;/**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G3 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_B4;96367758;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17166;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_B4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G4;97083782;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G4 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G4] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_SL;97135837;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_SL */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G3;100507737;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G3 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G2;102499644;V ;VIEW;8046;/**/ /* View: V_Equipment_V3_IDIM1_G2 */ /**/ /*=*/ /* V01.00.00 - 2021-11-25 Stephan Wund GS/BDD2 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-09 Initial version copied from V_Equipment_V3_IDIM1_G0 */ /*=*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G5;104087857;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G5 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G5;107511812;V ;VIEW;15144;"/**/ /* View: V_INTF_PnL_G5 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_G7;110831657;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;10709;/**/ /* V01.00.00 2021-10-13 Martin Urban CI/XTD2 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of user function ufn_GetPlanCost_V2_IFCT0_D4 */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_G7 ( @year int ) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select [CostCollector_HK] ,[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ) ,CostCollectorCostCenter_WLNK0 as ( select [CostCollector_HK] ,[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pvh.[Version_ID_BK],'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] ,cast((pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pc.[TotalValueCOAreaCurrency] - pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[TotalValueObjectCurrency] - pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [VariableAmountObjectCurrency] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G4;110935767;V ;VIEW;2604;/**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G4 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D0;112367815;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_D0 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G5;113083839;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G5 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G5] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_B2;113135894;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_B2 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G4;116507794;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G4 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G1;118499701;V ;VIEW;3318;/**/ /* View: V_FunctionalLocation_IDIM1_G1 */ /**/ /*=*/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-26 - Initial version copied from V_Functional Location_IDIM1_G0 */ /*=*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G6;120087914;V ;VIEW;8563;/**/ /* View: V_WBSElement_V1_IDIM1_G6 */ /**/ /* =*/ /* V01.00.05 2023-07-31 Philipp Staiger GS/BDD1 */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0199 https://inside-docupedia.bosch.com/confluence/x/yRcjfg */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Restriction: */ /* only WBS-Elements having bookings in the R&D facts (actual or plan) are considered */ /* Changes: */ /* V01.00.05 - Changed mapping for CostCollector from PartnerObject to PlannedObject */ /* V01.00.04 - performance optimization - changed scalar to */ /* tabular function ufn_WBSElementToSAPExternalFormat */ /* V01.00.03 - optimized view + Added EndDating Satellite */ /* V01.00.02 - Added WBSElements for PlanCost & optimized view */ /* V01.00.01 - Added documentation for BR % SR, link for CostCenterResponsible */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_MD_GLAccount_G0;121311742;V ;VIEW;1955;/**/ /* View: V_INTF_MD_GLAccount_G0 */ /**/ /* */ /* V01.00.01 2022-03-24 Tina Fritz (GS/PBI-GE) */ /* Interface view to provide end-of-previous-month GL Account master data to GS Accounting */ /* Data.CORE Outgoing Interface #0208 https://inside-docupedia.bosch.com/confluence/x/6plxgg */ /* Update */ /* - V01.00.01: Update view name (2022-03-24, frt3ka) */ /* - V01.00.00: Created (2022-03-21, frt3ka) */ /* Restrictions: */ /* - only includes GL Account description in English language */ /* - GL Accounts valid as of end of previous month */ /* - only includes GL Accounts with Chart of Accounts 'RB1' */ /* */
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G0;123199539;V ;VIEW;1342;
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_G6;123511869;V ;VIEW;15140;"/**/ /* View: V_INTF_PnL_G6 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G5;126935824;V ;VIEW;2604;/**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G5 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D3;128367872;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16204;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Jakub Kozlowski */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Copied from D0 */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_D3 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D3_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D3_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G6;129083896;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G6 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G6] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G0;129135951;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G0 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G5;132507851;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G5 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefSourceSystem_V1_IREF0;133679624;V ;VIEW;2230;/**/ /* View: V_RefSourceSystem_V1_IREF0 */ /**/ /**/ /* V01.00.01 - 2020-10-07 - Andras Szivos CI/DAV2.3 */ /* Hard-coded reference view for SAP source systems and their SAP Web GUI URL */ /* Update: */ /* - V01.00.00: 2020-10-07 - SZA2SH - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G2;134499758;V ;VIEW;3318;/**/ /* View: V_FunctionalLocation_IDIM1_G2 */ /**/ /*=*/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-26 - Initial version copied from V_Functional Location_IDIM1_G0 */ /*=*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G6;139199596;V ;VIEW;1342;
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_S3;139511926;V ;VIEW;18642;"/**/ /* View: V_INTF_PnL_S3 */ /**/ /* =*/ /* V01.10.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.10.00 Corrected field Plant */ /* - V01.09.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-06 */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_FBI_MDS_CSC2;30;INFormation Mart as Interface;V_INFI_MDS_MD_Plant;140071785;V ;VIEW;1875;/**/ /* View: V_INFI_MDS_MD_Plant */ /**/ /* =*/ /* V01.00.01 2022-01-03 Yannick Sigwalt GS/BDD2 */ /* This view provide the necessary Plant Master Data for FBI-MDS */ /* Update: */ /* V01.00.01 - Updated view due to renaming of underlaying satellite */ /* Restriction: */ /* - none */ /* =*/
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CustomerNumberByCompanyCode_G6;142935881;V ;VIEW;2604;/**/ /* View: V_INTF_REF_CustomerNumberByCompanyCode_G6 */ /**/ /* =*/ /* V01.01.00 2021-09-02 Tatjana Derdus CI/BTM-AC1 */ /* This view provides the list of SAP Customer Numbers by Comapany Code for IFRS15 */ /* Data.CORE Outgoing Interface #0216 https://inside-docupedia.bosch.com/confluence/x/yK-th */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_G7;145083953;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_G7 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_G7] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G1;145136008;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G1 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemActualDelta_G6;148507908;V ;VIEW;1922;/**/ /* View: V_COPALineItemActualDelta_G6 */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_XX_L] */ /* to identify FiscalYearPeriod of newly loaded actual CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_A2;149275987;V ;VIEW;4912;/**/ /* View: V_FactActualCost_A2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultPriceVariance_V1_IFCT0_G0;152088028;V ;VIEW;7321;/**/ /* View: V_PlantResultPriceVariance_V1_IFCT0_G0 */ /**/ /* =*/ /* V01.00.02 2023-06-27 Stephan Wund GS/BDD1 & Sanja Mihalic (BD/XAD3) & Aman Kumar BD/XAD5 */ /* Fact View for Price Variances for Plant Result on Document ID and aggregated level */ /* Data.CORE Outgoing Interface #0336 https://inside-docupedia.bosch.com/confluence/x/4BnOq */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.02 2023-06-27 - Update due to name change of AccDocHeader satellite */ /* V01.00.01 2023-05-24 - Update due to HK change */ /* V01.00.00 2023-05-04 - Initial version */ /* =*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G0;155199653;V ;VIEW;673;
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_DimProduct_V1;155511983;V ;VIEW;6588;/**/ /* View: V_INTF_PNL_GM1_DimProduct_V1 */ /**/ /* */ /* V01.00.02 2023-02-22 URA1FE */ /* This view provides the product hierarchy and material data for Profit&Loss.GM1Analysis */ /* Moreover this view extracts master data from facts data, which is not recommended */ /* Data.CORE Outgoing Interface #0174 https://inside-docupedia.bosch.com/confluence/x/3BnAcw */ /* Changes: */ /* - V01.00.02 Added fields [ProductHierarchySubClassDescriptionInEnglish] and */ /* [ProductHierarchyClassDescriptionInEnglish] */ /* - V01.00.01 Removed PERIO and MaterialByDivisionAndProfitCenter_rank, added field WW02 */ /* - V01.00.00 Created View - initial version */ /* */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CompanyCode;157295670;V ;VIEW;1307;/* = */ /* V01.00.00 2020-04-15 Patrik Just CI/DAV2.3 */ /* This view formats the company code hierarchy especially for the comsumption in TM1 */ /* Update: */ /* - V01.00.00 - Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessView_MDS;158831828;V ;VIEW;2258;/**/ /* View: V_INTF_PNL_DIM_BusinessView_MDS */ /**/ /* = */ /* V01.00.02 2021-10-01 Hui Yang CI/XEF1 */ /* This view is used as INterface for TME P&L Series for the loading of the Parent/Child Hierarchy from FBI-MDS */ /* Soft Rule: */ /* Outgoing Interface #0040 - https://inside-docupedia.bosch.com/confluence/x/2KR9Vg */ /* Restriction: */ /* Update: */ /* V01.00.02 - Enhanced length of Child and Parent */ /* V01.00.01 - Added Hierarchy Field, Prefix BU_ is now added to every node except to root node */ /* - Removed Filter, the view now delivers all hierarchy in all edition */ /* = */
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_CostCenter;158935938;V ;VIEW;24347;/**/ /* View: V_INTF_DIM_CostCenter */ /**/ /* =*/ /* V01.00.00 2022-09-13 Jakub Kozlowski */ /* This view provides the parent-child-hierarchy of Cost Center related to PlantResult to TM1 */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2022-09-13 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G0;160367986;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G0 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_GK;161084010;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_GK */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_GK] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G2;161136065;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G2 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_D0;161643869;V ;VIEW;2263;/**/ /* View: V_FactActualCost_D0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_Book2ReportJournalEntriesAggregatedByCompCode_G0_V1_IFCT0;162516058;V ;VIEW;7388;/*=*/ /* View: V_Book2ReportJournalEntriesAggregatedByCompCode_G0_V1_IFCT0 */ /*=*/ /**/ /* V01.00.06 2023-06-27 Stephan Wund GS/BDD1 & Sanja Mihalic (BD/XAD3) & Tina Fritz (GS/PBI-GE) */ /* Interface view to provide Fact for B2R Journal Entries, aggregated by Company Code */ /* Data.CORE Outgoing Interface #0183 https://inside-docupedia.bosch.com/confluence/x/b4tTe */ /* Update */ /* - V01.00.06 - Update due to name change of AccDocHeader satellite (2023-06-27, WDU8FE) */ /* - V01.00.05 - Update due to HK change in G0 (2023-05-24, MIS3BG) */ /* - V01.00.04 - Update filter criteria for GL postings (2023-03-20, frt3ka) */ /* - V01.00.03 - Update according to change in #FBI-SR-000000077, version 1.0.3 (2023-02-03, frt3ka) */ /* - V01.00.02 - Update function calls according to Journal Entry filter logic change in #FBI-SR-000000076 (2023-01-30, frt3ka) */ /* - V01.00.01 - Replace scalar value function by table valued function (2022-08-19, frt3ka) */ /* - V01.00.00 - Created (2022-06-03, frt3ka) */ /* Update view name and ensure requested grouping by Company Code (2022-06-07, frt3ka) */ /* Add G0 to view name, add column DayOfEntry, consider load(end)date for BSAT (2022-06-09, frt3ka) */ /* Add column AggregationKey (2022-08-12, frt3ka) */ /* Restrictions */ /* - Consider reporting period until end of previous month (2022-06-22, frt3ka) */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_A2;164507965;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_A2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_B2;165276044;V ;VIEW;4912;/**/ /* View: V_FactActualCost_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultPriceVariance_V1_IFCT0_G4;168088085;V ;VIEW;7083;/**/ /* View: V_PlantResultPriceVariance_V1_IFCT0_G4 */ /**/ /* =*/ /* V01.00.02 2023-06-27 Stephan Wund GS/BDD1 & Sanja Mihalic (BD/XAD3) & Aman Kumar BD/XAD5 */ /* Fact View for Price Variances for Plant Result on Document ID and aggregated level */ /* Data.CORE Outgoing Interface #0336 https://inside-docupedia.bosch.com/confluence/x/4BnOq */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.02 2023-06-27 - Update due to name change of AccDocHeader satellite */ /* V01.00.01 2023-05-24 - Update due to HK change */ /* V01.00.00 2023-05-04 - Initial version */ /* =*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_Short_G6;171199710;V ;VIEW;673;
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_IDIM1_G0;171303820;V ;VIEW;5324;"/**/ /* View: V_MalfunctionNotification_IDIM1_G0 */ /**/ /*=*/ /* V01.02.00 - 2021-01-18 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_CostCenter_V4_IDIM1;172071899;V ;VIEW;32092;/**/ /* View: V_CostCenter_V4_IDIM1 */ /**/ /**/ /* V01.00.04 2022-01-05 Yannick Sigwalt GS/BDD2 & Martin Urban CI/XTD2 */ /* Dimensional View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0167 https://inside-docupedia.bosch.com/confluence/x/WGJNcg */ /* Update: */ /* - V01.00.04 reworked VIew due to changes in Raw Vault Layer */ /* - V01.00.03 Removed duplicates from CostCenterDimId */ /* - V01.00.00 Creation */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessView_MDS_ATTR;174831885;V ;VIEW;10086;/**/ /* View: V_INTF_PNL_DIM_BusinessView_MDS_ATTR */ /**/ /* =*/ /* V01.00.04 2021-10-01 Hui Yang CI/XEF1 */ /* This view provide the attributes for TM1 for P&L Application */ /* Outgoing Interface #0041 https://inside-docupedia.bosch.com/confluence/x/j6Z9Vg */ /* V01.00.04 - Enhanced Lenght of Element and removed GB_ from Division */ /* V01.00.03 - Enhanced Lenght of Caption description to 100 */ /* V01.00.02 - Corrected default value for IsDummy from 'N' to NULL */ /* V01.00.01 - Added Hierarchy Field, Prefix BU_ is now added to every node except to root node */ /* - Removed Filter, the view now delivers all hierarchy in all edition */ /* - Filtering out Record where Attribute is null */ /* =*/
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_CostCenter_ATTR;174935995;V ;VIEW;22480;/**/ /* View: V_INTF_DIM_CostCenter_ATTR */ /**/ /* =*/ /* V01.00.00 2022-09-16 Yannick Sigwalt */ /* This view provides the the attributes of Cost Center related to PlantResult to TM1. */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2022-09-13 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G1;176368043;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17165;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G1 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_O1;177084067;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_O1 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_O1] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G3;177136122;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G3 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_D4;177643926;V ;VIEW;2263;/**/ /* View: V_FactActualCost_D4 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PC4 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;ufn_getB2RJournalEntriesAccountingDocument_G0;178516115;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;7631;/**/ /* V01.00.06 2023-06-27 Stephan Wund GS/BDD1 Sanja Mihalic (BD/XAD3) & Tina Fritz (GS/PBI-GE) */ /* Table Valued Function to implement the following Book2Report Outgoing Interface: */ /* Data.CORE Outgoing Interface #0182 https://inside-docupedia.bosch.com/confluence/x/CCp3dw */ /* Update: */ /* - V01.00.06 - Update due to name change of AccDocHeader satellite (2023-06-27, WDU8FE) */ /* - V01.00.05 - Update due to HK change (2023-05-24, MIS3BG) */ /* - V01.00.04 - Update filter criteria for GL postings (2023-03-20, frt3ka) */ /* - V01.00.03 - Update according to change in #FBI-SR-000000077, version 1.0.3 (2023-02-03, frt3ka) */ /* - V01.00.02 - Update function calls according to Journal Entry filter logic change in #FBI-SR-000000076 (2023-01-30, frt3ka) */ /* - V01.00.01 - Replace scalar value function by table valued function (2022-08-19, frt3ka) */ /* Add column AggregationKey in return set (2022-08-29, frt3ka) */ /* - V01.00.00 - Created (2022-08-12, frt3ka) */ /* Fix in column UserName (2022-08-16, frt3ka) */ /**/ create function INFI_GSAccounting_CSC1.ufn_getB2RJournalEntriesAccountingDocument_G0 ( @AggregationKey nvarchar(33) ) RETURNS TABLE AS RETURN with cte_AccountingDocumentDetails AS ( SELECT 'SAPPOE|011' AS [SAPSystem] ,adh_wh.[CompanyCodeBK] AS [CompanyCode] ,EOMONTH(adhaa_ws.[DateTimeOfEntry]) AS [ReportingDate] ,usrb2rgac.AutomationCategory AS [AutomationCategoryID] ,usrb2rgrf.isReversal AS [IsReversal] ,DAY(adhaa_ws.[DateTimeOfEntry]) AS [DayOfEntry] /* to be verified if a concatenated string is the best choice here... */ , CONCAT( 'SAPPOE|011', '|', adh_wh.[CompanyCodeBK], '|', EOMONTH(adhaa_ws.[DateTimeOfEntry]), '|', usrb2rgac.AutomationCategory, '|', usrb2rgrf.isReversal, '|', DAY(adhaa_ws.[DateTimeOfEntry]) ) AS [AggregationKey] ,adh_wh.[FiscalYear_BK] AS [FiscalYear] ,adh_wh.[AccountingDocumentNumber_BK] AS [AccountingDocumentNumber] ,adha_bs.[AccountingDocumentItemsCount] AS [LineItemCount] ,adhaa_ws.[DocumentType] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,usrb2rgwtu.whitelistedOrAnonymizedUser AS [UserName] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentHeaderText] ,adhaa_ws.[SessionName] ,adhaa_ws.[LogicalSystem] ,adhaa_ws.[ReferenceDocumentNumber] ,adhaa_ws.[CrossCompanyDocumentNumber] FROM [BUSV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_BSAT0_G0_L] adha_bs INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws ON adha_bs.[AccountingDocumentHeader_HK] = adhaa_ws.[AccountingDocumentHeader_HK] INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G0] adh_wh ON adhaa_ws.[AccountingDocumentHeader_HK] = adh_wh.[AccountingDocumentHeader_HK] /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentType(adhaa_ws.[DocumentType]) usrb2rjefdt CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_TransactionCode( adhaa_ws.[TransactionCode], adhaa_ws.[DocumentType], adhaa_ws.[ReferenceDocumentNumber]) usrb2rjeftc CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentStatus(adhaa_ws.[DocumentStatus]) usrb2rjefds CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_UserName(adhaa_ws.[UserName]) usrb2rjefun CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentHeaderText(adhaa_ws.[DocumentHeaderText]) usrb2rjefdht CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_SessionName(adhaa_ws.[SessionName]) usrb2rjefsn CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_LogicalSystem(adhaa_ws.[LogicalSystem]) usrb2rjefls CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_ExcludeSpecialCombinations( adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[DocumentHeaderText]) usrb2rjefesc /* #FBI-SR-000000083: Reversal identification, https://inside-docupedia.bosch.com/confluence/x/O566gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetReversalFlag](adhaa_ws.[TransactionCode]) usrb2rgrf /* #FBI-SR-000000077: Determine Automation Category for Journal Entries, https://inside-docupedia.bosch.com/confluence/x/5CiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetAutomationCategory]( 'SAPPOE', adhaa_ws.[UserName], adhaa_ws.[SessionName], adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[CrossCompanyDocumentNumber]) usrb2rgac /* #FBI-SR-000000084: Get whitelisted technical user name or '***', https://inside-docupedia.bosch.com/confluence/x/Sp66gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetWhitelistedTechUser]('SAPPOE', adhaa_ws.[UserName]) usrb2rgwtu WHERE /* #FBI-SR-000000085: Classification of Accounting Documents in Vendor, Customer or GL Posting https://inside-docupedia.bosch.com/confluence/x/OW03gw */ adha_bs.[IsACustomerPosting] = 0 AND adha_bs.[IsAVendorPosting] = 0 /* consider as-is status (latest updates) */ AND adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND adha_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' /* consider reporting period until end of previous month */ AND adhaa_ws.[DateTimeOfEntry] <= EOMONTH(CURRENT_TIMESTAMP, -1) /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ AND usrb2rjefdt.isValidDocumentType = 1 AND usrb2rjeftc.isValidTransactionCode = 1 AND usrb2rjefds.isValidDocumentStatus = 1 AND usrb2rjefun.isValidUserName = 1 AND usrb2rjefdht.isValidDocumentHeaderText = 1 AND usrb2rjefsn.isValidSessionName = 1 AND usrb2rjefls.isValidLogicalSystem = 1 AND usrb2rjefesc.isValidSpecialCombination = 1 ) SELECT [AggregationKey] ,[SAPSystem] ,[CompanyCode] ,[ReportingDate] ,[AutomationCategoryID] ,[IsReversal] ,[DayOfEntry] ,[FiscalYear] ,[AccountingDocumentNumber] ,[LineItemCount] AS [NumOfAccountingDocumentLineItems] ,[DocumentType] ,[PostingDate] ,CAST([DateTimeOfEntry] as date) AS [EntryDate] ,[DateTimeOfEntry] ,[UserName] ,[TransactionCode] ,[DocumentHeaderText] ,[SessionName] ,[CrossCompanyDocumentNumber] FROM cte_AccountingDocumentDetails WHERE AggregationKey = @AggregationKey
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_B2;180508022;V ;VIEW;3383;/**/ /* View: V_COPlanCostsDelta_B2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_B4;181276101;V ;VIEW;4912;/**/ /* View: V_FactActualCost_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G1;181888015;V ;VIEW;3769;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G1 */ /*=*/ /**/ /* V01.00.00 - 2022-08-10 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP45 */ /* Update: */ /* - V01.00.00: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G1;182499929;V ;VIEW;8580;/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G1 */ /**/ /**/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* New view Dimension Maintenance based on optimized data model for SAPP45 */ /* Update: */ /* - V01.00.00: Initial version copied from V_MaintenanceOrder_V3_IDIM1_G0 */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultPriceVariance_V1_IFCT0_G5;184088142;V ;VIEW;7086;/**/ /* View: V_PlantResultPriceVariance_V1_IFCT0_G5 */ /**/ /* =*/ /* V01.00.02 2023-06-27 Stephan Wund GS/BDD1 & Sanja Mihalic (BD/XAD3) & Aman Kumar BD/XAD5 */ /* Fact View for Price Variances for Plant Result on Document ID and aggregated level */ /* Data.CORE Outgoing Interface #0336 https://inside-docupedia.bosch.com/confluence/x/4BnOq */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.02 2023-06-27 - Update due to name change of AccDocHeader satellite */ /* V01.00.01 2023-05-24 - Update due to HK change */ /* V01.00.00 2023-05-04 - Initial version */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Plant_M2;188071956;V ;VIEW;4676;/**/ /* View: V_INTF_MD_Plant_M2 */ /**/ /* = */ /* V01.01.01 2022-01-03 Yannick Sigwalt GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month plant master data to Optravis */ /* Data.CORE Outgoing Interface #0082 https://inside-docupedia.bosch.com/confluence/x/X7qOYQ */ /* Restrictions: */ /* - only includes plant description in English language */ /* - only includes plants which have status 40 or 49 (Released or Discontinuation) */ /* Changes: */ /* - V01.01.01 Reworked View due to changes in formating of Address */ /* Adapted due to changes in underlaying Raw Vault Model */ /* - V01.00.00 2020-03-16 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Currency;189295784;V ;VIEW;1973;"/* = */ /* V 01.04.00 2020-04-14 Patrik Just CI/DAV2.3 */ /* This view provide a ""pseudo"" currency hierarchy for TM1 */ /* Filter on Currency set according to TFS-Task-10445 */ /* - V01.04.00 - Replace existing nodes be new node Currency Total */ /* - V01.02.00 - Added Dummy NOde */ /* - V01.02.00 - Added GroupEUR Node */ /* - V01.02.00 - Added CompanyCodeCurrency Node */ /* - V01.02.00 - Added ReportingEntityCurrency Node */ /* - V01.03.00 - Removed 'Currency_Total' root node */ /* = */"
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_CostElement;190936052;V ;VIEW;13429;/**/ /* View: V_INTF_DIM_CostElement */ /**/ /* =*/ /* V01.00.00 2022-09-13 Jakub Kozlowski */ /* This view provides the parent-child-hierarchy of Cost Element related to PlantResult to TM1 */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2022-09-13 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G2;192368100;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17165;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_O2;193084124;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_O2 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_O2] */ /* */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G6;193136179;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G6 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G0;193643983;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from POE */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;FNT_INTF_COOM_Costs_DIM_CostCenter_bySystem_CDP;193800148;TF;SQL_TABLE_VALUED_FUNCTION;7444;"/* =*/ /* V01.00.06 2023-05-05 Ismail Okadia */ /* This function retrieves hierarchy info from different SAP systems depending on parameter */ /* passed. */ /* Parameters: @RootNode (hierarchyname), @SAPSystem */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 2022-11-07 Fixed sort order again */ /* V01.00.04 - Added sort order */ /* V01.00.03 - Added D3/4/7 */ /* V01.00.01 - Created new function returns table. */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_Costs_CDP_CSC1.FNT_INTF_COOM_Costs_DIM_CostCenter_bySystem_CDP ( @RootNode VARCHAR(50),@SAPSystem VARCHAR(25) ) RETURNS @rt TABLE ( h VARCHAR(25), c VARCHAR(100), p VARCHAR(100), valid_from VARCHAR(6), valid_to VARCHAR(6), Weight INT, Type VARCHAR(1), SortOrder INT, SAPSystem VARCHAR(25) ) AS BEGIN ;WITH h AS (SELECT * FROM [RAWV_RB_CSC1].[CostCenter_WHUB0]), s AS (SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_A2_X] --TT Iberia-PCE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_B2_X] --RBLA Americas-PS0 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_B4_X] --TT Americas-PTW UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_D0_X] --TT World-PTT UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_D3_X] --PT World-PPT UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_D4_X] --BT World-PC4 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_D7_X] --ETAS World-P42 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G0_X] --RBLA World-POE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G1_X] --CM World-P45 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G2_X] --AE&BST World-P72 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G3_X] --ED World-P79 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G4_X] --PS(GS) & BEGWorld-P81 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G5_X] --PS World-P87 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G6_X] --CC World-P99 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G7_X] --CRIPS World-PCR UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_GK_X] --CI World-P77 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_O1_X] --TT A/P -PTE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_O2_X] --BGSW World-PEI ), t AS (SELECT h.CostCenter_HK, h.ControllingArea_ID_BK, h.CostCenterID_BK, s.SAPSystem, s.Nodename_Root_BK, s.LoadEndDate, s.HashDiff, s.Nodename_Parent_BK, s.Nodename_Child_BK, s.Level1_HK, s.Level1_BK, s.Level2_HK, s.Level2_BK, s.Level3_HK, s.Level3_BK, s.Level4_HK, s.Level4_BK, s.Level5_HK, s.Level5_BK, s.Level6_HK, s.Level6_BK, s.Level7_HK, s.Level7_BK, s.Level8_HK, s.Level8_BK, s.Level9_HK, s.Level9_BK, s.Level10_HK, s.Level10_BK, s.Level11_HK, s.Level11_BK, s.Level12_HK, s.Level12_BK, s.Level13_HK, s.Level13_BK, s.Level14_HK, s.Level14_BK, s.Level1_Order, s.Level2_Order, s.Level3_Order, s.Level4_Order, s.Level5_Order, s.Level6_Order, s.Level7_Order, s.Level8_Order, s.Level9_Order, s.Level10_Order, s.Level11_Order, s.Level12_Order, s.Level13_Order, s.Level14_Order, s.Level, s.LevelHigher14, s.StatusCDC FROM h JOIN s ON s.CostCenter_HK = h.CostCenter_HK WHERE s.[LoadEndDate] = CAST('2999-12-31' AS DATETIME2) AND s.Nodename_Root_BK = @RootNode AND s.SAPSystem = @SAPSystem) INSERT @rt SELECT DISTINCT CAST([Nodename_Root_BK] AS NVARCHAR(30)) AS [Nodename_Root_BK], CAST(ISNULL(u.[Child], CONCAT([ca], '/', [centc])) AS NVARCHAR(24)) AS [Child], CAST(COALESCE(u.[Parent], '') AS NVARCHAR(24)) AS [Parent], 200501 AS [valid_from], 999912 AS [valid_to], u.gen AS [Weight], 'N' AS [Type], u.SortOrder, h.[SAPSystem] AS [SAPSystem] FROM t h CROSS APPLY ( VALUES (CAST(h.[Nodename_Root_BK] AS NVARCHAR(30)), NULL, 0, NULL, NULL, NULL), (h.[Level1_BK], CAST(h.[Nodename_Root_BK] AS NVARCHAR(30)), 1, h.[Level1_Order], NULL, NULL), (h.[Level2_BK], h.[Level1_BK], 2, h.[Level2_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level3_BK], h.[Level2_BK], 3, h.[Level3_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level4_BK], h.[Level3_BK], 4, h.[Level4_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level5_BK], h.[Level4_BK], 5, h.[Level5_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level6_BK], h.[Level5_BK], 6, h.[Level6_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level7_BK], h.[Level6_BK], 7, h.[Level7_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level8_BK], h.[Level7_BK], 8, h.[Level8_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level9_BK], h.[Level8_BK], 9, h.[Level9_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level10_BK], h.[Level9_BK], 10, h.[Level10_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level11_BK], h.[Level10_BK], 11, h.[Level11_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level12_BK], h.[Level11_BK], 12, h.[Level12_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level13_BK], h.[Level12_BK], 13, h.[Level13_Order], h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (h.[Level14_BK], h.[Level13_BK], 14, h.[Level14_Order] , h.[ControllingArea_ID_BK], h.[CostCenterID_BK]), (NULL, h.[Level14_BK], 14, NULL, h.[ControllingArea_ID_BK], h.[CostCenterID_BK]) ) AS u (Child, Parent, gen, SortOrder, ca, centc) WHERE u.[Parent] IS NOT NULL; RETURN; END;"
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;ufn_getB2RJournalEntriesDetailByCCAndReportingDate_G0;194516172;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;7228;/**/ /* V01.00.05 2023-06-27 Stephan Wund GS/BDD1 & Sanja Mihalic (BD/XAD3) & Tina Fritz (GS/PBI-GE) */ /* Table Valued Function to implement the following Book2Report Outgoing Interface: */ /* Data.CORE Outgoing Interface #0262 https://inside-docupedia.bosch.com/confluence/x/P7pEjw */ /* Update: */ /* - V01.00.05 - Update due to name change of AccDocHeader satellite (2023-06-27, WDU8FE) */ /* - V01.00.04 - Update due to HK change (2023-05-24, MIS3BG) */ /* - V01.00.03 - Update filter criteria for GL postings (2023-03-20, frt3ka) */ /* - V01.00.02 - Update according to change in #FBI-SR-000000077, version 1.0.3 (2023-02-03, frt3ka) */ /* - V01.00.01 - Update function calls according to Journal Entry filter logic change in #FBI-SR-000000076 (2023-01-30, frt3ka) */ /* - V01.00.00 - Created (2022-08-29, frt3ka) */ /**/ create function INFI_GSAccounting_CSC1.ufn_getB2RJournalEntriesDetailByCCAndReportingDate_G0 ( @CompanyCode nvarchar(4),@ReportingDate date ) RETURNS TABLE AS RETURN with cte_AccountingDocumentDetails AS ( SELECT 'SAPPOE|011' AS [SAPSystem] ,adh_wh.[CompanyCodeBK] AS [CompanyCode] ,EOMONTH(adhaa_ws.[DateTimeOfEntry]) AS [ReportingDate] ,usrb2rgac.AutomationCategory AS [AutomationCategoryID] ,usrb2rgrf.isReversal AS [IsReversal] ,DAY(adhaa_ws.[DateTimeOfEntry]) AS [DayOfEntry] ,adh_wh.[FiscalYear_BK] AS [FiscalYear] ,adh_wh.[AccountingDocumentNumber_BK] AS [AccountingDocumentNumber] ,adha_bs.[AccountingDocumentItemsCount] AS [LineItemCount] ,adhaa_ws.[DocumentType] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,usrb2rgwtu.whitelistedOrAnonymizedUser AS [UserName] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentHeaderText] ,adhaa_ws.[SessionName] ,adhaa_ws.[LogicalSystem] ,adhaa_ws.[ReferenceDocumentNumber] ,adhaa_ws.[CrossCompanyDocumentNumber] FROM [BUSV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_BSAT0_G0_L] adha_bs INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws ON adha_bs.[AccountingDocumentHeader_HK] = adhaa_ws.[AccountingDocumentHeader_HK] INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G0] adh_wh ON adhaa_ws.[AccountingDocumentHeader_HK] = adh_wh.[AccountingDocumentHeader_HK] /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentType(adhaa_ws.[DocumentType]) usrb2rjefdt CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_TransactionCode( adhaa_ws.[TransactionCode], adhaa_ws.[DocumentType], adhaa_ws.[ReferenceDocumentNumber]) usrb2rjeftc CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentStatus(adhaa_ws.[DocumentStatus]) usrb2rjefds CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_UserName(adhaa_ws.[UserName]) usrb2rjefun CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentHeaderText(adhaa_ws.[DocumentHeaderText]) usrb2rjefdht CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_SessionName(adhaa_ws.[SessionName]) usrb2rjefsn CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_LogicalSystem(adhaa_ws.[LogicalSystem]) usrb2rjefls CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_ExcludeSpecialCombinations( adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[DocumentHeaderText]) usrb2rjefesc /* #FBI-SR-000000083: Reversal identification, https://inside-docupedia.bosch.com/confluence/x/O566gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetReversalFlag](adhaa_ws.[TransactionCode]) usrb2rgrf /* #FBI-SR-000000077: Determine Automation Category for Journal Entries, https://inside-docupedia.bosch.com/confluence/x/5CiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetAutomationCategory]( 'SAPPOE', adhaa_ws.[UserName], adhaa_ws.[SessionName], adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[CrossCompanyDocumentNumber]) usrb2rgac /* #FBI-SR-000000084: Get whitelisted technical user name or '***', https://inside-docupedia.bosch.com/confluence/x/Sp66gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetWhitelistedTechUser]('SAPPOE', adhaa_ws.[UserName]) usrb2rgwtu WHERE /* #FBI-SR-000000085: Classification of Accounting Documents in Vendor, Customer or GL Posting https://inside-docupedia.bosch.com/confluence/x/OW03gw */ adha_bs.[IsACustomerPosting] = 0 AND adha_bs.[IsAVendorPosting] = 0 /* consider as-is status (latest updates) */ AND adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND adha_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' /* consider reporting period until end of previous month */ AND adhaa_ws.[DateTimeOfEntry] <= EOMONTH(CURRENT_TIMESTAMP, -1) /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ AND usrb2rjefdt.isValidDocumentType = 1 AND usrb2rjeftc.isValidTransactionCode = 1 AND usrb2rjefds.isValidDocumentStatus = 1 AND usrb2rjefun.isValidUserName = 1 AND usrb2rjefdht.isValidDocumentHeaderText = 1 AND usrb2rjefsn.isValidSessionName = 1 AND usrb2rjefls.isValidLogicalSystem = 1 AND usrb2rjefesc.isValidSpecialCombination = 1 ) SELECT [SAPSystem] ,[CompanyCode] ,[ReportingDate] ,[AutomationCategoryID] ,[IsReversal] ,[DayOfEntry] ,[FiscalYear] ,[AccountingDocumentNumber] ,[LineItemCount] AS [NumOfAccountingDocumentLineItems] ,[DocumentType] ,[PostingDate] ,CAST([DateTimeOfEntry] as date) AS [EntryDate] ,[DateTimeOfEntry] ,[UserName] ,[TransactionCode] ,[DocumentHeaderText] ,[SessionName] ,[CrossCompanyDocumentNumber] FROM cte_AccountingDocumentDetails WHERE [CompanyCode] = @CompanyCode AND [ReportingDate] = @ReportingDate
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_B4;196508079;V ;VIEW;3383;/**/ /* View: V_COPlanCostsDelta_B4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_D0;197276158;V ;VIEW;4917;/**/ /* View: V_FactActualCost_V2_D0 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G2;197888072;V ;VIEW;3771;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G2 */ /*=*/ /**/ /* V01.00.00 - 2022-08-10 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP72 */ /* Update: */ /* - V01.00.00: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G2;198499986;V ;VIEW;8576;/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G2 */ /**/ /**/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* New view Dimension Maintenance based on optimized data model for SAPP79 */ /* Update: */ /* - V01.00.00: Initial version copied from V_MaintenanceOrder_V3_IDIM1_G0 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_ECPCATotals_ALL;204072013;V ;VIEW;14720;/**/ /* View: V_INTF_PNL_FACT_ECPCATotals_ALL */ /**/ /**/ /* V00.00.07 2021-12-17 Yannick Sigwalt GS/BDD2 */ /* This view is to provide EC-PCA Totals transaction data from GLPCT table for all source systems */ /* Data.CORE Outgoing Interface #0157 https://inside-docupedia.bosch.com/confluence/x/W9bMc */ /* Consumed Softrules */ /* #FBI-SR-000000079 https://inside-docupedia.bosch.com/confluence/x/bnA0eg */ /* GL Account Hierarchy for Networking Capital (NWC) */ /* Restriction: */ /* Update: */ /* V01.00.07 Removed unnecessary columns */ /* Added Accoutn Hierarchy Level Columns */ /* V01.00.06 Updated Filtering through GL Account Hierarchy */ /* Added #FBI-SR-000000079 to get AccountGroup assignment */ /* V00.00.05 connected additional systems for EC-PCA */ /* V00.00.04B Added Filter on LOGSYS */ /* V00.00.03B Removed Filter on ProfitCenter Status = 40 */ /* V00.00.02B Changed composition of SOURCESYSTEM + AccountGroup */ /* V00.00.01B added AccountGroup + */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_ICPartner_ATTR;206831999;V ;VIEW;6740;"/**/ /* View: V_INTF_PNL_DIM_ICPartner_ATTR */ /**/ /* =*/ /* V01.00.03 2021-10-12 Hui Yang CI/XEF1 */ /* Interface provides attribute for ICPartner Dimension for TM1 */ /* Outgoing Interface #0144 https://inside-docupedia.bosch.com/confluence/x/OJqDZw */ /* Update: */ /* V01.00.04 - Added attribute ""HCLOrLCL"" for hierarchy ICPartner */ /* V01.00.03 - Deleted 'GB_' Prefix from ""DivisionFromSource"" */ /* V01.00.02 - Added Description_EN and Removed HCLOrLCL */ /* V01.00.01 - Removed Local Cpation_EN, Caption_DE, LocalCurrency */ /* - Added GB_ Prefix to Attribute DivisionFromSource */ /* Restriction: */ /* - none */ /* =*/"
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_CostElement_ATTR;206936109;V ;VIEW;21384;/**/ /* View: V_INTF_DIM_CostElement_ATTR */ /**/ /* =*/ /* V01.00.00 2022-09-13 Jakub Kozlowski */ /* This view provides the the attributes of Cost Center related to PlantResult to TM1. */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2022-09-13 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G3;208368157;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G3 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostCenter_V5_IDIM1;209084181;V ;VIEW;72517;/**/ /* View: V_CostCenter_V5_IDIM1 */ /**/ /**/ /* V01.06.09 2023-03-20 Yannick Sigwalt GS/BDD1 & Michal Erdman & Jakub Kozlowski & URA1FE */ /* Dimension for CostCenter for Costs Application for SSAS */ /* Data.CORE Outgoing Interface #0066 https://inside-docupedia.bosch.com/confluence/x/jE_IWg */ /* Restrictions */ /* - none */ /* Update: */ /* V01.06.09 2023-03-20 - updated cte_CostCenterHierSat, implement NonConform to Conform Cost Center */ /* V01.06.08 2023-01-17 - performance changes */ /* V01.06.07 2022-12-21 - rewrite parts of the code, added materialized hierarchy */ /* V01.06.06 2022-09-30 - performance optimization and description fix */ /* V01.06.05 2022-09-14 - Added Cost Center Hierarchies from P77, PTE, PEI */ /* Replaced CROSS JOINS with INNER JOINS for better readibility */ /* V01.06.04 2022-09-14 - Adjusted CostCenter hierarchy desriptions to use original language */ /* descriptions, if available (else use descriptions in default language 'DE' or 'EN') */ /* V01.06.03 Added additional joins to CostCenterGlobalHierarchy_BSATM_D7_X] to transform */ /* Non Conform Cost Center to Conform Cost Center */ /* V01.06.02 Added Cost Center Hierarchies from PCE, PC4, PR1, PTW, P42 and P74 */ /* V01.06.01 Added Cost Center Hierarchies from PTT, PS0, P45, P72, P79 and P99 */ /* V01.06.00 -Removed fields: ControllingAreaCode, OrganizationalLevelId, ValidFrom, ValidTo, */ /* CostCenterCategory, LogicalSystem, BWN, Edition, AlternateHierarchyArea, */ /* LockIndicatorForPlanPrimaryCosts,LockIndicatorForPlanSecondarycosts, CostCenterResponsible*/ /* SEGMENT, Segment2, Segment3, CostCenterType, CostCenterArea, ProductLevel1, ProductLevel2,*/ /* PrincipalLocation, WithPersonnel, BusinessUnit, CostCoordinator, ControllingDepartment, */ /* ConcatenateOrganizationalOfficeAndDescription, ResponsibleUserId, ResponsibleUserDomain, */ /* AdditionalLevels */ /* - added new data field: Functional Area */ /* V01.05.05 2022-02-23 FRI3SH added filter to not retrieve hierarchy for PT2 & Responsible Org. Office */ /* V01.05.04 2021-09-02 FRI3SH aded hierarchy PlantManagementAreaId --> Level 1, */ /* MainDepartmentId --> Level 2, */ /* DepartmentId --> Level 3, */ /* CostCenterGroupId --> Level 4, */ /* ShopfloorId --> Level 5, */ /* V01.05.03 2021-09-02 SYA8FE */ /* V01.05.03 Swicthed to V_DataCOREDimensionHierarchy for flexible hierarchy selection */ /* Added column HierarchySourceSystem to make hierarchy unique */ /* V01.05.02 Corrected issue with Organizational Office Description when 1 description is only valid */ /* 1 day and the new record is valid from that same day #70927 */ /* Added filtered hierarchies from P81 and P87 */ /* V01.05.01 Changed the way, hierarchy levels, both CostCenter and OrganizationalOffice are filled up */ /* Updated field calculation for Hierarchylevel */ /* Replaced fixed LanguageCode through [MEAM_DataCORE_CSC1].[V_DataCOREDimensionLanguageCode] */ /* V01.05.00 Added Organizational Office Hierarchy, updated ConcatenateCostCenterCodeAndDepartment */ /* Enhanced CostCenter Hierarchy Levels up to 14 level to match Org.Office hier */ /* Reworked view to separate basis attribute into a distinct cte and reorganized fields */ /* V01.04.00 Added Field as of User Story 34095 */ /* Resp.Org.-office, Cost Center Type, Cost Center Category, Overhead Group */ /* with personnel, Area (Production, QM,...), Principal Location */ /* implemented #FBI-SR-000000043 related to Business Division */ /* https://inside-docupedia.bosch.com/confluence/display/BID/%23FBI-SR-000000043 */ /* V01.03.00 Switched to new Hierarchical Satellite (Language + Fill up of Description) */ /* V01.03.00 Added Currency from Controlling Area instead of fixed value */ /* V01.02.01 Added COareaCurrency amd Rename CURRENCY to CompanyCodeCurrency */ /* V01.02.00 Added new attributes from FBI_MDS */ /* V01.01.01 Removed filter on assigned hierarchy level 1 */ /* V01.01.00 Added BusinessDivision, Plant and ResponsibleUserId from FBI-MDS */ /* V01.01.00 Added Text for Company Code from REF-MDS PT2 */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_C7;209136236;V ;VIEW;3391;/**/ /* View: V_COPlanCostsDelta_C7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;FNT_INTF_COOM_Costs_DIM_CostElement_bySystem_CDP;209800205;TF;SQL_TABLE_VALUED_FUNCTION;6747;"/* =*/ /* V01.03.00 2023-05-05 Ismail Okadia */ /* This function retrieves hierarchy info from different SAP systems depending on parameter */ /* passed. */ /* Parameters: @RootNode (hierarchyname), @SAPSystem */ /* Restriction: */ /* none */ /* Changes: */ /* V01.02.00 - Fixed sort levels . */ /* V01.01.00 - Fixed sort levels and added more levels added more systems. */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_Costs_CDP_CSC1.FNT_INTF_COOM_Costs_DIM_CostElement_bySystem_CDP ( @RootNode varchar(50),@SAPSystem VARCHAR(25) ) RETURNS @rt TABLE ( h VARCHAR(25), c VARCHAR(100), p VARCHAR(100), valid_from VARCHAR(6), valid_to VARCHAR(6), Weight INT, Type VARCHAR(1), SortOrder INT, SAPSystem VARCHAR(25) ) AS BEGIN ;WITH h AS (SELECT cemctcoa_bl.[CostElementByChartOfAccounts_HK],cebca_wh.[CostElement_ID_BK],cebca_wh.ControllingArea_ID_BK FROM [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] cemctcoa_bl ON cemctcoa_bl.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] ), s AS (SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_A2_X] --TT Iberia-PCE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_B2_X] --RBLA Americas-PS0 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_B4_X] --TT Americas-PTW UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D0_X] --TT World-PTT UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D3_X] --PT World-PPT UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D4_X] --BT World-PC4 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D7_X] --ETAS World-P42 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G0_X] --RBLA World-POE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G1_X] --CM World-P45 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G2_X] --AE&BST World-P72 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G3_X] --ED World-P79 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G4_X] --PS(GS) & BEGWorld-P81 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G5_X] --PS World-P87 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G6_X] --CC World-P99 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G7_X] --CRIPS World-PCR UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_GK_X] --CI World-P77 UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_O1_X] --TT A/P -PTE UNION ALL SELECT * FROM [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_O2_X] --BGSW World-PEI ), t AS (SELECT h.[ControllingArea_ID_BK], h.[CostElement_ID_BK], s.[Nodename_Root_BK], s.[Level1_BK], s.[Level2_BK], s.[Level3_BK], s.[Level4_BK], s.[Level5_BK], s.[Level6_BK], s.[Level7_BK], s.[Level8_BK], s.[Level9_BK], s.[Level10_BK], s.[Level11_BK], s.[Level12_BK], s.[Level13_BK], s.[Level14_BK], s.[Level1_Order], s.[Level2_Order], s.[Level3_Order], s.[Level4_Order], s.[Level5_Order], s.[Level6_Order], s.[Level7_Order], s.[Level8_Order], s.[Level9_Order], s.[Level10_Order], s.[Level11_Order], s.[Level12_Order], s.[Level13_Order], s.[Level14_Order], s.SAPSystem FROM h JOIN s ON s.[CostElementByChartOfAccounts_HK] = h.[CostElementByChartOfAccounts_HK] WHERE s.[LoadEndDate] = CAST('2999-12-31' AS DATETIME2) AND s.Nodename_Root_BK = @RootNode AND s.SAPSystem = @SAPSystem) INSERT @rt SELECT DISTINCT CAST([Nodename_Root_BK] AS NVARCHAR(30)) AS [Nodename_Root_BK], ISNULL(u.[Child], cente) AS [Child], CAST(COALESCE(u.[Parent], '') AS NVARCHAR(24)) AS [Parent], 200501 AS [valid_from], 999912 AS [valid_to], u.gen AS [Weight], 'N' AS [Type], u.sortOrder, u.[SAPSystem] AS [SAPSystem] FROM t h CROSS APPLY (VALUES (CAST(h.[Nodename_Root_BK] AS NVARCHAR(30)), NULL, 0, h.[Level1_Order], NULL, NULL), (h.[Level1_BK], CAST(h.[Nodename_Root_BK] AS NVARCHAR(30)), 1,h.[Level1_Order], NULL, NULL), (h.[Level2_BK], h.[Level1_BK], 1,h.[Level2_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level3_BK], h.[Level2_BK], 1,h.[Level3_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level4_BK], h.[Level3_BK], 1,h.[Level4_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level5_BK], h.[Level4_BK], 5,h.[Level5_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level6_BK], h.[Level5_BK], 1,h.[Level6_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level7_BK], h.[Level6_BK], 1,h.[Level7_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level8_BK], h.[Level7_BK], 1,h.[Level8_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level9_BK], h.[Level8_BK], 1,h.[Level9_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level10_BK], h.[Level9_BK], 1,h.[Level10_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level11_BK], h.[Level10_BK], 1,h.[Level11_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level12_BK], h.[Level11_BK], 1,h.[Level12_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level13_BK], h.[Level12_BK], 1,h.[Level13_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (h.[Level14_BK], h.[Level13_BK], 1,h.[Level14_Order], h.[CostElement_ID_BK],h.[SAPSystem]), (NULL, h.[Level14_BK], NULL, 1,h.[CostElement_ID_BK],h.[SAPSystem]) ) AS u (Child, Parent, gen, sortOrder, cente,SAPSystem) WHERE u.[Parent] IS NOT NULL; RETURN; END;"
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;ufn_getB2RJournalEntriesDetailByCCAndReportingDate_G0_V2;210516229;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;7581;/**/ /* V01.00.06 2023-07-04 Sanja Mihalic (BD/XAD3) & Tina Fritz (GS/PBI-GE) */ /* Table Valued Function to implement the following Book2Report Outgoing Interface: */ /* Data.CORE Outgoing Interface #0262 https://inside-docupedia.bosch.com/confluence/x/P7pEjw */ /* Update: */ /* - V01.00.06 - Update due to name change of AccDocHeader satellite (2023-07-04, WDU8FE) */ /* - V01.00.05 - Introduce V2 of TVF to allow dynamic month end slicer (2023-06-26, frt3ka) */ /* - V01.00.04 - Update due to HK change (2023-05-24, MIS3BG) */ /* - V01.00.03 - Update filter criteria for GL postings (2023-03-20, frt3ka) */ /* - V01.00.02 - Update according to change in #FBI-SR-000000077, version 1.0.3 (2023-02-03, frt3ka) */ /* - V01.00.01 - Update function calls according to Journal Entry filter logic change in #FBI-SR-000000076 (2023-01-30, frt3ka) */ /* - V01.00.00 - Created (2022-08-29, frt3ka) */ /**/ create function INFI_GSAccounting_CSC1.ufn_getB2RJournalEntriesDetailByCCAndReportingDate_G0_V2 ( @CompanyCode nvarchar(4),@ReportingDateStr nvarchar(8) ) RETURNS TABLE AS RETURN with cte_Date as ( SELECT CASE WHEN @ReportingDateStr = 'Last MEC' THEN EOMONTH(CURRENT_TIMESTAMP, -1) ELSE EOMONTH(CONVERT(date, @ReportingDateStr)) END AS [ReportingDate] ) , cte_AccountingDocumentDetails AS ( SELECT 'SAPPOE|011' AS [SAPSystem] ,adh_wh.[CompanyCodeBK] AS [CompanyCode] ,EOMONTH(adhaa_ws.[DateTimeOfEntry]) AS [ReportingDate] ,usrb2rgac.AutomationCategory AS [AutomationCategoryID] ,usrb2rgrf.isReversal AS [IsReversal] ,DAY(adhaa_ws.[DateTimeOfEntry]) AS [DayOfEntry] ,adh_wh.[FiscalYear_BK] AS [FiscalYear] ,adh_wh.[AccountingDocumentNumber_BK] AS [AccountingDocumentNumber] ,adha_bs.[AccountingDocumentItemsCount] AS [LineItemCount] ,adhaa_ws.[DocumentType] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,usrb2rgwtu.whitelistedOrAnonymizedUser AS [UserName] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentHeaderText] ,adhaa_ws.[SessionName] ,adhaa_ws.[LogicalSystem] ,adhaa_ws.[ReferenceDocumentNumber] ,adhaa_ws.[CrossCompanyDocumentNumber] FROM [BUSV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_BSAT0_G0_L] adha_bs INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws ON adha_bs.[AccountingDocumentHeader_HK] = adhaa_ws.[AccountingDocumentHeader_HK] INNER JOIN [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G0] adh_wh ON adhaa_ws.[AccountingDocumentHeader_HK] = adh_wh.[AccountingDocumentHeader_HK] /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentType(adhaa_ws.[DocumentType]) usrb2rjefdt CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_TransactionCode( adhaa_ws.[TransactionCode], adhaa_ws.[DocumentType], adhaa_ws.[ReferenceDocumentNumber]) usrb2rjeftc CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentStatus(adhaa_ws.[DocumentStatus]) usrb2rjefds CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_UserName(adhaa_ws.[UserName]) usrb2rjefun CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_DocumentHeaderText(adhaa_ws.[DocumentHeaderText]) usrb2rjefdht CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_SessionName(adhaa_ws.[SessionName]) usrb2rjefsn CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_LogicalSystem(adhaa_ws.[LogicalSystem]) usrb2rjefls CROSS APPLY [BUSV_Accounting_CSC1].ufn_SR_B2R_JournalEntryFilter_ExcludeSpecialCombinations( adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[DocumentHeaderText]) usrb2rjefesc /* #FBI-SR-000000083: Reversal identification, https://inside-docupedia.bosch.com/confluence/x/O566gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetReversalFlag](adhaa_ws.[TransactionCode]) usrb2rgrf /* #FBI-SR-000000077: Determine Automation Category for Journal Entries, https://inside-docupedia.bosch.com/confluence/x/5CiSdw */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetAutomationCategory]( 'SAPPOE', adhaa_ws.[UserName], adhaa_ws.[SessionName], adhaa_ws.[DocumentType], adhaa_ws.[TransactionCode], adhaa_ws.[CrossCompanyDocumentNumber]) usrb2rgac /* #FBI-SR-000000084: Get whitelisted technical user name or '***', https://inside-docupedia.bosch.com/confluence/x/Sp66gg */ CROSS APPLY [BUSV_Accounting_CSC1].[ufn_SR_B2R_GetWhitelistedTechUser]('SAPPOE', adhaa_ws.[UserName]) usrb2rgwtu WHERE /* #FBI-SR-000000085: Classification of Accounting Documents in Vendor, Customer or GL Posting https://inside-docupedia.bosch.com/confluence/x/OW03gw */ adha_bs.[IsACustomerPosting] = 0 AND adha_bs.[IsAVendorPosting] = 0 /* consider as-is status (latest updates) */ AND adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND adha_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' /* consider reporting period until end of previous month */ AND adhaa_ws.[DateTimeOfEntry] <= EOMONTH(CURRENT_TIMESTAMP, -1) /* #FBI-SR-000000076: Filter Journal Entries (JE) by relevant and pure B2R JE https://inside-docupedia.bosch.com/confluence/x/xyiSdw */ AND usrb2rjefdt.isValidDocumentType = 1 AND usrb2rjeftc.isValidTransactionCode = 1 AND usrb2rjefds.isValidDocumentStatus = 1 AND usrb2rjefun.isValidUserName = 1 AND usrb2rjefdht.isValidDocumentHeaderText = 1 AND usrb2rjefsn.isValidSessionName = 1 AND usrb2rjefls.isValidLogicalSystem = 1 AND usrb2rjefesc.isValidSpecialCombination = 1 ) SELECT [SAPSystem] ,[CompanyCode] ,cte_AccountingDocumentDetails.[ReportingDate] ,[AutomationCategoryID] ,[IsReversal] ,[DayOfEntry] ,[FiscalYear] ,[AccountingDocumentNumber] ,[LineItemCount] AS [NumOfAccountingDocumentLineItems] ,[DocumentType] ,[PostingDate] ,CAST([DateTimeOfEntry] as date) AS [EntryDate] ,[DateTimeOfEntry] ,[UserName] ,[TransactionCode] ,[DocumentHeaderText] ,[SessionName] ,[CrossCompanyDocumentNumber] FROM cte_AccountingDocumentDetails CROSS JOIN cte_Date WHERE [CompanyCode] = @CompanyCode AND cte_AccountingDocumentDetails.[ReportingDate] = cte_Date.ReportingDate
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_D0;212508136;V ;VIEW;3383;/**/ /* View: V_COPlanCostsDelta_D0 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_D3;213276215;V ;VIEW;4912;/**/ /* View: V_FactActualCost_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_A2;213888129;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15753;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 24.08.2022 16:12:01 */ /**/ /**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_A2 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_A2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_A2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G1;214500043;V ;VIEW;7279;/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G1 */ /**/ /*=*/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.00.00: 2020-11-25 Initial version copied from V_Malfunction Notification_V2_IDIM1_G0 */ /*=*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_COPA_I3;217312084;V ;VIEW;17812;/**/ /* View: V_INTF_PNL_FACT_COPA_I3 */ /**/ /* =*/ /* V01.00.02 2021-07-26 Yannick Sigwalt GS/BDO12, Patrik Just CI/BTM-FI1 */ /* Transactional data for TM1 */ /* Outgoing Interface #0056 https://inside-docupedia.bosch.com/confluence/x/C7t9Vg */ /* This select has been build upon the new Data Vault entities created for a PoC with the aim to optimize */ /* the data delivery to TM1 for CO-PA Data */ /* Special: */ /* The view transforms the source data from Keyfigure model to account based model */ /* -------------------------------------------------------------------------------------------------------- */ /* updated */ /* - 01.00.02 - Added Column RBELN and RPOSN */ /* - 01.00.01 - Replace CreationDateTime from Attribute Sat by Amount/Quantity Sat due to BugFix */ /* - 01.00.00 - Creation based on [INFI_TM1_CSC2].[V_INTF_PNL_FACT_CE10010_G0] */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_ECPCATotals;220072070;V ;VIEW;2009;/**/ /* View: V_INTF_PNL_FACT_ECPCATotals */ /**/ /**/ /* V00.00.02 2021-12-20 Yannick Sigwalt GS/BDD2 */ /* This view is to provide EC-PCA Totals transaction data from GLPCT table for all source systems */ /* relevant to PnL Series */ /* Data.CORE Outgoing Interface #0157 https://inside-docupedia.bosch.com/confluence/x/W9bMc */ /* Restriction: */ /* This view is simply meant to be used as interface view for TM1 in the case we need to implement */ /* a persistent table for Performance purposes */ /* Update: */ /* V01.00.02 Removed unnecessary columns */ /* Added Account Hierarchy Level Columns */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_ReportingEntity_ATTR;222832056;V ;VIEW;7923;"/**/ /* View: V_INTF_PNL_DIM_ReportingEntity_ATTR */ /**/ /* =*/ /* V01.00.05 2021-10-12 Hui Yang CI/XEF1 */ /* Interface provides attribute for ReportingEntity Dimension for TM1 */ /* Outgoing Interface #0144 https://inside-docupedia.bosch.com/confluence/x/8SRyZg */ /* Update: */ /* V01.00.05 - Added attribute ""HCLOrLCL"" for hierarchy ""Entity_Total"" and ""Total_Entity_Total_Cons"" */ /* V01.00.04 - Removed Prefix GB_ from DivisionFromSource */ /* V01.00.03 - Removed DivisionTopNode from _Elim and _Cons nodes */ /* V01.00.02 - Added Description_EN and Removed HCLOrLCL */ /* V01.00.01 - Removed Local Caption_EN, Caption_DE, LocalCurrency */ /* - Added GB_ Prefix to Attribute DivisionFromSource */ /* Restriction: */ /* - none */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G4;224368214;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_O5;225136293;V ;VIEW;3389;/**/ /* View: V_COPlanCostsDelta_O5 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G1;225644097;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G1 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P45 */ /* Changes: */ /* Restriction: */ /**/
INFI_eLake_CSC2;127;INFormation Mart as Interface;V_eLake_CostActual_V1_IFCT0;225800262;V ;VIEW;14763;/**/ /* View: V_eLake_CostActual_V1_IFCT0 */ /**/ /* =*/ /* V01.00.00 2023-04-26 Philipp Staiger GS/BDD1 */ /* Fact View for eLake Cost Actuals */ /* Data.CORE Outgoing Interface #0323 https://inside-docupedia.bosch.com/confluence/x/iJa7mw */ /* Implemented Soft Rules */ /* Statistical Indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_D1;228508193;V ;VIEW;3385;/**/ /* View: V_COPlanCostsDelta_D1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_D4;229276272;V ;VIEW;4912;/**/ /* View: V_FactActualCost_D4 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_B4;229888186;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15543;"/**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_B4 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G2;230500100;V ;VIEW;7279;/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G2 */ /**/ /*=*/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.00.00: 2020-11-25 Initial version copied from V_Malfunction Notification_V2_IDIM1_G0 */ /*=*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_O1;232700227;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3637;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_O1] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_O1] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_O1_X] cebcoagh_bs ---> currenctly it refrers to G0 as this object is not yet created in Data.CORE INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_COPA_O5;233312141;V ;VIEW;15693;/**/ /* View: V_INTF_PNL_FACT_COPA_O5 */ /**/ /* =*/ /* V01.00.02 2021-07-26 Yannick Sigwalt GS/BDO12, Patrik Just CI/BTM-FI1 */ /* Transactional data for TM1 */ /* Outgoing Interface #0056 https://inside-docupedia.bosch.com/confluence/x/C7t9Vg */ /* This select has been build upon the new Data Vault entities created for a PoC with the aim to optimize */ /* the data delivery to TM1 for CO-PA Data */ /* Special: */ /* The view transforms the source data from Keyfigure model to account based model */ /* -------------------------------------------------------------------------------------------------------- */ /* updated */ /* - 01.00.02 - Added Column RBELN and RPOSN */ /* - 01.00.01 - Replace CreationDataTime from Attribute Sat by Amount/Quantity Sat due to BugFix */ /* - 01.00.00 - Creation based on [INFI_TM1_CSC2].[V_INTF_PNL_FACT_CE10010_G0] */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_REF_GLAccountNWCVerification;236072127;V ;VIEW;1978;/**/ /* View: V_INTF_PNL_REF_GLAccountNWCVerification */ /**/ /**/ /* V01.00.01 2021-12-20 Yannick Sigwalt GS/BDD2 */ /* This view shall support PnL Series Team to verifiy the assignment of GL Accounts to AccountGroup */ /* for Networking Capital NWC */ /* This view consumes softrule: */ /* #FBI-SR-000000079 https://inside-docupedia.bosch.com/confluence/x/bnA0eg */ /* Restriction: */ /* none */ /* Update: */ /* V01.00.01: Updated view due to clarification in source view */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;usp_DeltaLoad_INTF_PNL_FACT_ECPCA_CS_V2;239704302;P ;SQL_STORED_PROCEDURE;34494;"/* =*/ /* V01.00.06 2023-03-31 Ilja Frolov GS/BDD1, Yannick Sigwalt GS/BDD1 & Patrik Just CI/DAV2.3 */ /* This Stored Procedure for incremental loading of P&L.Series Persisted Fact Data of EC-PCA */ /* Outgoing Interface #0057 https://inside-docupedia.bosch.com/confluence/x/e8J9Vg */ /* Restriction: */ /* - Tailored loading for P&L.Series only */ /* - Fact table contains limited data set for selected accounts only (RB-E-XBIT account hierarchy) */ /* - Covered sources: G0:G6, I3, O5, S3, B2 */ /* - Used for loading of P&L.Series Input Cube and Dillthrough from application to Data.CORE */ /* - No reuse without alignment with P&L.Series application */ /* Update: */ /* - V01.00.06 Changed WBSElement to internal */ /* - V01.00.05: - removed loading of C3 */ /* - implemented reload capabilities with reversal record */ /* - Corrected behavior that Customer and WBS Element were only delivered for POE instead of */ /* all systems */ /* - V01.00.04: Implemented filter on RB_E_XBIT #FBI-SR-000000070 & #FBI-SR-000000071 */ /* - V01.00.03: Removed Filter on ProfitCenter Status = 40 */ /* - V01.00.02: Fix wrong precision for amount columns */ /* - V01.00.01: Increase precision for amount columns to decimal (18,5) */ /* - V01.00.00: Initial version */ /* =*/ create procedure INFI_TM1_CSC2.usp_DeltaLoad_INTF_PNL_FACT_ECPCA_CS_V2 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* Start definition of Parameeter for test execution */ /* Comment/Uncomment for testng Purposes*/ --DECLARE @DeltaTimestampFrom datetime2 = '2022-11-08 00:00:00.0000000' --DECLARE @DeltaTimestampTo datetime2 = '2999-12-31 23:59:00.0000000' --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int --; --/* End definition of Parameter for test execution */ DECLARE @RowsInStageTable int = 0; /* ------------------------------------------------------ */ -- Step 1 | Get EC-PCA Hashkeys for all delta timestamps /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #temp_deltaHKlist CREATE TABLE #temp_deltaHKlist ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[ECPCA_Item_HK] binary(20) ,[LoadDate] datetime2 ); -- Step 1.2 Save the timestamps in temp table INSERT INTO #temp_deltaHKlist SELECT * FROM ( SELECT NULL as Source, NULL as SAPSystem, NULL as ECPCA_Item_HK, NULL as LoadDate UNION ALL SELECT 'B2', N'SAPPS0', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_B2_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G0', N'SAPPOE', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_WSAT0_G0_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' -- --> AND CAST((([CreationTimestamp] AT TIME ZONE 'Central European Standard Time') AT TIME ZONE 'UTC') as datetime2) between @CreationTimestampFrom and @CreationTimestampTo -- --> UTC Conversion as Performance Killer UNION ALL SELECT 'G1', N'SAPP45', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G1_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G2', N'SAPP72', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G2_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G3', N'SAPP79', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G3_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G4', N'SAPP81', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G4_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G5', N'SAPP87', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G5_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'G6', N'SAPP99', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_G6_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT 'S3', N'SAPP66', [ECPCA_Item_HK], [LoadDate] FROM [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_S3_X] WHERE 1=1 AND [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo AND [LoadEndDate] = '2999-12-31 00:00:00.0000000' ) temp_deltaHKlist; -- Step 1.3 Create index for temp table to support following joins CREATE NONCLUSTERED INDEX IX_#temp_deltaHKlist ON #temp_deltaHKlist (ECPCA_Item_HK); /* ------------------------------------------------------ */ -- Step 2 | Get all Hub data delta timestamps /* ------------------------------------------------------ */ -- Step 2.1 Write hub data into temp table DROP TABLE IF EXISTS #temp_hub_data; with cte_profitcenter_info as ( SELECT [ProfitCenter_HK] ,[ProfitCenter_BK] ,CONCAT('BU_', [ProfitCenter_BK]) as [ProfitCenter] ,(CASE WHEN [BusinessDivisionCode] IS NULL THEN NULL ELSE CONCAT('GB_', [BusinessDivisionCode]) END) as [RepGB] ,[Edition] ,[StateDateFrom] ,[StateDateTo] FROM ( SELECT pc_wh.[ProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] ,pca_ws.[BusinessDivisionCode] ,pca_ws.[BusinessUnitCode] ,pca_ws.[Edition] ,pca_ws.[StateDateFrom] ,pca_ws.[StateDateTo] ,ROW_NUMBER() OVER (PARTITION BY pc_wh.[ProfitCenter_BK] ORDER BY pca_ws.[StateDateFrom] DESC ) as [LatestRecord] FROM [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh LEFT JOIN [RAWV_RB_CSC1].[ProfitCenterAttribute_WSATM_M2_X] pca_ws ON pca_ws.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] AND pca_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000'-- Filter 'AsIs' state WHERE 1=1 /* template to filter bitemporal data*/ AND pca_ws.[StateDateFrom] <= CURRENT_TIMESTAMP -- Start date is not in future AND pca_ws.[StateDateTo] >= CURRENT_TIMESTAMP -- End date is in future -- AND pca_ws.Status = 40 -- State for valid records from business point of view ) q1 WHERE q1.[LatestRecord] = 1 -- Filter on latest is necessary due to data quality in ProfitCenterAttribute_WSATM_M2_X. Time line is not valid. ) ,cte_customer_info as ( SELECT c2rbc_st_wlnk.[Customer_HK] ,[Customer_BK] ,rbc_wh.[RBCustomer_BK] ,ca_ws.[Country] FROM ( SELECT [RBCustomer_HK] ,[Customer_HK] FROM [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WLNK0] c2rbc_st_wlnk INNER JOIN [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WSATE_G0_L] c2rbc_st_wsat_e ON c2rbc_st_wsat_e.[CustomertoRBCustomerSoldTo_HK] = c2rbc_st_wlnk.[CustomertoRBCustomerSoldTo_HK] AND c2rbc_st_wsat_e.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) c2rbc_st_wlnk INNER JOIN RAWV_RB_CSC1.RBCustomer_WHUB0 rbc_wh ON c2rbc_st_wlnk.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] INNER JOIN RAWV_RB_CSC1.Customer_WHUB0 c_wh ON c2rbc_st_wlnk.Customer_HK = c_wh.[Customer_HK] INNER JOIN RAWV_RB_CSC1.CustomerAttribute_WSAT0_G0_X ca_ws ON ca_ws.[Customer_HK] = c_wh.[Customer_HK] AND ca_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION ALL SELECT CAST('' AS BINARY(20)),'', '','' -- add GhostRecord for Customer value Empty String without RB Customer relation ) SELECT ecpca_wh.[ECPCA_Item_HK] as [ECPCA_Item_HK] ,ecpca_wh.[SAPSystem] as [SAPSystem] ,Concat(substring(ecpca_wh.[SAPSystem],4,3),'011') as [SAPSystemClient] ,ecpca_wh.[DocumentNumberBK] as [DocumentNumber] ,ecpca_wh.[DocumentLineNumberBK] as [DocumentLineNumber] ,IIF( compc_wh.[CompanyCode_BK] = '','',CONCAT('CC_', compc_wh.[CompanyCode_BK]) ) as [CompanyCode] ,cte_profitcenter_info.[ProfitCenter] as [ProfitCenter] ,cte_profitcenter_info.[RepGB] as [DivisionFromSource] ,v_srglah.[GLAccount_BK] as [GLAccount] ,COALESCE(v_srglah.[Level5],v_srglah.[Level4], v_srglah.[Level3],v_srglah.[Level2],v_srglah.[Level1]) as [AccountGroup] ,IIF(p_wh.[Plant_BK] is NULL,NULL,CONCAT('PL_', p_wh.[Plant_BK]) ) as [WERKS] ,m_wh.[Material_BK] as [ARTNR] --,cte_customer_info.[Customer_BK] as [DebitorSoldTo] ,ecpca2customer_wl.[Customer_HK] as [DebitorSoldTo_HK] --,cte_customer_info.[Country] as [LAND1] --,cte_customer_info.[RBCustomer_BK] as [RBCustomerNumber] ,ccent_wh.[CostCenterID_BK] as [SKOST] ,cast(wbse_wh.[WBSElement_BK] as nvarchar(50)) as [PSPNR] -- Internal Number /* ATTENTION: NEW TEMP TABLE WILL BE USED TO STORE THE DATA */ INTO #temp_hub_data FROM #temp_deltaHKlist INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_WHUB0] ecpca_wh on ecpca_wh.[SAPSystem] = #temp_deltaHKlist.[SAPSystem] COLLATE Latin1_General_CS_AS and ecpca_wh.[ECPCA_Item_HK] = #temp_deltaHKlist.[ECPCA_Item_HK] /*GL Account*/ INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToGLAccount_WLNK0] ecpca2Account on ecpca2Account.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] INNER JOIN [BUSV_Accounting_MD_CSC1].[V_SR_GLAccountHierarchy_RB_E_XBIT_G0] v_srglah on v_srglah.[GLAccount_HK] = ecpca2Account.[GLAccount_HK] /*Profit Center*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToProfitCenter_WLNK0] ecpca2prctr ON ecpca2prctr.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN cte_profitcenter_info ON cte_profitcenter_info.[ProfitCenter_HK] = ecpca2prctr.[ProfitCenter_HK] /*Company Code*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToCompanyCode_WLNK0] ecpca2compc_wl ON ecpca2compc_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh ON compc_wh.[CompanyCode_HK] = ecpca2compc_wl.[CompanyCode_HK] /*Customer*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToCustomer_WLNK0] ecpca2customer_wl ON ecpca2customer_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] /*Plant*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToPlant_WLNK0] ecpca2p_wl ON ecpca2p_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN [RAWV_RB_CSC1].[Plant_WHUB0] p_wh ON p_wh.[Plant_HK] = ecpca2p_wl.[Plant_HK] /*Material*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToMaterial_WLNK0] ecpca2m_wl ON ecpca2m_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = ecpca2m_wl.[Material_HK] /*Cost Center*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToCostCenter_WLNK0] ecpca2ccent_wl ON ecpca2ccent_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ecpca2ccent_wl.[CostCenter_HK] /*WBS Element*/ LEFT JOIN [RAWV_ECPCA_CSC2].[ECPCA_ItemToWBSElement_WLNK0] ecpca2wbse_wl ON ecpca2wbse_wl.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] LEFT JOIN [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh ON wbse_wh.[WBSElement_HK] = ecpca2wbse_wl.[WBS_Element_HK] --LEFT JOIN [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2bv_wl --on wbsesapi2bv_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] --LEFT JOIN [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh --on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = wbsesapi2bv_wl.[WBSElementBusinessView_WHUB0_HK] ; -- Step 2.1 Create index to support joins CREATE CLUSTERED INDEX ix_#temp_hub_data ON #temp_hub_data (ECPCA_Item_HK); /* ------------------------------------------------------ */ -- Step 3 | Join the Hub data with the Sat data /* ------------------------------------------------------ */ -- Create #temp_result_raw DROP TABLE IF EXISTS #temp_result_raw; CREATE TABLE #temp_result_raw ( [SourceId] varchar(2) ,[ECPCA_Item_HK] binary(20) ,[SAPSystem] nvarchar(10) ,[SAPSystemClient] nvarchar(10) ,[DocumentNumber] nvarchar(20) ,[DocumentLineNumber] integer ,[CompanyCode] nvarchar(20) ,[ProfitCenter] nvarchar(20) ,[DivisionFromSource] nvarchar(20) ,[GLAccount] nvarchar(20) ,[AccountGroup] nvarchar(48) ,[WERKS] nvarchar(14) ,[ARTNR] nvarchar(36) ,[DebitorSoldTo] nvarchar(20) ,[LAND1] nvarchar(6) ,[RBCustomerNumber] nvarchar(20) ,[SKOST] nvarchar(20) ,[PSPNR] nvarchar(48) ,[GYear] integer ,[PERIO] int ,[BUDAT] char(10) ,[HZDAT_TIMESTAMP] datetime2 ,[CurrencyCodeTransaction] char(3) ,[AmountTransactionCurrency] decimal(18,5) ,[CurrencyCodeCompanyCode] char(3) ,[AmountCompanyCodeCurrency] decimal(18,5) ,[RKAUFNR] nvarchar(12) ,[LoadDateDVSat] datetime2 ,[ReverseFlag] smallint ) -- Step 3.1 Sepcify temp table for iteration DROP TABLE IF EXISTS #source_list; SELECT * INTO #source_list FROM (VALUES ('B2','SAPPS0','PS0011', 1) ,('G0','SAPPOE','POE011', 0) -- POE is queried by fixed statement ,('G1','SAPP45','P45011', 1) ,('G2','SAPP72','P72011', 1) ,('G3','SAPP79','P79011', 1) ,('G4','SAPP81','P81011', 1) ,('G5','SAPP87','P87011', 1) ,('G6','SAPP99','P99011', 1) ,('S3','SAPP66','P66011', 1) ,('I3','SAPGP1','GP1401', 0) -- GP1 is consumed via access Layer view as it is expected that the AS systems are not long lived anymore.... ,('O5','SAPGP7','GP7470', 0) -- GP1 is consumed via access Layer view as it is expected that the AS systems are not long lived anymore.... ) t1 ([SourceId], [SAPSystem], [SAPSystemClient], [State]) -- Declare cursor time variables DECLARE @DeltaTimestampFromCursor datetime2 = @DeltaTimestampFrom --'2021-01-31 00:00:0' DECLARE @DeltaTimestampToCursor datetime2 = @DeltaTimestampTo --'2021-02-03 23:59:0' -- Fixed Insert for G0 only because satellite structure is different from other BBM systems INSERT INTO #temp_result_raw SELECT 'G0' AS SourceId ,ecpca_wh.[ECPCA_Item_HK] ,ecpca_wh.[SAPSystem] ,ecpca_wh.[SAPSystemClient] ,ecpca_wh.[DocumentNumber] ,ecpca_wh.[DocumentLineNumber] ,ecpca_wh.[CompanyCode] ,ecpca_wh.[ProfitCenter] ,ecpca_wh.[DivisionFromSource] ,ecpca_wh.[GLAccount] ,ecpca_wh.[AccountGroup] ,ecpca_wh.[WERKS] ,ecpca_wh.[ARTNR] ,ss_Customer.[Customer_BK] as [DebitorSoldTo] ,ss_Customer.[Country] as [LAND1] ,ss_Customer.[RBCustomer_BK] as [RBCustomerNumber] ,ecpca_wh.[SKOST] ,ecpca_wh.[PSPNR] ,ecpcaif_ws.[FiscalYearInteger] as [GYear] ,ecpcaif_ws.[PostingYearPeriod] as [PERIO] ,CONVERT( CHAR(10), ecpcaif_ws.[PostingDateDocument], 112) as [BUDAT] -- Return type 112 = YYYYMMDD ,CAST(((ecpcaif_ws.[CreationTimestamp] AT TIME ZONE 'Central European Standard Time') AT TIME ZONE 'UTC') as datetime2) as [HZDAT_TIMESTAMP] ,ecpcaif_ws.[CurrencyCodeTransaction] ,ecpcaif_ws.[AmountTransactionCurrency] ,ecpcaif_ws.[CurrencyCodeCompanyCode] ,ecpcaif_ws.[AmountCompanyCodeCurrency] ,ecpcaif_wsj.[AUFNR] as [RKAUFNR] ,ecpcaifc_ws.[LoadDate] as [LoadDateDVSat] ,0 as [ReverseFlag] FROM #temp_hub_data ecpca_wh INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_WSAT0_G0_X] ecpcaif_ws ON ecpcaif_ws.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaif_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_Characteristics_WSAT0_G0_X] ecpcaifc_ws ON ecpcaifc_ws.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaifc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' INNER JOIN [RAWV_ECPCA_CSC2].ECPCA_Item_Fact_WSATJ_G0_X ecpcaif_wsj ON ecpcaif_wsj.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaif_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' /* retrieve Customer and RB Customer information from POE */ left join ( SELECT c2rbc_st_wlnk.[Customer_HK] ,[Customer_BK] ,rbc_wh.[RBCustomer_BK] ,ca_ws.[Country] FROM ( SELECT [RBCustomer_HK] ,[Customer_HK] FROM [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WLNK0] c2rbcst_wl INNER JOIN [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WSATE_G0_L] c2rbcst_ws ON c2rbcst_ws.[CustomertoRBCustomerSoldTo_HK] = c2rbcst_wl.[CustomertoRBCustomerSoldTo_HK] AND c2rbcst_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) c2rbc_st_wlnk INNER JOIN [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh ON c2rbc_st_wlnk.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] INNER JOIN [RAWV_RB_CSC1].[Customer_WHUB0] c_wh ON c2rbc_st_wlnk.Customer_HK = c_wh.[Customer_HK] INNER JOIN [RAWV_RB_CSC1].[CustomerAttribute_WSAT0_G0_X] ca_ws ON ca_ws.[Customer_HK] = c_wh.[Customer_HK] AND ca_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_Customer on ss_Customer.[Customer_HK] = ecpca_wh.[DebitorSoldTo_HK] ; DECLARE @SourceId VARCHAR(2), @SAPSystem VARCHAR(6), @SAPSystemClient VARCHAR(6) ; DECLARE source_list_cursor CURSOR FOR SELECT SourceId, SAPSystem, SAPSystemClient FROM #source_list where State = 1 OPEN source_list_cursor; FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient WHILE @@FETCH_STATUS = 0 BEGIN DECLARE @SQL nvarchar(max) SET @SQL = ' INSERT INTO #temp_result_raw SELECT '''+ @SourceId + ''' as [SourceId] ,ecpca_wh.[ECPCA_Item_HK] ,ecpca_wh.[SAPSystem] ,ecpca_wh.[SAPSystemClient] ,ecpca_wh.[DocumentNumber] ,ecpca_wh.[DocumentLineNumber] ,ecpca_wh.[CompanyCode] ,ecpca_wh.[ProfitCenter] ,ecpca_wh.[DivisionFromSource] ,ecpca_wh.[GLAccount] ,ecpca_wh.[AccountGroup] ,ecpca_wh.[WERKS] ,ecpca_wh.[ARTNR] ,ss_Customer.[Customer_BK] as [DebitorSoldTo] ,ss_Customer.[Country] as [LAND1] ,ss_Customer.[RBCustomer_BK] as [RBCustomerNumber] ,ecpca_wh.[SKOST] ,ecpca_wh.[PSPNR] ,ecpcaif_ws.[FiscalYearInteger] as [GYear] ,ecpcaif_ws.[PostingYearPeriod] as [PERIO] ,CONVERT( CHAR(10), ecpcaif_ws.[PostingDateDocument], 112) as [BUDAT] -- Return type 112 = YYYYMMDD ,ecpcaifc_ws.[CreationTimestampUTC] as [HZDAT_TIMESTAMP] ,ecpcaif_ws.[CurrencyCodeTransaction] ,ecpcaif_ws.[AmountTransactionCurrency] ,ecpcaif_ws.[CurrencyCodeCompanyCode] ,ecpcaif_ws.[AmountCompanyCodeCurrency] ,ecpcaif_wsj.[AUFNR] as [RKAUFNR] ,ecpcaifc_ws.[LoadDate] as [LoadDateDVSat] ,0 as [ReverseFlag] FROM #temp_hub_data ecpca_wh INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSAT0_'+@SourceId+'_X] ecpcaif_ws ON ecpcaif_ws.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaif_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_Characteristics_AccountFilter_WSAT0_'+@SourceId+'_X] ecpcaifc_ws ON ecpcaifc_ws.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaifc_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_ECPCA_CSC2].[ECPCA_Item_Fact_AccountFilter_WSATJ_'+@SourceId+'_X] ecpcaif_wsj ON ecpcaif_wsj.[ECPCA_Item_HK] = ecpca_wh.[ECPCA_Item_HK] AND ecpcaif_wsj.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' /* retrieve Customer and RB Customer information from system */ left join ( SELECT c2rbc_st_wlnk.[Customer_HK] ,[Customer_BK] ,rbc_wh.[RBCustomer_BK] ,ca_ws.[Country] FROM ( SELECT [RBCustomer_HK] ,[Customer_HK] FROM [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WLNK0] c2rbcst_wl INNER JOIN [RAWV_RB_CSC1].[CustomertoRBCustomerSoldTo_WSATE_G0_L] c2rbcst_ws ON c2rbcst_ws.[CustomertoRBCustomerSoldTo_HK] = c2rbcst_wl.[CustomertoRBCustomerSoldTo_HK] AND c2rbcst_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ) c2rbc_st_wlnk INNER JOIN [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh ON c2rbc_st_wlnk.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] INNER JOIN [RAWV_RB_CSC1].[Customer_WHUB0] c_wh ON c2rbc_st_wlnk.Customer_HK = c_wh.[Customer_HK] INNER JOIN [RAWV_RB_CSC1].[CustomerAttribute_WSAT0_G0_X] ca_ws ON ca_ws.[Customer_HK] = c_wh.[Customer_HK] AND ca_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ) ss_Customer on ss_Customer.[Customer_HK] = ecpca_wh.[DebitorSoldTo_HK] ' --PRINT (@SQL) EXECUTE sp_executesql @SQL FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient END CLOSE source_list_cursor; DEALLOCATE source_list_cursor; DROP TABLE IF EXISTS #temp_hub_data /* ------------------------------------------------------ */ -- Step 3.1 | Read Data from I3 and O5 (GP1 + GP7 from AS) /* ------------------------------------------------------ */ INSERT INTO #temp_result_raw SELECT 'I3' ,[ECPCA_Item_GPM_HK] as [ECPCA_Item_HK] ,'SAPGP1' ,[SourceSystemCode] as [SAPSystemClient] ,[DocumentNumber] ,[DocumentLineNumber] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[RKAUFNR] ,[LoadDateFactSat] as [LoadDateDVSat] ,0 as [ReverseFlag] FROM [INFI_TM1_CSC2].[V_INTF_PNL_FACT_GLPCA_I3] WHERE [LoadDateFactSat] BETWEEN @DeltaTimestampFrom AND @DeltaTimestampTo ; INSERT INTO #temp_result_raw SELECT 'O5' ,[ECPCA_Item_GPM_HK] as [ECPCA_Item_HK] ,'SAPGP7' ,[SourceSystemCode] as [SAPSystemClient] ,[DocumentNumber] ,[DocumentLineNumber] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[RKAUFNR] ,[LoadDateFactSat] as [LoadDateDVSat] ,0 as [ReverseFlag] FROM [INFI_TM1_CSC2].[V_INTF_PNL_FACT_GLPCA_O5] WHERE [LoadDateFactSat] BETWEEN @DeltaTimestampFrom AND @DeltaTimestampTo ; /* --------------------------------------------------------- */ /* Step 4 | Prepare export and create stage table */ /* --------------------------------------------------------- */ DROP TABLE IF EXISTS #INTF_PNL_FACT_ECPCA_CS_V2_STAGE; CREATE TABLE #INTF_PNL_FACT_ECPCA_CS_V2_STAGE ( [RowInsertDate] datetime2(7) ,[AuditId] int ,[EntityId] int ,[RowEndDate] datetime2(7) ,[LoadPackageId] int ,[ECPCA_Item_HK] binary(20) ,[LoadDateDVSat] datetime2(7) ,[SAPSystem] nvarchar(10) COLLATE Latin1_General_CS_AS ,[SAPSystemClient] nvarchar(10) COLLATE Latin1_General_CS_AS ,[GYear] int ,[PERIO] int ,[BUDAT] char(20) ,[HZDAT_TIMESTAMP] datetime2(7) ,[CompanyCode] nvarchar(20) COLLATE Latin1_General_CS_AS ,[ProfitCenter] nvarchar(20) COLLATE Latin1_General_CS_AS ,[DivisionFromSource] nvarchar(20) COLLATE Latin1_General_CS_AS ,[GLAccount] nvarchar(20) COLLATE Latin1_General_CS_AS ,[AccountGroup] nvarchar(20) COLLATE Latin1_General_CS_AS ,[DocumentNumber] nvarchar(20) COLLATE Latin1_General_CS_AS ,[DocumentLineNumber] int ,[CurrencyCodeTransaction] char(3) ,[AmountTransactionCurrency] decimal(18, 5) ,[CurrencyCodeCompanyCode] char(3) ,[AmountCompanyCodeCurrency] decimal(18, 5) ,[WERKS] nvarchar(10) COLLATE Latin1_General_CS_AS ,[ARTNR] nvarchar(20) COLLATE Latin1_General_CS_AS ,[DebitorSoldTo] nvarchar(20) COLLATE Latin1_General_CS_AS ,[LAND1] nvarchar(10) COLLATE Latin1_General_CS_AS ,[RBCustomerNumber] nvarchar(20) COLLATE Latin1_General_CS_AS ,[SKOST] nvarchar(30) COLLATE Latin1_General_CS_AS ,[PSPNR] nvarchar(50) COLLATE Latin1_General_CS_AS ,[RKAUFNR] nvarchar(12) COLLATE Latin1_General_CS_AS ,[ReverseFlag] smallint ) /* ------------------------------------------------------ */ -- Step 5 | Do the export /* ------------------------------------------------------ */ DECLARE @LoadTimestamp datetime2 = CURRENT_TIMESTAMP /* Definition of LoadPackageId */ DECLARE @LoadPackageId integer --SELECT @LoadPackageId = ISNULL(MAX(LoadPackageId),1000) + 1 FROM [INFI_TM1_CSC2].[INTF_PNL_FACT_ECPCA_CS_V2] SELECT @LoadPackageId = next value for [INFI_TM1_CSC2].[SEQ_LoadPackageId_INTF_PNL_FACT_ECPCA_CS] -- PRINT (@LoadPackageId) -- ALTER SEQUENCE [INFI_TM1_CSC2].[SEQ_LoadPackageId_INTF_PNL_FACT_ECPCA_CS] RESTART -- Max value = 1.999.999 -- print (@LoadPackageId) /* ------------------------------------------------------ */ -- Step 5.1 | get records for potential Reversal into stage table*/ /* ------------------------------------------------------ */ insert into #INTF_PNL_FACT_ECPCA_CS_V2_STAGE select @LoadTimestamp ,@AuditTrailId ,@EntityId ,'2999-12-31 00:00:00.0000000' ,@LoadPackageId ,[ECPCA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[DocumentNumber] ,[DocumentLineNumber] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[RKAUFNR] ,[ReverseFlag] from ( SELECT @LoadTimestamp as [RowInsertDate] ,@AuditTrailId as [AuditId] ,@EntityId as [EntityId] ,'2999-12-31 00:00:00.0000000' as [RowEndDate] ,@LoadPackageId as [LoadPackageId] ,cci.[ECPCA_Item_HK] ,cci.[LoadDateDVSat] ,cci.[SAPSystem] ,cci.[SAPSystemClient] ,cci.[GYear] ,cci.[PERIO] ,cci.[BUDAT] ,cci.[HZDAT_TIMESTAMP] ,cci.[CompanyCode] ,cci.[ProfitCenter] ,cci.[DivisionFromSource] ,cci.[GLAccount] ,cci.[AccountGroup] ,cci.[DocumentNumber] ,cci.[DocumentLineNumber] ,cci.[CurrencyCodeTransaction] ,(cci.[AmountTransactionCurrency] * -1 ) as [AmountTransactionCurrency] ,cci.[CurrencyCodeCompanyCode] ,(cci.[AmountCompanyCodeCurrency] * -1 ) as [AmountCompanyCodeCurrency] ,cci.[WERKS] ,cci.[ARTNR] ,cci.[DebitorSoldTo] ,cci.[LAND1] ,cci.[RBCustomerNumber] ,cci.[SKOST] ,cci.[PSPNR] ,cci.[RKAUFNR] ,(ISNULL(cci.[ReverseFlag],0) + 1 ) as [ReverseFlag] ,ROW_NUMBER() over (partition by cci.[ECPCA_Item_HK] order by cci.[LoadPackageId] desc ) as [RowNum] FROM #temp_result_raw inner join [INFI_TM1_CSC2].[INTF_PNL_FACT_ECPCA_CS_V2] cci on cci.[ECPCA_Item_HK] = #temp_result_raw.[ECPCA_Item_HK] and ( cci.[ReverseFlag] = 0 or cci.[ReverseFlag] is NULL) ) as ss_reversal where ss_reversal.[RowNum] = 1 ; /* ------------------------------------------------------ */ -- Step 5.2 | transfer record into Stage table to be able to insert only one time into CCI */ /* ------------------------------------------------------ */ INSERT INTO #INTF_PNL_FACT_ECPCA_CS_V2_STAGE WITH (TABLOCK) ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[ECPCA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[DocumentNumber] ,[DocumentLineNumber] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[RKAUFNR] ,[ReverseFlag] ) SELECT [RowInsertDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,[RowEndDate] = '2999-12-31 00:00:00.0000000' ,[LoadPackageId] = @LoadPackageId ,[ECPCA_Item_HK] = [ECPCA_Item_HK] ,[LoadDateDVSat] = [LoadDateDVSat] ,[SAPSystem] = [SAPSystem] ,[SAPSystemClient] = [SAPSystemClient] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[DocumentNumber] ,[DocumentLineNumber] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[RKAUFNR] ,[ReverseFlag] FROM #temp_result_raw ; /* ------------------------------------------------------ */ -- Step 5.2 | transfer record from Stage table into CCI */ /* ------------------------------------------------------ */ BEGIN TRY BEGIN TRAN INSERT INTO [INFI_TM1_CSC2].[INTF_PNL_FACT_ECPCA_CS_V2] WITH (TABLOCK) ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[ECPCA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[DocumentNumber] ,[DocumentLineNumber] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[RKAUFNR] ,[ReverseFlag] ) SELECT [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[ECPCA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[GYear] ,[PERIO] ,[BUDAT] ,[HZDAT_TIMESTAMP] ,[CompanyCode] ,[ProfitCenter] ,[DivisionFromSource] ,[GLAccount] ,[AccountGroup] ,[DocumentNumber] ,[DocumentLineNumber] ,[CurrencyCodeTransaction] ,[AmountTransactionCurrency] ,[CurrencyCodeCompanyCode] ,[AmountCompanyCodeCurrency] ,[WERKS] ,[ARTNR] ,[DebitorSoldTo] ,[LAND1] ,[RBCustomerNumber] ,[SKOST] ,[PSPNR] ,[RKAUFNR] ,[ReverseFlag] FROM #INTF_PNL_FACT_ECPCA_CS_V2_STAGE ; COMMIT TRAN SET @RowsInStageTable = (SELECT COUNT(*) FROM #INTF_PNL_FACT_ECPCA_CS_V2_STAGE ); END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; THROW; -- raise error to the client END CATCH; /* ------------------------------------------------------ */ -- Get rows inserted for logging /* ------------------------------------------------------ */ SET @RowsInserted = @RowsInStageTable SET @RowsRead = 0 /* ------------------------------------------------------ */ -- Last Step | Cleanup /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #INTF_PNL_FACT_ECPCA_CS_V2_STAGE DROP TABLE IF EXISTS #temp_deltaHKlist DROP TABLE IF EXISTS #temp_hub_data DROP TABLE IF EXISTS #temp_result_raw END;"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G5;240368271;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G5 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DeltaLoadSourceSystemByYearMonthCreation;241136350;V ;VIEW;1824;/**/ /* View: V_DeltaLoadSourceSystemByYearMonthCreation */ /**/ /* =*/ /* V01.00.01 2023-08-11 Yannick Sigwalt, GS/BDD1 */ /* This view provide to Consumer of CORE which Year Month Creation have been updated from source */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01 - Added Plan Specific Satellite */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G2;241644154;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G2 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P72 */ /* Changes: */ /* Restriction: */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_D3;244508250;V ;VIEW;3385;/**/ /* View: V_COPlanCostsDelta_D3 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_D7;245276329;V ;VIEW;4912;/**/ /* View: V_FactActualCost_D7 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_D1;245888243;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15543;"/**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_D1 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_A2;253556287;V ;VIEW;8362;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_A2 */ /**/ /* = */ /* V01.00.01 2022-11-10 Michal Erdman & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.01 Added PartnerCostCenter and PartnerActivityType */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G6;256368328;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G6 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G3;257644211;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G3 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P79 */ /* Changes: */ /* Restriction: */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_D4;260508307;V ;VIEW;3385;/**/ /* View: V_COPlanCostsDelta_D4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G0;261276386;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G0 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_D3;261888300;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15543;"/**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_D3 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D3_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D3_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_B2;269556344;V ;VIEW;8267;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_B2 */ /**/ /* = */ /* V01.00.01 2022-11-10 Michal Erdman & Karoline Adler GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.01 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G7;272368385;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17039;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G7 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G7_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G7_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_CompanyCode_IDIM1;273084409;V ;VIEW;14469;"/**/ /* View: V_INTF_CompanyCode_IDIM1 */ /**/ /**/ /* V01.00.08 2023-03-20 Sanja Mihalic BD/XAD3 & Hui Yang (CI/XEF1) */ /* Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0181 https://inside-docupedia.bosch.com/confluence/x/6INBdw */ /* Update: */ /* V01.00.08 2023-03-20 - Adding CompanyCodeDimId */ /* V01.00.07 2022-12-01 - Changed format of attribute ""RefMDS_StatusValidFrom"" to ""yyyy-mm-dd"" back */ /* V01.00.06 2022-11-23 - Changed format of attribute ""RefMDS_StatusValidFrom"" to ""dd.mm.yyyy"" */ /* V01.00.05 2022-11-09 - Removed attribute Scope_ChangeEBReceiver_Current_vs_Previous */ /* V01.00.04 2022-10-24 - Added manually loaded attributes from CORE.Writer */ /* V01.00.03 2022-03-25 - Added logic for ChartOfAccounts from other Systems */ /* V01.00.02 2022-03-25 - Added logic for LegalEntity_PGNumberSAP from other Systems */ /* V01.00.01 2022-03-02 - Enhanced with B5 */ /* V01.00.00 2022-02-21 - initial */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G4;273644268;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G4 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P81 */ /* Changes: */ /* Restriction: */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_D7;276508364;V ;VIEW;3385;/**/ /* View: V_COPlanCostsDelta_D7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G1;277276443;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G1 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_O1;277888357;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15543;"/**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_O1 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_O1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_O1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G1;278500271;V ;VIEW;3549;/**/ /* View: V_SparePart_IDIM1_G1 */ /**/ /**/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P45 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G1] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Spare Part_IDIM1_G0 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Plant;285296126;V ;VIEW;936;/* = */ /* V 01.00.00 2020-05-11 Patrik Just CI/DAV2.3 */ /* This view retreieves a list with Plant codes for TM1 */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_B4;285556401;V ;VIEW;8358;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_B4 */ /**/ /* = */ /* V01.00.01 2022-11-10 Michal Erdman & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.01 Added PartnerCostCenter and PartnerActivityType */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G9;288368442;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G9 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G9_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G9_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_Plant_IDIM1;289084466;V ;VIEW;1140;/**/ /* View: V_INTF_Plant_IDIM1 */ /**/ /**/ /* V01.00.00 2023-03-24 Sanja Mihalic BD/XAD3 */ /* Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0335 https://inside-docupedia.bosch.com/confluence/x/TFmCpw */ /* Update: */ /* V01.00.00 2023-03-24 - initial */ /**/
INFM_AccountingP2P_CSC2;121;INFormation Mart;usp_DeltaLoad_INTF_AccountingP2P;289136521;P ;SQL_STORED_PROCEDURE;109476;"/* =*/ /* V01.00.13 - 2023-08-17 Sanja Mihalic BD/XAD3 & Stephan Wund GS/BDD1 & Aman Kumar BD/XAD5 */ /* This Stored Procedure for incremantal loading of P2P Persisted Fact Data */ /* Data.CORE Outgoing Interface #0191 https://inside-docupedia.bosch.com/confluence/x/RT1Qf */ /* Implemented Soft Rules: */ /* #FBI-SR-000000105 https://inside-docupedia.bosch.com/confluence/x/3A0Wn - Invoice Document Channel */ /* #FBI-SR-000000106 https://inside-docupedia.bosch.com/confluence/x/xUhGng - Accounting Document ID */ /* #FBI-SR-000000122 https://inside-docupedia.bosch.com/confluence/x/pIcTsg - Data Combination Logic SAP+APM */ /* #FBI-SR-000000124 https://inside-docupedia.bosch.com/confluence/x/HeoTsg - Net Due Date */ /* #FBI-SR-000000125 https://inside-docupedia.bosch.com/confluence/x/OesTsg - Payment Information */ /* #FBI-SR-000000126 https://inside-docupedia.bosch.com/confluence/x/zesTsg - Trading Partner Category */ /* #FBI-SR-000000127 https://inside-docupedia.bosch.com/confluence/x/zvYTsg - Document Type FI/MM */ /* #FBI-SR-000000128 https://inside-docupedia.bosch.com/confluence/x/NfkTsg - Document Category */ /* #FBI-SR-000000129 https://inside-docupedia.bosch.com/confluence/x/MfsTsg - Days calculation */ /* #FBI-SR-000000130 https://inside-docupedia.bosch.com/confluence/x/cfwTsg - Payment Block */ /* #FBI-SR-000000131 https://inside-docupedia.bosch.com/confluence/x/Gv0Tsg - Invoice Cancellation Flag */ /* #FBI-SR-000000132 https://inside-docupedia.bosch.com/confluence/x/TABVsg - Days Overdue */ /* #FBI-SR-000000134 https://inside-docupedia.bosch.com/confluence/x/wgFVsg - Status of Accounting Document */ /* Restriction: */ /* - Tailored loading for Accounting P2P only */ /* - Covered sources: S7 (APM), G0, G4, G5 */ /* Update: */ /* - V01.00.13 2023-08-17: Adding new fields and change logic for #xBI-P2P-000000008 NetDueDate, */ /* #xBI-P2P-000000011 DocumentChannel and #xBI-P2P-000000018 DaysOverdue */ /* - V01.00.12 2023-07-31: Updated the table name from AccountingDocumentItemAttributeAccounting_WSATJ_xx_X */ /* to AccountingDocumentItemAttribute_WSATJ_xx_X */ /* for GO, G4 amnd G5 */ /* - V01.00.11 2023-07-27: New fileds added for UAT purpose */ /* - V01.00.10 2023-07-07: New Key Logic implemented (VendorInvoice_BHUB) */ /* - V01.00.09 2023-06-27: Update after renaming of AccDocHeader satellite */ /* - V01.00.08 2023-05-24: Update after HK change */ /* - V01.00.07 2023-05-08: Rework after Business UAT and adding SR links */ /* - V01.00.06 2023-04-06: Changed connection logic */ /* - V01.00.05 2023-03-20: Rework after UAT, adding logic for TradingPartnerCategory */ /* - V01.00.04 2023-02-28: Adding other non Prio1 fields */ /* - V01.00.03 2023-02-22: Correction in calculation of CompanyCodeSAP */ /* - V01.00.02 2023-02-13: Adding Purchase Organization in calculation of Document Type FI MM (direct/indirect) */ /* - V01.00.01 2023-02-09: Connectiong Purchase Organization from Accounting Document Line Item */ /* - V01.00.00 2023-01-25: Initial version */ /* =*/ create procedure INFM_AccountingP2P_CSC2.usp_DeltaLoad_INTF_AccountingP2P ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* = */ /* Start declaration for testing purpose */ /* Uncomment below column to be able to test the code */ --DECLARE @DeltaTimestampFrom datetime2 --DECLARE @DeltaTimestampTo datetime2 --DECLARE @LoadBatchId bigint --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int --SET @DeltaTimestampFrom = '2022-01-01 00:00:00.0000000' --SET @DeltaTimestampTo = '2023-08-17 00:00:00.0000000' /* End declaration for testing purpose */ /* = */ /* --------------------------------------------------------------------------------------------------------------------- */ -- Step 1 | Get AccountingDocument Hashkeys for all delta timestamps (from Payment Monitor and Accounting SAP Systems) -- and all Hub and Sat data needed /* --------------------------------------------------------------------------------------------------------------------- */ -- Step 1.1 get the delta timestamps of Payment Monitor DROP TABLE IF EXISTS #temp_deltaHKlistPMonitor; CREATE TABLE #temp_deltaHKlistPMonitor ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[InvoiceProcess_HK] binary(20) ,[LoadDate] datetime2 ,[FiscalYear] smallint ,[CompanyCode] nvarchar(4) COLLATE Latin1_General_CS_AS ,[AccountingDocumentNumber] nvarchar(10) COLLATE Latin1_General_CS_AS ,[PostingSystem] nvarchar(6) COLLATE Latin1_General_CS_AS ); --select [FiscalYear], count(1) from #temp_deltaHKlistPMonitor group by [FiscalYear] -- Step 1.1.1 Save the timestamps in temp table INSERT INTO #temp_deltaHKlistPMonitor SELECT * FROM ( Select NULL as [Source], NULL as [SAPSystem], NULL as [nvoiceProcess_HK], NULL as [LoadDate] ,NULL as [FiscalYear], NULL as [CompanyCode], NULL as [AccountingDocumentNumber], NULL as [PostingSystem] UNION ALL SELECT distinct 'S7' ,ip_wh.[SourceSystem_BK] ,ip_wh.[InvoiceProcess_HK] ,ipa_wsx.[LoadDate] ,ipa_wsx.[InvoiceDocumentYear] ,cc_wh.[CompanyCode_BK] ,ipa_wsx.[FIDocument] ,case right([PostingSystem],3) when N'011' then N'SAPPCD' when N'100' then N'SAPPOE' when N'800' then N'SAPPOE' when N'990' then N'SAPPCR' when N'_01' then N'SAPPR1' when N'39A' then N'SAPP38' else N'SAP'+right([PostingSystem],3) end as [PostingSystem] --SAPP81 FROM [RAWV_Accounting_CSC1].[InvoiceProcess_WHUB0] ip_wh inner join [RAWV_Accounting_CSC1].[InvoiceProcess_WSATE_S7_L] ip_wse on ip_wse.InvoiceProcess_HK = ip_wh.[InvoiceProcess_HK] and ip_wse.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[InvoiceProcessAttribute_WSAT0_S7_X] ipa_wsx on ipa_wsx.InvoiceProcess_HK = ip_wh.InvoiceProcess_HK and ipa_wsx.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[InvoiceProcessToCompanyCode_WLNK0] ip2cc_wl on ip2cc_wl.[InvoiceProcess_HK] = ip_wh.[InvoiceProcess_HK] inner join [RAWV_RB_CSC1].[CompanyCode_WHUB0] cc_wh on cc_wh.[CompanyCode_HK] = ip2cc_wl.[CompanyCode_HK] inner join [RAWV_Accounting_CSC1].[InvoiceProcessToCompanyCode_WSATE_S7_L] ip2cc_wse on ip2cc_wse.InvoiceProcessToCompanyCode_HK = ip2cc_wl.InvoiceProcessToCompanyCode_HK and ip2cc_wse.[LoadEndDate] = '2999-12-31 00:00:00.0000000' WHERE 1=1 --and InvoiceProcess_BK = '005229D661DF041EDE82980400D9985189' and (ipa_wsx.[InvoiceDocumentYear] >= 2021 or year(ipa_wsx.[CreationDate]) >= 2021) --and ipa_wsx.[FIDocument] is not null and ( ipa_wsx.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or ip2cc_wse.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or ip_wse.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) ) temp_deltaHKlistPMonitor ; -- Step 1.1.2 Create index for temp table to support following joins CREATE CLUSTERED INDEX IX_#temp_deltaHKlistPMonitor ON #temp_deltaHKlistPMonitor ([InvoiceProcess_HK]); -- Step 1.2 get the delta timestamps of Accounting SAP Systems DROP TABLE IF EXISTS #temp_deltaHKlistAccounting; CREATE TABLE #temp_deltaHKlistAccounting ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[AccountingDocumentHeader_HK] binary(20) ,[LoadDate] datetime2 ,[FiscalYear] smallint ,[CompanyCode] nvarchar(4) COLLATE Latin1_General_CS_AS ,[AccountingDocumentNumber] nvarchar(10) COLLATE Latin1_General_CS_AS ,[DocumentNumberOfClearingDocument] nvarchar(10) COLLATE Latin1_General_CS_AS ,[ReferenceKey] nvarchar(20) COLLATE Latin1_General_CS_AS ); -- Step 1.2.1 Save the timestamps in temp table - HK from Accounting Header INSERT INTO #temp_deltaHKlistAccounting SELECT * FROM ( Select NULL as [Source], NULL as [SAPSystem], NULL as [AccountingDocumentHeader_HK], NULL as [LoadDate] ,NULL as [FiscalYear], NULL as [CompanyCode], NULL as [AccountingDocumentNumber] ,NULL as [DocumentNumberOfClearingDocument], NULL as [ReferenceKey] UNION ALL SELECT distinct 'G0' ,adh_wh.[SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceKey] FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G0] adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G0] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItem_WHUB0_G0] adi_wh on adi_wh.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G0_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G0_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --checking if this fits Accounting Document of Posted Invoice from PMonitor left outer join #temp_deltaHKlistPMonitor t_dHKPM on t_dHKPM.[PostingSystem] = adh_wh.[SAPSystem] and t_dHKPM.[FiscalYear] = adh_wh.[FiscalYear_BK] and t_dHKPM.[CompanyCode] = adh_wh.[CompanyCodeBK] and t_dHKPM.[AccountingDocumentNumber] = adh_wh.[AccountingDocumentNumber_BK] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and ( adhaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiap2p_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or t_dHKPM.InvoiceProcess_HK is not null) ) as x; INSERT INTO #temp_deltaHKlistAccounting SELECT distinct 'G4' ,adh_wh.[SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceKey] FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G4] adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G4_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G4] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItem_WHUB0_G4] adi_wh on adi_wh.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G4_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G4_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --checking if this fits Accounting Document of Posted Invoice from PMonitor left outer join #temp_deltaHKlistPMonitor t_dHKPM on t_dHKPM.[PostingSystem] = adh_wh.[SAPSystem] and t_dHKPM.[FiscalYear] = adh_wh.[FiscalYear_BK] and t_dHKPM.[CompanyCode] = adh_wh.[CompanyCodeBK] and t_dHKPM.[AccountingDocumentNumber] = adh_wh.[AccountingDocumentNumber_BK] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and ( adhaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiap2p_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or t_dHKPM.InvoiceProcess_HK is not null) INSERT INTO #temp_deltaHKlistAccounting SELECT distinct 'G5' ,adh_wh.[SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceKey] FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G5] adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G5_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G5] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItem_WHUB0_G5] adi_wh on adi_wh.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G5_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G5_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi_wh.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --checking if this fits Accounting Document of Posted Invoice from PMonitor left outer join #temp_deltaHKlistPMonitor t_dHKPM on t_dHKPM.[PostingSystem] = adh_wh.[SAPSystem] and t_dHKPM.[FiscalYear] = adh_wh.[FiscalYear_BK] and t_dHKPM.[CompanyCode] = adh_wh.[CompanyCodeBK] and t_dHKPM.[AccountingDocumentNumber] = adh_wh.[AccountingDocumentNumber_BK] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and ( adhaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiaa_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or adiap2p_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo or t_dHKPM.InvoiceProcess_HK is not null) -- Step 1.2.2 Create index for temp table to support following joins CREATE CLUSTERED INDEX IX_#temp_deltaHKlistAccounting ON #temp_deltaHKlistAccounting ([AccountingDocumentHeader_HK]); CREATE NONCLUSTERED INDEX IX_#temp_deltaHKlistAccountingRest ON #temp_deltaHKlistAccounting ([SAPSystem],[FiscalYear],[CompanyCode],[AccountingDocumentNumber],[DocumentNumberOfClearingDocument],[ReferenceKey]); /* ---------------------------------------------------------------------------------------------------------------------- */ -- Step 2 | From Payment Monitor collect all data needed (by AccountingDocumentNumber from both deltas, APM and Accounting) /* ---------------------------------------------------------------------------------------------------------------------- */ DROP TABLE IF EXISTS #temp_PMonitor_Data; CREATE TABLE #temp_PMonitor_Data ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[InvoiceProcess_HK] binary(20) ,[LoadDate] datetime2 ,[FiscalYear] smallint ,[CompanyCode] nvarchar(4) COLLATE Latin1_General_CS_AS ,[CompanyCode_HK] binary(20) ,[AccountingDocumentNumber] nvarchar(10) COLLATE Latin1_General_CS_AS ,[PurchasingOrganization] nvarchar(256) ,[PurchasingOrganization_HK] binary(20) ,[Plant] nvarchar(4) ,[Plant_HK] binary(20) ,[DocumentDate] date ,[PostingDate] date ,[EntryDate] date ,[PaymentTermAccountingDocument] nvarchar(4) ,[BaselineDate] date ,[VendorNumberForInvoicing] nvarchar(10) ,[NetDueDate] date ,[TradingPartnerCode] nvarchar(128) ,[DocumentType] nvarchar(1) ,[Barcode] nvarchar(40) ,[DataSourceVariant] nvarchar(4) ,[DocumentChannel] nvarchar(4) ,[DocumentCategoryID] nvarchar(1) ,[ScanDate] date ,[CreationDate] date ,[ClearingDate] date ,[VendorInvoice_BHUB0_HK] binary(20) ,[PayableSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[PostingSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[PaymentSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[MainDataSourceCode] tinyint ,[StatusChangeType] tinyint ,[InvoiceStatus] nvarchar(10) ,[InvoiceProcess_BK] nvarchar(34) ,[BarcodeCoCo] nvarchar(128) ,[ReferenceKey] nvarchar(20) ,[AutomaticPostingStatus] nvarchar(10) ,[PostingUser] nvarchar(128) ,[InvoiceType] nvarchar(2) ,[ReadyToPostDate] date ,[DiscountPercentage1] numeric(5,3) ,[DiscountPercentage2] numeric(5,3) ,[PaymentBlock] nvarchar(1) ,[PaymentBlockFI] nvarchar(1) ,[Location] nvarchar(4) ,[ClearingEntryDate] date ,[ChangeDate] date ,[FIDocument] nvarchar(128) ,[InvoiceDocumentNumber] nvarchar(10) ,[DocumentNumberOfClearingDocument] nvarchar(10) ,[VendorInvoiceNumber] nvarchar(16) ,[IsPostedIndicator] bit ,[PostingSystem_Orig] nvarchar(32) COLLATE Latin1_General_CS_AS ); with cte_AP_PostingSystem as ( select [InvoiceProcess_HK] ,case right([PostingSystem],3) when N'011' then N'SAPPCD' when N'100' then N'SAPPOE' when N'800' then N'SAPPOE' when N'990' then N'SAPPCR' when N'_01' then N'SAPPR1' when N'39A' then N'SAPP38' else N'SAP'+right([PostingSystem],3) end as [PostingSystem] --SAPP81 from [RAWV_Accounting_CSC1].[InvoiceProcessAttribute_WSAT0_S7_X] where [LoadEndDate] = '2999-12-31 00:00:00.0000000' ) INSERT INTO #temp_PMonitor_Data SELECT * FROM ( Select NULL as [Source], NULL as [SAPSystem], NULL as [nvoiceProcess_HK], NULL as [LoadDate] ,NULL as [FiscalYear], NULL as [CompanyCode], NULL as [CompanyCode_HK], NULL as [AccountingDocumentNumber] ,NULL as [PurchasingOrganization],NULL as [PurchasingOrganization_HK], NULL as [Plant], NULL as [Plant_HK], NULL as [DocumentDate], NULL as [PostingDate], NULL as [EntryDate] ,NULL as [PaymentTermAccountingDocument], NULL as [BaselineDate], NULL as [VendorNumberForInvoicing], NULL as [NetDueDate] ,NULL as [TradingPartnerCode], NULL as [DocumentType], NULL as [Barcode], NULL as [DataSourceVariant], NULL as [DocumentChannel] ,NULL as [DocumentCategoryID], NULL as [ScanDate], NULL as [CreationDate], NULL as [ClearingDate], NULL as [VendorInvoice_BHUB0_HK] ,NULL as [PayableSystem], NULL as [PostingSystem], NULL as [PaymentSystem], NULL as [MainDataSourceCode], NULL as [StatusChangeType], NULL as [InvoiceStatus] ,NULL as [InvoiceProcess_BK], NULL as [BarcodeCoCo], NULL as [ReferenceKey] ,NULL as [AutomaticPostingStatus], NULL as [PostingUser], NULL as [InvoiceType], NULL as [ReadyToPostDate] ,NULL as [DiscountPercentage1], NULL as [DiscountPercentage2], NULL as [PaymentBlock], NULL as [PaymentBlockFI], NULL as [Location], NULL as [ClearingEntryDate] ,NULL as [ChangeDate], NULL as [FIDocument], NULL as [InvoiceDocumentNumber], NULL as [DocumentNumberOfClearingDocument], NULL as [VendorInvoiceNumber], NULL as [IsPostedIndicator] ,NULL as [PostingSystem_Orig] UNION ALL SELECT distinct 'S7' ,ip_wh.[SourceSystem_BK] ,ip_wh.[InvoiceProcess_HK] ,ipa_ws.[LoadDate] ,isnull(ipa_ws.[InvoiceDocumentYear],0) ,cc_wh.[CompanyCode_BK] ,cc_wh.[CompanyCode_HK] ,isnull(ipa_wsx.[FIDocument],'0') ,ipa_wsx.[PurchasingOrganization] ,po_wh.[PurchasingOrganization_WHUB0_HK] ,ipae_ws.[Plant] ,pl_wh.[Plant_HK] ,ipa_ws.[DocumentDate] ,ipa_ws.[PostingDate] ,ipa_ws.[EntryDate] ,ipa_ws.[PaymentTermAccountingDocument] ,ipa_ws.[BaselineDate] ,ipa_wsx.[VendorNumberForInvoicing] ,ipa_ws.[NetDueDate] ,ipa_ws.[TradingPartnerCode] ,ipa_ws.[DocumentType] ,ipa_wsx.[Barcode] ,ipa_wsx.[DataSourceVariant] ,ipae_ws.[DocumentChannel] ,ipa_wsx.[DocumentCategoryId] ,ipa_wsx.[ScanDate] ,ipa_wsx.[CreationDate] ,ipa_ws.[ClearingDate] ,vi_bh.[VendorInvoice_BHUB0_HK] ,visod_bs.[PayableSystem] ,visod_bs.[PostingSystem] ,visod_bs.[PaymentSystem] ,visod_bs.[MainDataSourceCode] ,visod_bs.[StatusChangeType] ,ipa_ws.[InvoiceStatus] ,ip_wh.[InvoiceProcess_BK] ,ipa_wsx.[BarcodeCoCo] ,ipae_ws.[ReferenceKey] ,ipa_ws.[AutomaticPostingStatus] ,ipa_ws.[PostingUser] ,ipa_ws.[InvoiceType] ,ipae_ws.[ReadyToPostDate] ,ipa_ws.[DiscountPercentage1] ,ipa_ws.[DiscountPercentage2] ,ipa_ws.[PaymentBlock] ,ipa_ws.[PaymentBlockFI] ,ipa_wsx.[Location] ,ipa_ws.[ClearingEntryDate] ,ipa_ws.[ChangeDate] ,ipa_wsx.[FIDocument] ,ipa_ws.[InvoiceDocumentNumber] ,ipa_ws.[DocumentNumberOfClearingDocument] ,ipa_ws.[VendorInvoiceNumber] ,visod_bs.[IsPostedIndicator] ,ipa_wsx.[PostingSystem] as [PostingSystem_Orig] FROM [RAWV_Accounting_CSC1].[InvoiceProcess_WHUB0] ip_wh inner join [RAWV_Accounting_CSC1].[InvoiceProcess_WSATE_S7_L] ip_wse on ip_wse.InvoiceProcess_HK = ip_wh.[InvoiceProcess_HK] and ip_wse.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[InvoiceProcessAttribute_WSAT0_S7_L] ipa_ws on ipa_ws.InvoiceProcess_HK = ip_wh.InvoiceProcess_HK and ipa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[InvoiceProcessToCompanyCode_WLNK0] ip2cc_wl on ip2cc_wl.[InvoiceProcess_HK] = ip_wh.[InvoiceProcess_HK] inner join [RAWV_Accounting_CSC1].[InvoiceProcessToCompanyCode_WSATE_S7_L] ip2cc_ws on ip2cc_ws.[InvoiceProcessToCompanyCode_HK] = ip2cc_wl.[InvoiceProcessToCompanyCode_HK] and ip2cc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CompanyCode_WHUB0] cc_wh on cc_wh.[CompanyCode_HK] = ip2cc_wl.[CompanyCode_HK] inner join [RAWV_Accounting_CSC1].[InvoiceProcessAttribute_WSAT0_S7_X] ipa_wsx on ipa_wsx.InvoiceProcess_HK = ip_wh.InvoiceProcess_HK and ipa_wsx.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join cte_AP_PostingSystem on cte_AP_PostingSystem.InvoiceProcess_HK = ipa_wsx.InvoiceProcess_HK left outer join [RAWV_Accounting_CSC1].[InvoiceProcessAttributeExtended_WSAT0_S7_X] ipae_ws on ipae_ws.InvoiceProcess_HK = ip_wh.InvoiceProcess_HK and ipae_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left outer join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_BK] = ipae_ws.[Plant] left outer join [RAWV_PUR_CSC2].[PurchasingOrganization_WHUB0] po_wh on po_wh.PurchasingOrganization_BK = ipa_wsx.PurchasingOrganization left outer join #temp_deltaHKlistPMonitor t_dHKPM on t_dHKPM.[InvoiceProcess_HK] = ip_wh.[InvoiceProcess_HK] --collecting data from BV left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoice_BHUB0] vi_bh on vi_bh.[PostingSystem_BK] = cte_AP_PostingSystem.PostingSystem --ip_wh.[SourceSystem_BK] and vi_bh.[AccountingDocumentYear_BK] = isnull(ipa_ws.[InvoiceDocumentYear],0) and vi_bh.[CompanyCode_BK] = cc_wh.[CompanyCode_BK] and vi_bh.[AccountingDocumentNumber_BK] = isnull(ipa_wsx.[FIDocument],'0') and vi_bh.[InvoiceProcess_BK] = ip_wh.[InvoiceProcess_BK] left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoiceSourceOfData_BSAT0_XX_L] visod_bs on visod_bs.[VendorInvoice_BHUB0_HK] = vi_bh.[VendorInvoice_BHUB0_HK] and (visod_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' or visod_bs.StatusChangeType = 2 ) --checking if this fits to AccountingDocument from Posting left outer join #temp_deltaHKlistAccounting t_dHKA_Posting on t_dHKA_Posting.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA_Posting.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA_Posting.[AccountingDocumentNumber] = vi_bh.[AccountingDocumentNumber_BK] and (t_dHKA_Posting.[SAPSystem] = N'SAP'+visod_bs.[PostingSystem] and visod_bs.[IsPostedIndicator] = 1) --checking if this fits to AccountingDocument from Payment System left outer join #temp_deltaHKlistAccounting t_dHKA_Payment on t_dHKA_Payment.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA_Payment.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA_Payment.[DocumentNumberOfClearingDocument] = vi_bh.[AccountingDocumentNumber_BK] and t_dHKA_Payment.[SAPSystem] = N'SAP'+visod_bs.[PaymentSystem] WHERE 1=1 and (t_dHKPM.[InvoiceProcess_HK] is not null -- on the delta list from PMonitor or t_dHKA_Posting.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting Posting or t_dHKA_Payment.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting Payment ) --and ipa_wsx.[FIDocument] is not null ) temp_PMonitor_Data ; CREATE CLUSTERED INDEX IX_#temp_PMonitor_Data ON #temp_PMonitor_Data (VendorInvoice_BHUB0_HK); /* ---------------------------------------------------------------------------------------------------------------------- */ -- Step 3 | From Accounting collect all data needed (by AccountingDocumentNumber from both deltas, APM and Accounting)) /* ---------------------------------------------------------------------------------------------------------------------- */ DROP TABLE IF EXISTS #temp_Accounting_Data CREATE TABLE #temp_Accounting_Data ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[AccountingDocumentHeader_HK] binary(20) ,[LoadDate] datetime2 ,[FiscalYear] smallint ,[CompanyCode] nvarchar(4) COLLATE Latin1_General_CS_AS ,[CompanyCode_HK] binary(20) ,[AccountingDocumentNumber] nvarchar(10) COLLATE Latin1_General_CS_AS ,[AccountingDocumentLineItem] smallint ,[Plant_BK] nvarchar(4) ,[Plant_HK] binary(20) ,[DocumentDate] date ,[PostingDate] date ,[DateTimeOfEntry] date ,[TermsOfPaymentKey] nvarchar(4) ,[BaselineDateforDueDateCalculation] date ,[VendorNumber] nvarchar(10) ,[CashDiscountDays1] numeric(3,0) ,[CashDiscountDays2] numeric(3,0) ,[NetPaymentTermsPeriod] numeric(3,0) ,[DaysNet] numeric(3,0) ,[ClearingDate] date ,[ClearingEntryDate] date ,[TransactionCode] nvarchar(20) ,[DocumentType] nvarchar(4) ,[ReferenceTransaction] nvarchar(5) ,[AccountType] nvarchar(1) ,[DebitOrCreditIndicator] nvarchar(1) ,TBTKZ nvarchar(1) ,[VendorInvoice_BHUB0_HK] binary(20) ,[PayableSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[PostingSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[PaymentSystem] nvarchar(3) COLLATE Latin1_General_CS_AS ,[MainDataSourceCode] tinyint ,[StatusChangeType] tinyint ,[AccountingDocumentItem_HK] binary(20) ,[ReferenceKey] nvarchar(20) ,[PurchasingOrganization_HK] binary(20) ,[PurchasingOrganization_BK] nvarchar(4) ,[UserName] nvarchar(12) ,[ZBD1P] numeric(5,3) ,[ZBD2P] numeric(5,3) ,[PaymentBlockKey] nvarchar(1) ,[ReverseDocumentNumber] nvarchar(10) ,[DocumentNumberOfClearingDocument] nvarchar(10) ,[ReferenceDocumentNumber] nvarchar(16) ,[TradingPartnerCompany] nvarchar(6) ,[PostingKey] nvarchar(3) ,[LogicalSystem] nvarchar(10) ,[InvoiceReference] nvarchar(10) ); DROP TABLE IF EXISTS #temp_Accounting_Data_G0 SELECT distinct adh_wh.[SAPSystem] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,vi_bh.[VendorInvoice_BHUB0_HK] ,visod_bs.[PayableSystem] ,visod_bs.[PostingSystem] ,visod_bs.[PaymentSystem] ,visod_bs.[MainDataSourceCode] ,visod_bs.[StatusChangeType] ,adh_wh.[AccountingDocumentHeader_HK] into #temp_Accounting_Data_G0 FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G0] adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --collecting data from BV left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoice_BHUB0] vi_bh on vi_bh.[AccountingDocumentYear_BK] = adh_wh.[FiscalYear_BK] and vi_bh.[CompanyCode_BK] = adh_wh.[CompanyCodeBK] and vi_bh.[AccountingDocumentNumber_BK] = adh_wh.[AccountingDocumentNumber_BK] left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoiceSourceOfData_BSAT0_XX_L] visod_bs on visod_bs.[VendorInvoice_BHUB0_HK] = vi_bh.[VendorInvoice_BHUB0_HK] and (visod_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' or visod_bs.[StatusChangeType] = 2 ) and (vi_bh.[PostingSystem_BK] = adh_wh.[SAPSystem] --ovo mora drugacije? or visod_bs.[PaymentSystem] = right(adh_wh.SAPSystem,3) ) --checking if this fits to AccountingDocument from Posting System left outer join #temp_deltaHKlistAccounting t_dHKA_Posting on t_dHKA_Posting.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA_Posting.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA_Posting.[AccountingDocumentNumber] = vi_bh.[AccountingDocumentNumber_BK] and (t_dHKA_Posting.[SAPSystem] = N'SAP'+visod_bs.[PostingSystem] ) -- and adsod_bs.[IsPostedIndicator] = 1) --review this!! --checking if this fits to AccountingDocument from Self-Payment System left outer join #temp_deltaHKlistAccounting t_dHKA_Payment on t_dHKA_Payment.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA_Payment.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA_Payment.[DocumentNumberOfClearingDocument] = vi_bh.[AccountingDocumentNumber_BK] and t_dHKA_Payment.[SAPSystem] = N'SAP'+visod_bs.[PaymentSystem] --checking if this fits to AccountingDocument from Payment System for others left outer join #temp_deltaHKlistAccounting t_dHKA_Payment_other on t_dHKA_Payment_other.[FiscalYear] = adh_wh.[FiscalYear_BK] and t_dHKA_Payment_other.[CompanyCode] = adh_wh.[CompanyCodeBK] and t_dHKA_Payment_other.[ReferenceKey] = adhaa_ws.[ReferenceKey] and t_dHKA_Payment_other.[SAPSystem] = N'SAP'+visod_bs.[PaymentSystem] ----checking if this fits Accounting Document of Posted Invoice from PMonitor --left outer join #temp_deltaHKlistPMonitor t_dHKPM -- on t_dHKPM.[FiscalYear] = ad_bh.[AccountingDocumentYear_BK] -- and t_dHKPM.[CompanyCode] = ad_bh.[CompanyCode_BK] -- and t_dHKPM.[AccountingDocumentNumber] = ad_bh.[AccountingDocumentNumber_BK] -- and t_dHKPM.[SAPSystem] = N'SAP'+adsod_bs.[PayableSystem] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and (t_dHKA_Posting.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting_Posting or t_dHKA_Payment.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting_Payment or t_dHKA_Payment_other.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting_Payment for others ); CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_G0 ON #temp_Accounting_Data_G0 (AccountingDocumentHeader_HK); -- Implementation of #FBI-SR-000000138 https://inside-docupedia.bosch.com/confluence/x/1R5Mu DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G0 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,poh2po_wl.[PurchasingOrganization_WHUB0_HK] ,po_wh.[PurchasingOrganization_BK] ,pohma_ws.[DocumentDate] ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_PurOrg_G0 FROM #temp_Accounting_Data_G0 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G0] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G0_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization Latest inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G0] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderToPurchasingOrganization_WLNK0] poh2po_wl on poh2po_wl.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchasingOrganization_WHUB0] po_wh on po_wh.[PurchasingOrganization_WHUB0_HK] = poh2po_wl.[PurchasingOrganization_WHUB0_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G0_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G0_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_PurOrg_G0 ON #temp_Accounting_Data_PurOrg_G0 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G0 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,pohma_ws.[DocumentDate] ,pl_wh.Plant_HK ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_Plant_G0 FROM #temp_Accounting_Data_G0 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G0] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G0_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G0] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G0_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G0_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Plant_G0 ON #temp_Accounting_Data_Plant_G0 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G0 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,va_ws.[TradingPartnerCompany] into #temp_Accounting_Data_Vendor_G0 from #temp_Accounting_Data_G0 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G0] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK --and adh_wh.PostingSystem = 'POE' -- Trading Partner Code left outer join [RAWV_Accounting_CSC1].[AccountingDocumentItemToVendor_WLNK0_G0] adi2v_wl on adi2v_wl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK left outer join [RAWV_PUR_MD_CSC2].[VendorAttribute_WSAT0_G0_X] va_ws on va_ws.[Vendor_HK] = adi2v_wl.[Vendor_HK] and va_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Vendor_G0 ON #temp_Accounting_Data_Vendor_G0 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); INSERT INTO #temp_Accounting_Data SELECT distinct 'G0' as [Source] ,adh.[SAPSystem] as [SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] as [AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] as [LoadDate] ,adh.[FiscalYear_BK] as [FiscalYear] ,adh.[CompanyCodeBK] as [CompanyCode] ,adi2h_wl.[CompanyCode_HK] as [CompanyCode_HK] ,adh.[AccountingDocumentNumber_BK] as [AccountingDocumentNumber] ,null as [AccountingDocumentLineItem] ,#temp_Accounting_Data_Plant_G0.[Plant_BK] as [Plant_BK] ,#temp_Accounting_Data_Plant_G0.[Plant_HK] as [Plant_HK] ,adhaa_ws.[DocumentDate] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,adiap2p_ws.[TermsOfPaymentKey] ,adiap2p_ws.[BaselineDateforDueDateCalculation] ,adiaa_ws.[VendorNumber] ,adiaa_ws.[CashDiscountDays1] ,adiaa_ws.[CashDiscountDays2] ,adiap2p_ws.[NetPaymentTermsPeriod] ,adiaa_ws.[DaysNet] ,adiaa_ws.[ClearingDate] ,adiaa_ws.[ClearingEntryDate] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentType] ,adhaa_ws.[ReferenceTransaction] ,adiaa_ws.[AccountType] ,adiaa_ws.[DebitOrCreditIndicator] ,adiaa_wsj.[TBTKZ] ,adh.[VendorInvoice_BHUB0_HK] ,adh.[PayableSystem] ,adh.[PostingSystem] ,adh.[PaymentSystem] ,adh.[MainDataSourceCode] ,adh.[StatusChangeType] ,adi2h_wl.[AccountingDocumentItem_HK] ,adhaa_ws.[ReferenceKey] ,#temp_Accounting_Data_PurOrg_G0.[PurchasingOrganization_WHUB0_HK] ,#temp_Accounting_Data_PurOrg_G0.[PurchasingOrganization_BK] ,adhaa_ws.[UserName] ,adiaa_wsj.[ZBD1P] ,adiaa_wsj.[ZBD2P] ,adiap2p_ws.[PaymentBlockKey] ,adha_wsj.[STBLG] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceDocumentNumber] ,#temp_Accounting_Data_Vendor_G0.[TradingPartnerCompany] ,adiaa_ws.[PostingKey] ,adhaa_ws.[LogicalSystem] ,adiaa_ws.[InvoiceReference] FROM #temp_Accounting_Data_G0 adh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G0_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G0] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK --inner join [RAWV_Accounting_CSC1].[AccountingDocumentItem_WHUB0_G0] adi_wh -- on adi_wh.AccountingDocumentItem_WHUB0_G0_HK = adi2h_wl.AccountingDocumentItem_WHUB0_G0_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G0_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G0_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSATJ_G0_X] adha_wsj on adha_wsj.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK and adha_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttribute_WSATJ_G0_X] adiaa_wsj on adiaa_wsj.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left outer join #temp_Accounting_Data_Plant_G0 on #temp_Accounting_Data_Plant_G0.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_Plant_G0.POOrder = 1 left outer join #temp_Accounting_Data_PurOrg_G0 on #temp_Accounting_Data_PurOrg_G0.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_PurOrg_G0.POOrder = 1 left outer join #temp_Accounting_Data_Vendor_G0 on #temp_Accounting_Data_Vendor_G0.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK DROP TABLE IF EXISTS #temp_Accounting_Data_G0 DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G0 DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G0 DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G0 DROP TABLE IF EXISTS #temp_Accounting_Data_G4 SELECT distinct adh_wh.[SAPSystem] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,vi_bh.[VendorInvoice_BHUB0_HK] ,visod_bs.[PayableSystem] ,visod_bs.[PostingSystem] ,visod_bs.[PaymentSystem] ,visod_bs.[MainDataSourceCode] ,visod_bs.[StatusChangeType] ,adh_wh.AccountingDocumentHeader_HK into #temp_Accounting_Data_G4 FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G4] adh_wh --collecting data from BV left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoice_BHUB0] vi_bh on vi_bh.[AccountingDocumentYear_BK] = adh_wh.[FiscalYear_BK] and vi_bh.[CompanyCode_BK] = adh_wh.[CompanyCodeBK] and vi_bh.[AccountingDocumentNumber_BK] = adh_wh.[AccountingDocumentNumber_BK] and vi_bh.[PostingSystem_BK] = adh_wh.[SAPSystem] left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoiceSourceOfData_BSAT0_XX_L] visod_bs on visod_bs.[VendorInvoice_BHUB0_HK] = vi_bh.[VendorInvoice_BHUB0_HK] and (visod_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' or visod_bs.[StatusChangeType] = 2 ) --checking if this fits to AccountingDocument from Posting or Payment System left outer join #temp_deltaHKlistAccounting t_dHKA on t_dHKA.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA.[AccountingDocumentNumber] = vi_bh.[AccountingDocumentNumber_BK] and ( (t_dHKA.[SAPSystem] = N'SAP'+visod_bs.[PostingSystem] ) --and adsod_bs.[IsPostedIndicator] = 1) --review this!! or t_dHKA.[SAPSystem] = N'SAP'+visod_bs.[PaymentSystem] ) ----checking if this fits Accounting Documnt of Posted Invoice from PMonitor --left outer join #temp_deltaHKlistPMonitor t_dHKPM -- on t_dHKPM.[FiscalYear] = ad_bh.[AccountingDocumentYear_BK] -- and t_dHKPM.[CompanyCode] = ad_bh.[CompanyCode_BK] -- and t_dHKPM.[AccountingDocumentNumber] = ad_bh.[AccountingDocumentNumber_BK] -- and t_dHKPM.[SAPSystem] = N'SAP'+adsod_bs.[PayableSystem] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and ( --t_dHKPM.[InvoiceProcess_HK] is not null -- on the delta list from PMonitor --or t_dHKA.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting ); CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_G4 ON #temp_Accounting_Data_G4 (AccountingDocumentHeader_HK); -- Implementation of #FBI-SR-000000138 https://inside-docupedia.bosch.com/confluence/x/1R5Mu DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G4 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,poh2po_wl.[PurchasingOrganization_WHUB0_HK] ,po_wh.[PurchasingOrganization_BK] ,pohma_ws.[DocumentDate] ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_PurOrg_G4 FROM #temp_Accounting_Data_G4 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G4] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G4_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization Latest inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G4] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderToPurchasingOrganization_WLNK0] poh2po_wl on poh2po_wl.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchasingOrganization_WHUB0] po_wh on po_wh.[PurchasingOrganization_WHUB0_HK] = poh2po_wl.[PurchasingOrganization_WHUB0_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G4_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G4_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_PurOrg_G4 ON #temp_Accounting_Data_PurOrg_G4 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G4 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,pohma_ws.[DocumentDate] ,pl_wh.Plant_HK ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_Plant_G4 FROM #temp_Accounting_Data_G4 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G4] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G4_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G4] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G4_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G4_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Plant_G4 ON #temp_Accounting_Data_Plant_G4 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G4 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,va_ws.[TradingPartnerCompany] into #temp_Accounting_Data_Vendor_G4 from #temp_Accounting_Data_G4 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G4] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK --and adh_wh.PostingSystem = 'POE' -- Trading Partner Code left outer join [RAWV_Accounting_CSC1].[AccountingDocumentItemToVendor_WLNK0_G4] adi2v_wl on adi2v_wl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK left outer join [RAWV_PUR_MD_CSC2].[VendorAttribute_WSAT0_G4_X] va_ws on va_ws.[Vendor_HK] = adi2v_wl.[Vendor_HK] and va_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Vendor_G4 ON #temp_Accounting_Data_Vendor_G4 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); INSERT INTO #temp_Accounting_Data SELECT distinct 'G4' as [Source] ,adh.[SAPSystem] as [SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] as [AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] as [LoadDate] ,adh.[FiscalYear_BK] as [FiscalYear] ,adh.[CompanyCodeBK] as [CompanyCode] ,adi2h_wl.[CompanyCode_HK] as [CompanyCode_HK] ,adh.[AccountingDocumentNumber_BK] as [AccountingDocumentNumber] ,null as [AccountingDocumentLineItem] ,#temp_Accounting_Data_Plant_G4.[Plant_BK] as [Plant_BK] ,#temp_Accounting_Data_Plant_G4.[Plant_HK] as [Plant_HK] ,adhaa_ws.[DocumentDate] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,adiap2p_ws.[TermsOfPaymentKey] ,adiap2p_ws.[BaselineDateforDueDateCalculation] ,adiaa_ws.[VendorNumber] ,adiaa_ws.[CashDiscountDays1] ,adiaa_ws.[CashDiscountDays2] ,adiap2p_ws.[NetPaymentTermsPeriod] ,adiaa_ws.[DaysNet] ,adiaa_ws.[ClearingDate] ,adiaa_ws.[ClearingEntryDate] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentType] ,adhaa_ws.[ReferenceTransaction] ,adiaa_ws.[AccountType] ,adiaa_ws.[DebitOrCreditIndicator] ,adiaa_wsj.[TBTKZ] ,adh.[VendorInvoice_BHUB0_HK] ,adh.[PayableSystem] ,adh.[PostingSystem] ,adh.[PaymentSystem] ,adh.[MainDataSourceCode] ,adh.[StatusChangeType] ,adi2h_wl.[AccountingDocumentItem_HK] ,adhaa_ws.[ReferenceKey] ,#temp_Accounting_Data_PurOrg_G4.[PurchasingOrganization_WHUB0_HK] ,#temp_Accounting_Data_PurOrg_G4.[PurchasingOrganization_BK] ,adhaa_ws.[UserName] ,adiaa_wsj.[ZBD1P] ,adiaa_wsj.[ZBD2P] ,adiap2p_ws.[PaymentBlockKey] ,adhaa_ws.[ReverseDocumentNumber] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceDocumentNumber] ,#temp_Accounting_Data_Vendor_G4.[TradingPartnerCompany] ,adiaa_ws.[PostingKey] ,adhaa_ws.[LogicalSystem] ,adiaa_ws.[InvoiceReference] FROM #temp_Accounting_Data_G4 adh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G4_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G4] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK --inner join [RAWV_Accounting_CSC1].[AccountingDocumentItem_WHUB0_G4] adi_wh -- on adi_wh.AccountingDocumentItem_WHUB0_G4_HK = adi2h_wl.AccountingDocumentItem_WHUB0_G4_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G4_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G4_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSATJ_G4_X] adha_wsj -- on adha_wsj.AccountingDocumentHeader_WHUB0_G4_HK = adh_wh.AccountingDocumentHeader_WHUB0_G4_HK -- and adha_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttribute_WSATJ_G4_X] adiaa_wsj on adiaa_wsj.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left outer join #temp_Accounting_Data_Plant_G4 on #temp_Accounting_Data_Plant_G4.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_Plant_G4.POOrder = 1 left outer join #temp_Accounting_Data_PurOrg_G4 on #temp_Accounting_Data_PurOrg_G4.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_PurOrg_G4.POOrder = 1 left outer join #temp_Accounting_Data_Vendor_G4 on #temp_Accounting_Data_Vendor_G4.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK DROP TABLE IF EXISTS #temp_Accounting_Data_G4 DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G4 DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G4 DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G4 DROP TABLE IF EXISTS #temp_Accounting_Data_G5 SELECT distinct adh_wh.[SAPSystem] ,adh_wh.[FiscalYear_BK] ,adh_wh.[CompanyCodeBK] ,adh_wh.[AccountingDocumentNumber_BK] ,vi_bh.[VendorInvoice_BHUB0_HK] ,visod_bs.[PayableSystem] ,visod_bs.[PostingSystem] ,visod_bs.[PaymentSystem] ,visod_bs.[MainDataSourceCode] ,visod_bs.[StatusChangeType] ,adh_wh.AccountingDocumentHeader_HK into #temp_Accounting_Data_G5 FROM [RAWV_Accounting_CSC1].[AccountingDocumentHeader_WHUB0_G5] adh_wh --collecting data from BV left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoice_BHUB0] vi_bh on vi_bh.[AccountingDocumentYear_BK] = adh_wh.[FiscalYear_BK] and vi_bh.[CompanyCode_BK] = adh_wh.[CompanyCodeBK] and vi_bh.[AccountingDocumentNumber_BK] = adh_wh.[AccountingDocumentNumber_BK] and vi_bh.[PostingSystem_BK] = adh_wh.[SAPSystem] left outer join [BUSV_AccountingP2P_CSC1].[VendorInvoiceSourceOfData_BSAT0_XX_L] visod_bs on visod_bs.[VendorInvoice_BHUB0_HK] = vi_bh.[VendorInvoice_BHUB0_HK] and (visod_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' or visod_bs.[StatusChangeType] = 2 ) --checking if this fits to AccountingDocument from Posting or Payment System left outer join #temp_deltaHKlistAccounting t_dHKA on t_dHKA.[FiscalYear] = vi_bh.[AccountingDocumentYear_BK] and t_dHKA.[CompanyCode] = vi_bh.[CompanyCode_BK] and t_dHKA.[AccountingDocumentNumber] = vi_bh.[AccountingDocumentNumber_BK] and ( (t_dHKA.[SAPSystem] = N'SAP'+visod_bs.[PostingSystem] ) --and adsod_bs.[IsPostedIndicator] = 1) --review this!! or t_dHKA.[SAPSystem] = N'SAP'+visod_bs.[PaymentSystem] ) ----checking if this fits Accounting Documnt of Posted Invoice from PMonitor --left outer join #temp_deltaHKlistPMonitor t_dHKPM -- on t_dHKPM.[FiscalYear] = ad_bh.[AccountingDocumentYear_BK] -- and t_dHKPM.[CompanyCode] = ad_bh.[CompanyCode_BK] -- and t_dHKPM.[AccountingDocumentNumber] = ad_bh.[AccountingDocumentNumber_BK] -- and t_dHKPM.[SAPSystem] = N'SAP'+adsod_bs.[PayableSystem] WHERE 1=1 and adh_wh.[FiscalYear_BK] >= 2021 and ( --t_dHKPM.[InvoiceProcess_HK] is not null -- on the delta list from PMonitor --or t_dHKA.[AccountingDocumentHeader_HK] is not null -- on the delta list from Accounting ); CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_G5 ON #temp_Accounting_Data_G5 (AccountingDocumentHeader_HK); -- Implementation of #FBI-SR-000000138 https://inside-docupedia.bosch.com/confluence/x/1R5Mu DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G5 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,poh2po_wl.[PurchasingOrganization_WHUB0_HK] ,po_wh.[PurchasingOrganization_BK] ,pohma_ws.[DocumentDate] ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_PurOrg_G5 FROM #temp_Accounting_Data_G5 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G5] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G5_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization Latest inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G5] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderToPurchasingOrganization_WLNK0] poh2po_wl on poh2po_wl.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchasingOrganization_WHUB0] po_wh on po_wh.[PurchasingOrganization_WHUB0_HK] = poh2po_wl.[PurchasingOrganization_WHUB0_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G5_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK left join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G5_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_PurOrg_G5 ON #temp_Accounting_Data_PurOrg_G5 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G5 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,pohma_ws.[DocumentDate] ,pl_wh.Plant_HK ,pl_wh.Plant_BK ,ROW_NUMBER()over(partition by adh_wh.AccountingDocumentHeader_HK order by pohma_ws.[DocumentDate] desc) as POOrder into #temp_Accounting_Data_Plant_G5 FROM #temp_Accounting_Data_G5 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G5] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G5_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and adiaa_ws.AccountType = 'S' -- Purchasing Organization inner join [BUSV_Accounting_CSC1].[AccountingDocumentItemToPurchaseOrder_BLNK0_G5] adi2po_bl on adi2po_bl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] poh_wh on poh_wh.[PurchaseOrderHeader_HK] = adi2po_bl.[PurchaseOrderHeader_HK] inner join [RAWV_PUR_CSC2].[PurchaseOrderHeaderMaintenanceAttribute_WSAT0_G5_X] pohma_ws on pohma_ws.[PurchaseOrderHeader_HK] = poh_wh.[PurchaseOrderHeader_HK] and pohma_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- Plant Latest inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WLNK0] poli2p_wl on poli2p_wl.PurchaseOrderLineItem_HK = adi2po_bl.PurchaseOrderLineItem_HK inner join [RAWV_PUR_CSC2].[PurchaseOrderLineItemToPlant_WSATE_G5_X] poli2p_ws on poli2p_ws.PurchaseOrderLineItemToPlant_WLNK0_HK = poli2p_wl.PurchaseOrderLineItemToPlant_WLNK0_HK and poli2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] pl_wh on pl_wh.[Plant_HK] = poli2p_wl.Plant_HK CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Plant_G5 ON #temp_Accounting_Data_Plant_G5 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G5 select distinct adh_wh.AccountingDocumentHeader_HK ,adi2h_wl.AccountingDocumentItem_HK ,va_ws.[TradingPartnerCompany] into #temp_Accounting_Data_Vendor_G5 from #temp_Accounting_Data_G5 adh_wh inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G5] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh_wh.AccountingDocumentHeader_HK --and adh_wh.PostingSystem = 'POE' -- Trading Partner Code left outer join [RAWV_Accounting_CSC1].[AccountingDocumentItemToVendor_WLNK0_G5] adi2v_wl on adi2v_wl.[AccountingDocumentItem_HK] = adi2h_wl.AccountingDocumentItem_HK left outer join [RAWV_PUR_MD_CSC2].[VendorAttribute_WSAT0_G5_X] va_ws on va_ws.[Vendor_HK] = adi2v_wl.[Vendor_HK] and va_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' CREATE CLUSTERED INDEX IX_#temp_Accounting_Data_Vendor_G5 ON #temp_Accounting_Data_Vendor_G5 (AccountingDocumentHeader_HK,AccountingDocumentItem_HK); INSERT INTO #temp_Accounting_Data SELECT distinct 'G5' as [Source] ,adh.[SAPSystem] as [SAPSystem] ,adhaa_ws.[AccountingDocumentHeader_HK] as [AccountingDocumentHeader_HK] ,adhaa_ws.[LoadDate] as [LoadDate] ,adh.[FiscalYear_BK] as [FiscalYear] ,adh.[CompanyCodeBK] as [CompanyCode] ,adi2h_wl.[CompanyCode_HK] as [CompanyCode_HK] ,adh.[AccountingDocumentNumber_BK] as [AccountingDocumentNumber] ,null as [AccountingDocumentLineItem] ,#temp_Accounting_Data_Plant_G5.[Plant_BK] as [Plant_BK] ,#temp_Accounting_Data_Plant_G5.[Plant_HK] as [Plant_HK] ,adhaa_ws.[DocumentDate] ,adhaa_ws.[PostingDate] ,adhaa_ws.[DateTimeOfEntry] ,adiap2p_ws.[TermsOfPaymentKey] ,adiap2p_ws.[BaselineDateforDueDateCalculation] ,adiaa_ws.[VendorNumber] ,adiaa_ws.[CashDiscountDays1] ,adiaa_ws.[CashDiscountDays2] ,adiap2p_ws.[NetPaymentTermsPeriod] ,adiaa_ws.[DaysNet] ,adiaa_ws.[ClearingDate] ,adiaa_ws.[ClearingEntryDate] ,adhaa_ws.[TransactionCode] ,adhaa_ws.[DocumentType] ,adhaa_ws.[ReferenceTransaction] ,adiaa_ws.[AccountType] ,adiaa_ws.[DebitOrCreditIndicator] ,adiaa_wsj.[TBTKZ] ,adh.[VendorInvoice_BHUB0_HK] ,adh.[PayableSystem] ,adh.[PostingSystem] ,adh.[PaymentSystem] ,adh.[MainDataSourceCode] ,adh.[StatusChangeType] ,adi2h_wl.[AccountingDocumentItem_HK] ,adhaa_ws.[ReferenceKey] ,#temp_Accounting_Data_PurOrg_G5.[PurchasingOrganization_WHUB0_HK] ,#temp_Accounting_Data_PurOrg_G5.[PurchasingOrganization_BK] ,adhaa_ws.[UserName] ,adiaa_wsj.[ZBD1P] ,adiaa_wsj.[ZBD2P] ,adiap2p_ws.[PaymentBlockKey] ,adhaa_ws.[ReverseDocumentNumber] ,adiaa_ws.[DocumentNumberOfClearingDocument] ,adhaa_ws.[ReferenceDocumentNumber] ,#temp_Accounting_Data_Vendor_G5.[TradingPartnerCompany] ,adiaa_ws.[PostingKey] ,adhaa_ws.[LogicalSystem] ,adiaa_ws.[InvoiceReference] FROM #temp_Accounting_Data_G5 adh inner join [RAWV_Accounting_CSC1].[AccountingDocumentHeaderAttribute_WSAT0_G5_L] adhaa_ws on adhaa_ws.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK and adhaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemToHeader_WLNK0_G5] adi2h_wl on adi2h_wl.AccountingDocumentHeader_HK = adh.AccountingDocumentHeader_HK inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeAccounting_WSAT0_G5_L] adiaa_ws on adiaa_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_ws.[AccountType] = N'K' --and adiaa_ws.[PostingKey] in ('21','31','25','35') and adiaa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttributeP2P_WSAT0_G5_L] adiap2p_ws on adiap2p_ws.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiap2p_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Accounting_CSC1].[AccountingDocumentItemAttribute_WSATJ_G5_X] adiaa_wsj on adiaa_wsj.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK and adiaa_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' left outer join #temp_Accounting_Data_Plant_G5 on #temp_Accounting_Data_Plant_G5.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_Plant_G5.POOrder = 1 left outer join #temp_Accounting_Data_PurOrg_G5 on #temp_Accounting_Data_PurOrg_G5.AccountingDocumentHeader_HK = adi2h_wl.AccountingDocumentHeader_HK and #temp_Accounting_Data_PurOrg_G5.POOrder = 1 left outer join #temp_Accounting_Data_Vendor_G5 on #temp_Accounting_Data_Vendor_G5.AccountingDocumentItem_HK = adi2h_wl.AccountingDocumentItem_HK DROP TABLE IF EXISTS #temp_Accounting_Data_G5 DROP TABLE IF EXISTS #temp_Accounting_Data_PurOrg_G5 DROP TABLE IF EXISTS #temp_Accounting_Data_Vendor_G5 DROP TABLE IF EXISTS #temp_Accounting_Data_Plant_G5 CREATE CLUSTERED INDEX IX_#temp_Accounting_Data ON #temp_Accounting_Data (VendorInvoice_BHUB0_HK); DROP TABLE IF EXISTS #temp_deltaHKlistPMonitor; DROP TABLE IF EXISTS #temp_deltaHKlistAccounting; delete from #temp_PMonitor_Data where InvoiceProcess_BK is null delete from #temp_Accounting_Data where VendorInvoice_BHUB0_HK is NULL /* ---------------------------------------------------------------------------------------------------------------------- */ -- Step 4 | Forming temp PerFact /* ---------------------------------------------------------------------------------------------------------------------- */ DROP TABLE IF EXISTS #temp_P2P_PerFact CREATE TABLE #temp_P2P_PerFact ( [LoadDate] datetime2 ,[AuditId] bigint ,[EntityId] int ,[LoadEndDate] datetime2 ,[VendorInvoiceDimId] bigint ,[VendorInvoice_BHUB0_HK] binary(20) ,[AccountingDocumentHeader_HK] binary(20) ,[AccountingDocumentItem_HK] binary(20) ,[AccountingDocumentFiscalYear] smallint ,[AccountingDocumentNumberSAP] nvarchar(10) ,[CompanyCodeDimId] bigInt --,[CompanyCode] nvarchar(4) ,[MainDataSource] tinyint ,[PostingSystem] nvarchar(3) ,[PaymentSystem] nvarchar(3) ,[AccountsPayableSystem] nvarchar(3) ,[StatusChangeType] tinyint ,[PurchasingOrganizationDimId] bigint ,[PurchasingOrganization] nvarchar(4) ,[DocumentTypeFIMM] nvarchar(50) ,[TradingPartnerCategory] nvarchar(30) ,[PlantDimId] bigint --,[Plant] nvarchar(4) ,[DocumentChannelCode] smallint --udf ,[DocumentCategoryId] smallint ,[StatusAPM] nvarchar(30) ,[DocumentDate] date ,[ScanDate] date ,[CreateDate] date ,[PostingDate] date ,[EntryDate] date ,[ClearingDate] date ,[ClearingDateAdvanced] date ,[BaselineDate] date ,[NetDueDate] date ,[DaysOverdue] decimal(10,2) ,[DueFlag] bit ,[PaymentTermAccountingDocument] nvarchar(4) ,[PaymentDays] decimal(10,2) ,[VendorNumberForInvoicing] nvarchar(10) ,[ProcessIDAPM] nvarchar(34) ,[BarcodeAPM] nvarchar(40) ,[BarcodeCoCoAPM] nvarchar(20) ,[CompanyCodeSAP] nvarchar(4) ,[CompanyCodeAPM] nvarchar(4) ,[AccountType] nvarchar(1) ,[AccountingDocumentFiscalYearSAP] smallint ,[AccountingDocumentFiscalYearAPM] smallint ,[ReferenceKeySAP] nvarchar(20) ,[ReferenceKeyAPM] nvarchar(20) ,[AutomaticPosting] nvarchar(30) --,[PostedByUser] nvarchar(30) ,[AccountingDocumentType] nvarchar(2) ,[StatusOfAccountingDocument] nvarchar(30) --,[GBView] nvarchar(30) ,[ReadytoPostDate] date ,[InvoiceReceipt] decimal(10,2) ,[InvoiceValidation] decimal(10,2) ,[InvoiceApproval] decimal(10,2) ,[InvoicePosting] decimal(10,2) ,[InvoiceApprovalPosting] decimal(10,2) ,[ProcessingTimeInvoice] decimal(10,2) ,[I2PProcessTime] decimal(10,2) --,[PaymentTermType] nvarchar(100) --,[AccountingDocumentAmountInEURGross] decimal(18,2) --,[AccountingDocumentAmountInEURNet] decimal(18,2) --,[NumberOfAccountingDocumentItems] integer --,[DiscountAmountInEURGross] decimal(18,2) --,[DiscountAmountInEURNet] decimal(18,2) ,[DiscountPercentage1] decimal(5,3) ,[DiscountPercentage2] decimal(5,3) ,[PaymentBlockKey] integer ,[CancellationFlag] bit ,[LocationAPM] nvarchar(4) --,[ValidationType] nvarchar(20) ,[ClearingEntryDate] date ,[DebitCreditIndicator] nvarchar(1) ,[CashDiscountDays1] numeric(3,0) ,[CashDiscountDays2] numeric(3,0) ,[NetPaymentTermsPeriod] numeric(3,0) ,[ChangeDateAPM] date ,[FIDocument] nvarchar(128) ,[AccountingDocumentNumberAPM] nvarchar(10) ,[ReferenceKey] nvarchar(20) --,[AccountingDocumentAmountInLocalCurrencyGross] decimal(18,2) --,[AccountingDocumentAmountInLocalCurrencyNet] decimal(18,2) --,[LocalCurrency] nvarchar(5) --,[AccountingDocumentAmountInDocumentCurrencyGross] decimal(18,2) --,[AccountingDocumentAmountInDocumentCurrencyNet] decimal(18,2) --,[DocumentCurrency] nvarchar(5) ,[DocumentNumberOfTheClearingDocument] nvarchar(10) ,[ReferenceDocumentNumber] nvarchar(16) ,[PaidFlag] bit ,[TradingPartnerCode] nvarchar(30) ,[MIRO] nvarchar(2) ,[SubsequentIndicator] nvarchar(1) ,[PostingKey] nvarchar(3) ,[TransactionCode] nvarchar(20) --,[ClearingDateBasic] date ,[DATA_SOURCE] nvarchar(4) ,[DATA_SOURCE_VARIANT] nvarchar(4) ,[NumberOfInvoiceTransactionBelongsTo] nvarchar(10) ); /* ------------------------------------------------------ */ /* Step 5 | Export to temp PerFact */ /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #cte_Postings select * into #cte_Postings from #temp_Accounting_Data where SAPSystem = N'SAP'+PostingSystem and [LogicalSystem] is null --and [PostingKey] in ('21','31') --and AccountingDocumentNumber <> isnull(DocumentNumberOfClearingDocument,'') collate database_default CREATE CLUSTERED INDEX IX_#cte_Postings ON #cte_Postings ([VendorInvoice_BHUB0_HK]); DROP TABLE IF EXISTS #temp_Payments CREATE TABLE #temp_Payments ( [VendorInvoice_BHUB0_HK] binary(20) ,[Payment_VendorInvoice_BHUB0_HK] binary(20) ,[Payment_AccountingDocumentItem_BHUB0_HK] binary(20) ,[PaymentSystem] nvarchar(6) ); --CASE 1 --Posting System = Payment System with cte_Payments as (select * from #temp_Accounting_Data where PostingKey in ('25','35'))--PostingSystem = PaymentSystem or LogicalSystem is not null) insert into #temp_Payments select tAd.[VendorInvoice_BHUB0_HK] ,Payment.[VendorInvoice_BHUB0_HK] as [Payment_VendorInvoice_BHUB0_HK] ,Payment.AccountingDocumentItem_HK as [Payment_AccountingDocumentItem_BHUB0_HK] ,tAd.[SAPSystem] as [PaymentSystem] from #cte_Postings tAd join cte_Payments Payment on Payment.SAPSystem = tAd.SAPSystem and Payment.FiscalYear = tAd.FiscalYear and Payment.CompanyCode_HK = tAd.CompanyCode_HK and Payment.AccountingDocumentNumber = tAd.DocumentNumberOfClearingDocument collate database_default --AUGBL where tAd.DocumentNumberOfClearingDocument is not NULL --check null or '' !!!! and tAd.DocumentNumberOfClearingDocument != 'ALE-extern' --LogicalSystem blank always -> assumption to be checked --CASE 2 --Posting System IS NOT Payment System ;with cte_Payments as (select * from #temp_Accounting_Data where LogicalSystem is not null) --and AccountingDocumentNumber = DocumentNumberOfClearingDocument collate database_default) insert into #temp_Payments select Posting.[VendorInvoice_BHUB0_HK] ,Payment.[VendorInvoice_BHUB0_HK] as [Payment_VendorInvoice_BHUB0_HK] ,Payment.AccountingDocumentItem_HK as [Payment_AccountingDocumentItem_BHUB0_HK] ,Posting.[PaymentSystem] as [PaymentSystem] from #cte_Postings Posting join cte_Payments Payment on Payment.SAPSystem = N'SAP'+Posting.[PaymentSystem] collate database_default and left(Payment.LogicalSystem,6) = Posting.SAPSystem collate database_default and Payment.FiscalYear = Posting.FiscalYear and Payment.CompanyCode_HK = Posting.CompanyCode_HK and Payment.ReferenceKey = Posting.ReferenceKey --join #temp_Accounting_Data Payment_Posting -- on Payment_Posting.SAPSystem = Posting.[PaymentSystem] collate database_default -- and Payment_Posting.FiscalYear = Posting.FiscalYear -- and Payment_Posting.CompanyCode_HK = Posting.CompanyCode_HK -- and Payment_Posting.ReferenceKey = Posting.ReferenceKey --join cte_Payments Payment -- on Payment.SAPSystem = Payment_Posting.SAPSystem collate database_default -- and Payment.FiscalYear = Payment_Posting.FiscalYear -- and Payment.CompanyCode_HK = Payment_Posting.CompanyCode_HK -- and Payment.DocumentNumberOfClearingDocument = Payment_Posting.AccountingDocumentNumber collate database_default where Posting.DocumentNumberOfClearingDocument ='ALE-extern' CREATE CLUSTERED INDEX IX_#temp_Payments ON #temp_Payments ([Payment_VendorInvoice_BHUB0_HK]); DROP TABLE IF EXISTS #cte_Payments select distinct #temp_Payments.VendorInvoice_BHUB0_HK as Payment_VendorInvoice_BHUB0_HK ,Payments.* into #cte_Payments from #temp_Payments join #temp_Accounting_Data Payments on Payments.VendorInvoice_BHUB0_HK = #temp_Payments.Payment_VendorInvoice_BHUB0_HK and Payments.AccountingDocumentItem_HK = #temp_Payments.Payment_AccountingDocumentItem_BHUB0_HK and Payments.SAPSystem = N'SAP'+ #temp_Payments.PaymentSystem collate database_default CREATE CLUSTERED INDEX IX_#cte_Payments ON #cte_Payments ([Payment_VendorInvoice_BHUB0_HK]); DROP TABLE IF EXISTS #cte_BHUB_HK select distinct VendorInvoice_BHUB0_HK into #cte_BHUB_HK from #temp_PMonitor_Data where VendorInvoice_BHUB0_HK is not null union select distinct VendorInvoice_BHUB0_HK from #cte_Postings where VendorInvoice_BHUB0_HK is not null CREATE CLUSTERED INDEX IX_#cte_BHUB_HK ON #cte_BHUB_HK ([VendorInvoice_BHUB0_HK]); -- 5.1 Get variables DECLARE @LoadTimestamp datetime2 = CURRENT_TIMESTAMP; ;with cte_PerFactData as ( select distinct [LoadDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,[LoadEndDate] = cast('2999-12-31 00:00:00' as datetime2) ,vidi_bsc.[DimensionId] as [VendorInvoiceDimId] ,cte_BHUB_HK.[VendorInvoice_BHUB0_HK] as [VendorInvoice_BHUB0_HK] ,coalesce(t_Ad.[AccountingDocumentHeader_HK],t_AdP.[AccountingDocumentHeader_HK]) as [AccountingDocumentHeader_HK] ,coalesce(t_Ad.[AccountingDocumentItem_HK],t_AdP.[AccountingDocumentItem_HK]) as [AccountingDocumentItem_HK] ,coalesce(t_Ad.FiscalYear,t_PMd.FiscalYear) as [AccountingDocumentFiscalYear] ,coalesce(t_Ad.AccountingDocumentNumber,t_AdP.AccountingDocumentNumber) as [AccountingDocumentNumberSAP] ,ccd_bs.[DimensionId] as [CompanyCodeDimId] ,case when coalesce(t_Ad.PayableSystem,t_PMd.PayableSystem) is NOT NULL and t_PMd.InvoiceProcess_BK is not null and t_Ad.PostingSystem is NOT NULL then 3 --AP+Posting when (coalesce(t_Ad.PayableSystem,t_PMd.PayableSystem) is NULL or t_PMd.InvoiceProcess_BK is null) and t_Ad.PostingSystem is NOT NULL then 2 --Posting Only when coalesce(t_Ad.PayableSystem,t_PMd.PayableSystem) is NOT NULL and t_PMd.InvoiceProcess_BK is not null then 1 --AP Only end as [MainDataSource] ,coalesce(t_Ad.PostingSystem,t_AdP.PostingSystem,t_PMd.PostingSystem) as [PostingSystem] ,right(t_AdP.[SAPSystem],3) as [PaymentSystem] ,coalesce(t_Ad.PayableSystem,t_PMd.PayableSystem) as [AccountsPayableSystem] ,coalesce(t_Ad.StatusChangeType,t_PMd.StatusChangeType) as [StatusChangeType] ,po_wh.PurchasingOrganization_BK as [PurchasingOrganizationLatest] ,podi_bs.[DimensionId] as [PurchasingOrganizationDimId] /* Document Type FI MM (direct/indirect) - #xBI-P2P-000000012 */ ,null as [DocumentTypeFIMM] /* Trading Partner Category - #xBI-P2P-000000010 */ ,case when t_PMd.TradingPartnerCode is null then 'External' when left(t_PMd.TradingPartnerCode,1) in ('A','B') then 'External' else 'Internal' end as [TradingPartnerCategory_APM] ,case when coalesce(t_Ad.AccountingDocumentHeader_HK,t_AdP.AccountingDocumentHeader_HK) is not null then case when coalesce(t_Ad.[TradingPartnerCompany],t_AdP.[TradingPartnerCompany]) is null then 'External' when left(coalesce(t_Ad.[TradingPartnerCompany],t_AdP.[TradingPartnerCompany]),1) in ('A','B') then 'External' else 'Internal' end end as [TradingPartnerCategory_SAP] ,case when coalesce(t_Ad.AccountingDocumentHeader_HK,t_AdP.AccountingDocumentHeader_HK) is not null then coalesce(t_Ad.[TradingPartnerCompany],t_AdP.[TradingPartnerCompany]) else t_PMd.TradingPartnerCode end as [TradingPartnerCode] /* Plant ID - #xBI-P2P-000000003 */ ,pdi_bs.[DimensionId] as [PlantDimId] /* Document Channel Code - #xBI-P2P-000000011 */ --ufn_SR0000000105_P2P_DocumentChannelCode as [DocumentChannelCode] ,Document_Channel_Code as [DocumentChannelCode] /* Document Category - #xBI-P2P-000000013 */ ,case when t_Ad.AccountType = 'K' and t_Ad.DebitOrCreditIndicator = 'H' and t_Ad.TBTKZ is null then 1 when t_Ad.AccountType = 'K' and t_Ad.DebitOrCreditIndicator = 'S' and t_Ad.TBTKZ is null then 2 when t_Ad.AccountType = 'K' and t_Ad.DebitOrCreditIndicator = 'H' and t_Ad.TBTKZ is not null then 3 when t_Ad.AccountType = 'K' and t_Ad.DebitOrCreditIndicator = 'S' and t_Ad.TBTKZ is not null then 4 when t_PMd.VendorInvoice_BHUB0_HK is not null then isnull(t_PMd.DocumentCategoryID,1) --PM data --? else end as [DocumentCategoryId] ,t_PMd.[InvoiceStatus] as [StatusAPM] ,coalesce(t_Ad.DocumentDate,t_AdP.DocumentDate,t_PMd.DocumentDate) as [DocumentDate] ,t_PMd.ScanDate as [ScanDate] ,t_PMd.CreationDate as [CreateDate] ,coalesce(t_Ad.PostingDate,t_AdP.PostingDate,t_PMd.PostingDate) as [PostingDate] ,coalesce(t_Ad.DateTimeOfEntry,t_AdP.DateTimeOfEntry,t_PMd.EntryDate) as [EntryDate] ,coalesce(t_Ad.ClearingDate,t_PMd.ClearingDate) as [ClearingDate] ,coalesce(t_AdP.ClearingDate,t_Ad.ClearingDate,t_PMd.ClearingDate) as [ClearingDateAdvanced] /* NetDueDate #xBI-P2P-000000008 add APM NetDueDate */ --[BaselineDate] + [REFE] ,coalesce(t_Ad.BaselineDateforDueDateCalculation,t_Ad.DocumentDate,t_PMd.BaselineDate) as [BaselineDate] ,case when t_Ad.DebitOrCreditIndicator = N'S' and t_Ad.InvoiceReference is null then 0 --EXCEPTION for non-invoice-related CREDIT NOTES else coalesce(t_Ad.NetPaymentTermsPeriod,t_Ad.CashDiscountDays2,t_Ad.CashDiscountDays1) end as [REFE] ,dateadd(day, isnull((case when t_Ad.DebitOrCreditIndicator = N'S' and t_Ad.InvoiceReference is null then 0 --EXCEPTION for non-invoice-related CREDIT NOTES else coalesce(t_Ad.NetPaymentTermsPeriod,t_Ad.CashDiscountDays2,t_Ad.CashDiscountDays1) end),0) ,coalesce(t_Ad.BaselineDateforDueDateCalculation,t_Ad.DocumentDate,t_PMd.BaselineDate)) as [NetDueDateSAP] ,t_PMd.NetDueDate as [NetDueDateAPM] ,coalesce(t_Ad.TermsOfPaymentKey,t_AdP.TermsOfPaymentKey,t_PMd.PaymentTermAccountingDocument) as [PaymentTermAccountingDocument] ,coalesce(t_Ad.VendorNumber,t_AdP.VendorNumber,t_PMd.VendorNumberForInvoicing) as [VendorNumberForInvoicing] ,t_PMd.[InvoiceProcess_BK] as [ProcessIDAPM] ,t_PMd.[Barcode] as [BarcodeAPM] ,t_PMd.[BarcodeCoCo] as [BarcodeCoCoAPM] ,t_Ad.[CompanyCode] as [CompanyCodeSAP] ,t_PMd.[CompanyCode] as [CompanyCodeAPM] ,coalesce(t_Ad.[AccountType],t_AdP.[AccountType]) as [AccountType] ,t_Ad.[FiscalYear] as [AccountingDocumentFiscalYearSAP] ,t_PMd.[FiscalYear] as [AccountingDocumentFiscalYearAPM] ,coalesce(t_Ad.[ReferenceKey],t_AdP.[ReferenceKey]) as [ReferenceKeySAP] ,t_PMd.[ReferenceKey] as [ReferenceKeyAPM] /* Automatic Posting #xBI-P2P-000000025 */ ,case when t_PMd.CompanyCode = '3210' and t_PMd.PostingUser = 'UC4PIC' then 'Manual' --when t_PMd.AutomaticPostingStatus = 'SUCCESS' and t_PMd.PostingUser = 'PM7_XFT_BTCH' then 'Automatic' when t_PMd.PostingUser != 'A' then 'Automatic' else 'Manual' end as [AutomaticPosting_APM] /* Accounting Document Type */ ,coalesce(t_Ad.DocumentType,t_AdP.DocumentType,t_PMd.DocumentType) as [AccountingDocumentType] ,t_PMd.[ReadyToPostDate] as [ReadyToPostDate] ,case when t_PMd.ScanDate is not null then DATEDIFF(d,t_PMd.DocumentDate,t_PMd.ScanDate) else DATEDIFF(d,t_PMd.DocumentDate,t_PMd.CreationDate) end as [InvoiceReceipt] ,case when t_PMd.ScanDate is not null then DATEDIFF(d,t_PMd.ScanDate,t_PMd.CreationDate) else DATEDIFF(d,t_PMd.CreationDate,t_PMd.CreationDate) end as [InvoiceValidation] ,coalesce(t_Ad.ZBD1P,t_AdP.ZBD1P,t_PMd.DiscountPercentage1) as [DiscountPercentage1] ,coalesce(t_Ad.ZBD2P,t_AdP.ZBD2P,t_PMd.DiscountPercentage2) as [DiscountPercentage2] /* PaymentBlockKey #xBI-P2P-000000016 */ ,case when coalesce(t_Ad.PaymentBlockKey,t_AdP.PaymentBlockKey) is NULL then 0 else 1 end as [PaymentBlockKey_SAP] ,case when t_PMd.PaymentBlock is NULL and t_PMd.PaymentBlockFI is NULL then 0 when t_PMd.PaymentBlockFI is NOT NULL then 1 when t_PMd.PaymentBlock is NOT NULL and t_PMd.PaymentBlockFI is NULL then 2 end as [PaymentBlockKey_APM] /* CancellationFlag #xBI-P2P-000000017 */ ,case when coalesce(t_Ad.[ReverseDocumentNumber],t_AdP.[ReverseDocumentNumber]) is NOT NULL then 1 else 0 end as [CancellationFlag] ,t_PMd.[Location] as [LocationAPM] ,coalesce(t_AdP.[ClearingEntryDate],t_Ad.[ClearingEntryDate],t_PMd.[ClearingEntryDate]) as [ClearingEntryDate] ,t_Ad.DebitOrCreditIndicator as [DebitCreditIndicator] ,coalesce(t_Ad.[CashDiscountDays1],t_AdP.[CashDiscountDays1]) as [CashDiscountDays1] ,coalesce(t_Ad.[CashDiscountDays2],t_AdP.[CashDiscountDays2]) as [CashDiscountDays2] ,coalesce(t_Ad.[NetPaymentTermsPeriod],t_AdP.[NetPaymentTermsPeriod]) as [NetPaymentTermsPeriod] ,t_PMd.[ChangeDate] as [ChangeDateAPM] ,t_PMd.[FIDocument] as [FIDocument] ,t_PMd.[InvoiceDocumentNumber] as [AccountingDocumentNumberAPM] ,coalesce(t_AdP.DocumentNumberOfClearingDocument,t_Ad.DocumentNumberOfClearingDocument, t_PMd.DocumentNumberOfClearingDocument) as [DocumentNumberOfTheClearingDocument] ,coalesce(t_Ad.ReferenceDocumentNumber,t_AdP.ReferenceDocumentNumber, t_PMd.VendorInvoiceNumber) as [ReferenceDocumentNumber] ,case when coalesce(t_Ad.ClearingDate,t_AdP.ClearingDate,t_PMd.ClearingDate) is null then 0 when coalesce(t_Ad.ClearingDate,t_AdP.ClearingDate,t_PMd.ClearingDate) is not null then 1 when coalesce(t_Ad.ClearingDate,t_AdP.ClearingDate,t_PMd.ClearingDate) is not null and coalesce(t_Ad.DocumentNumberOfClearingDocument,t_Ad.DocumentNumberOfClearingDocument) is not null then 2 end as [PaidFlag] ,case when coalesce(t_Ad.ReferenceTransaction,t_AdP.ReferenceTransaction) is not null and coalesce(t_Ad.ReferenceTransaction,t_AdP.ReferenceTransaction) = 'RMRP' then N'MM' when coalesce(t_Ad.ReferenceTransaction,t_AdP.ReferenceTransaction) is not null then N'FI' when t_PMd.DocumentType = 'X' then N'MM' else 'FI'end as [MIRO] ,t_Ad.TBTKZ as [SubsequentIndicator] ,case when t_Ad.VendorInvoice_BHUB0_HK is not null then isnull(t_Ad.[PostingKey],'999') else isnull(t_AdP.[PostingKey],'888') end as [PostingKey] ,case when t_Ad.VendorInvoice_BHUB0_HK is not null then isnull(t_Ad.TransactionCode,'999') else isnull(t_AdP.TransactionCode,'888') end as TransactionCode ,t_PMd.DataSourceVariant as [DATA_SOURCE] --from INV_Q ,t_PMd.DocumentChannel as [DATA_SOURCE_VARIANT] --from YC7F_XFT_C_INV_Q_S7 ,t_Ad.InvoiceReference as [NumberOfInvoiceTransactionBelongsTo] ,case when t_PMd.InvoiceProcess_HK is not null and t_Ad.AccountingDocumentItem_HK is not null then ROW_NUMBER() over (partition by cte_BHUB_HK.VendorInvoice_BHUB0_HK,t_Ad.AccountingDocumentItem_HK order by t_PMd.CreationDate desc) when t_PMd.InvoiceProcess_HK is not null then ROW_NUMBER() over (partition by cte_BHUB_HK.VendorInvoice_BHUB0_HK order by t_PMd.CreationDate desc) else 1 end as [LastProcessId] from #cte_BHUB_HK cte_BHUB_HK join [BUSV_AccountingP2P_CSC1].[VendorInvoiceDimensionId_BSATC_XX_X] vidi_bsc on vidi_bsc.VendorInvoice_BHUB0_HK = cte_BHUB_HK.VendorInvoice_BHUB0_HK left join #temp_PMonitor_Data t_PMd on t_PMd.VendorInvoice_BHUB0_HK = cte_BHUB_HK.VendorInvoice_BHUB0_HK left join #cte_Postings t_Ad on t_Ad.VendorInvoice_BHUB0_HK = cte_BHUB_HK.VendorInvoice_BHUB0_HK left join #cte_Payments t_AdP on t_AdP.Payment_VendorInvoice_BHUB0_HK = cte_BHUB_HK.VendorInvoice_BHUB0_HK and t_AdP.[AccountingDocumentLineItem] = t_Ad.[AccountingDocumentLineItem] --Dimensions left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] ccd_bs on ccd_bs.CompanyCode_HK = coalesce(t_Ad.CompanyCode_HK,t_PMd.CompanyCode_HK) left join [BUSV_RB_CSC1].[PlantDimensionID_BSATC_XX_X] pdi_bs on pdi_bs.Plant_HK = coalesce(isnull(t_Ad.Plant_HK,-1),t_PMd.Plant_HK) left join [RAWV_PUR_CSC2].[PurchasingOrganizationDimensionId_BSATC_XX_L] podi_bs --on podi_bs.PurchasingOrganization_WHUB0_HK = coalesce(isnull(t_Ad.[PurchasingOrganization_HK],-1),t_PMd.[PurchasingOrganization_HK]) --to rework on podi_bs.PurchasingOrganization_WHUB0_HK = (case when t_Ad.VendorInvoice_BHUB0_HK is not null then isnull(t_Ad.[PurchasingOrganization_HK],-1) else t_PMd.[PurchasingOrganization_HK] end) left join [RAWV_PUR_CSC2].[PurchasingOrganization_WHUB0] po_wh on po_wh.PurchasingOrganization_WHUB0_HK = podi_bs.PurchasingOrganization_WHUB0_HK cross apply [BUSV_AccountingP2P_CSC1].[ufn_SR0000000105_P2P_DocumentChannelCode] (coalesce(t_Ad.TransactionCode,t_AdP.TransactionCode) ,coalesce(t_Ad.DocumentType,t_AdP.DocumentType,t_PMd.DocumentType) ,coalesce(t_Ad.PayableSystem,t_AdP.PayableSystem,t_PMd.PayableSystem) ,t_PMd.Barcode ,t_PMd.DataSourceVariant --DATA_SOURCE from INV_Q ,t_PMd.DocumentChannel --DATA_SOURCE_VARIANT from YC7F_XFT_C_INV_Q_S7 ) ) INSERT INTO #temp_P2P_PerFact select [LoadDate] as [LoadDate] ,[AuditId] as [AuditId] ,[EntityId] as [EntityId] ,[LoadEndDate] as [LoadEndDate] ,[VendorInvoiceDimId] as [VendorInvoiceDimId] ,[VendorInvoice_BHUB0_HK] as [VendorInvoice_BHUB0_HK] ,[AccountingDocumentHeader_HK] as [AccountingDocumentHeader_HK] ,[AccountingDocumentItem_HK] as [AccountingDocumentItem_HK] ,[AccountingDocumentFiscalYear] as [AccountingDocumentFiscalYear] ,[AccountingDocumentNumberSAP] as [AccountingDocumentNumberSAP] ,[CompanyCodeDimId] as [CompanyCodeDimId] ,[MainDataSource] as [MainDataSource] ,[PostingSystem] as [PostingSystem] ,[PaymentSystem] as [PaymentSystem] ,[AccountsPayableSystem] as [AccountsPayableSystem] ,[StatusChangeType] as [StatusChangeType] ,case when [MIRO]=N'FI' then null else [PurchasingOrganizationDimId] end as [PurchasingOrganizationDimId] ,case when [MIRO]=N'FI' then null else [PurchasingOrganizationLatest] end as [PurchasingOrganization] ,case when [MIRO] = N'FI' then N'FI' when [MIRO] = N'MM' and left([PurchasingOrganizationLatest],1) = N'Z' then N'MM INDIRECT' else N'MM DIRECT' end as [DocumentTypeFIMM] ,coalesce([TradingPartnerCategory_SAP],[TradingPartnerCategory_APM]) as [TradingPartnerCategory] ,[PlantDimId] as [PlantDimId] --,[Plant] ,[DocumentChannelCode] as [DocumentChannelCode] ,[DocumentCategoryId] as [DocumentCategoryId] ,[StatusAPM] as [StatusAPM] ,[DocumentDate] as [DocumentDate] ,[ScanDate] as [ScanDate] ,[CreateDate] as [CreateDate] ,[PostingDate] as [PostingDate] ,[EntryDate] as [EntryDate] ,[ClearingDate] as [ClearingDate] ,[ClearingDateAdvanced] as [ClearingDateAdvanced] ,[BaselineDate] as [BaselineDate] ,coalesce([NetDueDateSAP],[NetDueDateAPM]) as [NetDueDate] --#xBI-P2P-000000018 ,case when [ClearingDate] is not null then datediff(DAY,coalesce([NetDueDateSAP],[NetDueDateAPM]),[ClearingDate]) else datediff(DAY,coalesce([NetDueDateSAP],[NetDueDateAPM]),dateadd(day,-1,[LoadDate])) end as [DaysOverdue] --#xBI-P2P-000000019 ,case when [ClearingDate] is not null then case when datediff(DAY,coalesce([NetDueDateSAP],[NetDueDateAPM]),[ClearingDate]) > 0 then 1 else 0 end else case when datediff(DAY,coalesce([NetDueDateSAP],[NetDueDateAPM]),dateadd(day,-1,[LoadDate])) > 0 then 1 else 0 end end as [DueFlag] ,[PaymentTermAccountingDocument] as [PaymentTermAccountingDocument] ,case when [ClearingDate] is not null then datediff(DAY,[BaselineDate],[ClearingDate]) end as [PaymentDays] ,[VendorNumberForInvoicing] as [VendorNumberForInvoicing] ,[ProcessIDAPM] as [ProcessIDAPM] ,[BarcodeAPM] as [BarcodeAPM] ,[BarcodeCoCoAPM] as [BarcodeCoCoAPM] ,[CompanyCodeSAP] as [CompanyCodeSAP] ,[CompanyCodeAPM] as [CompanyCodeAPM] ,[AccountType] as [AccountType] ,[AccountingDocumentFiscalYearSAP] as [AccountingDocumentFiscalYearSAP] ,[AccountingDocumentFiscalYearAPM] as [AccountingDocumentFiscalYearAPM] ,[ReferenceKeySAP] as [ReferenceKeySAP] ,[ReferenceKeyAPM] as [ReferenceKeyAPM] ,[AutomaticPosting_APM] as [AutomaticPosting] ,[AccountingDocumentType] as [AccountingDocumentType] ,case when [ClearingDate] is not null then 1 else 0 end as [StatusOfAccountingDocument] ,[ReadyToPostDate] as [ReadyToPostDate] ,[InvoiceReceipt] as [InvoiceReceipt] ,[InvoiceValidation] as [InvoiceValidation] ,DATEDIFF(d,[CreateDate],[ReadyToPostDate]) as [InvoiceApproval] ,DATEDIFF(d,[ReadyToPostDate],[EntryDate]) as [InvoicePosting] ,DATEDIFF(d,[CreateDate],[EntryDate]) as [InvoiceApprovalPosting] ,DATEDIFF(d,[DocumentDate],[EntryDate]) as [ProcessingTimeInvoice] ,DATEDIFF(d,[DocumentDate],[ClearingDate]) as [I2PProcessTime] ,[DiscountPercentage1] ,[DiscountPercentage2] ,coalesce([PaymentBlockKey_SAP],[PaymentBlockKey_APM]) as [PaymentBlockKey] ,[CancellationFlag] ,[LocationAPM] ,[ClearingEntryDate] ,[DebitCreditIndicator] ,[CashDiscountDays1] ,[CashDiscountDays2] ,[NetPaymentTermsPeriod] ,[ChangeDateAPM] ,[FIDocument] ,[AccountingDocumentNumberAPM] ,coalesce([ReferenceKeySAP],[ReferenceKeyAPM]) as [ReferenceKey] ,[DocumentNumberOfTheClearingDocument] ,[ReferenceDocumentNumber] ,[PaidFlag] ,[TradingPartnerCode] ,[MIRO] ,[SubsequentIndicator] ,[PostingKey] ,[TransactionCode] --,[ClearingDateBasic] ,[DATA_SOURCE] ,[DATA_SOURCE_VARIANT] ,[NumberOfInvoiceTransactionBelongsTo] from cte_PerFactData where [LastProcessId] = 1 --in case of more then 1 process_id assigned to document, take last one created /* ------------------------------------------------------ */ -- Insert temp PerFact into target table /* ------------------------------------------------------ */ BEGIN TRY BEGIN TRAN update AccP2P_PF SET AccP2P_PF.[LoadEndDate] = @LoadTimestamp from [INFM_AccountingP2P_CSC2].[INTF_AccountingP2P_PerFact] AccP2P_PF join #temp_P2P_PerFact ON AccP2P_PF.[VendorInvoice_BHUB0_HK] = #temp_P2P_PerFact.[VendorInvoice_BHUB0_HK] AND AccP2P_PF.[AccountingDocumentHeader_HK] = #temp_P2P_PerFact.[AccountingDocumentHeader_HK] AND AccP2P_PF.[AccountingDocumentItem_HK] = #temp_P2P_PerFact.[AccountingDocumentItem_HK] AND AccP2P_PF.[LoadEndDate] = CAST('2999-12-31 00:00:00.0000000' AS DATETIME2) -- WHEN NOT MATCHED THEN INSERT INTO [INFM_AccountingP2P_CSC2].[INTF_AccountingP2P_PerFact] ( [LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[VendorInvoiceDimId] ,[VendorInvoice_BHUB0_HK] ,[AccountingDocumentHeader_HK] ,[AccountingDocumentItem_HK] ,[AccountingDocumentFiscalYear] ,[AccountingDocumentNumberSAP] ,[CompanyCodeDimId] ,[MainDataSource] ,[PostingSystem] ,[PaymentSystem] ,[AccountsPayableSystem] ,[StatusChangeType] ,[PurchasingOrganizationDimId] --,[PurchasingOrganization] ,[DocumentTypeFIMM] ,[TradingPartnerCategory] ,[PlantDimId] --,[Plant] ,[DocumentChannelCode] ,[DocumentCategoryId] ,[StatusAPM] ,[DocumentDate] ,[ScanDate] ,[CreateDate] ,[PostingDate] ,[EntryDate] ,[ClearingDate] ,[ClearingDateAdvanced] ,[BaselineDate] ,[NetDueDate] ,[DaysOverdue] ,[DueFlag] ,[PaymentTermAccountingDocument] ,[PaymentDays] ,[VendorNumberForInvoicing] ,[ProcessIDAPM] ,[BarcodeAPM] ,[BarcodeCoCoAPM] ,[CompanyCodeSAP] ,[CompanyCodeAPM] ,[AccountType] ,[AccountingDocumentFiscalYearSAP] ,[AccountingDocumentFiscalYearAPM] ,[ReferenceKeySAP] ,[ReferenceKeyAPM] ,[AutomaticPosting] ,[AccountingDocumentType] ,[StatusOfAccountingDocument] ,[ReadytoPostDate] ,[InvoiceReceipt] ,[InvoiceValidation] ,[InvoiceApproval] ,[InvoicePosting] ,[InvoiceApprovalPosting] ,[ProcessingTimeInvoice] ,[I2PProcessTime] ,[DiscountPercentage1] ,[DiscountPercentage2] ,[PaymentBlockKey] ,[CancellationFlag] ,[LocationAPM] ,[ClearingEntryDate] ,[DebitCreditIndicator] ,[CashDiscountDays1] ,[CashDiscountDays2] ,[NetPaymentTermsPeriod] ,[ChangeDateAPM] ,[FIDocument] ,[AccountingDocumentNumberAPM] ,[ReferenceKey] ,[DocumentNumberOfTheClearingDocument] ,[ReferenceDocumentNumber] ,[PaidFlag] ,[TradingPartnerCode] ,[MIRO] ,[SubsequentIndicator] ,[PostingKey] ,[TransactionCode] ,[DATA_SOURCE] ,[DATA_SOURCE_VARIANT] ,[NumberOfInvoiceTransactionBelongsTo] ,[DaysOverdueInclGracePeriod] ,[DaysOverdueClusterKey] ) select --* [LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[VendorInvoiceDimId] ,isnull([VendorInvoice_BHUB0_HK],-1) ,[AccountingDocumentHeader_HK] ,[AccountingDocumentItem_HK] ,[AccountingDocumentFiscalYear] ,[AccountingDocumentNumberSAP] ,[CompanyCodeDimId] ,[MainDataSource] ,[PostingSystem] ,[PaymentSystem] ,[AccountsPayableSystem] ,[StatusChangeType] ,[PurchasingOrganizationDimId] --,[PurchasingOrganization] ,[DocumentTypeFIMM] ,[TradingPartnerCategory] ,[PlantDimId] --,[Plant] ,[DocumentChannelCode] ,[DocumentCategoryId] ,[StatusAPM] ,[DocumentDate] ,[ScanDate] ,[CreateDate] ,[PostingDate] ,[EntryDate] ,[ClearingDate] ,[ClearingDateAdvanced] ,[BaselineDate] ,[NetDueDate] ,[DaysOverdue] ,[DueFlag] ,[PaymentTermAccountingDocument] ,[PaymentDays] ,[VendorNumberForInvoicing] ,[ProcessIDAPM] ,[BarcodeAPM] ,[BarcodeCoCoAPM] ,[CompanyCodeSAP] ,[CompanyCodeAPM] ,[AccountType] ,[AccountingDocumentFiscalYearSAP] ,[AccountingDocumentFiscalYearAPM] ,[ReferenceKeySAP] ,[ReferenceKeyAPM] ,[AutomaticPosting] ,[AccountingDocumentType] ,[StatusOfAccountingDocument] ,[ReadytoPostDate] ,[InvoiceReceipt] ,[InvoiceValidation] ,[InvoiceApproval] ,[InvoicePosting] ,[InvoiceApprovalPosting] ,[ProcessingTimeInvoice] ,[I2PProcessTime] ,[DiscountPercentage1] ,[DiscountPercentage2] ,[PaymentBlockKey] ,[CancellationFlag] ,[LocationAPM] ,[ClearingEntryDate] ,[DebitCreditIndicator] ,[CashDiscountDays1] ,[CashDiscountDays2] ,[NetPaymentTermsPeriod] ,[ChangeDateAPM] ,[FIDocument] ,[AccountingDocumentNumberAPM] ,[ReferenceKey] ,[DocumentNumberOfTheClearingDocument] ,[ReferenceDocumentNumber] ,[PaidFlag] ,[TradingPartnerCode] ,[MIRO] ,[SubsequentIndicator] ,[PostingKey] ,[TransactionCode] ,[DATA_SOURCE] ,[DATA_SOURCE_VARIANT] ,[NumberOfInvoiceTransactionBelongsTo] ,[DaysOverdue]-2 as [DaysOverdueInclGracePeriod] ,case when ([DaysOverdue]-2) between -9999999999 and -90 then 1 when ([DaysOverdue]-2) between -90 and -61 then 2 when ([DaysOverdue]-2) between -61 and -31 then 3 when ([DaysOverdue]-2) between -31 and -11 then 4 when ([DaysOverdue]-2) between -11 and -6 then 5 when ([DaysOverdue]-2) between -6 and -3 then 6 when ([DaysOverdue]-2) between -3 and 0 then 7 when ([DaysOverdue]-2) between 0 and 2 then 8 when ([DaysOverdue]-2) between 2 and 10 then 9 when ([DaysOverdue]-2) between 10 and 30 then 10 when ([DaysOverdue]-2) between 30 and 60 then 11 when ([DaysOverdue]-2) between 60 and 90 then 12 when ([DaysOverdue]-2) between 90 and 180 then 13 when ([DaysOverdue]-2) between 180 and 9999999999 then 14 end as [DaysOverdueClusterKey] from #temp_P2P_PerFact where MainDataSource is not null ; COMMIT TRAN END TRY BEGIN CATCH PRINT 'In CATCH Block' SET @ProcessStatusMessage = N'In CATCH Block:' + @ProcessStatusMessage IF(@@TRANCOUNT > 0) ROLLBACK TRAN; END CATCH /* ------------------------------------------------------ */ -- Get rows inserted for logging /* ------------------------------------------------------ */ SET @RowsInserted = (SELECT COUNT(*) FROM #temp_P2P_PerFact) SET @RowsRead = @RowsInserted SET @RowsUpdated = 0 SET @RowsDeleted = 0 /* ------------------------------------------------------ */ -- Last Step | Cleanup /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #temp_deltaHKlistPMonitor DROP TABLE IF EXISTS #temp_deltaHKlistAccounting DROP TABLE IF EXISTS #temp_PMonitor_Data DROP TABLE IF EXISTS #temp_Accounting_Data DROP TABLE IF EXISTS #cte_Postings DROP TABLE IF EXISTS #temp_Payments DROP TABLE IF EXISTS #cte_Payments DROP TABLE IF EXISTS #cte_BHUB_HK DROP TABLE IF EXISTS #temp_P2P_PerFact end"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_Plant_V2_IDIM1;289800490;V ;VIEW;2185;/**/ /* View: V_INTF_Plant_V2_IDIM1 */ /**/ /**/ /* V01.00.00 2023-05-04 Aman Kumar BD/XAD5 */ /* Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0335 https://inside-docupedia.bosch.com/confluence/x/TFmCpw */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.00 2023-05-04 - initial */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G0;292508421;V ;VIEW;3385;/**/ /* View: V_COPlanCostsDelta_G0 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G2;293276500;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_O2;293888414;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;15543;"/**/ /* V01.00.00 2022-08-24 Tunc Yomut GS/BDD1 */ /* Fact View for GS Trust SGnA Cost Plan */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ --/* This function implements the following soft rules: */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* V01.00.00 - Copy of G0 */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_O2 ( @year int ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @year int = 2022; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_O2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_O2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@year * 100 + 1 ) and (@year * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_', coalesce(IIF( ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' , Left(ccoll_wh_partner.[CostCollectorObject_BK],2),NULL ),N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] from cte_PlanCost pc left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G2;294500328;V ;VIEW;3549;/**/ /* View: V_SparePart_IDIM1_G2 */ /**/ /**/ /* V01.00.00 - 2021-11-26 Stephan Wund GS/BDD2 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P72 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G2] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Spare Part_IDIM1_G0 */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_D0;301556458;V ;VIEW;8501;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_D0 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_GK;304368499;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_GK ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_GK_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_GK_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_PurchasingOrganization_IDIM1;305084523;V ;VIEW;1286;/**/ /* View: V_INTF_PurchasingOrganization_IDIM1 */ /**/ /**/ /* V01.00.00 2023-03-24 Sanja Mihalic BD/XAD3 */ /* Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0335 https://inside-docupedia.bosch.com/confluence/x/TFmCpw */ /* Update: */ /* V01.00.00 2023-03-24 - initial */ /**/
INFM_AccountingP2P_CSC2;121;INFormation Mart;usp_DeltaLoad_INTF_AccountingP2P_SNAP;305136578;P ;SQL_STORED_PROCEDURE;17296;"/* =*/ /* V01.00.06 - 2023-08-17 Sanja Mihalic BD/XAD3 */ /* This Stored Procedure for incremantal loading of P2P Persisted Fact Data SNAP */ /* Data.CORE Outgoing Interface #0191 https://inside-docupedia.bosch.com/confluence/x/RT1Qf */ /* Implemented Soft Rules: */ /* #FBI-SR-000000105 https://inside-docupedia.bosch.com/confluence/x/3A0Wn */ /* Restriction: */ /* - Tailored loading for Accounting P2P only */ /* - Covered sources: S7 (APM), G0, G4, G5 */ /* Update: */ /* - V01.00.05 2023-08-17: New fileds added for #xBI-P2P-000000008 NetDueDate and #xBI-P2P-000000018 DaysOverdue */ /* - V01.00.05 2023-07-27: New fileds added for UAT purpose */ /* - V01.00.04 2023-07-07: New Key Logic implemented (VendorInvoice_BHUB) */ /* - V01.00.03 2023-05-08: Additional columns: SubsequentIndicator, PostingKey, TransactionCode */ /* - V01.00.02 2023-04-07: Additional columns */ /* - V01.00.01 2023-02-28: Change of field name PaymentTermDays to PaymentDays */ /* - V01.00.00 2023-02-03: Initial version */ /* =*/ create procedure INFM_AccountingP2P_CSC2.usp_DeltaLoad_INTF_AccountingP2P_SNAP ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* = */ /* Start declaration for testing purpose */ /* Uncomment below column to be able to test the code */ --DECLARE @DeltaTimestampFrom datetime2 --DECLARE @DeltaTimestampTo datetime2 --DECLARE @LoadBatchId bigint --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int --SET @DeltaTimestampFrom = '2023-08-01 00:00:00.0000000' --SET @DeltaTimestampTo = '2023-08-17 00:00:00.0000000' /* End declaration for testing purpose */ /* = */ /* --------------------------------------------------------------------------------------------------------------------- */ -- Step 1 | Get all 3rd WDM for current year that are not saved as SNAP /* --------------------------------------------------------------------------------------------------------------------- */ DROP TABLE IF EXISTS #temp_dateList; select rd.[YearMonth] ,rd.[FullDate] ,DATEDIFF(day, DATEADD(month, DATEDIFF(month, 0, rd.FullDate), 0), rd.FullDate) + 1 - DATEDIFF(week, DATEADD(month, DATEDIFF(month, 0, rd.FullDate), 0), rd.FullDate) * 2 - (CASE WHEN DATENAME(WEEKDAY, DATEADD(month, DATEDIFF(month, 0, rd.FullDate), 0)) = 'Sunday' THEN 1 ELSE 0 END) - (CASE WHEN DATENAME(WEEKDAY, rd.FullDate) = 'Saturday' THEN 1 ELSE 0 END) - hdn.HolidayDayNumber as [WorkdayNumber] into #temp_dateList FROM [RAWV_RB_CSC1].[RefDate_WREF0] rd CROSS APPLY (select rd.FullDate, count(*) as HolidayDayNumber from [FBI_CORE_META_P].[lzfw].[HolidayMetadata] Hm where HolidayDate between @DeltaTimestampFrom and @DeltaTimestampTo and DATENAME(WEEKDAY,HolidayDate) not in ('Sunday','Saturday') and left(HolidayDate,7) = left(rd.FullDate,7) and HolidayDate <= rd.FullDate ) hdn where rd.FullDate between @DeltaTimestampFrom and @DeltaTimestampTo /* ---------------------------------------------------------------------------------------------------------------------- */ -- Step 2 | Forming temp PerFact /* ---------------------------------------------------------------------------------------------------------------------- */ DROP TABLE IF EXISTS #temp_P2P_PerFact_SNAP CREATE TABLE #temp_P2P_PerFact_SNAP ( LoadDate datetime2 ,AuditId bigint ,EntityId integer ,SnapDate date ,YearMonthSnap int ,AccountingDocumentDimId bigint ,AccountingDocument_BHUB0_HK binary(20) ,AccountingDocumentHeader_HK binary(20) ,AccountingDocumentItem_HK binary(20) ,AccountingDocumentFiscalYear smallint ,AccountingDocumentNumberSAP nvarchar(10) ,CompanyCodeDimId bigint ,MainDataSource tinyint ,PostingSystem nvarchar(3) ,PaymentSystem nvarchar(3) ,AccountsPayableSystem nvarchar(3) ,[StatusChangeType] tinyint ,PurchasingOrganizationDimId bigint ,PurchasingOrganization nvarchar(4) ,DocumentTypeFIMM nvarchar(50) ,TradingPartnerCategory nvarchar(30) ,PlantDimId bigint ,Plant nvarchar(4) ,DocumentChannelCode smallint ,DocumentCategoryId smallint ,StatusAPM nvarchar(30) ,DocumentDate date ,ScanDate date ,CreateDate date ,PostingDate date ,EntryDate date ,ClearingDate date ,ClearingDateAdvanced date ,BaselineDate date ,NetDueDate date ,DaysOverdue decimal(10,2) ,DueFlag bit ,PaymentTermAccountingDocument nvarchar(4) ,PaymentDays decimal(10,2) ,VendorNumberForInvoicing nvarchar(10) ,ProcessIDAPM nvarchar(34) ,BarcodeAPM nvarchar(40) ,BarcodeCoCoAPM nvarchar(20) ,CompanyCodeSAP nvarchar(4) ,CompanyCodeAPM nvarchar(4) ,AccountType nvarchar(1) ,AccountingDocumentFiscalYearSAP smallint ,AccountingDocumentFiscalYearAPM smallint ,ReferenceKeySAP nvarchar(20) ,ReferenceKeyAPM nvarchar(20) ,AutomaticPosting nvarchar(30) ,PostedByUser nvarchar(30) ,AccountingDocumentType nvarchar(2) ,StatusOfAccountingDocument nvarchar(30) ,GBView nvarchar(30) ,ReadytoPostDate date ,InvoiceReceipt decimal(10,2) ,InvoiceValidation decimal(10,2) ,InvoiceApproval decimal(10,2) ,InvoicePosting decimal(10,2) ,InvoiceApprovalPosting decimal(10,2) ,ProcessingTimeInvoice decimal(10,2) ,I2PProcessTime decimal(10,2) ,PaymentTermType nvarchar(100) ,AccountingDocumentAmountInEURGross decimal(18,2) ,AccountingDocumentAmountInEURNet decimal(18,2) ,NumberOfAccountingDocumentItems integer ,DiscountAmountInEURGross decimal(18,2) ,DiscountAmountInEURNet decimal(18,2) ,DiscountPercentage1 decimal(5,3) ,DiscountPercentage2 decimal(5,3) ,PaymentBlockKey integer ,CancellationFlag bit ,LocationAPM nvarchar(4) ,ValidationType nvarchar(20) ,ClearingEntryDate date ,DebitCreditIndicator nvarchar(1) ,CashDiscountDays1 numeric(3,0) ,CashDiscountDays2 numeric(3,0) ,NetPaymentTermsPeriod numeric(3,0) ,ChangeDateAPM date ,FIDocument nvarchar(128) ,AccountingDocumentNumberAPM nvarchar(10) ,ReferenceKey nvarchar(20) ,AccountingDocumentAmountInLocalCurrencyGross decimal(18,2) ,AccountingDocumentAmountInLocalCurrencyNet decimal(18,2) ,LocalCurrency nvarchar(5) ,AccountingDocumentAmountInDocumentCurrencyGross decimal(18,2) ,AccountingDocumentAmountInDocumentCurrencyNet decimal(18,2) ,DocumentCurrency nvarchar(5) ,DocumentNumberOfTheClearingDocument nvarchar(10) ,ReferenceDocumentNumber nvarchar(16) ,[PaidFlag] bit ,[TradingPartnerCode] nvarchar(30) ,[MIRO] nvarchar(2) ,[SubsequentIndicator] nvarchar(1) ,[PostingKey] nvarchar(3) ,[TransactionCode] nvarchar(20) ,[DATA_SOURCE] nvarchar(4) ,[DATA_SOURCE_VARIANT] nvarchar(4) ,[NumberOfInvoiceTransactionBelongsTo] nvarchar(10) ,[DaysOverdueInclGracePeriod] int ,[DaysOverdueClusterKey] int ); /* ------------------------------------------------------ */ /* Step 3 | Export to temp PerFact */ /* ------------------------------------------------------ */ DECLARE @LoadTimestamp datetime2 = CURRENT_TIMESTAMP; DECLARE @Snap_date date DECLARE @YearMonth int DECLARE DateCursor CURSOR FOR select [FullDate], [YearMonth] from #temp_dateList where [WorkdayNumber] = 3 and DATENAME(WEEKDAY,[FullDate]) not in ('Sunday','Saturday') and [FullDate] not in ( select distinct SnapDate from [INFM_AccountingP2P_CSC2].[INTF_AccountingP2P_PerFact_SNAP] where SnapDate between @DeltaTimestampFrom and @DeltaTimestampTo ) order by 1 OPEN DateCursor FETCH NEXT FROM DateCursor INTO @Snap_date, @YearMonth WHILE (@@FETCH_STATUS = 0) BEGIN --print @Snap_date --print @Snap_date insert into #temp_P2P_PerFact_SNAP ( LoadDate ,AuditId ,EntityId ,SnapDate ,YearMonthSnap ,AccountingDocumentDimId ,AccountingDocument_BHUB0_HK ,AccountingDocumentHeader_HK ,AccountingDocumentItem_HK ,AccountingDocumentFiscalYear ,AccountingDocumentNumberSAP ,CompanyCodeDimId ,MainDataSource ,PostingSystem ,PaymentSystem ,AccountsPayableSystem ,StatusChangeType ,PurchasingOrganizationDimId ,PurchasingOrganization ,DocumentTypeFIMM ,TradingPartnerCategory ,PlantDimId ,Plant ,DocumentChannelCode ,DocumentCategoryId ,StatusAPM ,DocumentDate ,ScanDate ,CreateDate ,PostingDate ,EntryDate ,ClearingDate ,ClearingDateAdvanced ,BaselineDate ,NetDueDate ,DaysOverdue ,DueFlag ,PaymentTermAccountingDocument ,PaymentDays ,VendorNumberForInvoicing ,ProcessIDAPM ,BarcodeAPM ,BarcodeCoCoAPM ,CompanyCodeSAP ,CompanyCodeAPM ,AccountType ,AccountingDocumentFiscalYearSAP ,AccountingDocumentFiscalYearAPM ,ReferenceKeySAP ,ReferenceKeyAPM ,AutomaticPosting ,PostedByUser ,AccountingDocumentType ,StatusOfAccountingDocument ,GBView ,ReadytoPostDate ,InvoiceReceipt ,InvoiceValidation ,InvoiceApproval ,InvoicePosting ,InvoiceApprovalPosting ,ProcessingTimeInvoice ,I2PProcessTime ,PaymentTermType ,AccountingDocumentAmountInEURGross ,AccountingDocumentAmountInEURNet ,NumberOfAccountingDocumentItems ,DiscountAmountInEURGross ,DiscountAmountInEURNet ,DiscountPercentage1 ,DiscountPercentage2 ,PaymentBlockKey ,CancellationFlag ,LocationAPM ,ValidationType ,ClearingEntryDate ,DebitCreditIndicator ,CashDiscountDays1 ,CashDiscountDays2 ,NetPaymentTermsPeriod ,ChangeDateAPM ,FIDocument ,AccountingDocumentNumberAPM ,ReferenceKey ,AccountingDocumentAmountInLocalCurrencyGross ,AccountingDocumentAmountInLocalCurrencyNet ,LocalCurrency ,AccountingDocumentAmountInDocumentCurrencyGross ,AccountingDocumentAmountInDocumentCurrencyNet ,DocumentCurrency ,DocumentNumberOfTheClearingDocument ,ReferenceDocumentNumber ,[PaidFlag] ,[TradingPartnerCode] ,[MIRO] ,[SubsequentIndicator] ,[PostingKey] ,[TransactionCode] ,[DATA_SOURCE] ,[DATA_SOURCE_VARIANT] ,[NumberOfInvoiceTransactionBelongsTo] ,[DaysOverdueInclGracePeriod] ,[DaysOverdueClusterKey] ) select [LoadDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,@Snap_date ,@YearMonth ,VendorInvoiceDimId ,VendorInvoice_BHUB0_HK ,AccountingDocumentHeader_HK ,AccountingDocumentItem_HK ,AccountingDocumentFiscalYear ,AccountingDocumentNumberSAP ,CompanyCodeDimId ,MainDataSource ,PostingSystem ,PaymentSystem ,AccountsPayableSystem ,StatusChangeType ,PurchasingOrganizationDimId ,PurchasingOrganization ,DocumentTypeFIMM ,TradingPartnerCategory ,PlantDimId ,Plant ,DocumentChannelCode ,DocumentCategoryId ,StatusAPM ,DocumentDate ,ScanDate ,CreateDate ,PostingDate ,EntryDate ,ClearingDate ,ClearingDateAdvanced ,BaselineDate ,NetDueDate ,DaysOverdue ,DueFlag ,PaymentTermAccountingDocument ,PaymentDays ,VendorNumberForInvoicing ,ProcessIDAPM ,BarcodeAPM ,BarcodeCoCoAPM ,CompanyCodeSAP ,CompanyCodeAPM ,AccountType ,AccountingDocumentFiscalYearSAP ,AccountingDocumentFiscalYearAPM ,ReferenceKeySAP ,ReferenceKeyAPM ,AutomaticPosting ,PostedByUser ,AccountingDocumentType ,StatusOfAccountingDocument ,GBView ,ReadytoPostDate ,InvoiceReceipt ,InvoiceValidation ,InvoiceApproval ,InvoicePosting ,InvoiceApprovalPosting ,ProcessingTimeInvoice ,I2PProcessTime ,PaymentTermType ,AccountingDocumentAmountInEURGross ,AccountingDocumentAmountInEURNet ,NumberOfAccountingDocumentItems ,DiscountAmountInEURGross ,DiscountAmountInEURNet ,DiscountPercentage1 ,DiscountPercentage2 ,PaymentBlockKey ,CancellationFlag ,LocationAPM ,ValidationType ,ClearingEntryDate ,DebitCreditIndicator ,CashDiscountDays1 ,CashDiscountDays2 ,NetPaymentTermsPeriod ,ChangeDateAPM ,FIDocument ,AccountingDocumentNumberAPM ,ReferenceKey ,AccountingDocumentAmountInLocalCurrencyGross ,AccountingDocumentAmountInLocalCurrencyNet ,LocalCurrency ,AccountingDocumentAmountInDocumentCurrencyGross ,AccountingDocumentAmountInDocumentCurrencyNet ,DocumentCurrency ,DocumentNumberOfTheClearingDocument ,ReferenceDocumentNumber ,[PaidFlag] ,[TradingPartnerCode] ,[MIRO] ,[SubsequentIndicator] ,[PostingKey] ,[TransactionCode] ,[DATA_SOURCE] ,[DATA_SOURCE_VARIANT] ,[NumberOfInvoiceTransactionBelongsTo] ,[DaysOverdueInclGracePeriod] ,[DaysOverdueClusterKey] from [INFM_AccountingP2P_CSC2].[INTF_AccountingP2P_PerFact] where (AccountingDocumentFiscalYear = YEAR(@Snap_date) or YEAR(CreateDate) = YEAR(@Snap_date) ) and @Snap_date between LoadDate and LoadEndDate FETCH NEXT FROM DateCursor INTO @Snap_date, @YearMonth END /*cursor WHILE*/ CLOSE DateCursor DEALLOCATE DateCursor /* ------------------------------------------------------ */ /* Step 4 | Final destination */ /* ------------------------------------------------------ */ BEGIN TRY BEGIN TRAN INSERT INTO [INFM_AccountingP2P_CSC2].[INTF_AccountingP2P_PerFact_SNAP] select * from #temp_P2P_PerFact_SNAP COMMIT TRAN END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; END CATCH /* ------------------------------------------------------ */ -- Get rows inserted for logging /* ------------------------------------------------------ */ SET @RowsInserted = (SELECT COUNT(*) FROM #temp_P2P_PerFact_SNAP) SET @RowsRead = @RowsInserted SET @RowsUpdated = 0 SET @RowsDeleted = 0 /* ------------------------------------------------------ */ -- Last Step | Cleanup /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #temp_dateList DROP TABLE IF EXISTS #temp_P2P_PerFact_SNAP end"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G5;305644382;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G5 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P87 */ /* Changes: */ /* Restriction: */ /**/
INFI_DCQMM_CSC1;106;INFormation Mart as Interface;V_INTF_DCQMM_REF_ExchangeRatesToEuro;305696437;V ;VIEW;1831;/**/ /* View: V_INTF_DCQMM_REF_ExchangeRatesToEuro */ /**/ /* = */ /* V 01.00.00 2022-07-11 Ilja Frolov GS/BDD2 */ /* This view delivers the exchange rates from X to EURO to DC */ /* Data.CORE Outgoing Interface #0245 https://inside-docupedia.bosch.com/confluence/x/IzfiiQ */ /* - Filter on [ExchangeRateType] = ZCAY Cross rates average yearly */ /* - Filter on [ExchangeRateType] = ZCAM Cross rates average monthly */ /* >> Definition copied from [INFI_TM1_CSC2].[V_INTF_PNL_REF_ExchangeRatesToEuro] */ /* = */
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_Vendor_V1_IDIM1;305800547;V ;VIEW;1341;/**/ /* View: V_INTF_Vendor_V1_IDIM1 */ /**/ /**/ /* V01.00.00 2023-05-08 Aman Kumar BD/XAD5 */ /* Vendor Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0201 https://inside-docupedia.bosch.com/confluence/x/1D6tfg */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.00 2023-05-08 - initial */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G1;308508478;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G3;309276557;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_D3;317556515;V ;VIEW;8347;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_D3 */ /**/ /* = */ /* V01.00.01 2022-11-10 Michal Erdman */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.01 Added PartnerCostCenter and PartnerActivityType */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_O1;320368556;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17163;"/**/ /* V01.04.01 2023-01-23 Michal Erdman & Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_O1 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_O1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_O1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_TM1_CSC2;9;INFormation Mart as Interface;usp_DeltaLoad_INTF_PNL_FACT_COPA_CS_V2;321136635;P ;SQL_STORED_PROCEDURE;52126;"/* = */ /* V01.00.26 - 2023-08-04 URA1FE, Tatjana Derdus BD/BTM-AC1 & Ilja Frolov GS/BDD1, Yannick Sigwalt GS/BDD1 */ /* This Stored Procedure for incremantal loading of P&L.Series Persisted Fact Data of CO-PA */ /* Data.CORE Outgoing Interface #0056 https://inside-docupedia.bosch.com/confluence/x/C7t9Vg */ /* Implemented Soft Rules: */ /* #FBI-SR-000000049 https://inside-docupedia.bosch.com/confluence/x/jwNAYw */ /* Restriction: */ /* - Tailored loading for P&L.Series only */ /* - Covered sources: G0, G6, I3, O5, S3, B2, D7 */ /* - Used for loading of P&L.Series Input Cube and Dillthrough from application to Data.CORE */ /* - No reuse without alignment with P&L.Series application */ /* Update: */ /* - V01.00.26: Fixed delta mechanism by optaining Loaddate from COPAAmount_WSATM_xx_L */ /* - V01.00.25: Reverted back to V01.00.23 due to changed requirements, a dedicated model PnL Service will be provided */ /* - V01.00.24: Reworked to include data from P47/D7 (Steps 1.1b, 1.2b, 1.3b, 2.1b, 2.2b, 3.1b, 3.2b, 3.3b, 5.2b, Cleanup) */ /* - V01.00.23: Changed WBSElement to internal */ /* - V01.00.22: removed join condition on YearMonthCreation for Amount and Quantity satellite */ /* - V01.00.21: Optimized querying on BBM Satellites */ /* - V01.00.20: - Added newcolumns + removed loading of C3 */ /* - Correct behavior that WBS Element were only delivered for POE instead of all systems */ /* - V01.00.19: Changed dynamic Filter for GYEAR */ /* - V01.00.18: Added dynamic Filter for GYEAR */ /* - V01.00.17: Corrected wrong Mapping on KUNRE */ /* - V01.00.16: Corrected Typo in Join with COPAAttribute_WSATJ_xx_L */ /* - V01.00.15: Added Column RBELN and RPOSN */ /* - V01.00.14: Change CreationDateTime source from Attribute Sat to Amount/Quantity Sat */ /* - V01.00.13: Add LoadEndDate filter for Quantities */ /* - V01.00.12: Change FiscalYear filter to >= 2021 */ /* - V01.00.11: Add reverse sign flag */ /* - V01.00.10: Create HK for Alternate Key values */ /* - V01.00.08: Sync conversion for BUDAT */ /* - V01.00.07: Replace CO-PA views for I3, O5 */ /* - V01.00.06: Add NameOfValueFieldOrg */ /* - V01.00.05: Rework currency information manaagement for quantities by enhanced data model */ /* - V01.00.04: Rework currency information manaagement for quantities by enhanced business logic */ /* - V01.00.03: Added Filter on LoadEndDate for CO-PA Satellite */ /* - V01.00.02: Implemented #FBI-SR-000000049 RB-Customer Sold-To */ /* - V01.00.01: Increase precision of data type for Amount column to decimal (18,5) */ /* - V01.00.00: Initial version */ /* = */ create procedure INFI_TM1_CSC2.usp_DeltaLoad_INTF_PNL_FACT_COPA_CS_V2 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* = */ /* Start declaration for testing purpose */ /* Uncomment below column to be able to test the code */ --DECLARE @DeltaTimestampFrom datetime2 --DECLARE @DeltaTimestampTo datetime2 --DECLARE @LoadBatchId bigint --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int --SET @DeltaTimestampFrom = '2022-01-01 00:00:01' --SET @DeltaTimestampTo = '2999-03-03 23:59:00' /* End declaration for testing purpose */ /* = */ DECLARE @DynamicYearFilter smallint = year(DATEADD(month, -6, SYSUTCDATETIME())) --dynamic Filter to switch to current year /* ------------------------------------------------------ */ -- Step 1 | Get CO-PA Hashkeys for all delta timestamps /* ------------------------------------------------------ */ -- Definition of delta time range. -- In this version same range for all sources only! -- Connection to Meta Mart necessary for source specific time ranges! -- Step 1.1 get the delta timestamps DROP TABLE IF EXISTS #temp_deltaHKlist; CREATE TABLE #temp_deltaHKlist ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[COPADocumentLineItem_HK] binary(20) ,[LoadDate] datetime2 ,[CreationDateTime] datetime2 ); -- Step 1.2 Save the timestamps in temp table INSERT INTO #temp_deltaHKlist SELECT * FROM ( Select NULL as [Source], NULL as [SAPSystem], NULL as [COPADocumentLineItem_HK], NULL as [LoadDate], NULL as [CreationDateTime] UNION ALL SELECT 'B2', N'SAPPS0', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_B2_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_B2_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G0', N'SAPPOE', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G0_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G0_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G1', N'SAPP45', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G1_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G1_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G2', N'SAPP72', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G2_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G2_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G3', N'SAPP79', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G3_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G3_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G4', N'SAPP81', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G4_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G4_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G5', N'SAPP87', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G5_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G5_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'G6', N'SAPP99', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_G6_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_G6_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 UNION ALL SELECT 'S3', N'SAPP66', [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_S3_L] copaat_ws WHERE EXISTS (SELECT 1 FROM [RAWV_COPA_CSC2].[COPAAmount_WSATM_S3_L] copaam_ws WHERE copaam_ws.[COPADocumentLineItem_HK] = copaat_ws.[COPADocumentLineItem_HK] and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and copaam_ws.[LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo ) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and [FiscalYear] >= 2021 ) temp_deltaHKlist ; -- Step 1.3 Create index for temp table to support following joins CREATE CLUSTERED INDEX IX_#temp_deltaHKlist ON #temp_deltaHKlist (COPADocumentLineItem_HK); /* ------------------------------------------------------ */ -- Step 2 | Get all Hub data delta timestamps /* ------------------------------------------------------ */ -- Step 2.1 Write hub data into temp table DROP TABLE IF EXISTS #temp_hub_data SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,wbse_wh.[WBSElement_BK] --,wea_ws.[WBSElementShortDescription] ,NULL as [WBSElement] ,bd_wh.[BusinessDivision_BK] ,bu_wh.[BusinessUnit_BK] -- RBCustomer roles ,strbc_wh.[RBCustomer_BK] ,prbc_wh.[RBCustomer_BK] as [RBCustomer_Project] -- Customer roles ,s2c_wh.[Customer_BK] as [Customer_SoldTo] ,b2c_wh.[Customer_BK] as [Customer_BillTo] ,sh2c_wh.[Customer_BK] as [Customer_ShipTo] ,io_wh.[InternalOrder_BK] ,sccent_wh.[ControllingArea_ID_BK] as [COArea_CostCenter] ,sccent_wh.[CostCenterID_BK] ,ce_wh.[ControllingArea_ID_BK] as [COArea_CostElement] ,ce_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] ,p_wh.[Plant_BK] ,prm_wh.[Material_BK] ,pc_wh.[ProfitCenter_BK] ,ppc_wh.[ProfitCenter_BK] as [ProfitCenter_Partner] ,#temp_deltaHKlist.[CreationDateTime] as [CreationDateTime] /* ATTENTION: NEW TEMP TABLE WILL BE USED TO STORE THE DATA */ INTO #temp_hub_data FROM #temp_deltaHKlist INNER JOIN [RAWV_COPA_CSC2].[COPADocumentLineItem_WHUB0] copadli_wh on copadli_wh.[SAPSystem] = #temp_deltaHKlist.[SAPSystem] COLLATE Latin1_General_CS_AS and copadli_wh.[COPADocumentLineItem_HK] = #temp_deltaHKlist.[COPADocumentLineItem_HK] /* WBS Element */ left join [RAWV_COPA_CSC2].[WBSElementToCOPADocumentLineItem_WLNK0] we2copadli_wl on we2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh on wbse_wh.[WBSElement_HK] = we2copadli_wl.[WBSElement_HK] -- left join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl -- on wbsesapi2biv_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] -- left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh -- on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] /* Business Division */ inner join [RAWV_COPA_CSC2].[BusinessDivisionToCOPADocumentLineItem_WLNK0] bd2copadli_wl on bd2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_wh on bd_wh.[BusinessDivision_HK] = bd2copadli_wl.[BusinessDivision_HK] /* Business Unit */ left join [RAWV_COPA_CSC2].[BusinessUnitToCOPADocumentLineItem_WLNK0] bu2copadli_wl on bu2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[BusinessUnit_WHUB0] bu_wh on bu_wh.[BusinessUnit_HK] = bu2copadli_wl.[BusinessUnit_HK] /* RB Customer Sold-To */ left join [RAWV_COPA_CSC2].[SoldToRBCustomerToCOPADocumentLineItem_WLNK0] strbc2copadli_wl on strbc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] strbc_wh on strbc_wh.[RBCustomer_HK] = strbc2copadli_wl.[RBCustomer_HK] /* RB Customer Project */ left join [RAWV_COPA_CSC2].[ProjectRBCustomerToCOPADocumentLineItem_WLNK0] prbc2copadli_wl on prbc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] prbc_wh on prbc_wh.[RBCustomer_HK] = prbc2copadli_wl.[RBCustomer_HK] /* Customer Sold-to */ left join [RAWV_COPA_CSC2].[SoldToCustomerToCOPADocumentLineItem_WLNK0] s2c2copadli_wl on s2c2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Customer_WHUB0] s2c_wh on s2c_wh.[Customer_HK] = s2c2copadli_wl.[Customer_HK] /* Customer Bill-to */ left join [RAWV_COPA_CSC2].[BillToCustomerToCOPADocumentLineItem_WLNK0] b2c2copadli_wl on b2c2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Customer_WHUB0] b2c_wh on b2c_wh.[Customer_HK] = b2c2copadli_wl.[Customer_HK] /* Customer Ship-to */ left join [RAWV_COPA_CSC2].[ShipToCustomerToCOPADocumentLineItem_WLNK0] sh2c2copadli_wl on sh2c2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Customer_WHUB0] sh2c_wh on sh2c_wh.[Customer_HK] = sh2c2copadli_wl.[Customer_HK] /* Internal Order */ left join [RAWV_COPA_CSC2].[InternalOrderToCOPADocumentLineItem_WLNK0] io2copadli_wl on io2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_COOM_CSC1].[InternalOrder_WHUB0] io_wh on io_wh.[InternalOrder_HK] = io2copadli_wl.[InternalOrder_HK] /* CostCenter Sender */ left join [RAWV_COPA_CSC2].[SenderCostCenterToCOPADocumentLineItem_WLNK0] scentc2copadli_wl on scentc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] sccent_wh on sccent_wh.[CostCenter_HK] = scentc2copadli_wl.[CostCenter_HK] /* Cost Element */ left join [RAWV_COPA_CSC2].[CostElementToCOPADocumentLineItem_WLNK0] ce2copadli_wl on ce2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] ce_wh on ce_wh.[CostElementByControllingArea_HK] = ce2copadli_wl.[CostElementByControllingArea_HK] /* Company Code */ left join [RAWV_COPA_CSC2].[CompanyCodeToCOPADocumentLineItem_WLNK0] compc2copadli_wl on compc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = compc2copadli_wl.[CompanyCode_HK] /* Plant */ left join [RAWV_COPA_CSC2].[PlantToCOPADocumentLineItem_WLNK0] p2copadli_wl on p2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = p2copadli_wl.[Plant_HK] /* Material Product */ left join [RAWV_COPA_CSC2].[ProductToCOPADocumentLineItem_WLNK0] pr2copadli_wl on pr2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Material_WHUB0] prm_wh on prm_wh.[Material_HK] = pr2copadli_wl.[Material_HK] /* Profit Center */ left join [RAWV_COPA_CSC2].[ProfitCenterToCOPADocumentLineItem_WLNK0] pc2copadli_wl on pc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = pc2copadli_wl.[ProfitCenter_HK] /* Profit Center - Partner */ left join [RAWV_COPA_CSC2].[PartnerProfitCenterToCOPADocumentLineItem_WLNK0] ppc2copadli_wl on ppc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] ppc_wh on ppc_wh.[ProfitCenter_HK] = ppc2copadli_wl.[ProfitCenter_HK] ; -- Step 2.1 Create index to support joins CREATE CLUSTERED INDEX ix_#temp_hub_data ON #temp_hub_data (COPADocumentLineItem_HK); /* ------------------------------------------------------ */ -- Step 3 | Join the Hub data with the Sat data /* ------------------------------------------------------ */ -- Step 3.1 Sepcify temp table for raw result DROP TABLE IF EXISTS #temp_result_raw CREATE TABLE #temp_result_raw ( SAPSystem nvarchar(30) ,COPADocumentLineItem_HK binary(20) ,COPADocumentNumber_BK nvarchar(20) ,COPAPosition_BK nvarchar(12) ,LoadDate datetime2 ,WBSElement_BK int --,WBSElementShortDescription nvarchar(80) ,WBSElement nvarchar(48) ,BusinessDivision_BK nvarchar(20) ,BusinessUnit_BK nvarchar(60) ,RBCustomer_BK nvarchar(20) ,RBCustomer_Project nvarchar(20) ,Customer_SoldTo nvarchar(20) ,Customer_BillTo nvarchar(20) ,Customer_ShipTo nvarchar(20) ,InternalOrder_BK nvarchar(24) ,COArea_CostCenter nvarchar(8) ,CostCenterID_BK nvarchar(20) ,COArea_CostElement nvarchar(8) ,CostElement_ID_BK nvarchar(20) ,CompanyCode_BK nvarchar(8) ,Plant_BK nvarchar(8) ,Material_BK nvarchar(36) ,ProfitCenter_BK nvarchar(20) ,ProfitCenter_Partner nvarchar(20) ,CurrencyTypeOfOperatingConcern nvarchar(4) ,ForeignCurrencyKey nvarchar(10) ,ExchangeRate decimal(9,5) ,CurrencyKey nvarchar(10) ,NameOfValueField nvarchar(60) ,Amount decimal(28,9) ,LoadDateDVSat datetime2 ,RecordType varchar(2) ,FiscalYearPeriod int ,CreationDateTime datetime2 ,FiscalYear smallint ,PostingDate datetime2 ,BillingType nvarchar(8) ,OrderReason nvarchar(6) ,Country nvarchar(6) ,MaterialType nvarchar(8) ,ProductHierarchy1 nvarchar(10) ,ProductHierarchy2 nvarchar(20) ,ProductHierarchy3 nvarchar(36) ,IntercompanyIndicator nvarchar(2) ,ReferenceCOPADocumentNumber_BK nvarchar(10) ,ReferenceCOPAPosition_BK nvarchar(6) ,SalesDocumentType nvarchar(4) ,SalesDocumentItemCategory nvarchar(4) ) /* Create iteration list*/ DROP TABLE IF EXISTS #source_list; SELECT * INTO #source_list FROM (VALUES ('B2','SAPPS0','PS0011', 1) ,('G0','SAPPOE','POE011', 1) ,('G2','SAPP72','P72011', 1) ,('G3','SAPP79','P79011', 1) ,('G4','SAPP81','P81011', 1) ,('G5','SAPP87','P87011', 1) ,('G6','SAPP99','P99011', 1) ,('S3','SAPP66','P66011', 1) ,('G1','SAPP45','P45011', 1) ,('I3','SAPGP1','GP1401', 0) ,('O5','SAPGP7','GP7470', 0) ) t1 ([SourceId], [SAPSystem], [SAPSystemClient], [State]) -- Step 3.2 Load Hub and Sat data into temp table, iteration is done cursor DECLARE @SourceId VARCHAR(2), @SAPSystem VARCHAR(6), @SAPSystemClient VARCHAR(6); DECLARE source_list_cursor CURSOR FOR SELECT [SourceId], [SAPSystem], [SAPSystemClient] FROM #source_list WHERE [State] = 1 OPEN source_list_cursor; FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient /* begin reading amount keyfigues */ WHILE @@FETCH_STATUS = 0 BEGIN DECLARE @DeltaTimestampFromCursor DATETIME2 = @DeltaTimestampFrom DECLARE @DeltaTimestampToCursor DATETIME2 = @DeltaTimestampTo DECLARE @SQL nvarchar(max) SET @SQL = ' insert into #temp_result_raw SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,copadli_wh.[WBSElement_BK] ,copadli_wh.[WBSElement] ,copadli_wh.[BusinessDivision_BK] ,copadli_wh.[BusinessUnit_BK] ,copadli_wh.[RBCustomer_BK] ,copadli_wh.[RBCustomer_Project] ,copadli_wh.[Customer_SoldTo] ,copadli_wh.[Customer_BillTo] ,copadli_wh.[Customer_ShipTo] ,copadli_wh.[InternalOrder_BK] ,copadli_wh.[COArea_CostCenter] ,copadli_wh.[CostCenterID_BK] ,copadli_wh.[COArea_CostElement] ,copadli_wh.[CostElement_ID_BK] ,copadli_wh.[CompanyCode_BK] ,copadli_wh.[Plant_BK] ,copadli_wh.[Material_BK] ,copadli_wh.[ProfitCenter_BK] ,copadli_wh.[ProfitCenter_Partner] ,copaam_ws.[CurrencyTypeOfOperatingConcern] ,copaam_ws.[ForeignCurrencyKey] ,copaam_ws.[ExchangeRate] ,copaam_ws.[CurrencyKey] ,copaam_ws.[NameOfValueField] ,copaam_ws.[Amount] ,copaat_ws.[LoadDate] ,copaat_ws.[RecordType] ,copaat_ws.[FiscalYearPeriod] --,copaat_ws.[CreationDateTime] -- deprecated ,copaam_ws.[CreationDateTime] ,copaat_ws.[FiscalYear] ,copaat_ws.[PostingDate] ,copaat_ws.[BillingType] ,copaat_ws.[OrderReason] ,copaat_ws.[Country] ,copaat_ws.[MaterialType] ,copaat_ws.[ProductHierarchy1] ,copaat_ws.[ProductHierarchy2] ,copaat_ws.[ProductHierarchy3] ,copaat_ws.[IntercompanyIndicator] ,NULLIF(copaat_wsj.[RBELN],N'' '') as [ReferenceCOPADocumentNumber_BK] ,NULLIF(copaat_wsj.[RPOSN],N'' '') as [ReferenceCOPAPosition_BK] ,copaat_ws.[SalesDocumentType] as [SalesDocumentType] ,copaat_wsj.[PSTYV] as [SalesDocumentItemCategory] from #temp_hub_data copadli_wh inner join [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_'+@SourceId+'_L] copaat_ws on copaat_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_ws.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_ws.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaat_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_COPA_CSC2].[COPAAttribute_WSATJ_'+@SourceId+'_L] copaat_wsj on copaat_wsj.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_wsj.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_wsj.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaat_wsj.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_COPA_CSC2].[COPAAmount_WSATM_'+@SourceId+'_L] copaam_ws on copaam_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] --and copaam_ws.[CreationDateTime] >= copadli_wh.[CreationDateTime] and copaam_ws.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaam_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ;' EXECUTE sp_executesql @SQL FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient END /* End reading amount keyfigues */ CLOSE source_list_cursor; DEALLOCATE source_list_cursor; ; -- Step 3.3 Repeat step 3.2 for quantity only DECLARE source_list_cursor CURSOR FOR SELECT [SourceId], [SAPSystem], [SAPSystemClient] FROM #source_list WHERE [State] = 1 OPEN source_list_cursor; FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient /* begin reading Quantity keyfigues */ WHILE @@FETCH_STATUS = 0 BEGIN SET @SQL = ' INSERT INTO #temp_result_raw SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,copadli_wh.[WBSElement_BK] ,copadli_wh.[WBSElement] ,copadli_wh.[BusinessDivision_BK] ,copadli_wh.[BusinessUnit_BK] ,copadli_wh.[RBCustomer_BK] ,copadli_wh.[RBCustomer_Project] ,copadli_wh.[Customer_SoldTo] ,copadli_wh.[Customer_BillTo] ,copadli_wh.[Customer_ShipTo] ,copadli_wh.[InternalOrder_BK] ,copadli_wh.[COArea_CostCenter] ,copadli_wh.[CostCenterID_BK] ,copadli_wh.[COArea_CostElement] ,copadli_wh.[CostElement_ID_BK] ,copadli_wh.[CompanyCode_BK] ,copadli_wh.[Plant_BK] ,copadli_wh.[Material_BK] ,copadli_wh.[ProfitCenter_BK] ,copadli_wh.[ProfitCenter_Partner] -------- ,copaqa_ws.CurrencyTypeOfOperatingConcern as [CurrencyTypeOfOperatingConcern] ,copaqa_ws.ForeignCurrencyKey as [ForeignCurrencyKey] ,copaqa_ws.ExchangeRate as [ExchangeRate] ,copaqa_ws.CurrencyKey as [CurrencyKey] -------- ,copaqa_ws.[NameOfValueField] as [NameOfValueField] ,copaqa_ws.[Quantity] as [Amount] -------- ,copaat_ws.LoadDate as [LoadDate] ,copaat_ws.RecordType as [RecordType] ,copaat_ws.FiscalYearPeriod as [FiscalYearPeriod] --,copaat_ws.CreationDateTime as [CreationDateTime] --deprecated ,copaqa_ws.CreationDateTime as [CreationDateTime] ,copaat_ws.FiscalYear as [FiscalYear] ,copaat_ws.PostingDate as [PostingDate] ,copaat_ws.BillingType as [BillingType] ,copaat_ws.OrderReason as [OrderReason] ,copaat_ws.Country as [Country] ,copaat_ws.MaterialType as [MaterialType] ,copaat_ws.ProductHierarchy1 as [ProductHierarchy1] ,copaat_ws.ProductHierarchy2 as [ProductHierarchy2] ,copaat_ws.ProductHierarchy3 as [ProductHierarchy3] ,copaat_ws.IntercompanyIndicator as [IntercompanyIndicator] ,NULLIF(copaat_wsj.[RBELN],N'' '') as [ReferenceCOPADocumentNumber_BK] ,NULLIF(copaat_wsj.[RPOSN],N'' '') as [ReferenceCOPAPosition_BK] ,copaat_ws.[SalesDocumentType] as [SalesDocumentType] ,copaat_wsj.[PSTYV] as [SalesDocumentItemCategory] from #temp_hub_data copadli_wh inner join [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_'+@SourceId+'_L] copaat_ws on copaat_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_ws.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_ws.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaat_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_COPA_CSC2].[COPAAttribute_WSATJ_'+@SourceId+'_L] copaat_wsj on copaat_wsj.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_wsj.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_wsj.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaat_wsj.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_COPA_CSC2].[COPAQuantity_WSATM_'+@SourceId+'_L] copaqa_ws on copaqa_ws.COPADocumentLineItem_HK = copadli_wh.COPADocumentLineItem_HK --and copaqa_ws.[CreationDateTime] >= copadli_wh.[CreationDateTime] and copaqa_ws.[LoadDate] between CAST('+ '''' +CAST(@DeltaTimestampFromCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and CAST('+ '''' +CAST(@DeltaTimestampToCursor AS NVARCHAR(MAX)) + '''' +' AS DATETIME2) and copaqa_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ;' EXECUTE sp_executesql @SQL FETCH NEXT FROM source_list_cursor INTO @SourceId, @SAPSystem, @SAPSystemClient END /* End reading Quantity keyfigues */ CLOSE source_list_cursor; DEALLOCATE source_list_cursor; /* --------------------------------------------------------- */ /* Step 4 | Prepare export and create stage table */ /* --------------------------------------------------------- */ DROP TABLE IF EXISTS #INTF_PNL_FACT_COPA_CS_V2_STAGE; CREATE TABLE #INTF_PNL_FACT_COPA_CS_V2_STAGE ( [RowInsertDate] datetime2 ,[AuditId] int ,[EntityId] int ,[RowEndDate] datetime2 ,[LoadPackageId] int ,[COPA_Item_HK] binary (20) ,[LoadDateDVSat] datetime2 ,[SAPSystem] nvarchar (30) COLLATE Latin1_General_CS_AS ,[SAPSystemClient] nvarchar (30) COLLATE Latin1_General_CS_AS ,[DocumentNumberIdBK] nvarchar (20) COLLATE Latin1_General_CS_AS ,[DocumentNumberPosid] nvarchar (12) COLLATE Latin1_General_CS_AS ,[MANDT] varchar (3) ,[PALEDGER] nvarchar (4) COLLATE Latin1_General_CS_AS ,[VRGAR] nvarchar (2) COLLATE Latin1_General_CS_AS ,[PERIO] int ,[BELNR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[POSNR] nvarchar (12) COLLATE Latin1_General_CS_AS ,[HZDAT] varchar (30) COLLATE Latin1_General_CS_AS ,[HZDAT_DATE] date ,[HZDAT_TIMESTAMP] datetime2 ,[TIMESTMP] datetime2 ,[GJAHR] smallint ,[BUDAT] varchar (30) COLLATE Latin1_General_CS_AS ,[KNDNR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[ARTNR] nvarchar (36) COLLATE Latin1_General_CS_AS ,[MatNr10Digit] nvarchar (20) COLLATE Latin1_General_CS_AS ,[FKART] nvarchar (8) COLLATE Latin1_General_CS_AS ,[FRWAE] nvarchar (10) COLLATE Latin1_General_CS_AS ,[KURSF] decimal (9,5) ,[REC_WAERS] nvarchar (10) COLLATE Latin1_General_CS_AS ,[RKAUFNR] nvarchar (24) COLLATE Latin1_General_CS_AS ,[SKOST] nvarchar (20) COLLATE Latin1_General_CS_AS ,[BUKRS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[KOKRS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[WERKS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[KSTAR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[PSPNR] int ,[WBSElement] nvarchar (48) COLLATE Latin1_General_CS_AS ,[PRCTR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[PPRCTR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[AUGRU] nvarchar (6) COLLATE Latin1_General_CS_AS ,[KUNRE] nvarchar (20) COLLATE Latin1_General_CS_AS ,[KUNWE] nvarchar (20) COLLATE Latin1_General_CS_AS ,[LAND1] nvarchar (6) COLLATE Latin1_General_CS_AS ,[MTART] nvarchar (8) COLLATE Latin1_General_CS_AS ,[PAPH1] nvarchar (10) COLLATE Latin1_General_CS_AS ,[PAPH2] nvarchar (20) COLLATE Latin1_General_CS_AS ,[PAPH3] nvarchar (36) COLLATE Latin1_General_CS_AS ,[WWR01] nvarchar (6) COLLATE Latin1_General_CS_AS ,[WWR02] nvarchar (20) COLLATE Latin1_General_CS_AS ,[WWR13] nvarchar (20) COLLATE Latin1_General_CS_AS ,[WWR14] nvarchar (2) COLLATE Latin1_General_CS_AS ,[WWR28] nvarchar (20) COLLATE Latin1_General_CS_AS ,[CustomerSoldTo] nvarchar (20) COLLATE Latin1_General_CS_AS ,[NameOfValueField] nvarchar (60) COLLATE Latin1_General_CS_AS ,[ValueField] decimal (28,9) ,[NameOfValueFieldOrg] nvarchar (60) COLLATE Latin1_General_CS_AS ,[ReverseFlag] smallint ,[RBELN] nvarchar(10) COLLATE Latin1_General_CS_AS ,[RPOSN] nvarchar(6) COLLATE Latin1_General_CS_AS ,[AUART] nvarchar(4) COLLATE Latin1_General_CS_AS ,[PSTYV] nvarchar(4) COLLATE Latin1_General_CS_AS ) /* ------------------------------------------------------ */ /* Step 5 | Export to stage */ /* ------------------------------------------------------ */ -- 5.1 Get variables DECLARE @LoadTimestamp datetime2 = CURRENT_TIMESTAMP DECLARE @LoadPackageId integer SELECT @LoadPackageId = next value for [INFI_TM1_CSC2].[SEQ_LoadPackageId_INTF_PNL_FACT_COPA_CS] -- 5.2 Clean and insert data into target CCI table INSERT INTO #INTF_PNL_FACT_COPA_CS_V2_STAGE ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[MANDT] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_DATE] ,[HZDAT_TIMESTAMP] ,[TIMESTMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[MatNr10Digit] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[PSPNR] ,[WBSElement] ,[PRCTR] ,[PPRCTR] ,[AUGRU] ,[KUNRE] ,[KUNWE] ,[LAND1] ,[MTART] ,[PAPH1] ,[PAPH2] ,[PAPH3] ,[WWR01] ,[WWR02] ,[WWR13] ,[WWR14] ,[WWR28] ,[CustomerSoldTo] ,[NameOfValueField] ,[ValueField] ,[NameOfValueFieldOrg] ,[ReverseFlag] ,[RBELN] ,[RPOSN] ,[AUART] ,[PSTYV] ) SELECT [RowInsertDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,[RowEndDate] = cast('2999-12-31 00:00:00' as datetime2) ,[LoadPackageId] = @LoadPackageId ,[COPA_Item_HK] = HASHBYTES('SHA1', RTRIM(LTRIM(CONVERT(VARCHAR(1024),[SAPSystem]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[COPADocumentNumber_BK]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[COPAPosition_BK]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[CurrencyTypeOfOperatingConcern]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[NameOfValueField]))) ) --[COPADocumentLineItem_HK] ,[LoadDateDVSat] = [LoadDateDVSat] ,[SAPSystem] = [SAPSystem] ,[SAPSystemClient] = Concat(substring([SAPSystem],4,3),'011') ,[DocumentNumberIdBK] = [COPADocumentNumber_BK] ,[DocumentNumberPosid] = [COPAPosition_BK] ,[MANDT] = '011' ,[PALEDGER] = [CurrencyTypeOfOperatingConcern] ,[VRGAR] = [RecordType] ,[PERIO] = [FiscalYearPeriod] ,[BELNR] = [COPADocumentNumber_BK] ,[POSNR] = [COPAPosition_BK] ,[HZDAT] = [CreationDateTime] ,[HZDAT_DATE] = cast([CreationDateTime] as date) ,[HZDAT_TIMESTAMP] = [CreationDateTime] ,[TIMESTMP] = [CreationDateTime] ,[GJAHR] = [FiscalYear] ,[BUDAT] = CONVERT(varchar, CAST([PostingDate] as datetime2), 112) ,[KNDNR] = [Customer_SoldTo] ,[ARTNR] = [Material_BK] ,[MatNr10Digit] = left([Material_BK],10) -- new column for 10 digit material ,[FKART] = [BillingType] ,[FRWAE] = [ForeignCurrencyKey] ,[KURSF] = [ExchangeRate] ,[REC_WAERS] = [CurrencyKey] ,[RKAUFNR] = [InternalOrder_BK] ,[SKOST] = [CostCenterID_BK] ,[BUKRS] = CONCAT('CC_',[CompanyCode_BK]) ,[KOKRS] = COALESCE([COArea_CostCenter], [COArea_CostElement]) ,[WERKS] = IIF([Plant_BK] IS NOT NULL, CONCAT('PL_',[Plant_BK]),NULL) ,[KSTAR] = [CostElement_ID_BK] ,[PSPNR] = [WBSElement_BK] ,[WBSElement] = [WBSElement] ,[PRCTR] = [ProfitCenter_BK] ,[PPRCTR] = [ProfitCenter_Partner] ,[AUGRU] = [OrderReason] ,[KUNRE] = [Customer_BillTo] ,[KUNWE] = [Customer_ShipTo] ,[LAND1] = [Country] ,[MTART] = [MaterialType] ,[PAPH1] = [ProductHierarchy1] ,[PAPH2] = [ProductHierarchy2] ,[PAPH3] = [ProductHierarchy3] ,[WWR01] = CONCAT('GB_',[BusinessDivision_BK]) ,[WWR02] = IIF( [BusinessUnit_BK] is not null , CONCAT('BU_',[BusinessUnit_BK]) , NULL) ,[WWR13] = [RBCustomer_BK] ,[WWR14] = [IntercompanyIndicator] ,[WWR28] = [RBCustomer_BK] ,[CustomerSoldTo] = IIF(COALESCE([IntercompanyIndicator],0) = 0,Coalesce( [RBCustomer_Project], [RBCustomer_BK] ),[RBCustomer_BK]) /* #FBI-SR-000000049 */ ,[NameOfValueField] = [NameOfValueField] ,[ValueField] = [Amount] ,[NameOfValueFieldOrg] = [NameOfValueField] ,[ReverseFlag] = NULL ,[RBELN] = [ReferenceCOPADocumentNumber_BK] ,[RPOSN] = [ReferenceCOPAPosition_BK] ,[AUART] = [SalesDocumentType] ,[PSTYV] = [SalesDocumentItemCategory] FROM #temp_result_raw ; ---------------Write Data for CO-PA GP1--------------------- INSERT INTO #INTF_PNL_FACT_COPA_CS_V2_STAGE ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[MANDT] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_DATE] ,[HZDAT_TIMESTAMP] ,[TIMESTMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[MatNr10Digit] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[PSPNR] ,[WBSElement] ,[PRCTR] ,[PPRCTR] ,[AUGRU] ,[KUNRE] ,[KUNWE] ,[LAND1] ,[MTART] ,[PAPH1] ,[PAPH2] ,[PAPH3] ,[WWR01] ,[WWR02] ,[WWR13] ,[WWR14] ,[WWR28] ,[CustomerSoldTo] ,[NameOfValueField] ,[ValueField] ,[NameOfValueFieldOrg] ,[ReverseFlag] ,[RBELN] ,[RPOSN] ,[AUART] ,[PSTYV] ) SELECT [RowInsertDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,[RowEndDate] = cast('2999-12-31 00:00:00' as datetime2) ,[LoadPackageId] = @LoadPackageId ,[COPA_Item_HK] = HASHBYTES('SHA1', RTRIM(LTRIM(CONVERT(VARCHAR(1024),[SAPSystem]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[BELNR]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[POSNR]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[PALEDGER]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[ValueField_GPx]))) ) ,[LoadDateDVSat] = [LoadDate] ,[SAPSystem] = 'SAPGP1' ,[SAPSystemClient] = [SourceSystemCodeBK] ,[DocumentNumberIdBK] = [BELNR] ,[DocumentNumberPosid] = [POSNR] ,[MANDT] = [MANDT] ,[PALEDGER] = [PALEDGER] ,[VRGAR] = [VRGAR] ,[PERIO] = [PERIO] ,[BELNR] = [BELNR] ,[POSNR] = [POSNR] ,[HZDAT] = [HZDAT] ,[HZDAT_DATE] = NULL ,[HZDAT_TIMESTAMP] = [HZDAT_TIMESTAMP] ,[TIMESTMP] = NULL ,[GJAHR] = LEFT([PERIO],4) ,[BUDAT] = [BUDAT] ,[KNDNR] = [KNDNR] ,[ARTNR] = [ARTNR] ,[MatNr10Digit] = [MatNr10Digit] ,[FKART] = [FKART] ,[FRWAE] = [FRWAE] ,[KURSF] = [KURSF] ,[REC_WAERS] = [REC_WAERS] ,[RKAUFNR] = [RKAUFNR] ,[SKOST] = [SKOST] ,[BUKRS] = [BUKRS] ,[KOKRS] = NULL ,[WERKS] = [WERKS] ,[KSTAR] = [KSTAR] ,[PSPNR] = [PSPNR] ,[WBSElement] = [WBSElement] ,[PRCTR] = [PRCTR] ,[PPRCTR] = [PPRCTR] ,[AUGRU] = [AUGRU] ,[KUNRE] = [KUNRE] ,[KUNWE] = [KUNWE] ,[LAND1] = [LAND1] ,[MTART] = [MTART] ,[PAPH1] = NULL ,[PAPH2] = NULL ,[PAPH3] = NULL ,[WWR01] = [WWR01] ,[WWR02] = [WWR02] ,[WWR13] = [WWR13] ,[WWR14] = [WWR14] ,[WWR28] = NULL ,[CustomerSoldTo] = [CustomerSoldTo] ,[NameOfValueField] = [NameOfValueField] ,[ValueField] = [ValueField] ,[NameOfValueFieldOrg] = [ValueField_GPx] ,[ReverseFlag] = NULL ,[RBELN] = [RBELN] ,[RPOSN] = [RPOSN] ,[AUART] = NULL ,[PSTYV] = NULL FROM [INFI_TM1_CSC2].[V_INTF_PNL_FACT_COPA_I3] WHERE 1 = 1 and [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo and [GJAHR] >= @DynamicYearFilter ; ---------------Write Data for CO-PA GP7--------------------- INSERT INTO #INTF_PNL_FACT_COPA_CS_V2_STAGE ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[MANDT] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_DATE] ,[HZDAT_TIMESTAMP] ,[TIMESTMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[MatNr10Digit] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[PSPNR] ,[WBSElement] ,[PRCTR] ,[PPRCTR] ,[AUGRU] ,[KUNRE] ,[KUNWE] ,[LAND1] ,[MTART] ,[PAPH1] ,[PAPH2] ,[PAPH3] ,[WWR01] ,[WWR02] ,[WWR13] ,[WWR14] ,[WWR28] ,[CustomerSoldTo] ,[NameOfValueField] ,[ValueField] ,[NameOfValueFieldOrg] ,[ReverseFlag] ,[RBELN] ,[RPOSN] ,[AUART] ,[PSTYV] ) SELECT [RowInsertDate] = @LoadTimestamp , [AuditId] = @AuditTrailId , [EntityId] = @EntityId , [RowEndDate] = cast('2999-12-31 00:00:00' as datetime2) , [LoadPackageId] = @LoadPackageId , [COPA_Item_HK] = HASHBYTES('SHA1', RTRIM(LTRIM(CONVERT(VARCHAR(1024),[SAPSystem]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[BELNR]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[POSNR]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[PALEDGER]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[ValueField_GPx]))) ) ,[LoadDateDVSat] = [LoadDate] ,[SAPSystem] = 'SAPGP7' ,[SAPSystemClient] = [SourceSystemCodeBK] ,[DocumentNumberIdBK] = [BELNR] ,[DocumentNumberPosid] = [POSNR] ,[MANDT] = [MANDT] ,[PALEDGER] = [PALEDGER] ,[VRGAR] = [VRGAR] ,[PERIO] = [PERIO] ,[BELNR] = [BELNR] ,[POSNR] = [POSNR] ,[HZDAT] = [HZDAT] ,[HZDAT_DATE] = NULL ,[HZDAT_TIMESTAMP] = [HZDAT_TIMESTAMP] ,[TIMESTMP] = NULL ,[GJAHR] = LEFT([PERIO],4) ,[BUDAT] = [BUDAT] ,[KNDNR] = [KNDNR] ,[ARTNR] = [ARTNR] ,[MatNr10Digit] = [MatNr10Digit] ,[FKART] = [FKART] ,[FRWAE] = [FRWAE] ,[KURSF] = [KURSF] ,[REC_WAERS] = [REC_WAERS] ,[RKAUFNR] = [RKAUFNR] ,[SKOST] = [SKOST] ,[BUKRS] = [BUKRS] ,[KOKRS] = NULL ,[WERKS] = [WERKS] ,[KSTAR] = [KSTAR] ,[PSPNR] = [PSPNR] ,[WBSElement] = [WBSElement] ,[PRCTR] = [PRCTR] ,[PPRCTR] = [PPRCTR] ,[AUGRU] = [AUGRU] ,[KUNRE] = [KUNRE] ,[KUNWE] = [KUNWE] ,[LAND1] = [LAND1] ,[MTART] = [MTART] ,[PAPH1] = NULL ,[PAPH2] = NULL ,[PAPH3] = NULL ,[WWR01] = [WWR01] ,[WWR02] = [WWR02] ,[WWR13] = [WWR13] ,[WWR14] = [WWR14] ,[WWR28] = NULL ,[CustomerSoldTo] = [CustomerSoldTo] ,[NameOfValueField] = [NameOfValueField] ,[ValueField] = [ValueField] ,[NameOfValueFieldOrg] = [ValueField_GPx] ,[ReverseFlag] = NULL ,[RBELN] = [RBELN] ,[RPOSN] = [RPOSN] ,[AUART] = NULL ,[PSTYV] = NULL FROM [INFI_TM1_CSC2].[V_INTF_PNL_FACT_COPA_O5] WHERE 1 = 1 and [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo and [GJAHR] >= @DynamicYearFilter ; /* ------------------------------------------------------ */ -- Create reversals for existing CO-PA documents non reversed CO-PA line items /* ------------------------------------------------------ */ INSERT INTO #INTF_PNL_FACT_COPA_CS_V2_STAGE SELECT [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SAPSystem] ,[SAPSystemClient] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[MANDT] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_DATE] ,[HZDAT_TIMESTAMP] ,[TIMESTMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[MatNr10Digit] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[PSPNR] ,[WBSElement] ,[PRCTR] ,[PPRCTR] ,[AUGRU] ,[KUNRE] ,[KUNWE] ,[LAND1] ,[MTART] ,[PAPH1] ,[PAPH2] ,[PAPH3] ,[WWR01] ,[WWR02] ,[WWR13] ,[WWR14] ,[WWR28] ,[CustomerSoldTo] ,[NameOfValueField] ,[ValueField] ,[NameOfValueFieldOrg] ,[ReverseFlag] ,[RBELN] ,[RPOSN] ,[AUART] ,[PSTYV] FROM ( select stg.[RowInsertDate] ,stg.[AuditId] ,stg.[EntityId] ,'2999-12-31 00:00:00.0000000' as [RowEndDate] ,stg.[LoadPackageId] ,reversal.[COPA_Item_HK] ,reversal.[LoadDateDVSat] ,reversal.[SAPSystem] ,reversal.[SAPSystemClient] ,reversal.[BELNR] as [DocumentNumberIdBK] ,reversal.[POSNR] as [DocumentNumberPosid] ,reversal.[MANDT] ,reversal.[PALEDGER] ,reversal.[VRGAR] ,reversal.[PERIO] ,reversal.[BELNR] ,reversal.[POSNR] ,reversal.[HZDAT] ,reversal.[HZDAT_DATE] ,reversal.[HZDAT_TIMESTAMP] ,reversal.[TIMESTMP] ,reversal.[GJAHR] ,reversal.[BUDAT] ,reversal.[KNDNR] ,reversal.[ARTNR] ,reversal.[MatNr10Digit] ,reversal.[FKART] ,reversal.[FRWAE] ,reversal.[KURSF] ,reversal.[REC_WAERS] ,reversal.[RKAUFNR] ,reversal.[SKOST] ,reversal.[BUKRS] ,reversal.[KOKRS] ,reversal.[WERKS] ,reversal.[KSTAR] ,reversal.[PSPNR] ,reversal.[WBSElement] ,reversal.[PRCTR] ,reversal.[PPRCTR] ,reversal.[AUGRU] ,reversal.[KUNRE] ,reversal.[KUNWE] ,reversal.[LAND1] ,reversal.[MTART] ,reversal.[PAPH1] ,reversal.[PAPH2] ,reversal.[PAPH3] ,reversal.[WWR01] ,reversal.[WWR02] ,reversal.[WWR13] ,reversal.[WWR14] ,reversal.[WWR28] ,reversal.[CustomerSoldTo] ,reversal.[NameOfValueField] ,(reversal.[ValueField] * - 1.00) as [ValueField] ,reversal.[NameOfValueFieldOrg] ,(ISNULL(reversal.[ReverseFlag],0) + 1) as [ReverseFlag] ,reversal.[RBELN] ,reversal.[RPOSN] ,reversal.[AUART] ,reversal.[PSTYV] ,ROW_NUMBER() over (partition by reversal.[COPA_Item_HK] order by reversal.[LoadPackageId] desc ) as [RowNum] FROM #INTF_PNL_FACT_COPA_CS_V2_STAGE stg INNER JOIN [INFI_TM1_CSC2].[INTF_PNL_FACT_COPA_CS_V2] reversal on reversal.[COPA_Item_HK] = stg.[COPA_Item_HK] and reversal.[ReverseFlag] is null ) as ss_reversal where ss_reversal.[RowNum] = 1 ; /* ------------------------------------------------------ */ -- Insert stage into target table /* ------------------------------------------------------ */ BEGIN TRY BEGIN TRAN INSERT INTO [INFI_TM1_CSC2].[INTF_PNL_FACT_COPA_CS_V2] WITH (TABLOCK) SELECT * FROM #INTF_PNL_FACT_COPA_CS_V2_STAGE ; COMMIT TRAN END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; END CATCH /* ------------------------------------------------------ */ -- Get rows inserted for logging /* ------------------------------------------------------ */ SET @RowsInserted = (SELECT COUNT(*) FROM #INTF_PNL_FACT_COPA_CS_V2_STAGE) SET @RowsRead = @RowsInserted SET @RowsUpdated = 0 SET @RowsDeleted = 0 /* ------------------------------------------------------ */ -- Last Step | Cleanup /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #temp_deltaHKlist DROP TABLE IF EXISTS #temp_hub_data DROP TABLE IF EXISTS #temp_result_raw DROP TABLE IF EXISTS #INTF_PNL_FACT_COPA_CS_V2_STAGE END;"
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_A2;321800604;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_A2 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G2;324508535;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G4;325276614;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G4 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CountryHFM;325732363;V ;VIEW;2505;/**/ /* View: V_INTF_PNL_DIM_CountryHFM */ /**/ /* = */ /* V 01.00.01 2021-03-18 Yang Hui CI/DAP2.3 & Just Patrik CI/CDAV2.3 */ /* This reads Country Hierarchy along to HFM Regions */ /* Update: */ /* - 01.00.01 Update interface due to rework of HFM source in MDS */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_D4;333556572;V ;VIEW;8497;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_D4 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ResourceTypeInternalAllocation_V1_IDIM1;334936565;V ;VIEW;1438;/**/ /* View: V_ResourceTypeInternalAllocation_V1_IDIM1 */ /**/ /* */ /* V01.00.01 2022-09-30 Ilja Frolov */ /* This view provides the ResourceTypeInternalAllocation Dimension for RnD CostActual fact views */ /* Data.CORE Outgoing Interface #0251 https://inside-docupedia.bosch.com/confluence/x/Z0JSj */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Merged with Plan Dim */ /* V01.00.00 - Initial version */ /* =*/
INFI_CapEx_TM1_CSC2;67;INFormation Mart as Interface;V_INFI_CapEx_FACT_PurchaseCommitments_G7;337136692;V ;VIEW;11807;/**/ /* View: V_INFI_CapEx_FACT_PurchaseCommitments_G7 */ /**/ /* =*/ /* V01.00.06 2023-08-07 Philipp Staiger GS/BDD1 */ /* This view provides purchase commitment fact data from SAPPcr for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.06 - Remapped column ExpectedDebitDate */ /* V01.00.05 - Reformatting, Language Code from Reference */ /* V01.00.04 - Reformatting, Filter deletion/change, cost center join like coom */ /* V01.00.03 - Project Type filter change */ /* V01.00.02 - Minimal change in cost center filter */ /* V01.00.01 - Minimal change in join criteria, added end-dating-satellites */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G6;337644496;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G6 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P99 */ /* Changes: */ /* Restriction: */ /**/
INFI_NAIS_TM1_CSC1;108;INFormation Mart as Interface;V_INTF_NAIS_REF_ExchangeRatesToEuro;337696551;V ;VIEW;2014;/**/ /* View: V_INTF_NAIS_REF_ExchangeRatesToEuro */ /**/ /* = */ /* V 01.00.00 2022-07-11 Ilja Frolov GS/BDD2 */ /* This view delivers the exchange rates from X to EURO to NAIS */ /* Data.CORE Outgoing Interface #0246 https://inside-docupedia.bosch.com/confluence/x/_lziiQ */ /* - Filter on [ExchangeRateType] = ZCAY Cross rates average yearly */ /* - Filter on [ExchangeRateType] = ZCBP Business Plan (Average, cross rate) */ /* - Filter on [ExchangeRateType] = ZCCF Current Forecast (Average, Cross rate) */ /* - Filter on [ExchangeRateType] = M MonthEndRate */ /* >> Definition copied from [INFI_TM1_CSC2].[V_INTF_PNL_REF_ExchangeRatesToEuro] */ /* Restriction: Reverted Source to Targert to get updated values */ /* = */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_B2;337800661;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_B2 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G3;340508592;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G3 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G5;341276671;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G5 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CountryHFM_ATTR;341732420;V ;VIEW;4471;/**/ /* View: V_INTF_PNL_DIM_CountryHFM_ATTR */ /**/ /* = */ /* V 01.00.01 2021-03-18 Yang Hui CI/DAP2.3 & Just Patrik CI/CDAV2.3 */ /* This view provide the description for HFM Regions to TM1 */ /* Update: */ /* - 01.00.01 Update interface due to rework of HFM source in MDS */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_SSAS_AnonymizeRBEFData_V2;345416650;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2202;/* =*/ /* V01.00.05 - 2022-02-22 - Waldemar Kessler CI/BTM-AC1 */ /* This function does anonymize data for the purposes on Costs Application DemoSystems */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /* =*/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[ufn_SSAS_AnonymizeRBEFData_V2] ( -- Add the parameters for the function here @StringToBeAnonymized NVARCHAR(100) ) RETURNS TABLE AS RETURN( select StringAnonymized= CASE WHEN CHARINDEX ('ArjP',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'ArjP', 'XxP'),@StringToBeAnonymized) WHEN CHARINDEX ('RBEF',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'RBEF', 'XxP'),@StringToBeAnonymized) WHEN CHARINDEX ('Aj',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'Aj', 'Xx'),@StringToBeAnonymized) WHEN CHARINDEX ('983',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'983', 'XxP'),@StringToBeAnonymized) WHEN CHARINDEX ('Aranjuez',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'Aranjuez', 'XxP'),@StringToBeAnonymized) WHEN CHARINDEX ('EB-ES',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'EB-ES', 'Xx-YY'),@StringToBeAnonymized) WHEN CHARINDEX ('GS/',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'GS/', 'Xx/'),@StringToBeAnonymized) WHEN CHARINDEX ('CI/',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'CI/', 'Xx/'),@StringToBeAnonymized) WHEN CHARINDEX ('M/',@StringToBeAnonymized) > 0 then coalesce(REPLACE(@StringToBeAnonymized,'M/', 'Xx/'),@StringToBeAnonymized) END )
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_D7;349556629;V ;VIEW;9602;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_D7 */ /**/ /* = */ /* V01.00.04 2022-11-10 Michal Erdman & Ilja Frolov & Pawel Bialecki */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ */ /* Update: */ /* V01.00.04 Added PartnerCostCenter and PartnerActivityType */ /* V01.00.03 - Bugfix Leading Zero 114197 */ /* V01.00.02 - Tune Up */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostElement_V4_IDIM1;352368670;V ;VIEW;14976;/**/ /* View: V_CostElement_V4_IDIM1 */ /**/ /**/ /* V01.00.10 2022-12-21 Michal Erdman & Jakub Kozlowski & Yannick Sigwalt GS/BDD2 */ /* & Michal Erdman & Tatjana Derdus CI/BTM-AC1 */ /* Conformed Dimension for CostElement for SSAS Costs Model with filtering from MDS */ /* Data.CORE Outgoing Interface #0212 https://inside-docupedia.bosch.com/confluence/x/X8lagw */ /* Restriction: */ /* - None */ /* Update: */ /* V01.00.10 2022-12-21 - performance optimization, used materialized hierarchies */ /* V01.00.09 2022-09-30 - performance optimization and description fix */ /* V01.00.08 2022-09-19 - Added GK, O1, O2 */ /* - Changed CROSS JOIN to INNER JOIN in cte_cebcoahier for better */ /* readibility (as the cross join was in practice an inner join) */ /* V01.00.07 2022-09-14 - Adjusted CostElement hierarchy desriptions to use original language */ /* descriptions, if available (else use descriptions in default language */ /* 'DE' or 'EN') */ /* V01.00.06 2022-09-02 - Removed COALESCE function while retrieving the Hierarchy Level */ /* New logic LevelX, LevelXDescription, ConcatenateLevelXAndDescription */ /* V01.00.05 2022-08-30 - Added A2, B4, D1, D4, D7, G9 */ /* V01.00.04 2022-07-12 - Optimized querying on Hierarchies */ /* - Implemened consumption of V_DataCOREDimensionLanguageCode for Language*/ /* V01.00.03 2022-07-06 - Fix description from other sources */ /* V01.00.02 2022-05-23 - Rework of view due to naming conventions */ /* V01.00.01 2022-05-16 - adding B2, D0, G0, G1, G2, G3, G6, G7 */ /* V01.00.00 2022-03-31 - initial */ /**/
INFI_MyMeasure_CSC2;124;INFormation Mart as Interface;V_Pilum_CostActual_V1_IFCT0_F0;353084694;V ;VIEW;3149;/**/ /* View: V_Pilum_CostActual_V1_IFCT0_F0 */ /**/ /* =*/ /* V01.00.00 2023-03-27 Aman Kumar BD/XAD5 */ /* Integrate the measures from PILUM Cost Actual into the myMeasure platform */ /* Data.Core Outgoing Interface #272 https://inside-docupedia.bosch.com/confluence/x/Cmf4k */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.00 - Initial Version - Creation */ /* =*/
INFI_CapEx_TM1_CSC2;67;INFormation Mart as Interface;V_INFI_CapEx_FACT_PurchaseCommitments_GK;353136749;V ;VIEW;11807;/**/ /* View: V_INFI_CapEx_FACT_PurchaseCommitments_GK */ /**/ /* =*/ /* V01.00.06 2023-08-07 Philipp Staiger GS/BDD1 */ /* This view provides purchase commitment fact data from SAPP77 for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.06 - Remapped column ExpectedDebitDate */ /* V01.00.05 - Reformatting, Language Code from Reference */ /* V01.00.04 - Reformatting, Filter deletion/change, cost center join like coom */ /* V01.00.03 - Project Type filter change */ /* V01.00.02 - Minimal change in cost center filter */ /* V01.00.01 - Minimal change in join criteria, added end-dating-satellites */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G7;353644553;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G7 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PCR */ /* Changes: */ /* Restriction: */ /**/
INFI_OTaP_TM1_CSC2;86;INFormation Mart as Interface;V_INTF_OTaP_FACT_PurchaseOrderWithInvoice;353696608;V ;VIEW;14361;/**/ /* View: V_INTF_OTaP_FACT_PurchaseOrderWithInvoice */ /**/ /**/ /* V01.00.03 2022-07-13 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* Access layer view for TM1 to transfer Purchase Order information as well as Invoice information */ /* Data.CORE Outgoing Interface #0170 https://inside-docupedia.bosch.com/confluence/x/Y7D4cg */ /* Update: */ /* - 01.00.03 2022-07-13 Replaced consumption of Dim CostElement_V3 by elements of Raw Vault */ /* - 01.00.02 2022-02-11 Added column FinalInvoiceIndicator */ /* - 01.00.01 2021-11-22 Added column PositingDate and corrected selection logic for PurchaseRequisition */ /* - 01.00.00 2021-10-29 Initial Creation */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_B4;353800718;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_B4 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G4;356508649;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G6;357276728;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G6 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter_ATTR;358500556;V ;VIEW;37185;"/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter_ATTR */ /**/ /* = */ /* V01.04.00 2020-11-20 Patrik Just CI/DAV2.3 & Yannick Sigwalt GS/FBI2 & Tatjana Derdus CI/DAV2.3 */ /* & Ilja Frolov GS/BDD2 */ /* This view provides the attributes of CostCenter for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.04.00 - Changed attribute Kostenstellenverantwortlicher */ /* V01.03.00 - Added attribute Kostenstellenverantwortlicher */ /* V01.02.00 - Added attribute CostCenterCurrency */ /* V01.01.00 - Added CostCenter Hierarchy along Organization Office */ /* - Switched CostCenter from RBW-CORE to RB-B */ /* V01.00.01 - Set all Types to ""S"", except CostCenter_BK (Type ""A"") */ /* - Replace CostCenter_BK definition_by CostCenter_BK_Trim and remove it */ /* V01.00.00 - Initial version based on predeccessor view [INFI_HR_TM1_CSC2]. */ /* [V_INTF_HR_DIM_CostCenter_ATTR] (V01.00.01) Replaced DimIDs by BKs. */ /* = */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G0;359828494;V ;VIEW;8103;"/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G0 */ /**/ /*=*/ /* V01.04.00 - 2021-04-22 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.04.00: 2021-04-22 Added values to Code and Group description fields */ /* - V01.03.01: 2021-04-06 Added columns [LanguageCode] and [SourceSystem] */ /* - V01.03.00: 2021-03-19 Renamed column [Damage] to [DamageGroup] & added columns [DamageCode], */ /* [DamageCodeDescription], [DamageGroupDescription]; */ /* Renamed column [Cause] to [CauseGroup] & added columns [CauseCode], */ /* [CauseCodeDescription], [CauseGroupDescription] (V2) */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G0;365556686;V ;VIEW;8493;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G0 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_Dummy;366780514;V ;VIEW;2615;"/**/ /* View: V_MalfunctionNotification_V2_IDIM1_Dummy */ /**/ /*=*/ /* V01.01.01 - 2021-04-06 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.01.01: 2021-04-06 Added columns [LanguageCode] and [SourceSystem] */ /* - V01.01.00: 2021-03-19 Renamed column [Damage] to [DamageGroup] & added columns [DamageCode], */ /* [DamageCodeDescription], [DamageGroupDescription]; */ /* Renamed column [Cause] to [CauseGroup] & added columns [CauseCode], */ /* [CauseCodeDescription], [CauseGroupDescription] */ /* - V01.00.00: 2021-01-15 Initial version */ /*=*/"
INFI_PnLService_TM1_CSC2;118;INFormation Mart as Interface;usp_DeltaLoad_PnL_Service_COPA_CCI_V1_MFCT0_D7;367704758;P ;SQL_STORED_PROCEDURE;29090;"/* = */ /* V01.00.01 - 2023-04-13 URA1FE */ /* This Stored Procedure for incremantal loading of PnL.Service Persisted Fact Data of CO-PA */ /* Data.CORE Outgoing Interface #0267 https://inside-docupedia.bosch.com/confluence/x/9ZYyp */ /* Implemented Soft Rules: */ /* Restriction: */ /* - Tailored loading for PnL.Service only, no reuse intended */ /* - Covered sources: D7 */ /* - Used for loading of PnL.Service Input Cube and Dillthrough from application to Data.CORE */ /* */ /* Update: */ /* - V01.00.01: Added column KSTRG */ /* - V01.00.00: Initial version inspired by [INFI_TM1_CSC2].[usp_DeltaLoad_INTF_PNL_FACT_COPA_CS_V2] */ /* = */ create procedure INFI_PnLService_TM1_CSC2.usp_DeltaLoad_PnL_Service_COPA_CCI_V1_MFCT0_D7 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* = */ /* Start declaration for testing purpose */ /* Uncomment below column to be able to test the code */ --DECLARE @DeltaTimestampFrom datetime2 --DECLARE @DeltaTimestampTo datetime2 --DECLARE @LoadBatchId bigint --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int --SET @DeltaTimestampFrom = '2023-01-01 00:00:00' --SET @DeltaTimestampTo = '2999-12-12 23:59:00' /* End declaration for testing purpose */ /* = */ DECLARE @DynamicYearFilter smallint = year(DATEADD(month, -6, SYSUTCDATETIME())) --dynamic Filter to switch to current year /* ------------------------------------------------------ */ -- Step 1 | Get CO-PA Hashkeys for all delta timestamps /* ------------------------------------------------------ */ -- Definition of delta time range. -- Connection to Meta Mart necessary for source specific time ranges! -- Step 1.1 create temp table for delta timestamps - for ETAS DROP TABLE IF EXISTS #temp_deltaHKlist_ETAS; CREATE TABLE #temp_deltaHKlist_ETAS ( [Source] char(2) ,[SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS ,[COPADocumentLineItem_HK] binary(20) ,[LoadDate] datetime2 ,[CreationDateTime] datetime2 ); -- Step 1.2 Save the timestamps in temp table - for ETAS INSERT INTO #temp_deltaHKlist_ETAS SELECT * FROM ( SELECT 'D7' as [Source], N'SAPP42' as [SAPSystem], [COPADocumentLineItem_HK], [LoadDate], [CreationDateTime] FROM [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_D7_X] WHERE 1=1 and [LoadEndDate] = '2999-12-31 00:00:00.0000000' and [LoadDate] between @DeltaTimestampFrom and @DeltaTimestampTo and [FiscalYear] >= 2021 ) temp_deltaHKlist_ETAS ; -- Step 1.3 Create index for temp table to support following joins - for ETAS CREATE CLUSTERED INDEX #temp_deltaHKlist_ETAS ON #temp_deltaHKlist_ETAS (COPADocumentLineItem_HK); /* ------------------------------------------------------ */ -- Step 2 | Get all Hub data delta timestamps /* ------------------------------------------------------ */ -- Step 2.1 Write hub data into temp table - for ETAS SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,wbse_wh.[WBSElement_BK] ,'ETAS' as [BusinessDivision_BK] -- fixed value for ETAS ,NULL as [BusinessUnit_BK] -- n/a for ETAS -- Customer roles ,s2c_wh.[Customer_ETAS_BK] as [Customer_SoldTo] -- based on special DV objects for ETAS ,io_wh.[InternalOrder_BK] ,sccent_wh.[ControllingArea_ID_BK] as [COArea_CostCenter] ,sccent_wh.[CostCenterID_BK] ,ce_wh.[ControllingArea_ID_BK] as [COArea_CostElement] ,ce_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] ,p_wh.[Plant_BK] ,prm_wh.[Material_ETAS_BK] as [Material_BK] -- based on special DV objects for ETAS ,pc_wh.[ProfitCenter_BK] ,ppc_wh.[ProfitCenter_BK] as [ProfitCenter_Partner] ,#temp_deltaHKlist_ETAS.[CreationDateTime] as [CreationDateTime] /* ATTENTION: NEW TEMP TABLE WILL BE USED TO STORE THE DATA */ INTO #temp_hub_data_ETAS FROM #temp_deltaHKlist_ETAS INNER JOIN [RAWV_COPA_CSC2].[COPADocumentLineItem_WHUB0] copadli_wh on copadli_wh.[SAPSystem] = #temp_deltaHKlist_ETAS.[SAPSystem] COLLATE Latin1_General_CS_AS and copadli_wh.[COPADocumentLineItem_HK] = #temp_deltaHKlist_ETAS.[COPADocumentLineItem_HK] /* WBS Element */ left join [RAWV_COPA_CSC2].[WBSElementToCOPADocumentLineItem_WLNK0] we2copadli_wl on we2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh on wbse_wh.[WBSElement_HK] = we2copadli_wl.[WBSElement_HK] /* Customer Sold-to - special DV objects for ETAS */ left join [RAWV_COPA_CSC2].[SoldToCustomerToCOPADocumentLineItem_ETAS_WLNK0] s2c2copadli_wl on s2c2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Customer_ETAS_WHUB0] s2c_wh on s2c_wh.[Customer_ETAS_HK] = s2c2copadli_wl.[Customer_ETAS_HK] /* Internal Order */ left join [RAWV_COPA_CSC2].[InternalOrderToCOPADocumentLineItem_WLNK0] io2copadli_wl on io2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_COOM_CSC1].[InternalOrder_WHUB0] io_wh on io_wh.[InternalOrder_HK] = io2copadli_wl.[InternalOrder_HK] /* CostCenter Sender */ left join [RAWV_COPA_CSC2].[SenderCostCenterToCOPADocumentLineItem_WLNK0] scentc2copadli_wl on scentc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] sccent_wh on sccent_wh.[CostCenter_HK] = scentc2copadli_wl.[CostCenter_HK] /* Cost Element */ left join [RAWV_COPA_CSC2].[CostElementToCOPADocumentLineItem_WLNK0] ce2copadli_wl on ce2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] ce_wh on ce_wh.[CostElementByControllingArea_HK] = ce2copadli_wl.[CostElementByControllingArea_HK] /* Company Code */ left join [RAWV_COPA_CSC2].[CompanyCodeToCOPADocumentLineItem_WLNK0] compc2copadli_wl on compc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = compc2copadli_wl.[CompanyCode_HK] /* Plant */ left join [RAWV_COPA_CSC2].[PlantToCOPADocumentLineItem_WLNK0] p2copadli_wl on p2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = p2copadli_wl.[Plant_HK] /* Material Product - special DV objects for ETAS */ left join [RAWV_COPA_CSC2].[ProductToCOPADocumentLineItem_ETAS_WLNK0] pr2copadli_wl on pr2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[Material_ETAS_WHUB0] prm_wh on prm_wh.[Material_ETAS_HK] = pr2copadli_wl.[Material_ETAS_HK] /* Profit Center */ left join [RAWV_COPA_CSC2].[ProfitCenterToCOPADocumentLineItem_WLNK0] pc2copadli_wl on pc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = pc2copadli_wl.[ProfitCenter_HK] /* Profit Center - Partner */ left join [RAWV_COPA_CSC2].[PartnerProfitCenterToCOPADocumentLineItem_WLNK0] ppc2copadli_wl on ppc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] ppc_wh on ppc_wh.[ProfitCenter_HK] = ppc2copadli_wl.[ProfitCenter_HK] ; -- Step 2.2 Create index to support joins CREATE CLUSTERED INDEX ix_#temp_hub_data_ETAS ON #temp_hub_data_ETAS (COPADocumentLineItem_HK); /* ------------------------------------------------------ */ -- Step 3 | Join the Hub data with the Sat data /* ------------------------------------------------------ */ -- Step 3.1 Specify temp table for raw result - for ETAS DROP TABLE IF EXISTS #temp_result_raw_ETAS CREATE TABLE #temp_result_raw_ETAS ( SAPSystem nvarchar(30) ,COPADocumentLineItem_HK binary(20) ,COPADocumentNumber_BK nvarchar(20) ,COPAPosition_BK nvarchar(12) ,LoadDate datetime2 ,WBSElement_BK int ,BusinessDivision_BK nvarchar(20) ,BusinessUnit_BK nvarchar(60) ,Customer_SoldTo nvarchar(20) ,InternalOrder_BK nvarchar(24) ,COArea_CostCenter nvarchar(8) ,CostCenterID_BK nvarchar(20) ,COArea_CostElement nvarchar(8) ,CostElement_ID_BK nvarchar(20) ,CompanyCode_BK nvarchar(8) ,Plant_BK nvarchar(8) ,Material_BK nvarchar(36) ,ProfitCenter_BK nvarchar(20) ,ProfitCenter_Partner nvarchar(20) ,CurrencyTypeOfOperatingConcern nvarchar(4) ,ForeignCurrencyKey nvarchar(10) ,ExchangeRate decimal(9,5) ,CurrencyKey nvarchar(10) ,NameOfValueField nvarchar(60) ,Amount decimal(28,9) ,LoadDateDVSat datetime2 ,RecordType varchar(2) ,FiscalYearPeriod int ,CreationDateTime datetime2 ,FiscalYear smallint ,PostingDate datetime2 ,BillingType nvarchar(8) ,Country nvarchar(6) ,MaterialType nvarchar(8) ,IntercompanyIndicator nvarchar(2) ,AccountAssignmentGroupMaterial nvarchar(2) ,ProductGroup nvarchar(2) ,ProductHierMaterial nvarchar(18) ,OrderReason nvarchar(4) ,CustomerGroup nvarchar(2) ,Region nvarchar(3) ,Payer nvarchar(10) ,CostObject nvarchar(12) ) -- Step 3.2 Load Hub and Sat data into temp table - for ETAS Insert into #temp_result_raw_ETAS SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,copadli_wh.[WBSElement_BK] ,copadli_wh.[BusinessDivision_BK] ,copadli_wh.[BusinessUnit_BK] ,copadli_wh.[Customer_SoldTo] ,copadli_wh.[InternalOrder_BK] ,copadli_wh.[COArea_CostCenter] ,copadli_wh.[CostCenterID_BK] ,copadli_wh.[COArea_CostElement] ,copadli_wh.[CostElement_ID_BK] ,copadli_wh.[CompanyCode_BK] ,copadli_wh.[Plant_BK] ,copadli_wh.[Material_BK] ,copadli_wh.[ProfitCenter_BK] ,copadli_wh.[ProfitCenter_Partner] ,copaam_ws.[CurrencyTypeOfOperatingConcern] ,copaam_ws.[ForeignCurrencyKey] ,copaam_ws.[ExchangeRate] ,copaam_ws.[CurrencyKey] ,copaam_ws.[NameOfValueField] ,copaam_ws.[Amount] ,copaat_ws.[LoadDate] -- as [LoadDateDVSat] ,copaat_ws.[RecordType] ,copaat_ws.[FiscalYearPeriod] ,copaam_ws.[CreationDateTime] ,copaat_ws.[FiscalYear] ,copaat_ws.[PostingDate] ,copaat_ws.[BillingType] ,copaat_ws.[Country] ,copaat_ws.[MaterialType] ,copaat_ws.[IntercompanyIndicator] ,copaat_wsj.[KTGRM] as [AccountAssignmentGroupMaterial] ,copaat_wsj.[WW100] as [ProductGroup] ,copaat_wsj.[WW101] as [ProductHierMaterial] ,copaat_wsj.[WW107] as [OrderReason] ,copaat_ws.CustomerGroup as [CustomerGroup] --Technical field - KDGRP ,copaat_wsj.[REGIO] as [Region] ,copaat_wsj.[KUNRG] as [Payer] ,copaat_wsj.[KSTRG] as [CostObject] from #temp_hub_data_ETAS copadli_wh inner join [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_D7_X] copaat_ws on copaat_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_ws.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_ws.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_COPA_CSC2].[COPAAttribute_WSATJ_D7_X] copaat_wsj on copaat_wsj.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_wsj.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_wsj.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaat_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_COPA_CSC2].[COPAAmount_WSATM_D7_X] copaam_ws on copaam_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] --and copaam_ws.[CreationDateTime] >= copadli_wh.[CreationDateTime] and copaam_ws.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaam_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ; -- Step 3.3 Repeat step 3.2b for quantity only - for ETAS INSERT INTO #temp_result_raw_ETAS SELECT copadli_wh.[SAPSystem] ,copadli_wh.[COPADocumentLineItem_HK] ,copadli_wh.[COPADocumentNumber_BK] ,copadli_wh.[COPAPosition_BK] ,copadli_wh.[LoadDate] ,copadli_wh.[WBSElement_BK] ,copadli_wh.[BusinessDivision_BK] ,copadli_wh.[BusinessUnit_BK] ,copadli_wh.[Customer_SoldTo] ,copadli_wh.[InternalOrder_BK] ,copadli_wh.[COArea_CostCenter] ,copadli_wh.[CostCenterID_BK] ,copadli_wh.[COArea_CostElement] ,copadli_wh.[CostElement_ID_BK] ,copadli_wh.[CompanyCode_BK] ,copadli_wh.[Plant_BK] ,copadli_wh.[Material_BK] ,copadli_wh.[ProfitCenter_BK] ,copadli_wh.[ProfitCenter_Partner] -------- ,copaqa_ws.[CurrencyTypeOfOperatingConcern] as [CurrencyTypeOfOperatingConcern] ,copaqa_ws.[ForeignCurrencyKey] as [ForeignCurrencyKey] ,copaqa_ws.[ExchangeRate] as [ExchangeRate] ,copaqa_ws.[CurrencyKey] as [CurrencyKey] -------- ,copaqa_ws.[NameOfValueField] as [NameOfValueField] ,copaqa_ws.[Quantity] as [Amount] -------- ,copaat_ws.[LoadDate] as [LoadDate] ,copaat_ws.[RecordType] as [RecordType] ,copaat_ws.[FiscalYearPeriod] as [FiscalYearPeriod] ,copaqa_ws.[CreationDateTime] as [CreationDateTime] ,copaat_ws.[FiscalYear] as [FiscalYear] ,copaat_ws.[PostingDate] as [PostingDate] ,copaat_ws.[BillingType] as [BillingType] ,copaat_ws.[Country] as [Country] ,copaat_ws.[MaterialType] as [MaterialType] ,copaat_ws.[IntercompanyIndicator] as [IntercompanyIndicator] ,copaat_wsj.[KTGRM] as [AccountAssignmentGroupMaterial] ,copaat_wsj.[WW100] as [ProductGroup] ,copaat_wsj.[WW101] as [ProductHierMaterial] ,copaat_wsj.[WW107] as [OrderReason] ,copaat_ws.[CustomerGroup] as [CustomerGroup] --Technical field - KDGRP ,copaat_wsj.[REGIO] as [Region] ,copaat_wsj.[KUNRG] as [Payer] ,copaat_wsj.[KSTRG] as [CostObject] from #temp_hub_data_ETAS copadli_wh inner join [RAWV_COPA_CSC2].[COPAAttribute_WSAT0_D7_X] copaat_ws on copaat_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_ws.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_ws.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaat_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_COPA_CSC2].[COPAAttribute_WSATJ_D7_X] copaat_wsj on copaat_wsj.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_wsj.[CreationDateTime] = copadli_wh.[CreationDateTime] and copaat_wsj.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaat_wsj.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_COPA_CSC2].[COPAQuantity_WSATM_D7_X] copaqa_ws on copaqa_ws.COPADocumentLineItem_HK = copadli_wh.COPADocumentLineItem_HK --and copaqa_ws.[CreationDateTime] >= copadli_wh.[CreationDateTime] and copaqa_ws.[LoadDate] between CAST(CAST(@DeltaTimestampFrom AS NVARCHAR(MAX)) AS DATETIME2) and CAST(CAST(@DeltaTimestampTo AS NVARCHAR(MAX)) AS DATETIME2) and copaqa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ; /* --------------------------------------------------------- */ /* Step 4 | Prepare export and create stage table */ /* --------------------------------------------------------- */ DROP TABLE IF EXISTS #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE; CREATE TABLE #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE ( [RowInsertDate] datetime2 ,[AuditId] int ,[EntityId] int ,[RowEndDate] datetime2 ,[LoadPackageId] int ,[COPA_Item_HK] binary (20) ,[LoadDateDVSat] datetime2 ,[SourceSystemCodeBK] nvarchar (30) COLLATE Latin1_General_CS_AS ,[DocumentNumberIdBK] nvarchar (20) COLLATE Latin1_General_CS_AS ,[DocumentNumberPosid] nvarchar (12) COLLATE Latin1_General_CS_AS ,[PALEDGER] nvarchar (4) COLLATE Latin1_General_CS_AS ,[VRGAR] nvarchar (2) COLLATE Latin1_General_CS_AS ,[PERIO] int ,[BELNR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[POSNR] nvarchar (12) COLLATE Latin1_General_CS_AS ,[HZDAT] varchar (30) COLLATE Latin1_General_CS_AS ,[HZDAT_TIMESTAMP] datetime2 ,[GJAHR] smallint ,[BUDAT] varchar (30) COLLATE Latin1_General_CS_AS ,[KNDNR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[ARTNR] nvarchar (36) COLLATE Latin1_General_CS_AS ,[FKART] nvarchar (8) COLLATE Latin1_General_CS_AS ,[FRWAE] nvarchar (10) COLLATE Latin1_General_CS_AS ,[KURSF] decimal (9,5) ,[REC_WAERS] nvarchar (10) COLLATE Latin1_General_CS_AS ,[RKAUFNR] nvarchar (24) COLLATE Latin1_General_CS_AS ,[SKOST] nvarchar (20) COLLATE Latin1_General_CS_AS ,[BUKRS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[KOKRS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[WERKS] nvarchar (8) COLLATE Latin1_General_CS_AS ,[KSTAR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[KSTRG] nvarchar (12) COLLATE Latin1_General_CS_AS ,[PSPNR] int ,[PRCTR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[PPRCTR] nvarchar (20) COLLATE Latin1_General_CS_AS ,[LAND1] nvarchar (6) COLLATE Latin1_General_CS_AS ,[MTART] nvarchar (8) COLLATE Latin1_General_CS_AS ,[WWR14] nvarchar (2) COLLATE Latin1_General_CS_AS ,[KTGRM] nvarchar (2) COLLATE Latin1_General_CS_AS ,[WW100] nvarchar (18) COLLATE Latin1_General_CS_AS ,[WW101] nvarchar (18) COLLATE Latin1_General_CS_AS ,[WW107] nvarchar (4) COLLATE Latin1_General_CS_AS ,[KDGRP] nvarchar (2) COLLATE Latin1_General_CS_AS ,[REGIO] nvarchar (3) COLLATE Latin1_General_CS_AS ,[KUNRG] nvarchar (10) COLLATE Latin1_General_CS_AS ,[NameOfValueField] nvarchar (60) COLLATE Latin1_General_CS_AS ,[ValueField] decimal (28,9) --,[NameOfValueFieldOrg] nvarchar (60) COLLATE Latin1_General_CS_AS ,[ReverseFlag] smallint ) /* ------------------------------------------------------ */ /* Step 5 | Export to stage */ /* ------------------------------------------------------ */ -- 5.1 Get variables DECLARE @LoadTimestamp datetime2 = CURRENT_TIMESTAMP DECLARE @LoadPackageId integer SELECT @LoadPackageId = next value for [INFI_PnLService_TM1_CSC2].[SEQ_LoadPackageId_PnL_Service_COPA_CCI_V1_MFCT0_D7] -- 5.2 Clean and insert data into target CCI table - for ETAS INSERT INTO #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE ( [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SourceSystemCodeBK] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_TIMESTAMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[KSTRG] ,[PSPNR] ,[PRCTR] ,[PPRCTR] ,[LAND1] ,[MTART] ,[WWR14] ,[KTGRM] ,[WW100] ,[WW101] ,[WW107] ,[KDGRP] ,[REGIO] ,[KUNRG] ,[NameOfValueField] ,[ValueField] --,[NameOfValueFieldOrg] ,[ReverseFlag] ) SELECT [RowInsertDate] = @LoadTimestamp ,[AuditId] = @AuditTrailId ,[EntityId] = @EntityId ,[RowEndDate] = cast('2999-12-31 00:00:00' as datetime2) ,[LoadPackageId] = @LoadPackageId ,[COPA_Item_HK] = HASHBYTES('SHA1', RTRIM(LTRIM(CONVERT(VARCHAR(1024),[SAPSystem]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[COPADocumentNumber_BK]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[COPAPosition_BK]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[CurrencyTypeOfOperatingConcern]))) + '\@|' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),[NameOfValueField]))) ) --[COPADocumentLineItem_HK] ,[LoadDateDVSat] = [LoadDateDVSat] ,[SourceSystemCodeBK] = [SAPSystem] ,[DocumentNumberIdBK] = [COPADocumentNumber_BK] ,[DocumentNumberPosid] = IIF([COPAPosition_BK] = '', NULL, [COPAPosition_BK]) ,[PALEDGER] = [CurrencyTypeOfOperatingConcern] ,[VRGAR] = [RecordType] ,[PERIO] = [FiscalYearPeriod] ,[BELNR] = [COPADocumentNumber_BK] ,[POSNR] = [COPAPosition_BK] ,[HZDAT] = [CreationDateTime] ,[HZDAT_TIMESTAMP] = [CreationDateTime] ,[GJAHR] = [FiscalYear] ,[BUDAT] = CONVERT(varchar, CAST([PostingDate] as datetime2), 112) ,[KNDNR] = [Customer_SoldTo] ,[ARTNR] = [Material_BK] ,[FKART] = [BillingType] ,[FRWAE] = [ForeignCurrencyKey] ,[KURSF] = [ExchangeRate] ,[REC_WAERS] = [CurrencyKey] ,[RKAUFNR] = [InternalOrder_BK] ,[SKOST] = [CostCenterID_BK] ,[BUKRS] = IIF(LEN(TRIM([CompanyCode_BK])) = 4 ,CONCAT('CC_',[CompanyCode_BK]), NULL) ,[KOKRS] = COALESCE([COArea_CostCenter], [COArea_CostElement]) ,[WERKS] = IIF([Plant_BK] IS NOT NULL, CONCAT('PL_',[Plant_BK]),NULL) ,[KSTAR] = [CostElement_ID_BK] ,[KSTRG] = [CostObject] ,[PSPNR] = [WBSElement_BK] ,[PRCTR] = [ProfitCenter_BK] ,[PPRCTR] = [ProfitCenter_Partner] ,[LAND1] = [Country] ,[MTART] = [MaterialType] ,[WWR14] = [IntercompanyIndicator] ,[KTGRM] = [AccountAssignmentGroupMaterial] ,[WW100] = [ProductGroup] ,[WW101] = [ProductHierMaterial] ,[WW107] = [OrderReason] ,[CustomerGroup] = [CustomerGroup] --Technical field - KDGRP ,[REGIO] = [Region] ,[KUNRG] = [Payer] ,[NameOfValueField] = [NameOfValueField] ,[ValueField] = [Amount] --,[NameOfValueFieldOrg] = [NameOfValueField] ,[ReverseFlag] = NULL FROM #temp_result_raw_ETAS ; /* ------------------------------------------------------ */ -- Create reversals for existing CO-PA documents non reversed CO-PA line items /* ------------------------------------------------------ */ INSERT INTO #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE SELECT [RowInsertDate] ,[AuditId] ,[EntityId] ,[RowEndDate] ,[LoadPackageId] ,[COPA_Item_HK] ,[LoadDateDVSat] ,[SourceSystemCodeBK] ,[DocumentNumberIdBK] ,[DocumentNumberPosid] ,[PALEDGER] ,[VRGAR] ,[PERIO] ,[BELNR] ,[POSNR] ,[HZDAT] ,[HZDAT_TIMESTAMP] ,[GJAHR] ,[BUDAT] ,[KNDNR] ,[ARTNR] ,[FKART] ,[FRWAE] ,[KURSF] ,[REC_WAERS] ,[RKAUFNR] ,[SKOST] ,[BUKRS] ,[KOKRS] ,[WERKS] ,[KSTAR] ,[KSTRG] ,[PSPNR] ,[PRCTR] ,[PPRCTR] ,[LAND1] ,[MTART] ,[WWR14] ,[KTGRM] ,[WW100] ,[WW101] ,[WW107] ,[KDGRP] ,[REGIO] ,[KUNRG] ,[NameOfValueField] ,[ValueField] --,[NameOfValueFieldOrg] ,[ReverseFlag] FROM ( select stg.[RowInsertDate] ,stg.[AuditId] ,stg.[EntityId] ,'2999-12-31 00:00:00.0000000' as [RowEndDate] ,stg.[LoadPackageId] ,reversal.[COPA_Item_HK] ,reversal.[LoadDateDVSat] ,reversal.[SourceSystemCodeBK] ,reversal.[BELNR] as [DocumentNumberIdBK] ,reversal.[POSNR] as [DocumentNumberPosid] ,reversal.[PALEDGER] ,reversal.[VRGAR] ,reversal.[PERIO] ,reversal.[BELNR] ,reversal.[POSNR] ,reversal.[HZDAT] ,reversal.[HZDAT_TIMESTAMP] ,reversal.[GJAHR] ,reversal.[BUDAT] ,reversal.[KNDNR] ,reversal.[ARTNR] ,reversal.[FKART] ,reversal.[FRWAE] ,reversal.[KURSF] ,reversal.[REC_WAERS] ,reversal.[RKAUFNR] ,reversal.[SKOST] ,reversal.[BUKRS] ,reversal.[KOKRS] ,reversal.[WERKS] ,reversal.[KSTAR] ,reversal.[KSTRG] ,reversal.[PSPNR] ,reversal.[PRCTR] ,reversal.[PPRCTR] ,reversal.[LAND1] ,reversal.[MTART] ,reversal.[WWR14] ,reversal.[NameOfValueField] ,reversal.[KTGRM] ,reversal.[WW100] ,reversal.[WW101] ,reversal.[WW107] ,reversal.[KDGRP] ,reversal.[REGIO] ,reversal.[KUNRG] ,(reversal.[ValueField] * - 1.00) as [ValueField] --,reversal.[NameOfValueFieldOrg] ,(ISNULL(reversal.[ReverseFlag],0) + 1) as [ReverseFlag] ,ROW_NUMBER() over (partition by reversal.[COPA_Item_HK] order by reversal.[LoadPackageId] desc ) as [RowNum] FROM #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE stg INNER JOIN [INFI_PnLService_TM1_CSC2].[PnL_Service_COPA_CCI_V1_MFCT0_D7] reversal on reversal.[COPA_Item_HK] = stg.[COPA_Item_HK] and reversal.[ReverseFlag] is null ) as ss_reversal where ss_reversal.[RowNum] = 1 ; /* ------------------------------------------------------ */ -- Insert stage into target table /* ------------------------------------------------------ */ BEGIN TRY BEGIN TRAN --TRUNCATE TABLE [INFI_PnLService_TM1_CSC2].[PnL_Service_COPA_CCI_V1_MFCT0_D7] INSERT INTO [INFI_PnLService_TM1_CSC2].[PnL_Service_COPA_CCI_V1_MFCT0_D7] WITH (TABLOCK) SELECT * FROM #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE ; COMMIT TRAN END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; END CATCH /* ------------------------------------------------------ */ -- Get rows inserted for logging /* ------------------------------------------------------ */ SET @RowsInserted = (SELECT COUNT(*) FROM #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE) SET @RowsRead = @RowsInserted SET @RowsUpdated = 0 SET @RowsDeleted = 0 /* ------------------------------------------------------ */ -- Last Step | Cleanup /* ------------------------------------------------------ */ DROP TABLE IF EXISTS #temp_deltaHKlist_ETAS DROP TABLE IF EXISTS #temp_hub_data_ETAS DROP TABLE IF EXISTS #temp_result_raw_ETAS DROP TABLE IF EXISTS #PnL_Service_COPA_CCI_V1_MFCT0_D7_STAGE END;"
INFI_MyMeasure_CSC2;124;INFormation Mart as Interface;V_Pilum_CostForecast_V1_IFCT0_F0;369084751;V ;VIEW;3161;/**/ /* View: V_Pilum_CostForecast_V1_IFCT0_F0 */ /**/ /* =*/ /* V01.00.00 2023-03-23 Aman Kumar BD/XAD5 */ /* Integrate the measures from PILUM CostForecast into the myMeasure platform */ /* Data.Core Outgoing Interface #272 https://inside-docupedia.bosch.com/confluence/x/Cmf4k */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.00 - Initial Version - Creation */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter_CDP_ATTR_V2;369136806;V ;VIEW;42487;/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter_CDP_ATTR_V2 */ /**/ /* =*/ /* V01.00.06 2023-08-09 Michal Erdman */ /* V01.00.05 2022-10-14 Ismail Okadia */ /* V01.00.04 2022-02-28 Hui Yang CI/XEF1 */ /* V01.00.03 2021-12-20 Michal Erdman CI/XTD2 */ /* V01.00.02 2021-11-15 Ilja Frolov GS/BDD2 */ /* V01.00.01 2021-08-31 Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view provides the attributes of CostCenter for CDP */ /* Data.CORE Outgoing Interface #0128 https://inside-docupedia.bosch.com/confluence/x/KwkyZg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.06: Changed valid_from and valid_to to display dates from source */ /* V01.00.05 - Removed checking of statetimefrom : to include future cost center attributes */ /* V01.00.04 - Extended with SGnA attributes and other additional attributes */ /* V01.00.03 - Optimization */ /* V01.00.02 - Added Logical System */ /* V01.00.01 - Added FunctionalArea + Implement dynamical language */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G9;369644610;V ;VIEW;2263;/**/ /* View: V_FactActualCost_G9 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P74 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_D0;369800775;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_D0 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G5;372508706;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G5 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G7;373276785;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G7 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G4;375828551;V ;VIEW;8103;"/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G4 */ /**/ /*=*/ /* V01.04.00 - 2021-04-22 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.04.00: 2021-04-22 Added values to Code and Group description fields */ /* - V01.03.01: 2021-04-06 Added columns [LanguageCode] and [SourceSystem] */ /* - V01.03.00: 2021-03-19 Renamed column [Damage] to [DamageGroup] & added columns [DamageCode], */ /* [DamageCodeDescription], [DamageGroupDescription]; */ /* Renamed column [Cause] to [CauseGroup] & added columns [CauseCode], */ /* [CauseCodeDescription], [CauseGroupDescription] (V2) */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G1;381556743;V ;VIEW;8498;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G1 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_GlobalHierarchyDescription_CDP;383704815;V ;VIEW;1618;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 4/11/2023 3:04:38 PM */ /**/ /**/ /* View: V_INTF_COOM_Costs_DIM_GlobalHierarchyDescription_CDP */ /**/ /* =*/ /* V00.00.01 2023-04-11 Ismail Okadia */ /* This view provides the description for the global hierarchy for CDP */ /* Restriction: */ /* None */ /* Changes: */ /* V00.00.01 - Initial version */ /* =*/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement;384368784;V ;VIEW;6686;/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement */ /**/ /* =*/ /* V01.03.01 2023-10-01 Yannick Sigwalt GS/BDD1 */ /* This view provides the parent child hierarchy of CostElement for TM1 */ /* Data.CORE Outgoing Interface #0011 https://inside-docupedia.bosch.com/confluence/x/-Oo_VQ */ /* Restriction: */ /* Dynamic Hierarchy filter is used ([MEAM_DataCORE_CSC1].[V_DataCOREDimensionHierarchy]) */ /* Changes: */ /* V01.03.01 - reworked usage of GenericParameter table */ /* V01.03.00 - Extended by GenericParameter CostElement */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Add hierarchy 'RB-E-LOG' */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_D7;385084808;V ;VIEW;9266;/**/ /* View: V_INTF_MD_Material_D7 */ /**/ /* = */ /* V01.00.01 2023-03-10 Ilja Frolov GS/BDD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #334 https://inside-docupedia.bosch.com/confluence/x/jsCgpg */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.00.01 Added filter for actual and previous year data */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_GK;385644667;V ;VIEW;2263;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P77 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_D1;385800832;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_D1 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G6;388508763;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G6 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G9;389276842;V ;VIEW;4912;/**/ /* View: V_FactActualCost_G9 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G5;391828608;V ;VIEW;8103;"/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G5 */ /**/ /*=*/ /* V01.04.00 - 2021-04-22 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.04.00: 2021-04-22 Added values to Code and Group description fields */ /* - V01.03.01: 2021-04-06 Added columns [LanguageCode] and [SourceSystem] */ /* - V01.03.00: 2021-03-19 Renamed column [Damage] to [DamageGroup] & added columns [DamageCode], */ /* [DamageCodeDescription], [DamageGroupDescription]; */ /* Renamed column [Cause] to [CauseGroup] & added columns [CauseCode], */ /* [CauseCodeDescription], [CauseGroupDescription] (V2) */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_B2;392036828;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_B2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G2;397556800;V ;VIEW;8498;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G2 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement_ATTR;400368841;V ;VIEW;9960;"/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement_ATTR */ /**/ /* =*/ /* V01.02.03 2022-01-10 Yannick Sigwalt & Stephan Wund GS/BDD1 */ /* This view provides the attributes of CostElement for TM1 */ /* Data.CORE Outgoing Interface #0012 https://inside-docupedia.bosch.com/confluence/x/kes_VQ */ /* Restriction: */ /* Dynamic Hierarchy filter is used ([MEAM_DataCORE_CSC1].[V_DataCOREDimensionHierarchy]) */ /* Changes: */ /* V01.02.03 - Reworked View to use dynamic hierarchy filter */ /* V01.02.02 - Include RB-E-LOG in hierarchy selection */ /* V01.02.01 - Remove hierarchy column and limit elements for RB-E hierarchy only */ /* - Remove CostElementId as attribute, already available as Element */ /* - Set ""S"" Type for all attributes */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Add hierarchy 'RB-E-LOG' */ /* V01.00.02 - Adapted column name ""Attribute"" to ""Attribut"" */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP_ATTR_V2;401136920;V ;VIEW;3614;/**/ /* View: V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP_ATTR_V2 */ /**/ /* = */ /* V01.00.04 2023-08-17 Michal Erdman & URA1FE & Patrik Just CI/DAV2.3 */ /* This view provides the attributes of Organization Office for CDP */ /* Data.CORE Outgoing Interface #0134 https://inside-docupedia.bosch.com/confluence/x/RAkyZg */ /* Implemented Soft Rules */ /* Restriction: */ /* Changes: */ /* V01.00.04: Convert valid_from, valid_to to int */ /* V01.00.03: Changed valid_from and valid_to to display dates from source */ /* V01.00.02: Replaced cte_OrganizationOfficeMaxStateTimeFrom with */ /* cte_OrganizationOfficeValidAtExecutionTime */ /* V01.00.01 : Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_D0;401644724;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_D0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CostCenter;401696779;V ;VIEW;1204;/**/ /* View: V_INTF_PNL_DIM_CostCenter */ /**/ /* = */ /* V 01.00.00 2020-10-23 Patrik Just CI/DAV2.3 */ /* Empty view to get structural consistency in target application */ /* Data.CORE Outgoing Interface #0052 https://inside-docupedia.bosch.com/confluence/x/lrh9Vg */ /* Restrictions: */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_D3;401800889;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_D3 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G7;404508820;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_GK;405276899;V ;VIEW;4912;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G6;407828665;V ;VIEW;8103;"/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G6 */ /**/ /*=*/ /* V01.04.00 - 2021-04-22 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.04.00: 2021-04-22 Added values to Code and Group description fields */ /* - V01.03.01: 2021-04-06 Added columns [LanguageCode] and [SourceSystem] */ /* - V01.03.00: 2021-03-19 Renamed column [Damage] to [DamageGroup] & added columns [DamageCode], */ /* [DamageCodeDescription], [DamageGroupDescription]; */ /* Renamed column [Cause] to [CauseGroup] & added columns [CauseCode], */ /* [CauseCodeDescription], [CauseGroupDescription] (V2) */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_D0;408036885;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_D0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCORELogicalSystem;409260713;V ;VIEW;937;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 19.10.2021 07:54:58 */ /**/ /**/ /* View: V_DataCORELogicalSystem */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G3;413556857;V ;VIEW;8487;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G3 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_INTF_SupplierHierarchy_V1_IDIM1;417136977;V ;VIEW;3972;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 8/4/2023 1:21:56 PM */ /**/ /**/ /* View: V_INTF_SupplierHierarchy_V1_IDIM1 */ /**/ /**/ /* V01.00.01 2023-08-04 Sanja Mihalic BD/XAD3 & Stephan Wund GS/BDD1 */ /* Vendor Dimensional View for GS Trust P2P */ /* Data.CORE Outgoing Interface #0201 https://inside-docupedia.bosch.com/confluence/x/1D6tfg */ /* Restriction: */ /* */ /* Update: */ /* V01.00.01 2023-08-04 - initial */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_D4;417644781;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_D4 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PC4 */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CostCenter_ATTR;417696836;V ;VIEW;13299;/**/ /* View: V_INTF_PNL_DIM_CostCenter_ATTR */ /**/ /* =*/ /* V01.00.01 2022-07-07 Yannick Sigwalt GS/BDD2 */ /* This view provides the attributes of CostCenter for TM1 */ /* Data.CORE Outgoing Interface #0053 https://inside-docupedia.bosch.com/confluence/x/-7h9Vg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 Added Cost Center from S4 */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_D4;417800946;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_D4 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G4_Test_DemoSystem;418972719;V ;VIEW;7629;"/**/ /* View: V_MaintenanceOrder_V3_IDIM1_Test_G4_DemoSystem */ /**/ /**/ /* V01.02.01 - 2020-08-26 Tatjana Derdus CI/DAV2.3 */ /* New view Dimension Maintenance based on optimized data model for SAPP81 */ /* Update: */ /* - V01.00.00: Initial version (2020-03-30) */ /* - V01.00.01: Cast BasicStartDate and BasicEndDate as Date */ /* - V01.01.00: Adjust MaintenanceOrderId to trim variable number of leading zeros */ /* - V01.02.00: Make independent of LanguageCode; Use BasicStart/End DateId instead of Date */ /* - V01.02.01: Make Dummy-Record (DimId = 0) exclusive for view of leading system (POE/G0) */ /* - V01.03.00: Add column FunctionalLocationDimId */ /**/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_G9;420508877;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_G9 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_O1;421276956;V ;VIEW;4912;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_D3;424036942;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_D3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G4;429556914;V ;VIEW;8498;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G4 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_WBSElement;433084979;V ;VIEW;4671;"/**/ /* View: V_INTF_DIM_WBSElement */ /**/ /* =*/ /* V01.00.01 2023-03-23 Tatjana Derdus */ /* This view provides the parent-child-hierarchy of WBS Element (internal) related to PlantResult to TM1. */ /* Restriction: */ /* - Only WBS Elements used in CO-PA bookings are delivered by this view. */ /* Changes: */ /* - V01.00.01 - 2023-03-15 - Use internal WBS Element as key; add end-dating satellites */ /* - V01.00.00 - 2023-03-10 - Initial version */ /* =*/"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_AccountingP2PAggregated_V1_IFCT0;433137034;V ;VIEW;6098;/**/ /* View: V_AccountingP2PAggregated_V1_IFCT0 */ /**/ /**/ /* V01.00.05 - 2023-08-17 Sanja Mihalic BD/XAD3 */ /* Fact view for Accounting P2P - Aggregated Fact */ /* Data.CORE Outgoing Interface #0191 https://inside-docupedia.bosch.com/confluence/x/UlFQf */ /* Update: */ /* - V01.00.05 2023-08-17 - Adding fields for changed rules #xBI-P2P-000000008 NetDueDate and #xBI-P2P-000000018 DaysOverdue */ /* - V01.00.04 2023-07-10 - New Key logic implemented (VendorInvoice_BHUB) */ /* - V01.00.03 2023-04-07 - Rework PerFact views after Business UAT */ /* - V01.00.02 2023-03-20 - Rework PerFact views after UAT */ /* - V01.00.01 2023-02-28 - Change of field name PaymentTermDays to PaymentDays */ /* - V01.00.00 2023-01-23 - Initial */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G0;433644838;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from POE */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G0;433801003;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G0 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_GK;436508934;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_GK */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_A3;437277013;V ;VIEW;4912;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_D4;440036999;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_D4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G5;445556971;V ;VIEW;8495;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G5 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_InternalOrder;448369012;V ;VIEW;1616;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 18.01.2023 11:37:56 */ /**/ /**/ /* View: V_INTF_DIM_InternalOrder */ /**/ /* = */ /* V01.00.00 2023-01-18 Michal Erdman */ /* Access Layer for Plant Result for Internal Orders for TM1 */ /* Data.CORE Outgoing Interface #0316 https://inside-docupedia.bosch.com/confluence/x/1iB6mQ */ /* Restrictions: */ /* - Empty view to get structural consistency in target application */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_WBSElement_ATTR;449085036;V ;VIEW;10542;"/**/ /* View: V_INTF_DIM_WBSElement_ATTR */ /**/ /* =*/ /* V01.00.01 2023-03-23 Tatjana Derdus */ /* This view provides the attributes of WBS Element (internal) related to PlantResult to TM1. */ /* Restriction: */ /* - Only WBS Elements used in CO-PA bookings are delivered by this view. */ /* Changes: */ /* - V01.00.01 - 2023-03-23 - Use internal WBS Element as key; add end-dating satellites */ /* - V01.00.00 - 2023-03-10 - Initial version */ /* =*/"
INFI_GSP2P_CSC2;96;INFormation Mart as Interface;V_AccountingP2PDetailed_V1_IFCT0;449137091;V ;VIEW;10447;/**/ /* View: V_AccountingP2PDetailed_V1_IFCT0 */ /**/ /**/ /* V01.00.05 - 2023-08-17 Sanja Mihalic BD/XAD3 */ /* Fact view for Accounting P2P - Detailed Fact */ /* Data.CORE Outgoing Interface #0190 https://inside-docupedia.bosch.com/confluence/x/RT1Qf */ /* Update: */ /* - V01.00.05 2023-08-17 - Adding fields for changed rules #xBI-P2P-000000008 NetDueDate and #xBI-P2P-000000018 DaysOverdue */ /* - V01.00.04 2023-07-10 - New Key logic implemented (VendorInvoice_BHUB) */ /* - V01.00.03 2023-04-07 - Rework PerFact views after Business UAT */ /* - V01.00.02 2023-03-20 - Rework PerFact views after UAT */ /* - V01.00.01 2023-02-28 - Change of field name PaymentTermDays to PaymentDays */ /* - V01.00.00 2023-02-03 - Initial */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G1;449801060;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G1 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G0;451024888;V ;VIEW;4097;/**/ /* View: V_SparePart_IDIM1_G0 */ /**/ /**/ /* V01.03.02 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from POE */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G0] */ /* Updates: */ /* - V01.03.02 - Replaced PerFact */ /* - V01.03.01 - Fixed join error in case of leading zeros for TermCode (cast TermCode as Int) */ /* - V01.03.00 - Filled MaterialGroupDescription, TermCodeDescription based on PT2 ref. data */ /* - V01.02.00 - Added MaterialGroup, MaterialGroupDescription, TermCode, TermCodeDescription */ /* - V01.01.00 - Use source system specific MaterialDimId and ref. view for LanguageCode */ /* - V01.00.01 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_O1;452508991;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_O1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_A4;453277070;V ;VIEW;4912;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_D7;456037056;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_D7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G6;461557028;V ;VIEW;8495;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G6 */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_CostCenter_V5_IDIM1;465137148;V ;VIEW;19602;/**/ /* View: V_CostCenter_V5_IDIM1 */ /**/ /**/ /* V01.00.00 2023-07-25 Yannick Sigwalt GS/BDD1 */ /* Dimensional View for GS Trust SGnA for Cost Center */ /* Data.CORE Outgoing Interface #0167 https://inside-docupedia.bosch.com/confluence/x/WGJNcg */ /* Update: */ /* - V01.00.00 Creation */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G1;465644952;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G1 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P45 */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Plant_ATTR;465697007;V ;VIEW;4489;/**/ /* View: V_INTF_PNL_DIM_Plant_ATTR */ /**/ /* = */ /* V 01.00.06 2022-07-11 Michal Erdman & Barbara Balcer CI/XAD2 & Pawel Bialecki CI/XTD2 */ /* This view retreieves the text for Plant */ /* Major data source: */ /* - RefMDS/Plant(SAP) */ /* https://rb3pxga0.server.bosch.com:44345/sap/bc/ui5_ui5/rb0g/refmdrep/index.html#/MDOBJECT_SET/E175_V1 */ /* Restrictions: */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.06 Added Description from PlantAddressData_WSAT0_SL_X */ /* - V01.00.05 Added CompanyCode, LocationCode, PlantNumber */ /* - V01.00.04 Updated view due to changes in underlaying RAW VAULT Model */ /* Implemented variable language Code Selection */ /* - V01.00.03 Add prefix PL_ */ /* - V01.00.02 remove additional attribute column */ /* - V01.00.01 replaces dummy view without content */ /* = */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G2;465801117;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G2 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_O2;468509048;V ;VIEW;3387;/**/ /* View: V_COPlanCostsDelta_O2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_H1;469277127;V ;VIEW;4912;/**/ /* View: V_FactActualCost_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G0;472037113;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_G7;477557085;V ;VIEW;8480;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_G7 */ /**/ /* = */ /* V01.00.02 2022-11-10 Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_InternalOrder_ATTR;480369126;V ;VIEW;6756;/**/ /* View: V_INTF_DIM_InternalOrder_ATTR */ /**/ /* =*/ /* V01.00.01 2023-01-20 Michal Erdman */ /* Access Layer for Plant Result for Internal Orders texts for TM1 */ /* Data.CORE Outgoing Interface #0317 https://inside-docupedia.bosch.com/confluence/x/MCF6mQ */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Restrictions: */ /* - Merged descriptions for B2,C3,G0,G1,G2,G3,G4,G5,G6,S3,SL */ /* Update: */ /* - V01.00.01 Performance optimization */ /* - V01.00.00 Create */ /*= */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_CompanyCode_M2;481137205;V ;VIEW;2354;/**/ /* View: V_INTF_MD_CompanyCode_M2 */ /**/ /* */ /* V01.01.01 URA1FE & Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month company code master data to Optravis */ /* Data.CORE Outgoing Interface #0067 https://inside-docupedia.bosch.com/confluence/x/g5nSWg */ /* Restrictions: */ /* - only includes company code description in English language */ /* - only includes company codes which have status 40, 49, 50 (Released, Discontinuation, Invalid) */ /* Changes: */ /* - V01.01.01 2023-08-16 Enhanced with status filter 50 and column [CompanyCodeStatusId] */ /* - V01.01.00 2021-02-10 Added column SourceSystem */ /* - V01.00.01 2020-12-10 Adjusted syntax for EOM determ. (uniform in all Optravis MD views) */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G2;481645009;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G2 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P72 */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_RKAUFNR_ATTR;481697064;V ;VIEW;6040;/**/ /* View: V_INTF_PNL_DIM_RKAUFNR_ATTR */ /**/ /* =*/ /* V 01.00.01 2022-07-11 Ilja Frolov GS/BDD2 & Patrik Just CI/DAV2.3 */ /* Interface provides Internal Orders texts for TM1 */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* - Access Layer Definition */ /* #FBI-PnL-000000054 https://inside-docupedia.bosch.com/confluence/x/kTHvhw */ /* Restrictions: */ /* - Merged descriptions for G0,G1,G2,G3,G4,G5,G6,C3,S3,B2, SL */ /* Update: */ /* V 01.00.01 added Description from InternalOrderGeneralAttributes_WSAT0_B2_X */ /*= */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G3;481801174;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G3 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G4;484509105;V ;VIEW;2311;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 04.11.2022 08:55:33 */ /**/ /**/ /* View: V_COPALineItemPlanDelta_G4 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefSourceSystem_V2_IREF0;485016909;V ;VIEW;15586;/**/ /* View: V_RefSourceSystem_V2_IREF0 */ /**/ /**/ /* V01.00.02 - 2021-02-04 - Tatjana Derdus CI/DAV2.3 */ /* Reference view inclduing Web GUI URL locations from various SAP systems for reporing */ /* Restrictions: */ /* - Limited to first URL with HTTPS protocol per system (SortSequence_BK = 1) */ /* Updates: */ /* - V01.00.02: 2021-02-04 - BugFix: Removed double entries for P79 */ /* - V01.00.01: 2021-01-25 - Renamed column [SAPSystem] to [SourceSystem] */ /* - V01.00.00: 2021-01-13 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_D7_DemoSystem;485277184;V ;VIEW;7084;/**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G1;488037170;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_TESTbyWK8FE;490029077;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;14544;/**/ /* V01.00.03 2021-11-23 Andrs Szvs */ /* Fact View for Maintennace Application */ /* */ /* Update: */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_TESTbyWK8FE] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_wh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK] INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cebcadi_bs.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_GK;493557142;V ;VIEW;8495;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_GK */ /**/ /* = */ /* V01.00.02 2022-11-10 Michal Erdman & Yannick Sigwalt GS/BDD2 */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.02 Added PartnerCostCenter and PartnerActivityType/changed SR-000000025 implementation */ /* V01.00.01 -BugFixing due to duplicate CostCenter */ /* -optimized datatype of FiscalYear for better performance while querying */ /* -Reworked field naming and order to match the one from Plan view */ /* V01.00.00 Creation */ /* = */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_LegalEntity_M2;497137262;V ;VIEW;2268;/**/ /* View: V_INTF_MD_LegalEntity_M2 */ /**/ /* */ /* V01.00.01 URA1FE & Tatjana Derdus CI/DAV2.3 */ /* Data.CORE Outgoing Interface #0074 https://inside-docupedia.bosch.com/confluence/x/JjMRY */ /* Interface view for transfer of end-of-previous-month legal entity master data to Optravis */ /* Restrictions: */ /* - only includes legal entities of edition 'WORKING SET' */ /* - only includeslegal entities which have status 40, 49, 50 (Released, Discontinuation,Invalid) */ /* Changes: */ /* - V01.00.01 2023-08-16 Enhanced with status filter 50 and column [LegalEntityStatusId] */ /* - V01.00.00 2020-02-22 Initial version */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G3;497645066;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G3 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P79 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G4;497801231;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G4 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPALineItemPlanDelta_G5;500509162;V ;VIEW;1969;/**/ /* View: V_COPALineItemPlanDelta_G5 */ /**/ /* =*/ /* V01.00.00 2022-11-04 Yannick Sigwalt GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_xx_X] */ /* to identify FiscalYearPeriod of newly loaded Plan CO-PA Document Line Items */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PartnerObject_V2_IDIM1;501016966;V ;VIEW;4448;/**/ /* View: V_PartnerObject_V2_IDIM1 */ /**/ /**/ /* V01.02.00 - 2021-02-11 Yannick Sigwalt GS/BDO12 & Tatjana Derdus CI/DAV2.3 */ /* Conformed Dimension for PartnerObject */ /* Update: */ /* V01.02.00 - Reworked View ( removed Obsolete CostCenter Satellite, Performance) */ /* V01.01.00 - Join CostCenters via LogicalSystem */ /* V01.00.00 - Initial version */ /* Restrictions: */ /* Currently only contains PartnerObjectSourceBK and PartnerObjectSourceDimId of the */ /* following dimensions objects: MaintenanceOrder, CostCenter */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G0_DemoSystem;501277241;V ;VIEW;7438;/**/ /* View: V_FactActualCost_G0_DemoSystem */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G2;504037227;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_O1;509557199;V ;VIEW;8356;/**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_O1 */ /**/ /* = */ /* V01.00.01 2022-11-10 Michal Erdman & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.01 Added PartnerCostCenter and PartnerActivityType */ /* V01.00.00 Creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G0;510885137;V ;VIEW;4643;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G0 */ /**/ /**/ /* V01.02.01 - 2022-04-12 Stephan Wund GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.02.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.02.00 - 2021-04-06 - Included new End-Dating Satellite for PO Header to Vendor Relationship */ /* - V01.01.00 - 2021-03-17 - Join PurchaseOrderLine Item information via EKKN (instead of AFVC) */ /* - V01.00.01 - 2021-02-24 - BugFix: Distinct selection of records */ /* - V01.00.00 - 2021-02-04 - Initial version */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessPartner;512369240;V ;VIEW;4054;/**/ /* View: V_INTF_PNL_DIM_BusinessPartner */ /**/ /* = */ /* V01.01.03 2023-01-10 Michal Erdman & Jakub Kozlowski & Yannick Sigwalt GS/BDD2 */ /* Data.CORE Outgoing Interface #0038 https://inside-docupedia.bosch.com/confluence/x/R9lSVg */ /* This view merges RB Customer External and RB Customer Internal Hierarchy together */ /* Hint: The lowest leave is SAP Customer (Debitor) */ /* - Filter on RB Customer Hierarchy External set to 'WORKING SET' */ /* - Filter on RB Customer Hierarchy Internal set to 'WORKING SET' */ /* Updates: */ /* V01.01.03 BugFix: RBCustomer from S4 becomes child of R3 customer instead of it's parent */ /* V01.01.02 Integrated the S4 external RB Customers */ /* V01.01.01 changed process of root node for ExternalBusinessPartner due to change in source SR */ /* V01.01.00 Removed Debitor Information from View */ /* V01.00.04 Added node BUSINESSPARTNER_DY */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GLAccountS4_ATTR;513085264;V ;VIEW;6206;/**/ /* View: V_INTF_PNL_DIM_GLAccountS4_ATTR */ /**/ /* = */ /* V01.00.07 2023-03-15 Ilja Frolov GS/BDD1, Yannick Sigwalt GS/BDD1 & URA1FE */ /* Attributes for GL Account */ /* Data.CORE Outgoing Interface #0222 https://inside-docupedia.bosch.com/confluence/x/Phodhg */ /* Restrictions: */ /* - IBM PA Interface Description https://inside-docupedia.bosch.com/confluence/x/wS--Ug */ /* Update: */ /* - V01.00.07 - Removed generic paramter and renamed */ /* - V01.00.06 - Performance optimization */ /* - V01.00.05 - Replaced Semantic Tag from source FINSC_HRRP2SEMTA_SL to FINSC_FAGL2SEMTA */ /* - V01.00.04 - removed doubled trimming of prefix of Child_BK */ /* - Optimized query because the querying from TM1 did not finish */ /* - V01.00.03 - Corrected datatype for Valid From and Valid To */ /* - V01.00.02 - Added attribute SemanticTag */ /* Removed attribute NodeOrder and all attributes w/ null values in Description */ /* - V01.00.01 - Changed Description for GL Account */ /* - Filtered on [NodeTypeCode] not in 'D' (duplicates) */ /* - converted Element to expected output format */ /* - V01.00.00 Creation */ /* = */
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_SL;513137319;V ;VIEW;10596;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 21.08.2023 20:51:29 */ /**/ /**/ /* View: V_INTF_MonthlySalesTransactions_SL */ /**/ /* =*/ /* V01.00.00 2023-08-18 Tatjana Derdus CI/DAV2.3 & Ilja Frolov GS/BDD1 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0264 https://inside-docupedia.bosch.com/confluence/x/IWtwo */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.00 Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G4;513645123;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G4 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P81 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G5;513801288;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G5 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G4_DemoSystem;514973061;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;11255;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G4_DemoSystem] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) *(1-(CAST(coalesce(ccdis.[DimensionID], 0) as decimal)/10-FLOOR(CAST(coalesce(ccdis.[DimensionID], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce(cecadis.[DimensionID], 0) as decimal)/10-FLOOR(CAST(coalesce(cecadis.[DimensionID], 0) as decimal)/10) )/10 *3) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) *(1-(CAST(coalesce(ccdis.[DimensionID], 0) as decimal)/10-FLOOR(CAST(coalesce(ccdis.[DimensionID], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce(cecadis.[DimensionID], 0) as decimal)/10-FLOOR(CAST(coalesce(cecadis.[DimensionID], 0) as decimal)/10) )/10 *3) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId] INNER join ( select ccdis.DimensionID from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccpa_wl with (nolock) inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccpa_ws with (nolock) on ccpa_wl.[CostCenterPlantAssignment_HK] = ccpa_ws.[CostCenterPlantAssignment_HK] and ccpa_ws.[LoadEndDate] = CAST('2999-12-31' AS DATETIME2) inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccpa_wl.[Plant_HK] --inner join [RAWV_RB_CSC1].CostCenter_WHUB0 cc_wh --on cc_wh.CostCenter_HK = ccpa_wl.CostCenter_HK inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis on ccdis.[CostCenter_HK] = ccpa_wl.CostCenter_HK where p_wh.Plant_BK = '9830' ) ccpa_wl on coalesce(ccdis.[DimensionID], 0) = ccpa_wl.DimensionID
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G3_DemoSystem;517277298;V ;VIEW;7084;/**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G3;520037284;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeEquipmentToFact_V2_IDIM1;526676974;V ;VIEW;1093;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 24.03.2020 15:45:59 */ /**/ /**/ /* View: V_BridgeEquipmentToFact_V2_IDIM1 */ /**/ /**/ /* V01.00.00 - 2020-03-24 Stephan Wund GS/FBI2 */ /* Bridge table for Equipment. holding unique values for EquipmentDimId */ /* - Update: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G1;526885194;V ;VIEW;4423;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G1 */ /**/ /**/ /* V01.00.01 - 2022-04-12 Stephan Wund GS/BDD2 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.00.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.00.00 - 2021-11-26 - Initial version copied from */ /* V_Purchase Order Line Item For Maintenance Order_IDIM1_G0 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_WBSElement_ATTR;529085321;V ;VIEW;7839;/**/ /* View: V_INTF_PNL_DIM_WBSElement_ATTR */ /**/ /* = */ /* V01.00.03 2023-03-17 Ilja Frolov GS/BDD1, Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view retreieves the texts for WBSElements from different source systems */ /* Restrictions: */ /* - Current systems G0,G1,G2,G3,G4,G5,G6,S3,B2 */ /* - IBM PA Interface Description https://inside-docupedia.bosch.com/confluence/x/lLp9Vg */ /* Update: */ /* - V01.00.03 Removed C3, chnaged to internal WBSElement_BK and added Enddating Satellite */ /* - V01.00.02 View recreated and switched to current CO-PA Model */ /* - V01.00.01 add texts for languages DE and EN */ /* = */
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_SL;529137376;V ;VIEW;11417;/**/ /* View: V_INTF_PnL_SL */ /**/ /* =*/ /* V01.00.00 2023-08-21 Tatjana Derdus CI/DAV2.3 & Ilja Frolov GS/BDD1 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0265 https://inside-docupedia.bosch.com/confluence/x/eW9wo */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.00 Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G6;529801345;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G6 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G4_DemoSystem;533277355;V ;VIEW;7438;/**/ /* View: V_FactActualCost_G4_DemoSystem */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G4;536037341;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_00_Master;538849382;P ;SQL_STORED_PROCEDURE;9476;"/* =*/ /* V01.00.01 2023-05-23 Michal Erdman */ /* This procedure is Master procedure for executing specific test cases. */ /* Consumed Soft Rules */ /* Restriction: */ /* Update: */ /* V01.00.01 - handled error if stored procedure name to execute is empty */ /* =*/ create procedure MERM_CORE_Testing_CSC1.usp_CORETesting_00_Master ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@UseCase nvarchar(50),@TestCase nvarchar(50),@TargetDatabase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as BEGIN /* Start definition of Parameter for test execution */ ------------------- --,@DeltaTimestampFrom datetime2 --,@DeltaTimestampTo datetime2 --,@SourceSystem nvarchar(15) --,@SourceSystemVar nvarchar(5) --,@UseCase nvarchar(50) --,@TestCase nvarchar(50) --,@TargetDatabase nvarchar(100) --,@TargetSchema nvarchar(256) --,@TargetTable nvarchar(256) --,@LoadBatchId bigint --,@ProcessStepId bigint = 0 --,@EntityId bigint = 0 --,@AuditTrailId bigint = 0 --,@ProcessStatusMessage nvarchar(4000) = null --out --,@RowsRead int --out --,@RowsInserted int --out --,@RowsUpdated int --out --,@RowsDeleted int --out --,@ErrorSeverity int --out --,@ErrorState int --out --,@ErrorProcedure nvarchar(128) --out --,@ErrorLine int --out --SET @UseCase = 'AL2_MERM_RnDTesting_PDM' --SET @TestCase = 'RnDTest_WBSElementMCRAttribute001' --SET @SourceSystem = N'SAPP87' --SET @SourceSystemVar = N'G5' --SET @TargetDatabase ='FBI_CORE_CORE_D' --SET @TargetSchema = '' --SET @TargetTable = '' --SET @DeltaTimestampFrom = '2023-03-13 07:54:58.6159860' --SET @DeltaTimestampTo = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --SET @LoadBatchId = 112 --SET @ProcessStepId = 789 --SET @EntityId = 123 --SET @AuditTrailId = -2 --SET @ProcessStatusMessage = null ----------------------------- /* End Comment/Uncomment for testing Purposes*/ declare @spName nvarchar(256) ,@SQL nvarchar(max) ,@SQLspMain nvarchar(max) ,@SQLspParamsDefinition nvarchar(max) ,@StoredProcedure NVARCHAR(256) declare @Result table (spName nvarchar(256)) declare @ReturnProcessStatusNumber INT = 0; SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; SET @SQL = 'select top 1 StoredProcedure from ' + @TargetDatabase + '.[MERM_CORE_Testing_CSC1].[TestCaseUspMapping_MREF0_XX_L] where UseCase_PK = ''' + @UseCase + ''' and TestCase_PK = ''' + @TestCase + ''' and LoadEndDate = ''2999-12-31 00:00:00''' IF(@DebugLevel >= 9 ) BEGIN print ' ='; print cast( @SQL as NTEXT); print ' ='; END insert into @Result EXECUTE sp_executesql @SQL; select @spName = spName from @Result IF @spName IS NULL BEGIN SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , ' || Missing stored procedure to execute. Check configuration table [MERM_CORE_Testing_CSC1].[TestCaseUspMapping_MREF0_XX_L] for use case <', @UseCase,'> and test case <',@TestCase,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); END SET @SQLspParamsDefinition = '@SourceSystem nvarchar(15) ,@SourceSystemVar nvarchar(5) ,@UseCase nvarchar(50) ,@TestCase nvarchar(50) ,@TargetDatabase nvarchar(100) ,@TargetSchema nvarchar(256) ,@TargetTable nvarchar(256) ,@DeltaTimestampFrom datetime2 ,@DeltaTimestampTo datetime2 ,@LoadBatchId bigint ,@ProcessStepId bigint ,@EntityId bigint ,@AuditTrailId bigint ,@ProcessStatusMessage nvarchar(4000) output ,@RowsRead int output ,@RowsInserted int output ,@RowsUpdated int output ,@RowsDeleted int output ,@ErrorSeverity int output ,@ErrorState int output ,@ErrorProcedure nvarchar(128) output ,@ErrorLine int output' SET @SQLspMain = concat ('exec ',@TargetDatabase, '.', @spName , char(13) ,'@SourceSystem = @SourceSystem ', char(13) ,', @SourceSystemVar = @SourceSystemVar ', char(13) ,', @Usecase = @UseCase ', char(13) ,', @TestCase = @TestCase ', char(13) ,', @TargetDataBase = @TargetDatabase ', char(13) ,', @TargetSchema = @TargetSchema ', char(13) ,', @TargetTable = @TargetTable ', char(13) ,', @DeltaTimestampFrom = @DeltaTimestampFrom ', char(13) ,', @DeltaTimestampTo = @DeltaTimestampTo ', char(13) ,', @LoadBatchId = @LoadBatchId ', char(13) ,', @ProcessStepId = @ProcessStepId ', char(13) ,', @EntityId = @EntityId ', char(13) ,', @AuditTrailId = @AuditTrailId ', char(13) ,', @ProcessStatusMessage = @ProcessStatusMessage OUTPUT' , char(13) ,', @ErrorSeverity = @ErrorSeverity OUTPUT' , char(13) ,', @ErrorState = @ErrorState OUTPUT' , char(13) ,', @ErrorProcedure = @ErrorProcedure OUTPUT' , char(13) ,', @ErrorLine = @ErrorLine OUTPUT' , char(13) ,', @RowsRead = @RowsRead OUTPUT' , char(13) ,', @RowsInserted = @RowsInserted OUTPUT' , char(13) ,', @RowsUpdated = @RowsUpdated OUTPUT' , char(13) ,', @RowsDeleted = @RowsDeleted OUTPUT' , char(13) ) BEGIN TRY IF(@DebugLevel >= 9 ) BEGIN print ' ='; print cast( @SQLspMain as NTEXT); print cast( @SQLspParamsDefinition as NTEXT); print ' ='; END EXECUTE sp_executesql @SQLspMain, @SQLspParamsDefinition , @SourceSystem = @SourceSystem , @SourceSystemVar = @SourceSystemVar , @UseCase = @UseCase , @TestCase = @TestCase , @TargetDatabase = @TargetDatabase , @TargetSchema = @TargetSchema , @TargetTable = @TargetTable , @DeltaTimestampFrom = @DeltaTimestampFrom , @DeltaTimestampTo = @DeltaTimestampTo , @LoadBatchId = @LoadBatchId , @ProcessStepId = @ProcessStepId , @EntityId = @EntityId , @AuditTrailId = @AuditTrailId , @ProcessStatusMessage = @ProcessStatusMessage OUTPUT , @ErrorSeverity = @ErrorSeverity OUTPUT , @ErrorState = @ErrorState OUTPUT , @ErrorProcedure = @ErrorProcedure OUTPUT , @ErrorLine = @ErrorLine OUTPUT , @RowsRead = @RowsRead OUTPUT , @RowsInserted = @RowsInserted OUTPUT , @RowsUpdated = @RowsUpdated OUTPUT , @RowsDeleted = @RowsDeleted OUTPUT ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing procedure <', @spName,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure; SET @ReturnProcessStatusNumber = 9; SET @ErrorLine = COALESCE(@ErrorLine,0); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; --THROW; -- raise error to the client END CATCH RETURN @ReturnProcessStatusNumber END"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_REF_ExchangeRatesToEuro;542677031;V ;VIEW;2660;/* = */ /* V 01.00.00 2020-03-23 Yannick Sigwalt GS/FBI2 */ /* This view delivers the exchange rates from X to EURO to TM1 */ /* - Filter on [ExchangeRateType] = EURX Daily rate (from European Central Bank) */ /* - Filter on [ExchangeRateType] = ZAM0 Monthly average rate */ /* - Filter on [ExchangeRateType] = ZAY0 Annual average rate */ /* - Filter on [ExchangeRateType] = ZCAY Cross rates average yearly */ /* - Filter on [ExchangeRateType] = ZCBP Business Plan (Average, cross rate) */ /* - Filter on [ExchangeRateType] = ZCCF Current Forecast (Average, Cross rate) */ /* - Filter on [ExchangeRateType] = ZCFE Current Forecast (End, Cross rate) */ /* - Enhanced View to deliver CURRENCY_DY for each ExchangeRateTypes and ExchangeRateDate */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G2;542885251;V ;VIEW;4423;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G2 */ /**/ /**/ /* V01.00.01 - 2022-04-12 Stephan Wund GS/BDD2 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.00.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.00.00 - 2021-11-26 - Initial version copied from */ /* V_Purchase Order Line Item For Maintenance Order_IDIM1_G0 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessPartner_ATTR;544369354;V ;VIEW;8875;/**/ /* View: V_INTF_PNL_DIM_BusinessPartner_ATTR */ /**/ /* =*/ /* V01.01.05 2023-01-16 URA1FE & Michal Erdman & Jakub Kozlowski & Ilja Frolov GS/BDD2 */ /* This reads both RB Customer External and Internal Hierarchies) */ /* Data.CORE Outgoing Interface #0039 https://inside-docupedia.bosch.com/confluence/x/-tpSVg */ /* and reads the adequate text for the record */ /* - Filter on RB Customer Hierarchy External set to 'WORKING SET' */ /* - Filter on RB Customer Hierarchy Internal set to 'WORKING SET' */ /* - V01.01.00 Removed Debitor Text from View */ /* Updates: */ /* V01.01.05 BugFix: Corrected [MasterRBCustomer_BK] in QueryDescriptionRBCustomerExternal */ /* V01.01.04 BugFix: RBCustomer from S4 becomes child of R3 customer instead of it's parent */ /* V01.01.03 -Added new Attributes RBCUST_R3 and RBCUSTS4 */ /* -Added the descriptions for RB Customers from S4 */ /* V01.01.02 -Added restriction on LoadEndDate while querying the satellite */ /* V01.01.01 -swicthed satellite for LegalShare */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_COPA_CS_V2;545085378;V ;VIEW;2346;/**/ /* View: V_INTF_PNL_FACT_COPA_CS_V2 */ /**/ /* =*/ /* V01.00.03 2023-03-15 Ilja Frolov GS/BDD1, Yannick Sigwalt GS/BDD1 & Patrik Just CI/BTM-FI1 */ /* Transactional data for TM1 */ /* Outgoing Interface #0056 https://inside-docupedia.bosch.com/confluence/x/C7t9Vg */ /* This view is used as interface between persisted fact table INFI_TM1_CSC2.INTF_PNL_FACT_COPA_CS_V2 */ /* and consuming TM1 application of P&L.Series */ /* Restrictions: */ /* This view should be only used for fact data loading between Data.CORE and TM1 Input cube */ /* -------------------------------------------------------------------------------------------------------- */ /* updated */ /* - 01.00.03 - Changed WBSElement to internal WBS Element */ /* - 01.00.02 - Added AUART and PSTYV */ /* - 01.00.01 - Added RBELN and RPOSN */ /* - 01.00.00 - Initial version */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_BS_SL;545137433;V ;VIEW;4495;"/**/ /* View: V_INTF_PNL_FACT_BS_SL */ /**/ /* =*/ /* V01.00.07 2023-08-15 Ilja Frolov GS/BDD1 & Hui Yang BD/XSP4 & Pawel Bialecki CI/XAD2 & Yannick Sigwalt GS/BDD1 */ /* This view provides Fact ""ACDOCA_PNL"" S4 Balance Sheet Accounts for PnLSeries */ /* Data.CORE Outgoing Interface #0252 https://inside-docupedia.bosch.com/confluence/x/Zpw9jg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.07 - 2023-08-15 Modified filter for AWSYS LogicalSystem */ /* V01.00.06 - 2023-05-31 Modified filter for ""Documenttype"" */ /* V01.00.05 - 2023-05-26 Modified filter for ""GLAccount"" */ /* V01.00.04 - 2023-05-24 Modified filter for ""Documenttype"" */ /* V01.00.03 - 2023-05-16 Added filter for columns ""LogicalSystem"" and ""Documenttype"" */ /* V01.00.02 - 2023-04-24 Added column ""DocumentType"" */ /* V01.00.01 - 2023-01-13 Hui Yang: Added new attribute ""SourceTimeStamp"" and renamed ""TimeStamp"" to ""LoadTimeStamp"" */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G5;545645237;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G5 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_G7;545801402;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_G7 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_V2_G5_DemoSystem;549277412;V ;VIEW;7233;/**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_FBI_MDS_CSC2;30;INFormation Mart as Interface;V_INFI_MDS_MD_CostCenter;550501240;V ;VIEW;7265;/**/ /* View: V_INFI_MDS_MD_CostCenter */ /**/ /* =*/ /* V01.01.01 2020-10-12 Yannick Sigwalt GS/FBI2 */ /* This view provide the necessary CostCenter Master Data for FBI-MDS */ /* See details about this view:https://inside-docupedia.bosch.com/confluence/x/6cRNe */ /* Update: */ /* V01.01.02 - Enhance View with the required attributes for SGnA such as CompanyCodeShortText, Currency, Location etc. */ /* V01.01.01 - Enhance View with a filter on most actual record for CostCenter having several (!?) valid records Bug 42336 */ /* V01.01.00 - Changed view to use new Satellite for CostCenter Attribute */ /* V01.00.02 - Filtered out records with invalid values in [ValidFrom_Org] */ /* V01.00.01 - Added Status of CostCenter from Ref-MDS */ /* Restriction: */ /* - none */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G5;552037398;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G5 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costing_SSAS_CSC1;125;INFormation Mart as Interface;V_Account_V1_IDIM1;554849439;V ;VIEW;1788;/**/ /* View: V_Account_V1_IDIM1 */ /**/ /* -*/ /* V01.00.00 2023-05-24 Yannick Sigwalt GS/BDD1 */ /* This View represent the account Dimension for Costing */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0254 https://inside-docupedia.bosch.com/confluence/x/Ilyyjg */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G3;558885308;V ;VIEW;4423;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G3 */ /**/ /**/ /* V01.00.01 - 2022-04-12 Stephan Wund GS/BDD2 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.00.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.00.00 - 2021-11-09 - Initial version copied from */ /* V_Purchase Order Line Item For Maintenance Order_IDIM1_G0 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_BS_SL_V2;561137490;V ;VIEW;6684;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 22.08.2023 07:29:43 */ /**/ /**/ /* View: V_INTF_PNL_FACT_BS_SL_V2 */ /**/ /* =*/ /* V01.00.08 2023-08-21 Ilja Frolov GS/BDD1 & Hui Yang BD/XSP4 & Pawel Bialecki CI/XAD2 & Yannick Sigwalt GS/BDD1 */ /* This view provides Fact ""ACDOCA_PNL"" S4 Balance Sheet Accounts for PnLSeries */ /* Data.CORE Outgoing Interface #0252 https://inside-docupedia.bosch.com/confluence/x/Zpw9jg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.08 - 2023-08-21 Changed from one to one data copy to data vault */ /* V01.00.07 - 2023-08-15 Modified filter for AWSYS LogicalSystem */ /* V01.00.06 - 2023-05-31 Modified filter for ""Documenttype"" */ /* V01.00.05 - 2023-05-26 Modified filter for ""GLAccount"" */ /* V01.00.04 - 2023-05-24 Modified filter for ""Documenttype"" */ /* V01.00.03 - 2023-05-16 Added filter for columns ""LogicalSystem"" and ""Documenttype"" */ /* V01.00.02 - 2023-04-24 Added column ""DocumentType"" */ /* V01.00.01 - 2023-01-13 Hui Yang: Added new attribute ""SourceTimeStamp"" and renamed ""TimeStamp"" to ""LoadTimeStamp"" */ /* V01.00.00 - Initial version */ /* =*/"
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_LegalShare_V1_IDIM1;561697349;V ;VIEW;1531;/**/ /* View: V_LegalShare_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-07-04 Ilja Frolov GS/BDD2 */ /* This view provides the LegalShare Dimension for RnD analysis reporting. */ /* Data.CORE Outgoing Interface #0195 https://inside-docupedia.bosch.com/confluence/x/aPemfQ */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_O1;561801459;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_O1 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_B2;563025287;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_B2 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_A2;565277469;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CCKAM;566501297;V ;VIEW;8187;/**/ /* View: V_INTF_REF_CCKAM */ /**/ /* =*/ /* V01.00.02 2021-11-30 Urban Martin CI/XTD2 */ /* This view provide the list of C-C-KAM Id for IFRS15 */ /* Data.CORE Outgoing Interface #0162 https://inside-docupedia.bosch.com/confluence/x/LqfPcQ */ /* Update: */ /* V01.00.02 - Added Status and Edition Filter */ /* V01.00.01 - View enhanced by field ProductClassId */ /* V01.00.00 - Initial version */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G6;568037455;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G6 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costing_SSAS_CSC2;126;INFormation Mart as Interface;V_Costing_V1_IDIM1_G4;570849496;V ;VIEW;9513;/**/ /* View: V_Costing_V1_IDIM1_G4 */ /**/ /* -*/ /* V01.00.00 2023-05-24 Yannick Sigwalt GS/BDD1 */ /* This view represent the Dimension for Costing for Costing application */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0253 https://inside-docupedia.bosch.com/confluence/x/GFyyjg */ /* it consumes the following soft rules */ /* #FBI-SR-000000116 https://inside-docupedia.bosch.com/confluence/x/a2xUpQ - Flag Costing */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G4;574885365;V ;VIEW;4643;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G4 */ /**/ /**/ /* V01.02.01 - 2022-04-12 Stephan Wund GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.02.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.02.00 - 2021-04-06 - Included new End-Dating Satellite for PO Header to Vendor Relationship */ /* - V01.01.00 - 2021-03-17 - Join PurchaseOrderLine Item information via EKKN (instead of AFVC) */ /* - V01.00.01 - 2021-02-24 - BugFix: Distinct selection of records */ /* - V01.00.00 - 2021-02-04 - Initial version */ /**/
INFI_PnLService_TM1_CSC2;118;INFormation Mart as Interface;V_INTF_PnLService_FACT_ECPCA_D7;577085492;V ;VIEW;6808;"/**/ /* View: V_INTF_PnLService_FACT_ECPCA_D7 */ /**/ /**/ /* V01.00.00 2023-03-27 URA1FE */ /* Fact ""EC-PCA GLPCT"" from ETAS for TM1 */ /* Data.CORE Outgoing Interface #0249 https://inside-docupedia.bosch.com/confluence/x/R5UTj */ /* Restrictions */ /* - none */ /* Update: */ /* V01.00.00 Initial version */ /**/"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_PnL_SL_V2;577137547;V ;VIEW;12036;"/**/ /* View: V_INTF_PNL_FACT_PnL_SL_V2 */ /**/ /* =*/ /* V01.00.11 2023-08-21 Ilja Frolov GS/BDD1, Jakub Kozlowski & Yannick Sigwalt GS/BDD1 */ /* This view provides Fact ""ACDOCA_PNL"" S4 Profit & Loss Accounts for PnLSeries */ /* Data.CORE Outgoing Interface #0250 https://inside-docupedia.bosch.com/confluence/x/UqQTj */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.11 - 2023-08-21 Changed from one to one data copy to data vault */ /* V01.00.10 - 2023-07-20 Removed column ""CustomerBillTo"", added column ""CustomerSoldTo"" */ /* V01.00.09 - 2023-05-31 Modified filter for ""Documenttype"" */ /* V01.00.08 - 2023-05-26 Modified the caculation logic for columns ""AmountVarCompanyCodeCurrency"" and ""AmountVarTransactionCurrency"" */ /* V01.00.07 - 2023-05-24 Modified filter for ""Documenttype"" */ /* V01.00.06 - 2023-05-16 Added filter for columns ""LogicalSystem"" and ""Documenttype"" */ /* V01.00.05 - 2023-04-24 Added column ""DocumentType"" */ /* V01.00.04 - 2023-03-15 Changed to internal WBS Element */ /* V01.00.03 - 2023-01-13 Hui Yang: Added new attribute ""SourceTimeStamp"" and renamed ""TimeStamp"" to ""LoadTimeStamp"" */ /* V01.00.02 - Jakub Kozlowski: Added Round function to [AmountFixCompanyCodeCurrency] and [AmountFixTransactionCurrency] */ /* V01.00.01 - Added missing Filter */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G6;577645351;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G6 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P99 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActualCost_V2_IFCT0_O2;577801516;V ;VIEW;3409;/**/ /* View: V_ActualCost_V2_IFCT0_O2 */ /**/ /* =*/ /* V01.00.02 2023-04-24 Philipp Staiger GS/BDD1 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* Update: */ /* V01.00.02 - Replaced persisted fact table with [COCostActual_V2_MFCT0_<SourceSystem>] */ /* - Added column [TechnicalReverseFlag] */ /* V01.00.01 - Added new columns CostCenterCode & CostElementId */ /* V01.00.00 - Initial version */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_KSTAR_ATTR;578921234;V ;VIEW;11574;/**/ /* View: V_INTF_PNL_DIM_KSTAR_ATTR */ /**/ /* =*/ /* V01.00.01 2020-11-23 Patrik Just CI/DAV2.3 */ /* This view provides the attributes of CostElement for TM1 */ /* Restriction: */ /* Only CostElement hierarchy 'RB-E' is used */ /* Changes: */ /* V01.00.01 - Remove ElementId from Description column for Capation_xx */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D0;579025344;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_D0 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_CostCenter_ProfitCenter_History_CDP;580457392;V ;VIEW;1480;/**/ /* View: V_INTF_COOM_Costs_CostCenter_ProfitCenter_History_CDP */ /**/ /* =*/ /* V01.00.00 2022-03-31 Sanja Mihalic CI/XAD3 */ /* This view provides historized mapping from CostCenter to ProfitCenter */ /* Data.CORE Outgoing Interface #0213 https://inside-docupedia.bosch.com/confluence/x/QM9agw */ /* The following softrules are implemented in this view */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter_CDP;580509447;V ;VIEW;10895;"/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter_CDP */ /**/ /* =*/ /* V01.00.07 2022-08-26 Ismail Okadia */ /* This view provides the parent child hierarchy of CostCenter for CDP */ /* Interface #0127 https://inside-docupedia.bosch.com/confluence/x/kwgyZg */ /* The following softrules are implemented in this view */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.07 - Added SourceSystem column */ /* V01.00.06 - Harmonized by system view and this view and introduced call to function */ /* V01.00.05 - Change Hierarchy from ""Edition_FBI_MDS"" to ""Edition_GS_CTS"" */ /* V01.00.04 - Extended with SGnA Cost Center Hierarchies from FBI-MDS */ /* V01.00.03 - Corrected issues and optimized performance */ /* V01.00.02 - Remove RB-B and add new hierarchies */ /* V01.00.01 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_A3;581277526;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_A3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G7;584037512;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costing_SSAS_CSC1;125;INFormation Mart as Interface;V_MaterialPlant_V1_IDIM1_G4;586849553;V ;VIEW;5326;/**/ /* View: V_MaterialPlant_V1_IDIM1_G4 */ /**/ /* -*/ /* V01.00.00 2023-05-25 Yannick Sigwalt GS/BDD1 */ /* This view represent the Dimension for Material Plant for Costing application */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0257 https://inside-docupedia.bosch.com/confluence/x/cfvRjg */ /* it consumes the following soft rules */ /* Restriction: */ /* - only Material Type maintained in [RAWV_COPC_CSC2].[CostingMaterialTypeForSelection_WREFM_XX_L] are to be returned */ /* - Distinct is used because a unique selection cannot yet be achieved as only Material must be display related to a */ /* costing and a material Plant combination may have several Costing, also the costing selection is to be done through*/ /* a given time window */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G5;590885422;V ;VIEW;4643;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G5 */ /**/ /**/ /* V01.02.01 - 2022-04-12 Stephan Wund GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.02.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.02.00 - 2021-04-06 - Included new End-Dating Satellite for PO Header to Vendor Relationship */ /* - V01.01.00 - 2021-03-17 - Join PurchaseOrderLine Item information via EKKN (instead of AFVC) */ /* - V01.00.01 - 2021-02-24 - BugFix: Distinct selection of records */ /* - V01.00.00 - 2021-02-04 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_D3;592369525;V ;VIEW;2596;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 22.12.2022 13:35:40 */ /**/ /**/ /* View: V_FactActualCost_D3 */ /**/ /**/ /* V01.00.01 2022-12-22 Jakub Kozlowski */ /* Fact view for Costs booked on Cost Centers from PPT */ /* Changes: */ /* Restriction: */ /**/
INFI_PnLService_TM1_CSC2;118;INFormation Mart as Interface;V_INTF_PnLService_FACT_GLPCA_D7;593085549;V ;VIEW;5965;/**/ /* View: V_INTF_PnLService_FACT_GLPCA_D7 */ /**/ /**/ /* V01.00.00 2023-03-27 Tatjana Derdus BD/BTM-AC1 */ /* This view provides EC-PCA transaction data from D7/P42 source table GLPCA to application PnL Service */ /* Outgoing Interface #0248 https://inside-docupedia.bosch.com/confluence/x/VpITj */ /* Restrictions: */ /* Update: */ /* - V01.00.00 2023-03-27: Initial version */ /**/
INFI_xBI_Controlling_CSC2;117;INFormation Mart as Interface;V_CostActuals_V1_IFCT0_G0;593137604;V ;VIEW;13432;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 14.08.2023 13:37:17 */ /**/ /**/ /* View: V_CostActuals_V1_IFCT0_G0 */ /**/ /* =*/ /* V01.00.00 2023-08-09 Philipp Staiger GS/BDD1 */ /* xBI Controlling Purchase Order for POE */ /* Data.CORE Outgoing Interface #298 https://inside-docupedia.bosch.com/confluence/x/L338l */ /* Update: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G7;593645408;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_G7 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PCR */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_D7;593801573;V ;VIEW;9570;"/**/ /* View: V_INTF_PnL_D7 */ /**/ /* =*/ /* V01.00.03 2023-04-27 Tatjana Derdus BD/BTM-AC1 */ /* Interface view for transfer of monthly sales transactions data from ETAS to Optravis */ /* Data.CORE Outgoing Interface #0326 https://inside-docupedia.bosch.com/confluence/x/5yiznQ */ /* This view implements the following Soft Rules: */ /* - #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of Optravis), cf. #FBI-SR-000000066 */ /* Changes: */ /* - V01.00.03 - 2023-04-27 - Fixed bug in field order */ /* - V01.00.02 - 2023-02-21 - Fixed bug in case when condition related to [TotalNetSales]; */ /* - Adapted field order as per changed customer requirement */ /* - V01.00.01 - 2023-02-02 - Added filter to RecordType between 'B' and 'Z' */ /* - V01.00.00 - 2023-01-12 - Initial version */ /* =*/"
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D4;595025401;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_D4 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ActivityType_CDP;596457449;V ;VIEW;1869;/**/ /* View: V_INTF_COOM_Costs_DIM_ActivityType_CDP */ /**/ /* =*/ /* V01.00.02 2021-09-16 Ilja Frolov GS/BDD2 */ /* This view provides the Parent/Child Hierarchy for ActivityType for CDP */ /* Data.CORE Outgoing Interface #0155 https://inside-docupedia.bosch.com/confluence/x/_8K_ag */ /* Workitem: https://rb-msvs-alm.de.bosch.com/tfs/Col-FBI/FBI/_workitems/edit/78250 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Aligned to view INFI_Costs_TM1_CSC1.V_INTF_COOM_Costs_DIM_ActivityType */ /* V01.00.01 - Build up hierarchy from PT2 */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter_CDP_ATTR;596509504;V ;VIEW;43552;/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter_CDP_ATTR */ /**/ /* =*/ /* V01.00.05 2022-10-14 Ismail Okadia */ /* V01.00.04 2022-02-28 Hui Yang CI/XEF1 */ /* V01.00.03 2021-12-20 Michal Erdman CI/XTD2 */ /* V01.00.02 2021-11-15 Ilja Frolov GS/BDD2 */ /* V01.00.01 2021-08-31 Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view provides the attributes of CostCenter for CDP */ /* Data.CORE Outgoing Interface #0128 https://inside-docupedia.bosch.com/confluence/x/KwkyZg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Removed checking of statetimefrom : to include future cost center attributes */ /* V01.00.04 - Extended with SGnA attributes and other additional attributes */ /* V01.00.03 - Optimization */ /* V01.00.02 - Added Logical System */ /* V01.00.01 - Added FunctionalArea + Implement dynamical language */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_A4;597277583;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_A4 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G9;600037569;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_G9 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G5_DemoSystem;601417562;V ;VIEW;25985;/**/ /* View: V_CostActual_V1_IFCT0_G5 */ /**/ /* =*/ /* V01.00.03 2022-11-15 Ilja Frolov FRI3SH & Yannick Sigwalt */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - Added #FBI-SR-000000096 */ /* V01.00.02 - Added logic & documentation for #FBI-SR-000000099 */ /* V01.00.01 - Added documentation for #FBI-SR-000000095 */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costing_SSAS_CSC1;125;INFormation Mart as Interface;V_OverheadGroup_V1_IDIM1;602849610;V ;VIEW;1499;/**/ /* View: V_OverheadGroup_V1_IDIM1 */ /**/ /* -*/ /* V01.00.00 2023-05-24 Yannick Sigwalt GS/BDD1 */ /* This view represent the Dimension for Overhead Group for Costing application */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0284 https://inside-docupedia.bosch.com/confluence/x/iWFykw */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G6;606885479;V ;VIEW;4643;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_G6 */ /**/ /**/ /* V01.02.01 - 2022-04-12 Stephan Wund GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Limited to purchase orders linked to maintenance orders via SAP table EKKN */ /* Updates: */ /* - V01.02.01 - 2022-04-12 - Changed schema to join to link */ /* [RAWV_RB_CSC1].[PurchaseOrderLineItemToInternalOrder_WLNK0] */ /* - V01.02.00 - 2021-04-06 - Included new End-Dating Satellite for PO Header to Vendor Relationship */ /* - V01.01.00 - 2021-03-17 - Join PurchaseOrderLine Item information via EKKN (instead of AFVC) */ /* - V01.00.01 - 2021-02-24 - BugFix: Distinct selection of records */ /* - V01.00.00 - 2021-02-04 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;uspLoadBRGActualCostMaintenanceOrder_Initialize_SZA2SH;607445338;P ;SQL_STORED_PROCEDURE;24672;"CREATE Procedure [INFI_Costs_SSAS_CSC2].[uspLoadBRGActualCostMaintenanceOrder_Initialize_SZA2SH] ( @SourceSystem VARCHAR(10) , @SourceSystemVar varchar(10) ) AS BEGIN /* Declare variables , Set variables Example : @YearMonth = 201901 , 201902 Example : @SourceSystem = 'SAPP87' , 'SAPP81' Example : @SourceSystemVar = 'G5' , 'G4' */ DECLARE @Counter INT ; DECLARE @maxCounter INT ; DECLARE @minCounter INT ; DECLARE @RC int ; DECLARE @YearMonth int ; DECLARE @SourceOfData varchar(30) = 'COCostActual'; DECLARE @ConsumerOfData varchar(30) = 'PerFact_CostMaintenance' DECLARE @DateTimeStart DATETIME2(7); DECLARE @DateTimeEnd DATETIME2(7); DECLARE @RowsInserted INT; --Sample Test Select [YearMonthCreation] INTO #PartitionList FROM ( SELECT 201801 [YearMonthCreation] UNION SELECT 201802 [YearMonthCreation] UNION SELECT 201803 [YearMonthCreation] UNION SELECT 201804 [YearMonthCreation] UNION SELECT 201805 [YearMonthCreation] UNION SELECT 201806 [YearMonthCreation] UNION SELECT 201807 [YearMonthCreation] UNION SELECT 201808 [YearMonthCreation] UNION SELECT 201809 [YearMonthCreation] UNION SELECT 201810 [YearMonthCreation] UNION SELECT 201811 [YearMonthCreation] UNION SELECT 201812 [YearMonthCreation] UNION SELECT 201901 [YearMonthCreation] UNION SELECT 201902 [YearMonthCreation] UNION SELECT 201903 [YearMonthCreation] UNION SELECT 201904 [YearMonthCreation] UNION SELECT 201905 [YearMonthCreation] UNION SELECT 201906 [YearMonthCreation] UNION SELECT 201907 [YearMonthCreation] UNION SELECT 201908 [YearMonthCreation] UNION SELECT 201909 [YearMonthCreation] UNION SELECT 201910 [YearMonthCreation] UNION SELECT 201911 [YearMonthCreation] UNION SELECT 201912 [YearMonthCreation] UNION SELECT 202001 [YearMonthCreation] UNION SELECT 202002 [YearMonthCreation] UNION SELECT 202003 [YearMonthCreation] UNION SELECT 202004 [YearMonthCreation] UNION SELECT 202005 [YearMonthCreation] UNION SELECT 202006 [YearMonthCreation] UNION SELECT 202007 [YearMonthCreation] UNION SELECT 202008 [YearMonthCreation] UNION SELECT 202009 [YearMonthCreation] UNION SELECT 202010 [YearMonthCreation] UNION SELECT 202011 [YearMonthCreation] UNION SELECT 202012 [YearMonthCreation] UNION SELECT 202101 [YearMonthCreation] UNION SELECT 202102 [YearMonthCreation] ) T /* SELECT DISTINCT [YearMonthCreation] INTO #PartitionList FROM [MEAM_DataCORE_CSC1].[V_DeltaLoadSourceSystemByYearMonthCreation] Where [SourceSystem] = @SourceSystemVar AND [SourceOfData] = @SourceOfData AND [ConsumerOfData] = @ConsumerOfData ORDER BY [YearMonthCreation] ASC ; */ Select @Counter = COUNT(*) FROM #PartitionList; IF ( @Counter > 0 ) BEGIN SET @maxCounter = (SELECT COUNT(1) AS CountRows FROM #PartitionList) SET @minCounter = 1 WHILE (@minCounter <= @maxCounter) BEGIN SET @DateTimeStart = SYSUTCDATETIME() SET @YearMonth = (SELECT TOP(1) [YearMonthCreation] FROM #PartitionList) Declare @TruncateSQL NVARCHAR(500) = 'Truncate Table [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] ;' EXECUTE sp_executesql @TruncateSQL; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_0 NVARCHAR(1500) = '' DECLARE @SQL_1 NVARCHAR(1500) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(1500) = '' DECLARE @SQL_4 NVARCHAR(1500) = '' DECLARE @SQL_5 NVARCHAR(1500) = '' DECLARE @SQL_6 NVARCHAR(1500) = '' DECLARE @SQL_7 NVARCHAR(MAX) = '' /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Collect the required cost centers , maintenenace orders --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL_0 = ' Select mo2ccoll_wl.MaintenanceOrder_HK, mo2ccoll_wl.CostCollector_HK Into #orders FROM [RAWV_COOM_CSC1].[MaintenanceOrder_WHUB0] mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCollector_WLNK0] as mo2ccoll_wl ON ( mo2ccoll_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] ) INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_bo on ccoll_wh_bo.[CostCollector_HK] = mo2ccoll_wl.[CostCollector_HK] Where mo_wh.SAPSystem = ''' + @SourceSystem + ''' ; ALTER TABLE #orders ADD CONSTRAINT C_IX_MAINTENANCE_ORDERS_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED (CostCollector_HK,[MaintenanceOrder_HK]) ; ' SET @SQL_1 = ' Select cocad2bo_wl.COCostActualDocumentLineItem_HK, cocad2bo_wl.COCostActualDocumentHeader_HK, cocad2bo_wl.CostElementByControllingArea_HK, cocad2bo_wl.CostCollector_HK, ord.MaintenanceOrder_HK Into #link FROM #orders ord INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WLNK0] AS cocad2bo_wl ON cocad2bo_wl.CostCollector_HK = ord.CostCollector_HK INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WSATE_' + @SourceSystemVar + '_L] AS cocad2bo_wse_l ON ( cocad2bo_wl.COCostActualDocumentToBookedObject_HK = cocad2bo_wse_l.COCostActualDocumentToBookedObject_HK AND cocad2bo_wse_l.[LoadEndDate]= cast(''2999-12-31'' as datetime2) ) Where cocad2bo_wse_l.YearMonthCreation = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #link ADD CONSTRAINT C_IX_COCostActualDocumentToBookedObject_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK],[COCostActualDocumentHeader_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required Equipments,Responsible Cost Centers,basic settlement Cost Centers. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_2 = ' Create table #MaintenenaceOrders ( MaintenanceOrder_HK binary(20) NOT NULL, EquipmentDimId INT NOT NULL, ResponsibleCostCenterDimId INT NOT NULL, CostCenterforBasicSettlementDimId INT NOT NULL ); ALTER TABLE #MaintenenaceOrders ADD CONSTRAINT C_IX_MaintenenaceOrders_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([MaintenanceOrder_HK]) ; With cte as ( Select Distinct MaintenanceOrder_HK from #link ) INSERT INTO #MaintenenaceOrders ( MaintenanceOrder_HK,EquipmentDimId,ResponsibleCostCenterDimId,CostCenterforBasicSettlementDimId ) Select MaintenanceOrder_HK , COALESCE( [Equipment_HK] , 0 ) AS EquipmentDimId, COALESCE( [Responsible_HK] , 0 ) AS ResponsibleCostCenterDimId, COALESCE( [BasicSettlement_HK] , 0) AS CostCenterforBasicSettlementDimId From ( Select mo2io_wl.MaintenanceOrder_HK, COALESCE(edi_bs_x.[DimensionId], 0) As Ref_HK , OrderType=''Equipment_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToInternalOrder_WLNK0] as mo2io_wl INNER JOIN cte mo_wh on mo2io_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[InternalOrder_WHUB0] io_wh on io_wh.[InternalOrder_HK] = mo2io_wl.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WLNK0] io2e_wl on io2e_wl.[InternalOrder_HK] = io_wh.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WSATE_' + @SourceSystemVar + '_X] io2e_ws_x on io2e_ws_x.[InternalOrderToEquipment_HK] = io2e_wl.[InternalOrderToEquipment_HK] and io2e_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_Production_MD_CSC1].[Equipment_WHUB0] e_wh on e_wh.[Equipment_HK] = io2e_wl.[Equipment_HK] INNER JOIN [BUSV_Production_MD_CSC1].[Equipment_DimensionId_BSATC_XX_X] edi_bs_x on edi_bs_x.[Equipment_HK] = e_wh.[Equipment_HK] Union All Select mo2rccent_wl.MaintenanceOrder_HK, COALESCE(ccentdi_bs_x.DimensionID, 0) As Ref_HK, OrderType=''Responsible_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WLNK0] as mo2rccent_wl INNER JOIN cte mo_wh on mo2rccent_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WSATE_' + @SourceSystemVar + '_X] mo2rccent_ws_x on mo2rccent_ws_x.[MaintenanceOrderToResponsibleCostCenter_HK] = mo2rccent_wl.[MaintenanceOrderToResponsibleCostCenter_HK] and mo2rccent_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = mo2rccent_wl.[ResponsibleCostCenter_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x on ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] Union All Select mo2ccentbs_wl.MaintenanceOrder_HK, COALESCE(ccentdi_bs_x.DimensionID, 0) As Ref_HK , OrderType = ''BasicSettlement_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WLNK0] as mo2ccentbs_wl INNER JOIN cte mo_wh on mo2ccentbs_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WSATE_' + @SourceSystemVar + '_X] mo2ccentbs_ws_x on mo2ccentbs_ws_x.[MaintenanceOrderToCostCenterBasicSettlement_HK] = mo2ccentbs_wl.[MaintenanceOrderToCostCenterBasicSettlement_HK] and mo2ccentbs_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = mo2ccentbs_wl.[CostCenterBasicSettlement_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x on ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) AS S PIVOT ( MAX(Ref_HK) FOR [OrderType] IN ([Equipment_HK],[Responsible_HK],[BasicSettlement_HK]) ) AS PVT ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_3 = ' ;With cte as ( Select Distinct COCostActualDocumentHeader_HK from #link ) SELECT cocadh_ws0.[COCostActualDocumentHeader_HK] , cocadh_ws0.[PostingDate] , cocadh_ws0.[DocumentDate] , CAST( cocadh_ws0.[DateTimeDocumentWasCreated] AS DATE ) AS EntryDate , cocadh_ws0.[IsReversalBooking] , cocadh_ws0.[IsReversedBooking] , cocadh_ws0.[ControllingAreaCurrencyCode] , cocadhdi_bs_x.[DimensionId] AS [DocumentNumberDimId] INTO #TempHeaderItems FROM cte cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentHeader_WSAT0_' + @SourceSystemVar + '_L] cocadh_ws0 ON cocadh_ws0.COCostActualDocumentHeader_HK=cte.COCostActualDocumentHeader_HK INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentHeaderDimensionId_BSATC_XX_X] cocadhdi_bs_x ON cocadh_ws0.COCostActualDocumentHeader_HK = cocadhdi_bs_x.COCostActualDocumentHeader_HK WHERE cocadh_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadh_ws0.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_HEADERITEMS_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentHeader_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_4 = ' SELECT cocadli2po_wl.COCostActualDocumentLineItem_HK , ccoll_wh_po.CostCollectorObject_BK , COALESCE(cocodis.DimensionId,0) AS PartnerObjectDimId INTO #partnerAndBookedObject FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WLNK0] cocadli2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WSATE_' + @SourceSystemVar + '_L] cocadli2po_wse_l ON cocadli2po_wl.COCostActualDocumentLineItemToPartnerObject_HK = cocadli2po_wse_l.COCostActualDocumentLineItemToPartnerObject_HK AND cocadli2po_wse_l.[LoadEndDate] = cast(''2999-12-31'' as datetime2) Inner Join #link as hub on hub.COCostActualDocumentLineItem_HK = cocadli2po_wl.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.CostCollector_HK = cocadli2po_wl.CostCollector_HK INNER JOIN BUSV_RB_CSC1.CostCollectorDimensionId_BSATC_XX_X cocodis ON cocodis.CostCollector_HK = ccoll_wh_po.CostCollector_HK WHERE cocadli2po_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #partnerAndBookedObject ADD CONSTRAINT C_IX_PartnerObject_WLNK0_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]); ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Purchase order objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_5 = ' SELECT cocadli2po_wl.COCostActualDocumentLineItem_HK , COALESCE(cocodis.DimensionId,0) AS PurchaseOrderDimId INTO #purchaseOrderObject FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPurchaseOrder_WLNK0] cocadli2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPurchaseOrder_WSATE_' + @SourceSystemVar + '_L] cocadli2po_wse_l ON cocadli2po_wl.[COCostActualDocumentLineItemToPurchaseOrder_HK] = cocadli2po_wse_l.[COCostActualDocumentLineItemToPurchaseOrder_HK] AND cocadli2po_wse_l.[LoadEndDate] = cast(''2999-12-31'' as datetime2) --testing Inner Join #link as hub on hub.COCostActualDocumentLineItem_HK = cocadli2po_wl.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] ccoll_wh_po ON ccoll_wh_po.[PurchaseOrderHeader_HK] = cocadli2po_wl.[PurchaseOrderHeader_HK] INNER JOIN [BUSV_PUR_CSC2].[PurchaseOrderHeaderDimensionId_BSATC_XX_L] cocodis ON cocodis.[PurchaseOrderHeader_HK] = ccoll_wh_po.[PurchaseOrderHeader_HK] WHERE cocadli2po_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #purchaseOrderObject ADD CONSTRAINT C_IX_PurchaseOrder_WLNK0_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]); '; /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Material objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_6 = ' SELECT link.[COCostActualDocumentLineItem_HK] , COALESCE(bsat.[DimensionId],0) AS MaterialDimId INTO #material FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WLNK0] link INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WSATE_' + @SourceSystemVar + '_L] sat ON link.[COCostActualDocumentLineItemToMaterial_HK] = sat.[COCostActualDocumentLineItemToMaterial_HK] INNER JOIN #link as hub on hub.COCostActualDocumentLineItem_HK = link.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = link.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_XX_X] bsat ON bsat.[Material_HK] = m_wh.[Material_HK] WHERE sat.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND sat.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) ; ALTER TABLE #material ADD CONSTRAINT C_IX_Materials_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- INSERT result set into TEMP Fact-Table. This result set will then be SWITCHED into the target Fact-Table. Example... [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_G5_Temp] will be switched to [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_G5] --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_7 = CAST('' AS NVARCHAR(MAX)) + ' INSERT INTO [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] Select ' + CAST( @YearMonth as VARCHAR(6)) + ' AS YearMonthCreation ,iomodi_bs_x.[DimensionId] AS MaintenanceOrderDimId ,cocadh_ws0.DocumentNumberDimId AS COActualCostsDocumentNumberDimId ,cocadlidi_bs_x.[DimensionId] AS COActualCostsDocumentItemDimId ,cocadli_wh.[COCostActualDocumentHeader_BK] AS COActualCostsDocumentNumberId ,cocadli_wh.[COCostActualDocumentLineItem_BK] AS COActualCostsDocumentItemId , ''' + @SourceSystem + ''' AS SourceSystem ,coalesce(cebcadi_bsc_x.[DimensionID],0) AS CostElementbyControllingAreaDimId ,MO.ResponsibleCostCenterDimId ,MO.CostCenterforBasicSettlementDimId ,MO.EquipmentDimId ,COALESCE(Concat(cocadli_bs_l.[DebitCreditCode],''_'',cocadli_bs_l.[StatisticalIndicator],''_ACT_'', COALESCE(IIF(prt.[CostCollectorObject_BK] <> '' '', left(prt.[CostCollectorObject_BK],2), NULL),N''0'') ), N''0'' ) as JunkDimId ,CONCAT(cocadli_ws0.[FiscalYear],cocadli_ws0.[Period]) AS PostingPeriodYearId ,CAST(convert (char(8),cocadh_ws0.EntryDate,112) AS int) AS EntryDateId ,material.MaterialDimId ,prt.PartnerObjectDimId ,pur.PurchaseOrderDimId ,Coalesce(cocadli_ws0.[OffsettingAccountNumber],'''') AS OffsetAccount ,cocadh_ws0.EntryDate AS EntryDate ,cocadh_ws0.[DocumentDate] AS DocumentDate ,cocadh_ws0.[PostingDate] AS PostingDate ,cocadli_ws0.[COBusinessTransaction] AS COBusinessTransaction ,Coalesce(cocadh_ws0.[IsReversedBooking],'''') AS DocumentWasReversed ,Coalesce(cocadh_ws0.[IsReversalBooking],'''') AS DocumentisReversalDocument ,cocadli_ws0.[ControllingAreaTotalAmount] AS TotalAmountCOAreaCurrency ,cocadli_ws0.[ControllingAreaFixedAmount] AS FixedAmountCOAreaCurrency ,cocadh_ws0.[ControllingAreaCurrencyCode] AS COAreaCurrencyCode ,cocadli_ws0.[TransactionTotalAmount] AS TotalAmountTransactionCurrency ,cocadli_ws0.[TransactionCurrency] AS TransactionCurrencyCode ,cocadli_ws0.[ObjectTotalAmount] AS TotalAmountObjectCurrency ,cocadli_ws0.[ObjectCurrency] AS ObjectCurrencyCode --,cocadli_ws0.[TotalQuantity] AS TotalQuantity --,cocadli_ws0.[FixedQuantity] AS FixedQuantity --,Coalesce(cocadli_ws0.[UnitofMeasure],'''') AS UnitOfMeasure ,cocadli_ws0.[EnteredTotalQuantity] AS TotalQuantity ,cocadli_ws0.[EnteredFixedQuantity] AS FixedQuantity ,Coalesce(cocadli_ws0.[UnitOfEntry],'''') AS UnitOfMeasure FROM #link bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WHUB0] cocadli_wh ON cocadli_wh.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WSAT0_' + @SourceSystemVar + '_L] cocadli_ws0 ON cocadli_ws0.[COCostActualDocumentLineItem_HK] = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentLineItem_BSAT0_' + @SourceSystemVar + '_L] cocadli_bs_l ON cocadli_bs_l.[COCostActualDocumentLineItem_HK] = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentLineItemDimensionId_BSATC_XX_X] cocadlidi_bs_x on cocadlidi_bs_x.[COCostActualDocumentLineItem_HK] = cocadli_wh.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bsc_x on cebcadi_bsc_x.[CostElementByControllingArea_HK] = bo.[CostElementByControllingArea_HK] INNER JOIN #TempHeaderItems cocadh_ws0 ON bo.COCostActualDocumentHeader_HK = cocadh_ws0.COCostActualDocumentHeader_HK LEFT OUTER JOIN #MaintenenaceOrders MO ON MO.MaintenanceOrder_HK = bo.MaintenanceOrder_HK INNER JOIN [BUSV_COOM_CSC1].[MaintenanceOrderDimensionId_BSATC_XX_X] iomodi_bs_x on bo.[MaintenanceOrder_HK] = iomodi_bs_x.[MaintenanceOrder_HK] LEFT OUTER JOIN #partnerAndBookedObject prt on prt.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] LEFT OUTER JOIN #purchaseOrderObject pur on pur.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] LEFT OUTER JOIN #material material ON material.COCostActualDocumentLineItem_HK = bo.COCostActualDocumentLineItem_HK WHERE cocadli_wh.[SAPSystem] = ''' + @SourceSystem + ''' AND cocadli_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadli_ws0.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) AND cocadli_bs_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadli_bs_l.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2); ' SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = @SQL + @SQL_0 + @SQL_1 + @SQL_2 + @SQL_3 + @SQL_4 + @SQL_5 + @SQL_6 + @SQL_7 ; --Select @SQL_7 EXECUTE sp_executesql @SQL; SET @DateTimeEnd = SYSUTCDATETIME() DECLARE @PartitionNumber INT ; SELECT @PartitionNumber = partition_number, @RowsInserted = [rows] FROM sys.partitions as par WHERE ( par.object_id = OBJECT_ID('INFI_Costs_SSAS_CSC2.ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp') ) And ([rows] > 0 ); IF ( @PartitionNumber IS NOT NULL ) BEGIN SET @TruncateSQL = ' TRUNCATE TABLE [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '] WITH (PARTITIONS(' + Cast(@PartitionNumber as varchar(4)) + ')) ; ALTER TABLE [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] SWITCH PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' TO [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '] PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' ; ' EXECUTE sp_executesql @TruncateSQL; /* Call the procedure to inform the successful loading of the data for the selected partition*/ DECLARE @return_value int ; EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar, @SourceOfData = @SourceOfData, @ConsumerOfData = @ConsumerOfData, @YearMonthCreation = @YearMonth, @StartDateTime = @DateTimeStart, @EndDateTime = @DateTimeEnd, @RowsInserted = @RowsInserted; ; END SET @minCounter = @minCounter + 1 ; DELETE TOP(1) FROM #PartitionList ; END DROP TABLE #PartitionList ; END END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_D3;608369582;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-12-22 Jakub Kozlowski */ /* Fact view for Costs aggregated booked on Cost Centers from PPT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G9;609645465;V ;VIEW;1722;/**/ /* View: V_FactActualCost_Short_G9 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P74 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G0;611025458;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G0 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_B2;613277640;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_GK;616037626;V ;VIEW;11885;/**/ /* View: V_FactActualCost_Short_YTD_GK */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costing_SSAS_CSC1;125;INFormation Mart as Interface;V_Plant_V1_IDIM1;618849667;V ;VIEW;806148;/**/ /* View: V_Plant_V1_IDIM1 */ /**/ /* -*/ /* V01.00.00 2023-05-25 Yannick Sigwalt GS/BDD1 */ /* This View represent the Plant Dimension for Costing */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0255 https://inside-docupedia.bosch.com/confluence/x/KVyyjg */ /* Restriction: */ /* - none */ /* Update: */ /* =*/
INFI_CapEx_TM1_CSC2;67;INFormation Mart as Interface;V_INFI_CapEx_FACT_CostActuals_G7;624213474;V ;VIEW;12871;/**/ /* View: V_INFI_CapEx_FACT_CostActuals_G7 */ /**/ /* =*/ /* V01.00.05 2021-09-01 VST9BA */ /* This view provides actual cost fact data from SAPPCR for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Reformatting, Join changes to COOM, LanguageCode Filter to Reference */ /* V01.00.04 - Reformatting, Filter deletion/change, cost center join like coom */ /* V01.00.03 - Project Type filter change */ /* V01.00.02 - Minimal change in cost center filter */ /* V01.00.01 - Minimal change in join criteria, added end-dating-satellites */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_D3;624369639;V ;VIEW;10895;/**/ /* View: V_FactActualCost_Short_YTD_D3 */ /**/ /**/ /* V01.01.00 2022-12-22 Jakub Kozlowski */ /* Fact view for Costs aggregated booked on Cost Centers from PPT in a YTD logic */ /* Changes: */ /* - V01.01.00 Copied from D0 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_GK;625645522;V ;VIEW;1723;/**/ /* View: V_FactActualCost_Short_GK */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P77 */ /* Changes: */ /* Restriction: */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G1;627025515;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G1 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CompanyCode_CDP_ATTR;628457563;V ;VIEW;1606;/**/ /* View: V_INTF_COOM_Costs_DIM_CompanyCode_CDP_ATTR */ /**/ /* =*/ /* V01.00.01 2022-01-04 Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view provides the attributes of CompanyCode for CDP */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated view due to changed in underlaying Raw Vault Model */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_A2;628509618;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_A2 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_D0;629277697;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D0 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G0_DemoSystem;632037683;V ;VIEW;14089;/**/ /* View: V_FactActualCost_Short_YTD_G0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREDimensionLanguageCode;634589449;V ;VIEW;1494;/**/ /* View: V_DataCOREDimensionLanguageCode */ /**/ /* =*/ /* V01.00.00 2021-02-18 Yannick Sigwalt GS/BDO12 */ /* This view provide the list of Language in which a dimension is to be displayed */ /* Filter on Application, Element to receive the list of Language Code to be processed in the */ /* dimension */ /* Element = N'ALL' means that the Entry can be used for all the Dimension of an Application */ /* Restriction */ /* This view is only to be used in Dimension related to Hierachies */ /* Update: */ /* =*/
INFI_Costing_SSAS_CSC1;125;INFormation Mart as Interface;V_ProfitCenter_V1_IDIM1;634849724;V ;VIEW;14579;/**/ /* View: V_ProfitCenter_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2023-05-25 Yannick Sigwalt GS/BDD1 */ /* This view provides the Profit Center Dimension from Ref-MDS for Costing Application . */ /* Data.CORE Outgoing Interface #0256 https://inside-docupedia.bosch.com/confluence/x/NVyyjg */ /* This View consumes the following soft rules: */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg */ /* - #FBI-SR-000000098 https://inside-docupedia.bosch.com/confluence/x/eRDyjw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version based on [INFI_RnDAnalysis_SSAS_CSC1].[V_ProfitCenter_V1_IDIM1] */ /* as of V01.00.02 2023-05-08 */ /* =*/
INFI_CapEx_TM1_CSC2;67;INFormation Mart as Interface;V_INFI_CapEx_FACT_CostActuals_GK;640213531;V ;VIEW;12871;/**/ /* View: V_INFI_CapEx_FACT_CostActuals_GK */ /**/ /* =*/ /* V01.00.05 2021-09-01 VST9BA */ /* This view provides actual cost fact data from SAPP77 for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Reformatting, Join changes to COOM, LanguageCode Filter to Reference */ /* V01.00.04 - Reformatting, Filter deletion/change, cost center join like coom */ /* V01.00.03 - Project Type filter change */ /* V01.00.02 - Minimal change in cost center filter */ /* V01.00.01 - Minimal change in join criteria, added end-dating-satellites */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G0;641645579;V ;VIEW;3767;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G0 */ /*=*/ /**/ /* V01.00.01 - 2021-10-14 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPPOE */ /* Update: */ /* - V01.00.01: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G2;643025572;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G2 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_B2;644509675;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_B2 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_D3;645277754;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G4_DemoSystem;648037740;V ;VIEW;14089;/**/ /* View: V_FactActualCost_Short_YTD_G4_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costing_SSAS_CSC2;126;INFormation Mart as Interface;V_CostingCostComponents_V1_IFCT0_G4;650849781;V ;VIEW;18742;/**/ /* View: V_CostingCostComponents_V1_IFCT0_G4 */ /**/ /* -*/ /* V01.00.00 2023-05-24 Yannick Sigwalt GS/BDD1 */ /* This view represent the fact for Cost Component for Costing application */ /* it implements the following access Layer */ /* Data.CORE Outgoing Interface #0200 https://inside-docupedia.bosch.com/confluence/x/ZHeXfg */ /* Restriction: */ /* -none */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G3;657645636;V ;VIEW;3860;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G3 */ /*=*/ /**/ /* V01.00.03 - 2021-10-14 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP79 */ /* Update: */ /* - V01.00.01: 2021-10-14 Andras Szivos CI/BTM-AC1 New version to combine data from the two */ /* DataCore views V_MaintenanceOrder and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_MaterialValuation;657801801;V ;VIEW;6925;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 08.05.2023 12:59:50 */ /**/ /**/ /* View: V_INTF_DIM_MaterialValuation */ /**/ /* =*/ /* V01.00.00 2022-05-05 Tatjana Derdus */ /* This view provides the parent-child-hierarchy of Material Valuation related to PlantResult to TM1. */ /* It implements soft rule #FBI-SR-000000121: https://inside-docupedia.bosch.com/confluence/x/hhqCsQ */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2023-05-05 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G3;659025629;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G3 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_B4;660509732;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_B4 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_D4;661277811;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D4 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_G5_DemoSystem;664037797;V ;VIEW;14089;/**/ /* View: V_FactActualCost_Short_YTD_G5_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_MD_CompanyCode_M2;666849838;V ;VIEW;5990;/**/ /* View: V_INTF_MD_CompanyCode_M2 */ /**/ /* */ /* V01.01.09 2023-05-15 Tina Fritz (GS/PBI-GE) */ /* Interface view to provide end-of-previous-month company code master data to GS Accounting */ /* Data.CORE Outgoing Interface #0158 https://inside-docupedia.bosch.com/confluence/x/3J02cQ */ /* Update */ /* - V01.01.09: Rename columns (2023-05-15, frt3ka) */ /* - V01.01.08: Rename columns (2023-05-05, frt3ka) */ /* - V01.01.07: Update validity rule (2023-04-25, frt3ka) */ /* - V01.01.06: Add additional column for Status Usage (2023-04-21, frt3ka) */ /* - V01.01.05: Update ufn_SR_CompanyCodeDivisionCleansing function call (2023-04-03, frt3ka) */ /* - V01.01.04: Add additional column for Organizational Area (2023-03-31, frt3ka) */ /* - V01.01.03: Changed source from 107 to 164 ref mds */ /* - V01.01.02: Add additional information about Legal Entity (2022-04-21, frt3ka) */ /* - V01.01.01: Remove restriction to provide company codes with arbitrary status (2022-03-21, frt3ka) */ /* - V01.01.00: Added columns CompanyCodeShortText, CompanyCodeStatus (2022-01-24, frt3ka) */ /* - V01.00.00: Copied from [INFI_Optravis_CSC1].[V_INTF_MD_CompanyCode_M2] as of 2020-02-10 */ /* Restrictions: */ /* - only includes company code description in English language */ /* */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GLAccountR3_ATTR;669557769;V ;VIEW;1926;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 22.11.2022 09:22:24 */ /**/ /**/ /* View: V_INTF_PNL_DIM_GLAccountR3_ATTR */ /**/ /* = */ /* V01.00.00 2022-11-22 Tatjana Derdus (CI/BTM-AC1) */ /* Attributes for GL Account from SAP ERP system POE (source table: SKAT) */ /* Data.CORE Outgoing Interface #0289 https://inside-docupedia.bosch.com/confluence/x/V3nAkw */ /* Restrictions: */ /* - IBM PA Interface Description https://inside-docupedia.bosch.com/confluence/x/wS--Ug */ /* Update: */ /* - V01.00.00 2022-11-22 - Initial creation */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G4;673645693;V ;VIEW;3769;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G4 */ /*=*/ /**/ /* V01.00.01 - 2021-10-14 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP81 */ /* Update: */ /* - V01.00.01: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_PlantResult_TM1_CSC1;111;INFormation Mart as Interface;V_INTF_DIM_MaterialValuation_ATTR;673801858;V ;VIEW;12989;/**/ /* View: V_INTF_DIM_MaterialValuation_ATTR */ /**/ /* =*/ /* V01.00.00 2022-05-05 Tatjana Derdus */ /* This view provides the attributes of Material Valuation related to PlantResult to TM1. */ /* It implements soft rule #FBI-SR-000000121: https://inside-docupedia.bosch.com/confluence/x/hhqCsQ */ /* Restriction: */ /* Changes: */ /* - V01.00.00 - 2023-05-05 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G4;675025686;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;14334;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Update: */ /* */ /**/ /**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G4 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_D0;676509789;V ;VIEW;12416;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_D0 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_D7;677277868;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D7 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_G4_DemoSystem;683357699;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9807;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V2_IFCT0_G4_DemoSystem] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [FBI_CORE_CORE_P].[RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [FBI_CORE_CORE_P].[RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], /*'_', pvh.[Version_ID_BK],*/'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK --inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch -- on ccccl.CostCenter_HK = cch.CostCenter_HK INNER JOIN ( SELECT [CostCenter_HK] FROM [RAWV_RB_CSC1].[CostCenter_WHUB0] WHERE [CostCenterID_BK] IN ( '0000014016', '0000015965', '0000060823', '0000060958', '0000515600', '0000515830', '0000816702' ) ) cch ON cch.CostCenter_HK = ccccl.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanDataTableIsReadyForInput;688213702;V ;VIEW;1523;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 20.08.2021 16:53:59 */ /**/ /**/ /* View: V_INTF_COPlanDataTableIsReadyForInput */ /**/ /* =*/ /* V01.00.00 2021-08-20 Yannick Sigwalt GS/BDO2 */ /* This view provide CORE.Writer the information if it may enter data into the target table or not */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G4_DemoSystem;689645750;V ;VIEW;5420;/**/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G4_DemoSystem */ /**/ /* =*/ /* V01.00.05 - 2022-02-22 - Andras Szivos CI/BTM-AC1 */ /* Dimension view for MaintenanceOrder data, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by specific plant . */ /* Update: */ /* - V01.00.05 -Enhancement of view with a function to anonymize data entries with better anonymization functnion */ /* - V01.00.02 -Enhancement of view with a function to anonymize data entries of Ajp */ /* - V01.00.01 - Initial Version - View is based on [INFI_Costs_SSAS_CSC2].[V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G4] */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G5;691025743;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G5 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter_bySystem_CDP;692457791;V ;VIEW;12454;/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter_bySystem_CDP */ /**/ /* =*/ /* V01.00.02 2022-04-15 Sanja Mihalic CI/XAD3 & Hui Yang CI/XEF1 */ /* This view provides the parent child hierarchy of CostCenter for CDP by SAP System */ /* Copy of a view V_INTF_COOM_Costs_DIM_CostCenter_CDP as of V01.00.04 2022-02-28 */ /* The following softrules are implemented in this view */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Adding B2 and G2 hierarchies */ /* V01.00.01 - Removed Responsible Org. Office */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_D3;692509846;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_D3 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G0;693277925;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_G3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_G5_DemoSystem;699357756;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9807;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V2_IFCT0_G5_DemoSystem] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [FBI_CORE_CORE_P].[RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [FBI_CORE_CORE_P].[RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], /*'_', pvh.[Version_ID_BK],*/'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK --inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch -- on ccccl.CostCenter_HK = cch.CostCenter_HK INNER JOIN ( SELECT [CostCenter_HK] FROM [RAWV_RB_CSC1].[CostCenter_WHUB0] WHERE [CostCenterID_BK] IN ( '0000014016', '0000015965', '0000060823', '0000060958', '0000515600', '0000515830', '0000816702' ) ) cch ON cch.CostCenter_HK = ccccl.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanValidationCostCenter;704213759;V ;VIEW;2462;/**/ /* View: V_INTF_COPlanValidationCostCenter */ /**/ /* =*/ /* V01.00.00 2021-08-20 Yannick Sigwalt GS/BDD2 */ /* This view provide the valid values for CostCenter for CO Plant CORE.Writer */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G5;705645807;V ;VIEW;3771;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G5 */ /*=*/ /**/ /* V01.00.01 - 2021-10-14 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP87 */ /* Update: */ /* - V01.00.01: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G6;707025800;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G6 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_D4;708509903;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_D4 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G1;709277982;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_G1 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Product_ATTR;712389607;V ;VIEW;2070;/**/ /* View: V_INTF_PNL_DIM_Product_ATTR */ /**/
INFI_Overall_TM1_CSC1;59;INFormation Mart as Interface;V_INTF_TM1_DIM_Currency;719393682;V ;VIEW;1607;"/**/ /* View: V_INTF_TM1_DIM_Currency */ /**/ /* = */ /* V 01.00.00 Yannick Sigwalt */ /* This view provide a ""pseudo"" currency hierarchy for TM1 */ /* Filter on Currency set according to TFS-Task-10445 */ /* Copied from V_INTF_PNL_DIM_Currency as of V01.04.00 */ /* = */"
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanValidationCostElement;720213816;V ;VIEW;1042;/**/ /* View: V_INTF_COPlanValidationCostElement */ /**/ /* =*/ /* V01.00.00 2021-08-20 Yannick Sigwalt GS/BDD2 */ /* This view provide the valid values for CostElement for CO Plant CORE.Writer */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_CustomerOrderHierachy_V1;721138060;V ;VIEW;11134;"/**/ /* View: V_INTF_PNL_GM1_CustomerOrderHierachy_V1 */ /**/ /* */ /* V01.00.00b 2023-08-09 Ilja Frolov GS/BDD2 & Martin Urban CI/XAD2 */ /* This view merges RB Customer External and RB Customer Internal Hierarchy together */ /* If one level in the hierarchy is empty the next available parent is used. */ /* The parameter for the ""Edition"" to be set within MDS and populated to [DataCOREGenericParameter_WREFM] */ /* Data.CORE Outgoing Interface #0168 https://inside-docupedia.bosch.com/confluence/x/Ult8cg */ /* Changes: */ /* - V01.00.00b 2023-08-29 - HOTFIX - Manually restored view V01.00.00 on [P] as per customer request */ /* - V01.00.00 2022-02-07 - Created View - Initial version */ /* */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G6;721645864;V ;VIEW;3773;/*=*/ /* View: V_MaintenanceOrderWithMalfunctionNotification_V3_IDIM1_G6 */ /*=*/ /**/ /* V01.00.01 - 2021-10-14 Andras Szivos CI/BTM-AC1 */ /* New view Dimension Maintenance based on optimized data model for SAPP99 */ /* Update: */ /* - V01.00.01: New version to combine data from the two DataCore views V_MaintenanceOrder */ /* and V_MalfunctionNotification to improvev performance in SSAS cube */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G7;723025857;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13723;/**/ /* V01.00.00 2021-12-06 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Copy of Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V3_IFCT0_G7 ( @YearCreation int,@Prioritization bit ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G7_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G7_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pc.[SAPVersion],'_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement_CDP_ATTR;724457905;V ;VIEW;9335;/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement_CDP_ATTR */ /**/ /* =*/ /* V00.00.02 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view provides the attributes of CostElement for TM1 */ /* Restriction: */ /* Currently, only CostElement hierarchy 'RB-E' is used */ /* Changes: */ /* V00.00.02 - Replace hierarchy list by control table [RefCDPHierarchyApplicationControl_WREF0] */ /* V00.00.01 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_D7;724509960;V ;VIEW;10852;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_D7 */ /**/ /* */ /* V01.02.01 2022-08-09 Yannick Sigwalt GS/BDD1 & Jakub Kozlowski & Erdman Michal */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ */ /* Update: */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Copied the script from P, where the view was reworked to optimize the */ /* Execution Plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G2;725278039;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Overall_TM1_CSC1;59;INFormation Mart as Interface;V_INTF_TM1_DIM_Currency_ATTR;735393739;V ;VIEW;1121;/**/ /* View: V_INTF_TM1_DIM_Currency_ATTR */ /**/ /* =*/ /* V 01.00.00 2020-07-20 Yannick Sigwalt GS/BDO12 */ /* This view provide the description of Currency Codes to TM1 */ /* =*/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_B2;735706069;V ;VIEW;3929;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_B2 */ /**/ /* =*/ /* V01.00.01 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 & Sanja Mihalic CI/XAD3 */ /* This view provides actual cost fact data from SAPPS0 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Copy of a view V_INTF_COOM_Costs_FACT_CostActual_V2_G0 as of V01.00.01 2021-11-29 */ /* Changes: */ /* V01.00.01 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_B2] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_B2] */ /* V01.00.00 - Initial version */ /* =*/
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanValidationDebitCredit;736213873;V ;VIEW;1069;/**/ /* View: V_INTF_COPlanValidationDebitCredit */ /**/ /* =*/ /* V01.00.00 2021-08-20 Yannick Sigwalt GS/BDD2 */ /* This view provide the valid values for Debit Credit for CO Plant CORE.Writer */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ProdHierarchy_V1_IDIM1;737802086;V ;VIEW;9388;/****** Object: View [INFI_RnDAnalysis_SSAS_CSC1].[V_ProdHierarchy_V1_IDIM1] Script Date: 23.06.2023 13:53:16 ******/ /**/ /* View: V_ProdHierarchy_V1_IDIM1 */ /**/ /* =*/ /* V01.00.05b 2023-05-08 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 & Hui Yang CI/XEF1 */ /* This view provides the Product Hierarchy Dimension from Ref-MDS for RnD analysis reporting. */ /* Data.CORE Outgoing Interface #0194 https://inside-docupedia.bosch.com/confluence/x/zvamfQ */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05b - hotfix differnet int_id leads to double entry for ProfitCenter 'P00803' */ /* V01.00.05 - update Dummy */ /* V01.00.04 - Added ProfitCenter attribute */ /* V01.00.03 - Added Dummy value */ /* V01.00.02 - Corrected Field name */ /* V01.00.01 - Changed join Condition */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_B2;739025914;V ;VIEW;9155;"/**/ /* View: V_INTF_MD_Material_B2 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement_CDP_Flat;740457962;V ;VIEW;2137;/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement_CDP_Flat */ /**/ /* =*/ /* V01.00.00 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view provides the parent child hierarchy of CostElement for TM1 */ /* Restriction: */ /* Currently, only CostElement hierarchies 'RB-E' & 'RB-E-LOG' are used */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G0;740510017;V ;VIEW;12412;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G0 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G3;741278096;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_G3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Overall_TM1_CSC1;59;INFormation Mart as Interface;V_INTF_TM1_REF_ExchangeRatesToEuro;751393796;V ;VIEW;1997;/**/ /* View: V_INTF_TM1_REF_ExchangeRatesToEuro */ /**/ /* = */ /* V 01.00.00 2020-07-20 Yannick Sigwalt GS/BDO12 */ /* This view delivers the exchange rates from X to EURO to TM1 */ /* = */
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_D0;751706126;V ;VIEW;3947;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_D0 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPPTT for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_D0] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D0] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ProfitCenter_V1_IDIM1;753802143;V ;VIEW;14698;/**/ /* View: V_ProfitCenter_V1_IDIM1 */ /**/ /* =*/ /* V01.00.02 2023-05-08 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 &Hui Yang CI/XEF1 */ /* This view provides the Profit Center Dimension from Ref-MDS for RnD analysis reporting. */ /* Data.CORE Outgoing Interface #0196 https://inside-docupedia.bosch.com/confluence/x/JPimfQ */ /* This View consumes the following soft rules: */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg */ /* - #FBI-SR-000000098 https://inside-docupedia.bosch.com/confluence/x/eRDyjw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Changed identification of As-Is BusinessUnit and BusinessDivision and Description */ /* V01.00.01 - Added softrule 000000095 */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement_bySystem_CDP;756458019;V ;VIEW;11158;/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement_bySystem_CDP */ /**/ /* =*/ /* V00.00.02 2022-04-15 Sanja Mihalic CI/XAD3 */ /* This view provides the parent child hierarchy of CostElement for CDP */ /* Copy of the view V_INTF_COOM_Costs_DIM_CostElement_CDP as of V00.00.00 2021-04-28 */ /* Restriction: */ /* Currently, only CostElement hierarchies 'RB-E' & 'RB-E-LOG' are used */ /* Changes: */ /* V01.00.02 - Adding B2 and G2 hierarchies */ /* V00.00.01 - Changed hierarchy to CostElementHier */ /* V00.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G1;756510074;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G1 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G4;757278153;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_D4;767706183;V ;VIEW;3929;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_D4 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 */ /* This view provides actual cost fact data from SAPPC4 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_D4] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D4] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanValidationYear;768213987;V ;VIEW;925;/**/ /* View: V_INTF_COPlanValidationYear */ /**/ /* =*/ /* V01.00.00 2021-08-20 Yannick Sigwalt GS/BDD2 */ /* This view provide the valid values for Year for CO Plant CORE.Writer */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_COREWriter_COPlan_CSC1;80;INFormation Mart as Interface;V_INTF_COPlanValidationScenario;768982066;V ;VIEW;1830;"/**/ /* View: V_INTF_COPlanValidationScenario */ /**/ /* =*/ /* V01.00.03 2022-04-25 Michal Erdman & Sanja Mihalic CI/HAD3 & Hui Yang CI/XEF1 */ /* This view provide the valid values for Scenario for CO Plant CORE.Writer */ /* Data.CORE Outgoing Interface #0217: */ /* https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=2239958135 */ /* Restriction: */ /* - */ /* Changes: */ /* V01.00.03 Added connection to RAWV_Global_MD_CSC1.COREWriterValidationScenario_WSAT0_MF_X */ /* V01.00.02 Added connection to HUB, only existing Scenarios from list will be validated (Scenarios entered in MDS)*/ /* V01.00.01 Added new Scenarios; deleted old Scenarios */ /* V01.00.00 Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G0;769698090;V ;VIEW;3552;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G0 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G1;771026028;V ;VIEW;9248;"/**/ /* View: V_INTF_MD_Material_G1 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP;772458076;V ;VIEW;1973;/**/ /* View: V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP */ /**/ /* =*/ /* V01.00.01 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view provides the parent child hierarchy of Organization Office for CDP */ /* Restriction: */ /* - only the actual Parent/child hierarchy is provided */ /* Changes: */ /* V01.00.01 : Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G2;772510131;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G2 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G5;773278210;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_D7;783706240;V ;VIEW;4010;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_D7 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Stephan Wund GS/BDO12 */ /* This view provides actual cost fact data from SAPP42 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_D7] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D7] */ /* V01.00.01 - Set [ControllingAreaCurrency] to constant 'EUR' (Workaround until */ /* implementation of PT2ConformCOArea done) */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostCenter_V5_IDIM1_Costs_DemoSystem;784982123;V ;VIEW;9250;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 13.05.2022 16:57:33 */ /**/ /**/ /* View: V_CostCenter_V5_IDIM1_Costs_DemoSystem */ /**/ /**/ /* V01.00.07 2022-05-10 Szivos Andras CI/BTM-AC1 */ /* Dimension view for Costs Center master data, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.07 Reformulating the view after in the ""normal"" view fields were removed and added */ /* - V01.00.06 - Bug fix as some fields were missing and some datafields the data type was corrected */ /* and included some new filters in the Hierachy ""Responsible Org. Office"" */ /* - V01.00.05 - Initial Version - View copied from V01.00.01 V_Cost Center_V4_IDIM1_DemoSystem */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G3;785698147;V ;VIEW;3551;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G3 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on on Cost Centers from P79 */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G2;787026085;V ;VIEW;9249;"/**/ /* View: V_INTF_MD_Material_G2 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G3;788510188;V ;VIEW;12417;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G3 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G6;789278267;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_Dummy;794590019;V ;VIEW;1700;/**/ /* View: V_PurchaseOrderLineItemForMaintenanceOrder_IDIM1_Dummy */ /**/ /**/ /* V01.00.01 - 2021-02-24 Tatjana Derdus CI/DAV2.3 */ /* Purchase order line item dimension created for the use case of reporting on maintenance actual costs */ /* Restrictions: */ /* - Only contains dummy record */ /* Updates: */ /* - V01.00.01 - 2021-02-24 - BugFix: DimId dummy value 0 instead of NULL */ /* - V01.00.00 - 2021-02-02 - Initial version */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_WBSElementMCRAttribute001;794850294;P ;SQL_STORED_PROCEDURE;16964;"/* =*/ /* V01.00.00 2023-05-10 Yannick Sigwalt GS/BDD1 */ /* This procedure implements Test Case 1 for RnD Analysis, */ /* Test Case checks if for a relevant WBS Element MCR attribute are available or not */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case execution*/ /* Consumed Soft Rules */ /* Restriction: */ /* Update: */ /* =*/ create procedure MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_WBSElementMCRAttribute001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem nvarchar(15) = N'SAPP87' --DECLARE @SourceSystemVar nvarchar(5) = N'G5' --DECLARE @Usecase nvarchar(50) = N'AL2_MERM_RnDTesting_PDM' --DECLARE @TestCase nvarchar(50) = N'RnDTest_WBSElementMCRAttribute001' --DECLARE @TargetDataBase nvarchar(100) ='FBI_CORE_CORE_D' --DECLARE @TargetSchema nvarchar(256) = '' --DECLARE @TargetTable nvarchar(256) = '' --DECLARE @DeltaTimestampFrom datetime2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo datetime2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 789 --DECLARE @EntityId bigint = 123 --DECLARE @AuditTrailId bigint = -2 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnD_TC1_WBSElementwoMCRData]'; DECLARE @TestedElement NVARCHAR(100) = N'WBSElement'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(MAX) = '' DECLARE @SQL_4 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #WBSElementList; CREATE TABLE #WBSElementList ( [SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS NOT NULL ,[WBSElement_BK] int NOT NULL ,[WBSElement] nvarchar(24) COLLATE Latin1_General_CS_AS ,[RowId] int identity(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); SET @SQL_1 = ( select CONCAT(' with cte_distinctWBSElement_HK as ( /* Cost Plan Primary Data */ SELECT distinct wbse_wh.[WBSElement_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[WBSElement] FROM [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl with (nolock) inner join [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_', @SourceSystemVar, '_X] pcp_ws with (nolock) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in (N''01'',N''02'',N''10'') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh with (nolock) on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> ''000'' inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl with (nolock) on ccoll2wbse_wl.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh with (nolock) on wbse_wh.[SAPSystem] = N''',@SourceSystem ,''' and wbse_wh.[WBSElement_HK] = ccoll2wbse_wl.[WBSElement_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_', @SourceSystemVar, '_X] wbsea_ws with (nolock) on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and wbsea_ws.[FunctionalArea] = N''0500'' ')); SET @SQL_2 = ( select CONCAT('UNION ALL /* Cost Plan Secondary Data */ SELECT distinct wbse_wh.[WBSElement_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[WBSElement] FROM [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl with (nolock) inner join [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_', @SourceSystemVar, '_X] pcs_ws with (nolock) on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in (N''01'',N''02'',N''10'') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh with (nolock) on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> N''000'' inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner with (nolock) on ccoll_wh_partner.[SourceSystem_BK] = N''',@SourceSystem ,''' and ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl with (nolock) on ccoll2wbse_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh with (nolock) on wbse_wh.[SAPSystem] = N''',@SourceSystem ,''' and wbse_wh.[WBSElement_HK] = ccoll2wbse_wl.[WBSElement_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_', @SourceSystemVar, '_X] wbsea_ws with (nolock) on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and wbsea_ws.[FunctionalArea] = N''0500''')); SET @SQL_3 = ( select CONCAT(' UNION ALL /* Cost Actual Data */ select distinct wbse_wh.[WBSElement_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[WBSElement] from [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_', @SourceSystemVar, '] coca2bo_wl with (nolock) inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[SourceSystem_BK] = N''',@SourceSystem ,''' and ccoll_wh.[CostCollector_HK] = coca2bo_wl.[CostCollector_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl with (nolock) on ccoll2wbse_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh with (nolock) on wbse_wh.[SAPSystem] = N''',@SourceSystem ,''' and wbse_wh.[WBSElement_HK] = ccoll2wbse_wl.[WBSElement_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_', @SourceSystemVar, '_X] wbsea_ws with (nolock) on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and wbsea_ws.[FunctionalArea] = N''0500'' )' )); SET @SQL_4 = ( select CONCAT(' INSERT INTO #WBSElementList ( [SAPSystem] ,[WBSElement_BK] ,[WBSElement] ) Select distinct wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,wbsebv_wh.[WBSElement_BK] AS [WBSElement] from cte_distinctWBSElement_HK wbse_wh with (nolock) inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbssapi2biv_wl with (nolock) on wbssapi2biv_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_', @SourceSystemVar, '_X] wbssapi2biv_ws with (nolock) on wbssapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbssapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbssapi2biv_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh with (nolock) on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = wbssapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementBusinessViewMCRProjectInformation_WSAT0_P2_X] wbsebvmcrpi_ws with (nolock) on wbsebvmcrpi_ws.[WBSElementBusinessView_WHUB0_HK] = wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] and wbsebvmcrpi_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' where wbsebvmcrpi_ws.[InternalMCRWBSElementId] is null ')) ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1,@SQL_2,@SQL_3,@SQL_4)); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (Select @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'S' --Success ,0 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,[WBSElement_BK] ,N'W' --Warning ,10 ,CONCAT(N'PR',right(CONCAT(N'00000000',cast([WBSElement_BK]as nvarchar(8))),8)) as [MessagePart1] ,[WBSElement] as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #WBSElementList END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'E' --Success ,999 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage DROP TABLE IF EXISTS #WBSElementList; RETURN @ReturnProcessStatusNumber END"
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G0;799706297;V ;VIEW;3923;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G0 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPPOE for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G0] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G0] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREDimensionFiscalYear;800878070;V ;VIEW;1700;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 18.05.2021 15:29:50 */ /**/ /**/ /* View: V_DataCOREDimensionFiscalYear */ /**/ /* =*/ /* V01.00.00 2021-05-18 Yannick Sigwalt GS/BDO12 */ /* This view provide the generic Parameter for Fiscal year which a dimension can display */ /* Filter on Application, Element to receive the list of Language Code to be processed in the */ /* dimension */ /* This view is only to be used in Dimension related to Hierachies */ /* Update: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostCenter_V5_IDIM1_Maintenance_DemoSystem;800982180;V ;VIEW;9241;"/**/ /* View: V_CostCenter_V5_IDIM1_Maintenance_DemoSystem */ /**/ /* =*/ /* V01.00.07 - 2022-05-10 - Andras Szivos CI/BTM-AC1 */ /* Dimension view for Cost Center data, but anonimized for DemoSystem purposes for Maintenance Application */ /* Restriction: View for demo purposes only, restricted by specific plant only for Maintenance Application */ /* Update: */ /* - V01.00.07 Reformulating the view after in the ""normal"" view fields were removed and added */ /* - V01.00.05 -Enhancement of view with a function to anonymize data entries with better anonymization functnion */ /* - V01.00.02 -Enhancement of view with a function to anonymize data entries of Ajp */ /* - V01.00.01 - Initial Version - View is based on [INFI_Costs_SSAS_CSC2].[V_CostCenter_V4_IDIM1] */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4;801698204;V ;VIEW;3552;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from P81 */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G3;803026142;V ;VIEW;9247;"/**/ /* View: V_INTF_MD_Material_G3 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_Plant_CDP;804458190;V ;VIEW;1410;/**/ /* View: V_INTF_COOM_Costs_DIM_Plant_CDP */ /**/ /* =*/ /* V01.00.00 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view provides the parent child hierarchy of Plant for CDP */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G4;804510245;V ;VIEW;12414;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G4 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G7;805278324;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G0;807062011;V ;VIEW;3271;/**/ /* View: V_FunctionalLocation_IDIM1_G0 */ /**/ /*=*/ /* V01.00.00 - 2020-09-07 Tatjana Derdus CI/DAV2.3 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-09-07 - Initial version */ /*=*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G5_DemoSystem_Backup_20230224;813558282;V ;VIEW;2982;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 18.11.2022 09:43:09 */ /**/ /**/ /* View: V_CostActual_V1_IFCT0_G5_DemoSystem */ /**/ /*-*-*-*-**/ /* V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 */ /* Fact view for Research & Development Actual Costs booked on Projects from P87 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 Original version created */ /**-*-*-*-*/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G1;815706354;V ;VIEW;3925;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G1 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP45 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G1] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G1] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4_DemoSystem;817698261;V ;VIEW;5317;/**/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4_DemoSystem */ /**/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance booked on Cost Centers Order from P81 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G4;819026199;V ;VIEW;9247;"/**/ /* View: V_INTF_MD_Material_G4 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREDimensionExchangeRateType;819690168;V ;VIEW;1782;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 18.08.2021 16:34:48 */ /**/ /**/ /* View: V_DataCOREDimensionExchangeRateType */ /**/ /* =*/ /* V01.00.00 2021-08-18 Yannick Sigwalt GS/BDD2 */ /* This view provide the list of Exchange Rate Types to be displayed */ /* Filter on Application, Element to receive the list of Exchange Rate to be processed in the */ /* dimension */ /* Element = N'ALL' means that the Entry can be used for all the Dimension of an Application */ /* Restriction */ /* This view is only to be used in Dimension related to Hierachies */ /* Update: */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G5;820510302;V ;VIEW;12415;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G5 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G9;821278381;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_D3 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_FBI_MDS_CSC2;30;INFormation Mart as Interface;V_INFI_MDS_MD_CurrencyCode;822450154;V ;VIEW;2223;/**/ /* View: V_INFI_MDS_MD_CurrencyCode */ /**/ /* =*/ /* V01.01.00 2021-06-11 Hui Yang (CI/XEF1) */ /* This view delivers the Currency Information to FBI-MDS */ /* Update: V01.01.00: filter of duplicate currency code */ /* Update: V01.00.00: Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G4;823062068;V ;VIEW;3271;/**/ /* View: V_FunctionalLocation_IDIM1_G4 */ /**/ /*=*/ /* V01.00.00 - 2020-09-07 Tatjana Derdus CI/DAV2.3 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-09-07 - Initial version */ /*=*/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_MD_LegalEntity_M2;826746298;V ;VIEW;2836;/**/ /* View: V_INTF_MD_LegalEntity_M2 */ /**/ /* */ /* V01.00.02 2022-08-01 Ilja Frolov (GS/BDD2) & Tina Fritz (GS/PBI-GE) */ /* Interface view to provide end-of-previous-month legal entity master data to GS Accounting */ /* Data.CORE Outgoing Interface #0207 https://inside-docupedia.bosch.com/confluence/x/2plxgg */ /* Update */ /* - V01.01.02: Changed source from 107 to 164 ref mds */ /* - V01.00.01: Update view name (2022-03-24, frt3ka) */ /* - V01.00.00: Created (2022-03-21, frt3ka) */ /* Restrictions: */ /* - legal entites valid as of end of previous month */ /* */
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G5_DemoSystem;829558339;V ;VIEW;2479;/**/ /* View: V_ResultActual_V1_IFCT0_G5_DemoSystem */ /**/ /**/ /* V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 */ /* Fact view for Research & Development result Actual bookings in COPA from P87 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G2;831706411;V ;VIEW;3922;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G2 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP72 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G2] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G2] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G5;833698318;V ;VIEW;3552;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G5 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from P87 */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G5;835026256;V ;VIEW;9247;"/**/ /* View: V_INTF_MD_Material_G5 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ProfitCenter_CDP;836458304;V ;VIEW;3208;/**/ /* View: V_INTF_COOM_Costs_DIM_ProfitCenter_CDP */ /**/ /* =*/ /* V01.00.00 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view provides the parent child hierarchy of ProfitCenter for CDP */ /* Restriction: */ /* none */ /* Changes: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G6;836510359;V ;VIEW;12417;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G6 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_GK;837278438;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_GK */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G5;839062125;V ;VIEW;3271;/**/ /* View: V_FunctionalLocation_IDIM1_G5 */ /**/ /*=*/ /* V01.00.00 - 2020-09-07 Tatjana Derdus CI/DAV2.3 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-09-07 - Initial version */ /*=*/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCORECostsPerFactHousekeeping;840598283;V ;VIEW;1636;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 1/27/2022 8:13:30 AM */ /**/ /**/ /* View: V_DataCORECostsPerFactHousekeeping */ /**/ /* =*/ /* V01.00.00 2022-01-26 Sanja Mihalic CI/XAD3 */ /* This view provide the generic Parameter for range of years to be loaded if new data is comming */ /* Filter on Application, Element to receive the list of Costs PerFacts */ /* This view is only to be used in CO%Delta views */ /* Update: */ /* =*/
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_Fact_Table_From_TM1;842746355;V ;VIEW;1902;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 29.07.2022 16:09:42 */ /**/ /**/ /* View: V_INTF_PNL_GM1_Fact_Table_From_TM1 */ /**/ /* =*/ /* V01.00.00 2022-07-26 Pawel Bialecki */ /* GM1 dashboard data to TM1 */ /* -------------------------------------------------------------------------------------------------------- */ /* updated */ /* - 01.00.00 - initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G5_DemoSystem;845558396;V ;VIEW;2391;/**/ /* View: V_ResultPlan_V1_IFCT0_G5_DemoSystem */ /**/ /**/ /* V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 */ /* Fact view for Research & Development result Plan bookings in COPA from P87 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_ELEMENT_NameOfValueField;847394138;V ;VIEW;3296;/**/ /* View: V_INTF_PNL_FACT_ELEMENT_NameOfValueField */ /**/ /* = */ /* V 01.00.01 2020-07-07 Patrik Just CI/DAV2.3 */ /* Soft Rule: tbd */ /* This view is to check TM1 cube integrity for each dimension. Check is based on base element of each dimension. */ /* Static list NameOfValueField is based on STAG_G0.STAG_CE10010_G0 */ /* Update: */ /* - 01.00.01: Replace dedicated EC-PCA view by direct SQL Query */ /* = */
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G3;847706468;V ;VIEW;3922;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G3 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP79 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G3] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G3] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_REF_ExchangeRatesToEuro_M2;848214272;V ;VIEW;2260;/**/ /* View: V_INTF_REF_ExchangeRatesToEuro_M2 */ /**/ /* */ /* V01.00.00 2020-08-18 Yannick Sigwalt GS/BDD2 */ /* This view delivers the exchange rates from X to EURO to GS Accounting */ /* Data.CORE Outgoing Interface #0159 https://inside-docupedia.bosch.com/confluence/x/sZ42cQ */ /* Restrictions: */ /* The exchanges Rates Type are read dynamically from */ /* Changes: */ /* - Copied from [INFI_Costs_CDP_CSC1].[V_INTF_PNL_REF_ExchangeRatesToEuro] V01.00.00 as of 2021-03-16 */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G6;849698375;V ;VIEW;3552;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G6 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from P99 */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G6;851026313;V ;VIEW;9247;"/**/ /* View: V_INTF_MD_Material_G6 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ProfitCenter_CDP_ATTR;852458361;V ;VIEW;2544;/**/ /* View: V_INTF_COOM_Costs_DIM_ProfitCenter_CDP_ATTR */ /**/ /* = */ /* V01.00.00 2021-04-28 Patrik Just CI/DAV2.3 */ /* This view shows the texts for the ProfitCenter for CDP */ /* - 01.00.00 source for ProfitCenter Text is still open */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_G7;852510416;V ;VIEW;12421;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_G7 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ExchangeRates_M2;853018220;V ;VIEW;4487;/**/ /* View: V_INTF_MD_ExchangeRates_M2 */ /**/ /* = */ /* V01.01.01 2021-02-10 Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-month exchange rate master data to Optravis */ /* Restrictions: */ /* - only includes EUR in foreign currency exchange rates of exchange rate type ZCAM */ /* - only includes end-of-month exchange rates of months within the reporting year (YTD) */ /* Changes: */ /* -V01.01.01 2021-02-10 Bugfix: Use UKURS instead of cleansed ExchangeRate to avoid rounding issues */ /* -V01.01.00 2021-02-04 Select Rates via TargetCurrency = EUR, Factors via SourceCurrency = EUR */ /* -V01.00.00 2021-01-28 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_H1;853278495;V ;VIEW;2248;/**/ /* View: V_FactActualCost_Short_H1 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G6;855062182;V ;VIEW;3271;/**/ /* View: V_FunctionalLocation_IDIM1_G6 */ /**/ /*=*/ /* V01.00.00 - 2020-09-07 Tatjana Derdus CI/DAV2.3 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-09-07 - Initial version */ /*=*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_WBSElement_V1_IDIM1_G5_DemoSystem;861558453;V ;VIEW;2029;/**/ /* View: V_WBSElement_V1_IDIM1_G5_DemoSystem */ /**/ /*-*-*-*-**/ /* V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 */ /* Dimension view for Research & Development Projects master data from P87 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 Original version created */ /**-*-*-*-*/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G4;863706525;V ;VIEW;4143;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G4 */ /**/ /* =*/ /* V01.00.03 2023-03-30 Michal Erdman & YannicK Sigwalt & Stephan Wund GS/BDD2 */ /* This view provides actual cost fact data from SAPP81 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G4] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G4] */ /* V01.00.02 - Added new column [DebitCreditCode] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_S3;867026370;V ;VIEW;9247;"/**/ /* View: V_INTF_MD_Material_S3 */ /**/ /* = */ /* V01.02.02 2021-12-03 Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessPartner;868458418;V ;VIEW;2215;/**/ /* View: V_INTF_PNL_DIM_BusinessPartner */ /**/ /* = */ /* V 01.01.00 2021-04-28 Patrik Just CI/DA2.3 */ /* This view merges RB Customer External and RB Customer Internal Hierarchy together */ /* Hint: The lowest leave is SAP Customer (Debitor) */ /* - Filter on RB Customer Hierarchy External set to 'WORKING SET' */ /* - Filter on RB Customer Hierarchy Internal set to 'WORKING SET' */ /* - V01.01.00 Initial version for Cost Driver Planning */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_GK;868510473;V ;VIEW;12417;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_GK */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_D7_DemoSystem;869278552;V ;VIEW;2961;/**/ /* View: V_FactActualCost_Short_D7_DemoSystem */ /**/ /**/ /* V01.00.01 2023-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P42, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /**/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_JunkRnDResult_V1_IDIM1;874746469;V ;VIEW;1390;/**/ /* View: V_JunkRnDResult_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-07-27 Yannick Sigwalt GS/BDD2 */ /* This view provides the junk dimension for RnD Result records */ /* Data.CORE Outgoing Interface #0211 https://inside-docupedia.bosch.com/confluence/x/VYS6gg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G5;879706582;V ;VIEW;3922;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G5 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP87 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G5] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G5] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_G0;883026427;V ;VIEW;9355;"/**/ /* View: V_INTF_MD_Material_G0 */ /**/ /* = */ /* V01.02.03 2021-12-08 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.03 2021-12-08 corrected name of satellite */ /* - V01.02.02 2021-12-03 add additional attributes */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessPartner_ATTR;884458475;V ;VIEW;4109;/**/ /* View: V_INTF_PNL_DIM_BusinessPartner_ATTR */ /**/ /* =*/ /* V01.00.00 2021-04-28 Patrik Just CI/DAV2.3 */ /* This reads both RB Customer External and Internal Hierarchies) */ /* and reads the adequate text for the record */ /* - Filter on RB Customer Hierarchy External set to 'WORKING SET' */ /* - Filter on RB Customer Hierarchy Internal set to 'WORKING SET' */ /* Updates: */ /* V01.00.00 - initial version for CDP */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_O1;884510530;V ;VIEW;12417;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_O1 */ /**/ /* */ /* V01.02.02 2022-09-30 Michal Erdman & Yannick Sigwalt GS/BDD1 & Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - fixed partner activity type */ /* V01.02.01 - changed call for #FBI-SR-000000025 */ /* V01.02.00 - Reworked the script to optimize the execution plan */ /* V01.01.00 -Optimized Coding */ /* -Reworked field naming and order to match the one from Actual view */ /* V01.00.00 Creation */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G0_DemoSystem;885278609;V ;VIEW;4880;/**/ /* View: V_FactActualCost_Short_G0_DemoSystem */ /**/ /**/ /* V01.00.01 2023-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_MissingSettlementObjectResultActual001;890850636;P ;SQL_STORED_PROCEDURE;15512;"/* =*/ /* V01.00.00 2023-05-22 Michal Erdman */ /* This procedure implements for testing of correctness of Settlement object assigment. */ /* Test Case checks if one of attributes WBSElement, CostCenter_HK, ProfitCenter has value */ /* and settlement obeject is filled */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case execution*/ /* Consumed Soft Rules */ /* Restriction: */ /* Update: */ /* =*/ create procedure MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_MissingSettlementObjectResultActual001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem nvarchar(15) = N'SAPP87' --DECLARE @SourceSystemVar nvarchar(5) = N'G5' --DECLARE @Usecase nvarchar(50) = N'xx' --DECLARE @TestCase nvarchar(50) = N'xx1' --DECLARE @TargetDataBase nvarchar(100) ='FBI_CORE_CORE_D' --DECLARE @TargetSchema nvarchar(256) = '' --DECLARE @TargetTable nvarchar(256) = '' --DECLARE @DeltaTimestampFrom datetime2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo datetime2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 789 --DECLARE @EntityId bigint = 123 --DECLARE @AuditTrailId bigint = -2 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnD_TC1_WBSElementwoMCRData]'; DECLARE @TestedElement NVARCHAR(100) = N'SettlementObject'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #TestResult; DROP TABLE IF EXISTS #cte_Amount; CREATE TABLE #TestResult ( [SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS NOT NULL ,[COPADocumentNumber_BK] nvarchar(10) NOT NULL ,[COPAPosition_BK] nvarchar(6) COLLATE Latin1_General_CS_AS NOT NULL ,[RowId] int identity(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); SET @SQL_1 = ( select CONCAT(' Select [COPADocumentLineItem_HK] ,copaam_ws.[NameOfValueField] ,max(copaam_ws.[CreationDateTime]) as [CreationDateTime] ,SUM(IIF(copaam_ws.[CurrencyTypeOfOperatingConcern] = ''01'',copaam_ws.[Amount],0)) as [TotalAmountCOAreaCurrency] ,SUM(IIF(copaam_ws.[CurrencyTypeOfOperatingConcern] = ''02'',copaam_ws.[Amount],0)) as [TotalAmountObjectCurrency] into #cte_Amount from [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAAmount_WSATM_', @SourceSystemVar, '_L] copaam_ws inner join (select distinct [ValueField_PK] from [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPARnDValueFieldJunkDimension_WREFM_F0_L] coparnd_wr where 1 = 1 and coparnd_wr.[ProjectRelatedCostCenterFilter_PK] > 1 and coparnd_wr.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ) ss_coparnd_wr on ss_coparnd_wr.[ValueField_PK] = copaam_ws.[NameOfValueField] and copaam_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' group by [COPADocumentLineItem_HK] ,copaam_ws.[NameOfValueField]; create index idx on #cte_Amount([COPADocumentLineItem_HK]); ')); SET @SQL_2 = ( select CONCAT(' insert into #TestResult ( [SAPSystem] , [COPADocumentNumber_BK] , [COPAPosition_BK] ) Select distinct copadli_wh.[SAPSystem] as [SAPSystem] ,copadli_wh.[COPADocumentNumber_BK] as [COPADocumentNumber_BK] ,IIF([COPAPosition_BK]='''',''000001'',[COPAPosition_BK]) as [COPAPosition_BK] from [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPADocumentLineItem_WHUB0] copadli_wh inner join #cte_Amount copaam_ws on copaam_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAAttribute_WSAT0_', @SourceSystemVar, '_L] copaat_ws on copaat_ws.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] and copaat_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[ProfitCenterToCOPADocumentLineItem_WLNK0] pc2copadli_wl on pc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = pc2copadli_wl.[ProfitCenter_HK] inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[CompanyCodeToCOPADocumentLineItem_WLNK0] compc2copadli_wl on compc2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] inner join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = compc2copadli_wl.[CompanyCode_HK] left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[WBSElementToCOPADocumentLineItem_WLNK0] wbse2copadli_wl on wbse2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh on wbse_wh.[WBSElement_HK] = wbse2copadli_wl.[WBSElement_HK] left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[SenderCostCenterToCOPADocumentLineItem_WLNK0] sccent2copadli_wl on sccent2copadli_wl.[COPADocumentLineItem_HK] = copadli_wh.[COPADocumentLineItem_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCenter_WHUB0] cte_CostCenter on cte_CostCenter.[CostCenter_HK] = sccent2copadli_wl.[CostCenter_HK] ')) ; SET @SQL_3 = ( select CONCAT(' inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPARnDValueFieldJunkDimension_WREFM_F0_L] coparnd_wr on coparnd_wr.[ValueField_PK] = copaam_ws.[NameOfValueField] and coparnd_wr.[COPASettlementObjectType_PK] = (CASE WHEN wbse_wh.[WBSElement_HK] is not null THEN ''J'' WHEN cte_CostCenter.[CostCenter_HK] is not null THEN ''C'' WHEN pc_wh.[ProfitCenter_HK] is not null THEN ''P'' END ) and coparnd_wr.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and coparnd_wr.[ProjectRelatedCostCenterFilter_PK] > 1 left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPARnDValueFieldJunkDimension_WREFM_F0_L] ccentprojrelated on ccentprojrelated.[ValueField_PK] = copaam_ws.[NameOfValueField] and ccentprojrelated.COPASettlementObjectType_PK = (CASE WHEN wbse_wh.[WBSElement_HK] is not null THEN ''J'' WHEN cte_CostCenter.[CostCenter_HK] is not null THEN ''C'' WHEN pc_wh.[ProfitCenter_HK] is not null THEN ''P'' END ) and ccentprojrelated.[ProjectRelatedCostCenterFilter_PK] = 1 and ccentprojrelated.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' where COALESCE(ccentprojrelated.[COPASettlementObject], coparnd_wr.[COPASettlementObject]) is null and ( wbse_wh.[WBSElement_HK] is not null or cte_CostCenter.[CostCenter_HK] is not null or pc_wh.[ProfitCenter_HK] is not null ); ')) ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1,@SQL_2,@SQL_3)); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (Select @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'S' --Success ,0 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,CONCAT([COPADocumentNumber_BK],'_',[COPAPosition_BK]) ,N'W' --Warning ,20 ,[COPADocumentNumber_BK] as [MessagePart1] ,[COPAPosition_BK] as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #TestResult END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'E' --Success ,999 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage DROP TABLE IF EXISTS #TestResult; RETURN @ReturnProcessStatusNumber END"
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G6;895706639;V ;VIEW;3922;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G6 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP99 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G6] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G6] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Country_ATTR;896878412;V ;VIEW;3578;/**/ /* View: V_INTF_PNL_DIM_Country_ATTR */ /**/ /* = */ /* V01.01.01 2021-04-16 Patrik Just CI/DAV 2.3 */ /* This view retreieves the description and HFM Country ID for every Country Hierarchy node */ /* Update: */ /* - V01.00.00 - 2019-03-14 - SYA8FE - Initial version */ /* - V01.00.01 - 2019-03-20 - SYA8FE - Added prefix for child and parent */ /* - V01.01.00 - 2020-08-04 - DTD7FE - Added attribute HFMID */ /* - V01.01.01 - 2021-04-26 - JUP8FE - Excluded attribute HFMID */ /* Restrictions: */ /* - For all attributes: filter on Edition set to 'WORKING SET' */ /* - For all attributes: filter on AllocationType to 'REP' */ /* - For attribut HFMID: filter on NodeType set to 'COUNTRY' */ /* = */
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_PNL_REF_ExchangeRatesToEuro;900458532;V ;VIEW;2964;/**/ /* View: V_INTF_PNL_REF_ExchangeRatesToEuro */ /**/ /* = */ /* V 01.00.00 2021-03-16 Patrik Just CI/DAV2.3 */ /* This view delivers the exchange rates from X to EURO to CDP */ /* - Filter on [ExchangeRateType] = EURX Daily rate (from European Central Bank) */ /* - Filter on [ExchangeRateType] = ZAM0 Monthly average rate */ /* - Filter on [ExchangeRateType] = ZAY0 Annual average rate */ /* - Filter on [ExchangeRateType] = ZCAY Cross rates average yearly */ /* - Filter on [ExchangeRateType] = ZCBP Business Plan (Average, cross rate) */ /* - Filter on [ExchangeRateType] = ZCCF Current Forecast (Average, Cross rate) */ /* - Filter on [ExchangeRateType] = ZCFE Current Forecast (End, Cross rate) */ /* - Enhanced View to deliver CURRENCY_DY for each ExchangeRateTypes and ExchangeRateDate */ /* >> Definition copied from [INFI_TM1_CSC2].[V_INTF_PNL_REF_ExchangeRatesToEuro] */ /* = */
INFI_COREWriter_P2P_CSC1;114;INFormation Mart as Interface;V_INTF_P2PValidationCompanyCode;900510587;V ;VIEW;1431;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 10/10/2022 3:33:08 PM */ /**/ /**/ /* View: V_INTF_P2PValidationCompanyCode */ /**/ /* */ /* V01.00.00 2022-10-10 Hui Yang CI/XEF */ /* This view displays CompanyCode BKs of Data.CORE for CORE.Writer Validation. */ /* Data.CORE Outgoing Interface #0280 https://inside-docupedia.bosch.com/confluence/x/vUo8kg */ /* Restrictions: */ /* Changes: */ /* - V01.00.00 initial version */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G3_DemoSystem;901278666;V ;VIEW;4729;/**/ /* View: V_FactActualCost_Short_G3_DemoSystem */ /**/ /**/ /* V01.00.01 2023-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_MissingSettlementObjectResultPlan001;906850693;P ;SQL_STORED_PROCEDURE;13936;"/* =*/ /* V01.00.00 2023-05-22 Michal Erdman */ /* This procedure implements for testing of correctness of Settlement object assigment. */ /* Test Case checks if one of attributes WBSElement, CostCenter_HK, ProfitCenter has value */ /* and settlement obeject is filled */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case execution*/ /* Consumed Soft Rules */ /* Restriction: */ /* Update: */ /* =*/ create procedure MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_MissingSettlementObjectResultPlan001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem nvarchar(15) = N'SAPP87' --DECLARE @SourceSystemVar nvarchar(5) = N'G5' --DECLARE @Usecase nvarchar(50) = N'xx' --DECLARE @TestCase nvarchar(50) = N'xx1' --DECLARE @TargetDataBase nvarchar(100) ='FBI_CORE_CORE_D' --DECLARE @TargetSchema nvarchar(256) = '' --DECLARE @TargetTable nvarchar(256) = '' --DECLARE @DeltaTimestampFrom datetime2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo datetime2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 789 --DECLARE @EntityId bigint = 123 --DECLARE @AuditTrailId bigint = -2 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnD_TC1_WBSElementwoMCRData]'; DECLARE @TestedElement NVARCHAR(100) = N'SettlementObject'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #TestResult; CREATE TABLE #TestResult ( [SAPSystem] nvarchar(15) COLLATE Latin1_General_CS_AS NOT NULL ,[COPAPlanDocumentNumber_BK] nvarchar(10) NOT NULL ,[FiscalYearPeriod_BK] int NOT NULL ,[Version_ID_BK] nvarchar(3) NOT NULL ,[RowId] int identity(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); SET @SQL_1 = ( select CONCAT(' with src as( Select copapd_wh.[SAPSystem] as [SourceSystem] ,copapd_wh.[FiscalYearPeriod_BK] ,copapd_wh.COPAInternalSubobject_BK ,copapd_wh.COPAPlanDocumentNumber_BK ,copapd_wh.Version_ID_BK from [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAPlanDocument_WHUB0] copapd_wh inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAPlanDocumentAmount_WSATM_G0_X] copapdam_ws on copapdam_ws.[COPAPlanDocument_HK] = copapd_wh.[COPAPlanDocument_HK] and copapdam_ws.[Ledger_PK] = ''02'' and copapdam_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAPlanDocumentToSenderCostCenter_WLNK0] copapd2sccent_wl on copapd2sccent_wl.[COPAPlanDocument_HK] = copapd_wh.[COPAPlanDocument_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = copapd2sccent_wl.[CostCenter_HK] left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAPlanDocumentToProfitCenter_WLNK0] copapd2pc_wl on copapd2pc_wl.[COPAPlanDocument_HK] = copapd_wh.[COPAPlanDocument_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copapd2pc_wl.[ProfitCenter_HK] left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPAPlanDocumentToWBSElement_WLNK0] copapd2wbse_wl on copapd2wbse_wl.[COPAPlanDocument_HK] = copapd_wh.[COPAPlanDocument_HK] left join [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh on wbse_wh.[WBSElement_HK] = copapd2wbse_wl.[WBSElement_HK] inner join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPARnDValueFieldJunkDimension_WREFM_F0_L] coparnd_wr on coparnd_wr.[ValueField_PK] = copapdam_ws.[NameOfValueField_PK] and coparnd_wr.COPASettlementObjectType_PK = (CASE WHEN wbse_wh.WBSElement_HK is not null THEN ''J'' WHEN ccent_wh.CostCenter_HK is not null THEN ''C'' WHEN pc_wh.[ProfitCenter_HK] is not null THEN ''P'' END ) and coparnd_wr.[ProjectRelatedCostCenterFilter_PK] > 1 and coparnd_wr.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' left join [',@TargetDataBase,'].[RAWV_COPA_CSC2].[COPARnDValueFieldJunkDimension_WREFM_F0_L] ccentprojrelated on ccentprojrelated.[ValueField_PK] = copapdam_ws.[NameOfValueField_PK] and ccentprojrelated.COPASettlementObjectType_PK = (CASE WHEN wbse_wh.WBSElement_HK is not null THEN ''J'' WHEN ccent_wh.CostCenter_HK is not null THEN ''C'' WHEN pc_wh.[ProfitCenter_HK] is not null THEN ''P'' END ) and ccentprojrelated.[ProjectRelatedCostCenterFilter_PK] = 1 and ccentprojrelated.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' where COALESCE(ccentprojrelated.[COPASettlementObject], coparnd_wr.[COPASettlementObject]) is null and ( wbse_wh.WBSElement_HK is not null or ccent_wh.CostCenter_HK is not null or pc_wh.[ProfitCenter_HK] is not null ) ) ')); SET @SQL_2 = ( select ' insert into #TestResult ( [SAPSystem] ,[COPAPlanDocumentNumber_BK] ,[FiscalYearPeriod_BK] ,[Version_ID_BK] ) Select distinct [SourceSystem] ,[COPAPlanDocumentNumber_BK] ,[FiscalYearPeriod_BK] ,[Version_ID_BK] from src; ') ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1,@SQL_2)); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (Select @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'S' --Success ,0 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,CONCAT([COPAPlanDocumentNumber_BK],'_',[FiscalYearPeriod_BK],'_',[Version_ID_BK]) ,N'W' --Warning ,21 ,[COPAPlanDocumentNumber_BK] as [MessagePart1] ,[FiscalYearPeriod_BK] as [MessagePart2] ,[Version_ID_BK] as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #TestResult END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'E' --Success ,999 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage DROP TABLE IF EXISTS #TestResult; RETURN @ReturnProcessStatusNumber END"
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G7;911706696;V ;VIEW;3922;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G7 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPPCR for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G7] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G7] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ActivityType_CDP_ATTR;915078596;V ;VIEW;2640;/**/ /* View: V_INTF_COOM_Costs_DIM_ActivityType_CDP_ATTR */ /**/ /* =*/ /* V01.00.03 2022-06-17 Ismail Okadia GS/TET3-NA */ /* This view provides the attributes of ActivityType for CDP */ /* Data.CORE Outgoing Interface #0156 https://inside-docupedia.bosch.com/confluence/x/LsO_ag */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - Removed SR on GlobalHierarchy, added ActitityTypeCategory,ActivityUnit attribute */ /* V01.00.02 - Added Hierarchy nodes */ /* V01.00.01 - Add Activity Type texts and characteristics */ /* V01.00.00 - Initial version */ /* =*/
INFI_COREWriter_P2P_CSC1;114;INFormation Mart as Interface;V_INTF_CompanyCodeP2PDataTableIsReadyForInput;916510644;V ;VIEW;1525;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 10/27/2022 10:15:33 AM */ /**/ /**/ /* View: V_INTF_CompanyCodeP2PDataTableIsReadyForInput */ /**/ /* =*/ /* V01.00.00 2022-10-26 Hui Yang CI/XEF1 */ /* This view provide CORE.Writer the information if it may enter data into the target table or not */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G4_DemoSystem;917278723;V ;VIEW;4879;/**/ /* View: V_FactActualCost_Short_G4_DemoSystem */ /**/ /**/ /* V01.00.06 2023-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_G9;927706753;V ;VIEW;3915;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_G9 */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP74 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_G9] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G9] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_D4;928214557;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;10578;/**/ /* V01.00.00 2021-09-07 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_D4 ( @year int ) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select [CostCollector_HK] ,[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ) ,CostCollectorCostCenter_WLNK0 as ( select [CostCollector_HK] ,[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pvh.[Version_ID_BK],'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] ,cast((pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pc.[TotalValueCOAreaCurrency] - pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[TotalValueObjectCurrency] - pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [VariableAmountObjectCurrency] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_G5_DemoSystem;933278780;V ;VIEW;4880;/**/ /* View: V_FactActualCost_Short_G5_DemoSystem */ /**/ /**/ /* V01.00.01 2023-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostActual_V2_GK;943706810;V ;VIEW;3924;/**/ /* View: V_INTF_COOM_Costs_FACT_CostActual_V2_GK */ /**/ /* =*/ /* V01.00.02 2023-03-30 Michal Erdman CI/XTD & Martin Urban CI/XTD2 */ /* This view provides actual cost fact data from SAPP77 for TM1 */ /* Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* it consumes the folling Soft rules */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - changed persisted Fact [INFM_Costs_CSC1].[CO_CostActual_PerFact_GK] */ /* to [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_GK] */ /* V01.00.01 - Added new colums [PartnerObject_BK], [COBusinessTransaction],[DebitCreditIndicator] */ /* V01.00.00 - Initial version */ /* =*/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_G0;944214614;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;10578;/**/ /* V01.00.00 2021-09-07 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_G0 ( @year int ) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select [CostCollector_HK] ,[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ) ,CostCollectorCostCenter_WLNK0 as ( select [CostCollector_HK] ,[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pvh.[Version_ID_BK],'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] ,cast((pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pc.[TotalValueCOAreaCurrency] - pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[TotalValueObjectCurrency] - pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [VariableAmountObjectCurrency] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G0;949278837;V ;VIEW;6215;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G0 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MERM_CORE_Testing_CSC1;128;;V_DataCOREDataDictionnaryChangeReporting_V1_MFCTS;954850864;V ;VIEW;2007;/**/ /* View: V_DataCOREDataDictionnaryChangeReporting_V1_MFCTS */ /**/ /* =*/ /* V01.00.00 2023-05-17 Yannick Sigwalt GS/BDD1 */ /* View implement the DataDicitionary Change information from SAP Systems */ /* it implements access layer */ /* Data.CORE Outgoing Interface #0342 https://inside-docupedia.bosch.com/confluence/x/jxeVtQ */ /* Restriction: */ /* - none */ /* Updates: */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GLAccount;959706867;V ;VIEW;2927;/**/ /* View: V_INTF_PNL_DIM_GLAccount */ /**/ /* = */ /* V01.00.03 2023-03-10 Ilja Frolov GS/BDD1 & Yannick Sigwalt GS/BDD1 */ /* Parent Child Hierarchy for GL Account */ /* Data.CORE Outgoing Interface #0221 https://inside-docupedia.bosch.com/confluence/x/ahkdhg */ /* Restrictions: */ /* - IBM PA Interface Description https://inside-docupedia.bosch.com/confluence/x/wS--Ug */ /* Update: */ /* - V01.00.03 - Performance Optimization */ /* - V01.00.02 - Corrected datatype for Valid From and Valid To */ /* - V01.00.01 - Added Column NodeOrder */ /* - Filtered on [NodeTypeCode] not in 'D' (duplicates) */ /* - converted Child and Parent to expected output format */ /* - V01.00.00 Creation */ /* = */
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;ufn_GetPlanCost_V2_IFCT0_G1;960214671;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;10578;/**/ /* V01.00.00 2021-09-07 Sanja Mihalic CI/XTD3 */ /* Fact View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0165 https://inside-docupedia.bosch.com/confluence/x/_WFNcg */ /* Update: */ /* */ /**/ create function INFI_GSSGA_CSC2.ufn_GetPlanCost_V2_IFCT0_G1 ( @year int ) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select [CostCollector_HK] ,[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ) ,CostCollectorCostCenter_WLNK0 as ( select [CostCollector_HK] ,[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[FixedValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_', pvh.[Version_ID_BK],'_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] ,cast((pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pc.[TotalValueCOAreaCurrency] - pc.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pc.[TotalValueCOAreaCurrency] <> 0,pc.[TotalValueObjectCurrency] - pc.[FixedValueCOAreaCurrency] / pc.[TotalValueCOAreaCurrency] * pc.[TotalValueObjectCurrency],0) as decimal(38,2)) as [VariableAmountObjectCurrency] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake]
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Debitor_ATTR;963078767;V ;VIEW;4937;/**/ /* View: V_INTF_PNL_DIM_Debitor_ATTR */ /**/ /* = */ /* V01.00.02 2022-06-21 Michal Erdman & Patrik Just CI/DAV2.3 */ /* Interface provides the description for SAP Debitor (Customer) */ /* History: */ /* - V01.00.02: Added attributes from SL */ /* - V01.00.01: Add new systems */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G1;965278894;V ;VIEW;6215;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G1 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_B4;967374911;V ;VIEW;2250;/**/ /* View: V_FactActualCost_Short_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_DataCORETest_DataDictionnaryStructureChanges001;970850921;P ;SQL_STORED_PROCEDURE;43010;"/* =*/ /* V01.00.00 2023-05-17 Yannick Sigwalt GS/BDD1 */ /* This procedure implements as Test Case 1 for DataCORE, */ /* Test Case checks changes in DataDictionnary structures between P ERP and Q ERP systems to be able to early */ /* identify a need to reaction */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case execution*/ /* Consumed Soft Rules */ /* Restriction: */ /* Update: */ /* =*/ create procedure MERM_CORE_Testing_CSC1.usp_CORETesting_DataCORETest_DataDictionnaryStructureChanges001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out )as begin /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem nvarchar(15) = N'SAPPOE' --DECLARE @SourceSystemVar nvarchar(5) = N'G0' --DECLARE @Usecase nvarchar(50) = N'AL2_MERM_SAPDDTesting_PDM' --DECLARE @TestCase nvarchar(50) = N'DataCORETest_DataDictionnaryStructureChanges001' --DECLARE @TargetDataBase nvarchar(100) ='FBI_CORE_CORE_Q' --DECLARE @TargetSchema nvarchar(256) = '' --DECLARE @TargetTable nvarchar(256) = '' --DECLARE @DeltaTimestampFrom datetime2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo datetime2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 789 --DECLARE @EntityId bigint = 123 --DECLARE @AuditTrailId bigint = -2 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnD_TC1_WBSElementwoMCRData]'; DECLARE @TestedElement NVARCHAR(100) = N'SAPDataDictionary'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT = 0; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FindingRowCounter INT = 0; DECLARE @FindingCounter INT = 0; DECLARE @Diff INT; DECLARE @CheckPosition bit = 0; DECLARE @CheckLowercase bit = 0; DECLARE @CheckOutputLen bit = 0; DECLARE @TargetEnvironmentForQuery nvarchar(1); SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_TableList NVARCHAR(MAX) = '' DECLARE @SQL_DDP NVARCHAR(MAX) = '' DECLARE @SQL_DDQ NVARCHAR(MAX) = '' DECLARE @SQL_Result NVARCHAR(MAX) = '' DROP TABLE if exists #DDP; DROP TABLE if exists #DDQ; DROP TABLE if exists #SAPTable; DROP TABLE if exists #ComparisonResults; CREATE TABLE #SAPTable ( [OriginalSAPTABNAME] nvarchar(100) COLLATE Latin1_General_CS_AS NOT NULL ); CREATE TABLE #DDQ ( [HashKey] binary(20) NOT NULL ,[HashDiff] binary(20) NOT NULL ,[TABCLASS] nvarchar(8) COLLATE Latin1_General_CS_AS NOT NULL ,[TABNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[FIELDNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[POSITION] nvarchar(4) COLLATE Latin1_General_CS_AS ,[KEYFLAG] nvarchar(1) COLLATE Latin1_General_CS_AS ,[ROLLNAME] nvarchar(30) COLLATE Latin1_General_CS_AS ,[Domain] nvarchar(30) COLLATE Latin1_General_CS_AS ,[LOWERCASE] nvarchar(1) COLLATE Latin1_General_CS_AS ,[DataType] nvarchar(4) COLLATE Latin1_General_CS_AS ,[FieldLength] nvarchar(6) COLLATE Latin1_General_CS_AS ,[DataPrecision] nvarchar(6) COLLATE Latin1_General_CS_AS ,[OUTPUTLEN] nvarchar(6) COLLATE Latin1_General_CS_AS ,[REFTABLE] nvarchar(30) COLLATE Latin1_General_CS_AS ,[REFFIELD] nvarchar(30) COLLATE Latin1_General_CS_AS ,[ColumnText] nvarchar(60) COLLATE Latin1_General_CS_AS ,[TECH_NAME_SOURCESYSTEM] nvarchar(10) COLLATE Latin1_General_CS_AS ); CREATE TABLE #DDP ( [HashKey] binary(20) NOT NULL ,[HashDiff] binary(20) NOT NULL ,[TABCLASS] nvarchar(8) COLLATE Latin1_General_CS_AS NOT NULL ,[TABNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[FIELDNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[POSITION] nvarchar(4) COLLATE Latin1_General_CS_AS ,[KEYFLAG] nvarchar(1) COLLATE Latin1_General_CS_AS ,[ROLLNAME] nvarchar(30) COLLATE Latin1_General_CS_AS ,[Domain] nvarchar(30) COLLATE Latin1_General_CS_AS ,[LOWERCASE] nvarchar(1) COLLATE Latin1_General_CS_AS ,[DataType] nvarchar(4) COLLATE Latin1_General_CS_AS ,[FieldLength] nvarchar(6) COLLATE Latin1_General_CS_AS ,[DataPrecision] nvarchar(6) COLLATE Latin1_General_CS_AS ,[OUTPUTLEN] nvarchar(6) COLLATE Latin1_General_CS_AS ,[REFTABLE] nvarchar(30) COLLATE Latin1_General_CS_AS ,[REFFIELD] nvarchar(30) COLLATE Latin1_General_CS_AS ,[ColumnText] nvarchar(60) COLLATE Latin1_General_CS_AS ,[TECH_NAME_SOURCESYSTEM] nvarchar(10) COLLATE Latin1_General_CS_AS ); CREATE TABLE #ComparisonResults ( [RecordId] int identity(1,1) ,[TABCLASS] nvarchar(8) COLLATE Latin1_General_CS_AS NOT NULL ,[TABNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[FIELDNAME] nvarchar(30) COLLATE Latin1_General_CS_AS NOT NULL ,[POSITION] nvarchar(4) COLLATE Latin1_General_CS_AS ,[Diff] int ,[POSITIONOnP] nvarchar(4) COLLATE Latin1_General_CS_AS ,[POSITIONOnQ] nvarchar(4) COLLATE Latin1_General_CS_AS ,[TECH_NAME_SOURCESYSTEMOnP] nvarchar(10) COLLATE Latin1_General_CS_AS ,[TECH_NAME_SOURCESYSTEMOnQ] nvarchar(10) COLLATE Latin1_General_CS_AS ,[KEYFLAGOnP] nvarchar(1) COLLATE Latin1_General_CS_AS ,[KEYFLAGOnQ] nvarchar(1) COLLATE Latin1_General_CS_AS ,[ROLLNAMEOnP] nvarchar(30) COLLATE Latin1_General_CS_AS ,[ROLLNAMEOnQ] nvarchar(30) COLLATE Latin1_General_CS_AS ,[DomainOnP] nvarchar(30) COLLATE Latin1_General_CS_AS ,[DomainOnQ] nvarchar(30) COLLATE Latin1_General_CS_AS ,[LOWERCASEOnP] nvarchar(1) COLLATE Latin1_General_CS_AS ,[LOWERCASEOnQ] nvarchar(1) COLLATE Latin1_General_CS_AS ,[DataTypeOnP] nvarchar(4) COLLATE Latin1_General_CS_AS ,[DataTypeOnQ] nvarchar(4) COLLATE Latin1_General_CS_AS ,[FieldLengthOnP] nvarchar(6) COLLATE Latin1_General_CS_AS ,[FieldLengthOnQ] nvarchar(6) COLLATE Latin1_General_CS_AS ,[DataPrecisionOnP] nvarchar(6) COLLATE Latin1_General_CS_AS ,[DataPrecisionOnQ] nvarchar(6) COLLATE Latin1_General_CS_AS ,[OUTPUTLENOnP] nvarchar(6) COLLATE Latin1_General_CS_AS ,[OUTPUTLENOnQ] nvarchar(6) COLLATE Latin1_General_CS_AS ,[REFTABLEOnP] nvarchar(30) COLLATE Latin1_General_CS_AS ,[REFTABLEOnQ] nvarchar(30) COLLATE Latin1_General_CS_AS ,[REFFIELDOnP] nvarchar(30) COLLATE Latin1_General_CS_AS ,[REFFIELDOnQ] nvarchar(30) COLLATE Latin1_General_CS_AS ,[ColumnTextOnP] nvarchar(60) COLLATE Latin1_General_CS_AS ,[ColumnTextOnQ] nvarchar(60) COLLATE Latin1_General_CS_AS ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sqls for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); SET @SQL_TableList = (SELECT CONCAT('INSERT INTO #SAPTable Select distinct ( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE (IIF( LEFT([SchemaName],4)= ''RAWB'',LEFT([EntityClassCode], LEN([EntityClassCode]) -3), [EntityClassCode]),''V_CUSN_'',''''),''V_HIST_'','''') ,''RB9X_'',''/RB9X/''),''RB9F_'',''/RB9F/''),''RB0M_'',''/RB0M/''),''RB4C_'',''/RB4C/''),''BBP_'',''/BBP/''),''XFT_'',''/XFT/'') ) as [OriginalSAPTABNAME] from [FBI_CORE_META_', RIGHT(@TargetDataBase,1),'].[MetadataZone].[EntityClass] where 1 = 1 and [Stereotype] = ''Source'' and [ModelCode] like ''SO%'' ')); SET @TargetEnvironmentForQuery = RIGHT(@TargetDataBase,1); SET @SQL_DDP = (SELECT CONCAT('INSERT INTO #DDP Select HASHBYTES(''SHA1'',RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[TABNAME]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[FIELDNAME]))) -- + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[POSITION]))) ) as [HashKey] ,HASHBYTES(''SHA1'',IIF(',cast(@CheckPosition as nvarchar(1)),' = 1 , RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[POSITION]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[KEYFLAG]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[ROLLNAME]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),Coalesce( DD04L.[DOMNAME], DD03L.[DOMNAME])))) + ''\@|'' + IIF(',cast(@CheckLowercase as nvarchar(1)),' = 1, RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD04L.[LOWERCASE]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[DATATYPE], DD03L.[DATATYPE])))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[LENG], DD03L.[LENG])))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[DECIMALS], DD03L.[DECIMALS])))) + ''\@|'' + IIF(',cast(@CheckOutputLen as nvarchar(1)),' = 1, RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD04L.[OUTPUTLEN]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[REFTABLE]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[REFFIELD]))) -- + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD03T.[DDTEXT], DD04T.[DDTEXT])))) ) as [HashDiff] , DD02L.[TABCLASS] , DD03L.[TABNAME] , DD03L.[FIELDNAME] , DD03L.[POSITION] , DD03L.[KEYFLAG] , DD03L.[ROLLNAME] , Coalesce( DD04L.[DOMNAME], DD03L.[DOMNAME]) as Domain , DD04L.[LOWERCASE] , coalesce (DD04L.[DATATYPE], DD03L.[DATATYPE]) as DataType , coalesce (DD04L.[LENG], DD03L.[LENG] ) as FieldLength , coalesce (DD04L.[DECIMALS], DD03L.[DECIMALS]) as DataPrecision , DD04L.[OUTPUTLEN] , DD03L.[REFTABLE] , DD03L.[REFFIELD] , coalesce (DD03T.[DDTEXT], DD04T.[DDTEXT]) as ColumnText , DD03L.[TECH_NAME_SOURCESYSTEM] from #SAPTable INNER JOIN [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD02L_',@SourceSystemVar,'] DD02L ON DD02L.[TABNAME] = #SAPTable.[OriginalSAPTABNAME] and DD02L.[AS4LOCAL] = ''A'' and DD02L.[TABCLASS] IN (''TRANSP'',''CLUSTER'',''POOL'') INNER JOIN [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD03L_',@SourceSystemVar,'] DD03L on DD03L.[TABNAME] = DD02L.[TABNAME] and DD03L.[AS4LOCAL] = DD02L.[AS4LOCAL] and DD03L.[COMPTYPE] NOT IN (''N'', ''S'') --> Remove Structures left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD03T_',@SourceSystemVar,'] DD03T on DD03T.[TABNAME] = DD03L.[TABNAME] and DD03T.[AS4LOCAL] = DD03L.[AS4LOCAL] and DD03T.[FIELDNAME] = DD03L.[FIELDNAME] and DD03T.[DDLANGUAGE] = ''E'' left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD04L_',@SourceSystemVar,'] DD04L on DD04L.[ROLLNAME] = DD03L.[ROLLNAME] and DD04L.[AS4LOCAL] = DD03L.[AS4LOCAL] left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD04T_',@SourceSystemVar,'] DD04T on DD04T.[ROLLNAME] = DD03L.[ROLLNAME] and DD04T.[AS4LOCAL] = DD03L.[AS4LOCAL] and DD04T.[DDLANGUAGE] = ''E'' ; ')); SET @TargetEnvironmentForQuery = 'T'; SET @SQL_DDQ = (SELECT CONCAT('INSERT INTO #DDQ Select HASHBYTES(''SHA1'',RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[TABNAME]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[FIELDNAME]))) -- + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[POSITION]))) ) as [HashKey] ,HASHBYTES(''SHA1'',IIF(',cast(@CheckPosition as nvarchar(1)),' = 1 , RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[POSITION]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[KEYFLAG]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[ROLLNAME]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),Coalesce( DD04L.[DOMNAME], DD03L.[DOMNAME])))) + ''\@|'' + IIF(',cast(@CheckLowercase as nvarchar(1)),' = 1, RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD04L.[LOWERCASE]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[DATATYPE], DD03L.[DATATYPE])))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[LENG], DD03L.[LENG])))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD04L.[DECIMALS], DD03L.[DECIMALS])))) + ''\@|'' + IIF(',cast(@CheckOutputLen as nvarchar(1)),' = 1, RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD04L.[OUTPUTLEN]))), '''') + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[REFTABLE]))) + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),DD03L.[REFFIELD]))) -- + ''\@|'' + RTRIM(LTRIM(CONVERT(VARCHAR(1024),coalesce (DD03T.[DDTEXT], DD04T.[DDTEXT])))) ) as [HashDiff] , DD02L.[TABCLASS] , DD03L.[TABNAME] , DD03L.[FIELDNAME] , DD03L.[POSITION] , DD03L.[KEYFLAG] , DD03L.[ROLLNAME] , Coalesce( DD04L.[DOMNAME], DD03L.[DOMNAME]) as Domain , DD04L.[LOWERCASE] , coalesce (DD04L.[DATATYPE], DD03L.[DATATYPE]) as DataType , coalesce (DD04L.[LENG], DD03L.[LENG] ) as FieldLength , coalesce (DD04L.[DECIMALS], DD03L.[DECIMALS]) as DataPrecision , DD04L.[OUTPUTLEN] , DD03L.[REFTABLE] , DD03L.[REFFIELD] , coalesce (DD03T.[DDTEXT], DD04T.[DDTEXT]) as ColumnText , DD03L.[TECH_NAME_SOURCESYSTEM] from #SAPTable INNER JOIN [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD02L_',@SourceSystemVar,'] DD02L ON DD02L.[TABNAME] = #SAPTable.[OriginalSAPTABNAME] and DD02L.[AS4LOCAL] = ''A'' and DD02L.[TABCLASS] IN (''TRANSP'',''CLUSTER'',''POOL'') INNER JOIN [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD03L_',@SourceSystemVar,'] DD03L on DD03L.[TABNAME] = DD02L.[TABNAME] and DD03L.[AS4LOCAL] = DD02L.[AS4LOCAL] and DD03L.[COMPTYPE] NOT IN (''N'', ''S'') --> Remove Structures left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD03T_',@SourceSystemVar,'] DD03T on DD03T.[TABNAME] = DD03L.[TABNAME] and DD03T.[AS4LOCAL] = DD03L.[AS4LOCAL] and DD03T.[FIELDNAME] = DD03L.[FIELDNAME] and DD03T.[DDLANGUAGE] = ''E'' left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD04L_',@SourceSystemVar,'] DD04L on DD04L.[ROLLNAME] = DD03L.[ROLLNAME] and DD04L.[AS4LOCAL] = DD03L.[AS4LOCAL] left join [FBI_CORE_STAGE_',@TargetEnvironmentForQuery,'].[STAG_',@SourceSystemVar,'].[STAG_DD04T_',@SourceSystemVar,'] DD04T on DD04T.[ROLLNAME] = DD03L.[ROLLNAME] and DD04T.[AS4LOCAL] = DD03L.[AS4LOCAL] and DD04T.[DDLANGUAGE] = ''E'' ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute SQL and collect basic informations --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY --SET @SQL = CAST('' AS NVARCHAR(MAX)); --Set @SQL = (SELECT CONCAT( @SQL_1,@SQL_2,@SQL_3,@SQL_4)); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL_TableList AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL_TableList; SET @rowCounter = (Select COALESCE(@rowCounter,0) + @@ROWCOUNT); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL_DDP AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL_DDP; SET @rowCounter = (Select COALESCE(@rowCounter,0) + @@ROWCOUNT); IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL_DDQ AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL_DDQ; SET @rowCounter = (Select COALESCE(@rowCounter,0) + @@ROWCOUNT); insert into #ComparisonResults ([TABCLASS] ,[TABNAME] ,[FIELDNAME] ,[POSITION] ,[Diff] ,[POSITIONOnP] ,[POSITIONOnQ] ,[TECH_NAME_SOURCESYSTEMOnP] ,[TECH_NAME_SOURCESYSTEMOnQ] ,[KEYFLAGOnP] ,[KEYFLAGOnQ] ,[ROLLNAMEOnP] ,[ROLLNAMEOnQ] ,[DomainOnP] ,[DomainOnQ] ,[LOWERCASEOnP] ,[LOWERCASEOnQ] ,[DataTypeOnP] ,[DataTypeOnQ] ,[FieldLengthOnP] ,[FieldLengthOnQ] ,[DataPrecisionOnP] ,[DataPrecisionOnQ] ,[OUTPUTLENOnP] ,[OUTPUTLENOnQ] ,[REFTABLEOnP] ,[REFTABLEOnQ] ,[REFFIELDOnP] ,[REFFIELDOnQ] ,[ColumnTextOnP] ,[ColumnTextOnQ] ) Select coalesce(#DDP.[TABCLASS],#DDQ.[TABCLASS]) AS [TABCLASS] ,coalesce(#DDP.[TABNAME],#DDQ.[TABNAME]) AS [TABNAME] ,coalesce(#DDP.[FIELDNAME],#DDQ.[FIELDNAME]) AS [FIELDNAME] ,COALESCE(#DDP.[POSITION],#DDQ.[POSITION]) AS [POSITION] ,IIF(#DDP.[TABNAME] IS NULL ,1,0) +IIF(#DDQ.[TABNAME] IS NULL ,2,0) +IIF( COALESCE(#DDP.[POSITION] ,'') <> COALESCE(#DDQ.[POSITION] ,''),4,0) +IIF( COALESCE(#DDP.[KEYFLAG] ,'') <> COALESCE(#DDQ.[KEYFLAG] ,''),8,0) +IIF( COALESCE(#DDP.[ROLLNAME] ,'') <> COALESCE(#DDQ.[ROLLNAME] ,''),16,0) +IIF( COALESCE(#DDP.[Domain] ,'') <> COALESCE(#DDQ.[Domain] ,''),32,0) +IIF( COALESCE(#DDP.[LOWERCASE] ,'') <> COALESCE(#DDQ.[LOWERCASE] ,''),64,0) +IIF( COALESCE(#DDP.[DataType] ,'') <> COALESCE(#DDQ.[DataType] ,''),128,0) +IIF( COALESCE(#DDP.[FieldLength] ,'') <> COALESCE(#DDQ.[FieldLength] ,''),256,0) +IIF( COALESCE(#DDP.[DataPrecision] ,'') <> COALESCE(#DDQ.[DataPrecision] ,''),512,0) +IIF( COALESCE(#DDP.[OUTPUTLEN] ,'') <> COALESCE(#DDQ.[OUTPUTLEN] ,''),1024,0) +IIF( COALESCE(#DDP.[REFTABLE] ,'') <> COALESCE(#DDQ.[REFTABLE] ,''),2048,0) +IIF( COALESCE(#DDP.[REFFIELD] ,'') <> COALESCE(#DDQ.[REFFIELD] ,''),4096,0) +IIF( COALESCE(#DDP.[ColumnText] ,'') <> COALESCE(#DDQ.[ColumnText] ,''),8192,0) , #DDP.[POSITION] AS [POSITIONOnP] , #DDQ.[POSITION] AS [POSITIONOnQ] , #DDP.[TECH_NAME_SOURCESYSTEM] AS [TECH_NAME_SOURCESYSTEMOnP] , #DDQ.[TECH_NAME_SOURCESYSTEM] AS [TECH_NAME_SOURCESYSTEMOnQ] , #DDP.[KEYFLAG] AS [KEYFLAGOnP] , #DDQ.[KEYFLAG] AS [KEYFLAGOnQ] , #DDP.[ROLLNAME] AS [ROLLNAMEOnP] , #DDQ.[ROLLNAME] AS [ROLLNAMEOnQ] , #DDP.[Domain] AS [DomainOnP] , #DDQ.[Domain] AS [DomainOnQ] , #DDP.[LOWERCASE] AS [LOWERCASEOnP] , #DDQ.[LOWERCASE] AS [LOWERCASEOnQ] , #DDP.[DataType] AS [DataTypeOnP] , #DDQ.[DataType] AS [DataTypeOnQ] , #DDP.[FieldLength] AS [FieldLengthOnP] , #DDQ.[FieldLength] AS [FieldLengthOnQ] , #DDP.[DataPrecision] AS [DataPrecisionOnP] , #DDQ.[DataPrecision] AS [DataPrecisionOnQ] , #DDP.[OUTPUTLEN] AS [OUTPUTLENOnP] , #DDQ.[OUTPUTLEN] AS [OUTPUTLENOnQ] , #DDP.[REFTABLE] AS [REFTABLEOnP] , #DDQ.[REFTABLE] AS [REFTABLEOnQ] , #DDP.[REFFIELD] AS [REFFIELDOnP] , #DDQ.[REFFIELD] AS [REFFIELDOnQ] , #DDP.[ColumnText] AS [ColumnTextOnP] , #DDQ.[ColumnText] AS [ColumnTextOnQ] from #DDP full join #DDQ on #DDQ.[HashKey] = #DDP.[HashKey] where ( #DDP.[HashKey] is null or #DDQ.[HashKey] is null or NOT ( #DDP.[HashDiff] = #DDQ.[HashDiff] OR ( #DDP.[HashDiff] IS NULL and #DDQ.[HashDiff] IS NULL ) ) ) SET @FindingRowCounter = (Select @@ROWCOUNT); SET @rowCounter = (Select COALESCE(@FindingRowCounter,0) + @@ROWCOUNT); /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; BEGIN TRAN IF ( @rowCounter IS NULL ) SET @rowCounter = 0; SET @FindingCounter = 0; IF (@rowCounter = 0) BEGIN insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'S' --Success ,0 as [MessageId] ,@TestCase as [MessagePart1] ,cast(NULL as nvarchar(100)) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure END ELSE BEGIN SET @Counter = 1; while ( @Counter <= @FindingRowCounter) BEGIN Select @Diff = Diff from #ComparisonResults where [RecordId] = @Counter; -- Select *from #ComparisonResults --where [RecordId] = @Counter; IF( @Diff & 1 = 1) BEGIN /* Case Column is on P not on Q i.e. Column has been deleted! */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'E' --Error ,10 /*Action required! Column [&1] has been deleted from Table [&2] on system [&3]!*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[TECH_NAME_SOURCESYSTEMOnQ] as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 2 = 2) BEGIN /* Case Column is on Q not on P i.e. Column has been added! */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,11 /*Column [&1] has been added to table [&2] on system [&3]*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[TECH_NAME_SOURCESYSTEMOnQ] as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 4 = 4 and @CheckPosition = 1 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* Position of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,12 /*Column [&1] of table [&2] has switched position*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 8 = 8 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* Key information of column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,12 /*Column [&1] of table [&2] has switched position*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 16 = 16 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* Data element of the column has chanaged */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,13 /*'DataElement of column [&1] of table [&2] has changed from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[ROLLNAMEOnQ] as [MessagePart3] ,[ROLLNAMEOnP] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 32 = 32 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the domain of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,14 /*'DataElement of column [&1] of table [&2] has changed from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[DomainOnQ] as [MessagePart3] ,[DomainOnP] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 64 = 64 and @CheckLowercase = 1 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the LowerCase setting of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,15 /*Lowercase Setting of column [&1] of table [&2] has changed from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[LOWERCASEOnQ] as [MessagePart3] ,[LOWERCASEOnP] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 128 = 128 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the Datatype of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'E' --Warning ,25 /*Action required! DataType of column [&1] of table [&2] has been changed from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[DataTypeOnP] as [MessagePart3] ,[DataTypeOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 256 = 256 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the Fieldsize of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],IIF([FieldLengthOnP] < [FieldLengthOnQ] , 'E', 'W') ,IIF([FieldLengthOnP] < [FieldLengthOnQ] ,16 /*Action required! Size of column [&1] of table [&2] has been increased from (&3) to (&4)*/ ,17 /*Size of column [&1] of table [&2] has been reduced from (&3) to (&4)*/) ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[FieldLengthOnP] as [MessagePart3] ,[FieldLengthOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 512 = 512 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the DataPrecision of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],IIF([DataPrecisionOnP] < [DataPrecisionOnQ] , 'E', 'W') ,IIF([DataPrecisionOnP] < [DataPrecisionOnQ] ,18 /*Action required! Fieldprecision of column [&1] of table [&2] has been increased from (&3) to (&4)*/ ,19 /*Fieldprecision of column [&1] of table [&2] has been reduced from (&3) to (&4)*/) ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[DataPrecisionOnP] as [MessagePart3] ,[DataPrecisionOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 1024 = 1024 and @CheckOutputLen = 1 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the Output length of the column has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,IIF([OUTPUTLENOnP] < [OUTPUTLENOnQ] ,20 /*OutputLength of column [&1] of table [&2] has been increased from (&3) to (&4)*/ ,21 /*OutputLength of column [&1] of table [&2] has been reduced from (&3) to (&4)*/) ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[OUTPUTLENOnP] as [MessagePart3] ,[OUTPUTLENOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 2048 = 2048 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the reference table for the colun has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,22 /*Reference table of column [&1] of table [&2] has been reduced from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[REFTABLEOnP] as [MessagePart3] ,[REFTABLEOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 4096 = 4096 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the reference Column for the colun has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,23 /*Reference column of column [&1] of table [&2] has been reduced from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[REFFieldOnP] as [MessagePart3] ,[REFFieldOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END IF( @Diff & 8192 = 8192 and @Diff & 1 = 0 and @Diff & 2 = 0) BEGIN /* the Description for the colun has changed */ SET @FindingCounter = @FindingCounter + 1; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK],[SourceSystem_PK],[RowId],[LoadDate],[AuditId],[Element],[FailureCount],[Value_BK],[ResultCode],[MessageId],[MessagePart1],[MessagePart2],[MessagePart3],[MessagePart4],[StoredProcedure]) SELECT @Usecase,@TestCase,COALESCE([TECH_NAME_SOURCESYSTEMOnP],[TECH_NAME_SOURCESYSTEMOnQ]),@FindingCounter,@LoadTimestamp,@AuditTrailId ,[TABNAME],1,[FIELDNAME],N'W' --Warning ,23 /*Description of column [&1] of table [&2] has been updated from (&3) to (&4)*/ ,[TABNAME] as [MessagePart1] ,[FIELDNAME] as [MessagePart2] ,[ColumnTextOnP] as [MessagePart3] ,[ColumnTextOnQ] as [MessagePart4] ,@StoredProcedure from #ComparisonResults where [RecordId] = @Counter; END SET @Counter = @Counter + 1; END END COMMIT --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @FindingCounter = @FindingCounter + 1; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; insert into [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[MessagePart1] ,[MessagePart2] ,[MessagePart3] ,[MessagePart4] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,@FindingCounter ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,cast(NULL as nvarchar(100)) as [Value_BK] ,N'E' --Error ,999 as [MessageId] /*Action required! TestCase (&1) execution ran into technical issues. Check log file in ExMeX (&2)'*/ ,@TestCase as [MessagePart1] ,left(@ProcessStatusMessage,100) as [MessagePart2] ,cast(NULL as nvarchar(100)) as [MessagePart3] ,cast(NULL as nvarchar(100)) as [MessagePart4] ,@StoredProcedure IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage DROP TABLE if exists #DDP; DROP TABLE if exists #DDQ; DROP TABLE if exists #SAPTable; DROP TABLE if exists #ComparisonResults; RETURN @ReturnProcessStatusNumber end"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GLAccountS4;975706924;V ;VIEW;2737;/**/ /* View: V_INTF_PNL_DIM_GLAccountS4 */ /**/ /* = */ /* V01.00.05 2023-03-31 Ilja Frolov GS/BDD1 & Yannick Sigwalt GS/BDD1 */ /* Parent Child Hierarchy for GL Account */ /* Data.CORE Outgoing Interface #0221 https://inside-docupedia.bosch.com/confluence/x/ahkdhg */ /* Restrictions: */ /* - IBM PA Interface Description https://inside-docupedia.bosch.com/confluence/x/wS--Ug */ /* Update: */ /* - V01.00.05 - Added business rule for column type */ /* - V01.00.04 - Removed generic paramter and renamed */ /* - V01.00.03 - Performance Optimization */ /* - V01.00.02 - Corrected datatype for Valid From and Valid To */ /* - V01.00.01 - Added Column NodeOrder */ /* - Filtered on [NodeTypeCode] not in 'D' (duplicates) */ /* - converted Child and Parent to expected output format */ /* - V01.00.00 Creation */ /* = */
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_CC;976214728;V ;VIEW;3322;/**/ /* View: V_INTF_REF_CC */ /**/ /* =*/ /* V01.00.00 2021-09-02 Yannick Sigwalt GS/BDD2 */ /* This view provide the list of Customer Country Combination C-C-ID for IFRS15 */ /* Data.CORE Outgoing Interface #0161 https://inside-docupedia.bosch.com/confluence/x/HafPcQ */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_TradingPartner;979078824;V ;VIEW;1260;/**/ /* View: V_INTF_PNL_DIM_TradingPartner */ /**/ /* = */ /* V01.00.00 2022-06-21 Michal Erdman */ /* Interface provides the trading partner data from SAP */ /* History: */ /* - V01.00.00: initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G2;981278951;V ;VIEW;6215;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G2 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_V2_O1;983374968;V ;VIEW;2250;/**/ /* View: V_FactActualCost_Short_B2 */ /**/ /**/ /* V01.00.01 2022-03-06 Kessler Waldemar CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_WBSElement;991706981;V ;VIEW;4418;/**/ /* View: V_INTF_PNL_DIM_WBSElement */ /**/ /* = */ /* V01.01.00 2023-04-06 Yannick Sigwalt GS/BDD1 & Patrik Just CI/DAV2.3 */ /* This view retrieves the texts for WBSElements from different source systems */ /* Data.CORE Outgoing Interface #0054 https://inside-docupedia.bosch.com/confluence/x/SLp9Vg */ /* Restrictions: */ /* - Current systems G0,G1,G2,G3,G4,G5,G6,C3,S3,B2 */ /* Update: */ /* - V01.00.02 View recreated and switched to current CO-PA Model */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CompanyCode_ATTR;996510929;V ;VIEW;8835;/**/ /* View: V_INTF_PNL_DIM_CompanyCode_ATTR */ /**/ /* = */ /* V 01.00.01 2022-10-20 Jakub Kozlowski & Ilja Frolov GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view retreieves the text for Legal Entities and CompanyCodes */ /* - Text for Legal Entities is composed of Short and Long Text */ /* Update */ /* - V01.00.02: -Added CompanyCodeCurrency cte in order to incorporate new Currency attribute to */ /* the view. The source is CompanyCodeDescription_WSAT0_G0_X */ /* -Fixed issue with empty Description for CompanyCodeText and CompanyCodeCountry */ /* - V01.00.01:Changed Source for Legal Entity from LegalEntity_WSAT0_M2_X(V_STAG_RB0M_XR_107_M2)*/ /* to RBCustomerLegalEntityAttribute_WSATM_M2_X (V_STAG_RB9X_MD4R_164_M2_V2). */ /* old Source ..RB0M_XR_107_M2 not maintained on Ref-MDS any more */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G3;997279008;V ;VIEW;6215;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G3 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G0;999062695;V ;VIEW;10269;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 11.09.2020 11:07:22 */ /**/ /* if exists (select 1 from sysobjects where id = object_id('INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G6') and type = 'V') drop view INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G6 go if exists (select 1 from sysobjects where id = object_id('INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G5') and type = 'V') drop view INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G5 go if exists (select 1 from sysobjects where id = object_id('INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G4') and type = 'V') drop view INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G4 go if exists (select 1 from sysobjects where id = object_id('INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G0') and type = 'V') drop view INFI_Costs_SSAS_CSC2.V_MaintenanceOrder_V2_IDIM1_G0 go */ /**/ /* View: V_MaintenanceOrder_V3_IDIM1_G0 */ /**/ /**/ /* V01.02.01 - 2020-08-26 Tatjana Derdus CI/DAV2.3 */ /* New view Dimension Maintenance based on optimized data model for SAPPOE */ /* Update: */ /* - V01.00.00: Initial version */ /* - V01.01.00: Adjust MaintenanceOrderId to trim variable number of leading zeros */ /* - V01.02.00: Make independent of LanguageCode; Use BasicStart/End DateId instead of Date */ /* - V01.02.01: Make Dummy-Record (DimId = 0) exclusive for view of leading system (POE/G0) */ /* - V01.03.00: Add column FunctionalLocationDimId */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefCostCenterReportingCurrency_V1_IREF0;1003918698;V ;VIEW;1247;/**/ /* View: V_RefCostCenterReportingCurrency_V1_IREF0 */ /**/ /**/ /* V01.00.01 - 2020-07-16 - Tatjana Derdus CI/DAV2.3 */ /* Reference view for ReportingCurrency in CostCenter reporting */ /* Update: */ /* - V01.00.00: 2019-12-05 - SYA8FE - Initial version */ /* - V01.00.01: 2020-07-16 - DTD7FE - Renamed view & moved to scheme INFI_Costs_SSAS_CSC2 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Product_iGPM;1007707038;V ;VIEW;1889;/**/ /* View: V_INTF_PNL_DIM_Product_iGPM */ /**/ /* = */ /* V01.00.02 2023-04-17 URA1FE & Patrik Just CI/DAV2.3 */ /* Interface provides RB product hierarchy as a parent child relation. */ /* Contained levels ProductClass, ProductSubClass, StatisticGroup, Material */ /* Restrictions: */ /* - Filter on WORKING SET Edition and Material States: '10','11','20','30','35','49' */ /* - Material / Product Hierarchy relations is provided by iGPM and GPM (AS) */ /* Update: */ /* -V01.00.02 Changed description in regards of Material state filter criteria */ /* -V01.00.01 Add prefix for hierarchy only */ /* = */
INFI_IFRS15_TM1_CSC1;81;INFormation Mart as Interface;V_INTF_REF_ProfitCenter;1008214842;V ;VIEW;1510;/**/ /* View: V_INTF_REF_ProfitCenter */ /**/ /* =*/ /* V01.00.00 2021-09-02 Yannick Sigwalt GS/BDD2 */ /* This view provide the list of ProfitCenter for IFRS15 */ /* Data.CORE Outgoing Interface #0163 https://inside-docupedia.bosch.com/confluence/x/OqfPcQ */ /* Update: */ /* */ /* Restriction: */ /* None */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G4;1013279065;V ;VIEW;6215;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;uspLoadBRGActualCostMaintenanceOrder;1013734814;P ;SQL_STORED_PROCEDURE;24024;"CREATE Procedure [INFI_Costs_SSAS_CSC2].[uspLoadBRGActualCostMaintenanceOrder] ( @SourceSystem VARCHAR(10) , @SourceSystemVar varchar(10) ) AS BEGIN /* Declare variables , Set variables Example : @YearMonth = 201901 , 201902 Example : @SourceSystem = 'SAPP87' , 'SAPP81' Example : @SourceSystemVar = 'G5' , 'G4' */ DECLARE @Counter INT ; DECLARE @maxCounter INT ; DECLARE @minCounter INT ; DECLARE @RC int ; DECLARE @YearMonth int ; DECLARE @SourceOfData varchar(30) = 'COCostActual'; DECLARE @ConsumerOfData varchar(30) = 'PerFact_CostMaintenance' DECLARE @DateTimeStart DATETIME2(7); DECLARE @DateTimeEnd DATETIME2(7); DECLARE @RowsInserted INT; /* --Sample Test Select [YearMonthCreation] INTO #PartitionList FROM ( SELECT 202001 AS [YearMonthCreation] UNION SELECT 202002 AS [YearMonthCreation] UNION SELECT 202003 AS [YearMonthCreation] UNION SELECT 202004 AS [YearMonthCreation] UNION SELECT 202005 AS [YearMonthCreation] UNION SELECT 202006 AS [YearMonthCreation] UNION SELECT 202007 AS [YearMonthCreation] UNION SELECT 202008 AS [YearMonthCreation] UNION SELECT 202009 AS [YearMonthCreation] UNION SELECT 202010 AS [YearMonthCreation] UNION SELECT 202011 AS [YearMonthCreation] UNION SELECT 202012 AS [YearMonthCreation] UNION SELECT 202101 AS [YearMonthCreation] UNION SELECT 202102 AS [YearMonthCreation] UNION SELECT 202103 AS [YearMonthCreation] ) T */ SELECT DISTINCT [YearMonthCreation] INTO #PartitionList FROM [MEAM_DataCORE_CSC1].[V_DeltaLoadSourceSystemByYearMonthCreation] Where [SourceSystem] = @SourceSystemVar AND [SourceOfData] = @SourceOfData AND [ConsumerOfData] = @ConsumerOfData ORDER BY [YearMonthCreation] ASC ; Select @Counter = COUNT(*) FROM #PartitionList; IF ( @Counter > 0 ) BEGIN SET @maxCounter = (SELECT COUNT(1) AS CountRows FROM #PartitionList) SET @minCounter = 1 WHILE (@minCounter <= @maxCounter) BEGIN SET @DateTimeStart = SYSUTCDATETIME() SET @YearMonth = (SELECT TOP(1) [YearMonthCreation] FROM #PartitionList) Declare @TruncateSQL NVARCHAR(500) = 'Truncate Table [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] ;' EXECUTE sp_executesql @TruncateSQL; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_0 NVARCHAR(1500) = '' DECLARE @SQL_1 NVARCHAR(1500) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(1500) = '' DECLARE @SQL_4 NVARCHAR(1500) = '' DECLARE @SQL_5 NVARCHAR(1500) = '' DECLARE @SQL_6 NVARCHAR(1500) = '' DECLARE @SQL_7 NVARCHAR(MAX) = '' /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Collect the required cost centers , maintenenace orders --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL_0 = ' Select mo2ccoll_wl.MaintenanceOrder_HK, mo2ccoll_wl.CostCollector_HK Into #orders FROM [RAWV_COOM_CSC1].[MaintenanceOrder_WHUB0] mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCollector_WLNK0] as mo2ccoll_wl ON ( mo2ccoll_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] ) INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_bo on ccoll_wh_bo.[CostCollector_HK] = mo2ccoll_wl.[CostCollector_HK] Where mo_wh.SAPSystem = ''' + @SourceSystem + ''' ; ALTER TABLE #orders ADD CONSTRAINT C_IX_MAINTENANCE_ORDERS_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED (CostCollector_HK,[MaintenanceOrder_HK]) ; ' SET @SQL_1 = ' Select cocad2bo_wl.COCostActualDocumentLineItem_HK, cocad2bo_wl.COCostActualDocumentHeader_HK, cocad2bo_wl.CostElementByControllingArea_HK, cocad2bo_wl.CostCollector_HK, ord.MaintenanceOrder_HK Into #link FROM #orders ord INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WLNK0] AS cocad2bo_wl ON cocad2bo_wl.CostCollector_HK = ord.CostCollector_HK INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WSATE_' + @SourceSystemVar + '_L] AS cocad2bo_wse_l ON ( cocad2bo_wl.COCostActualDocumentToBookedObject_HK = cocad2bo_wse_l.COCostActualDocumentToBookedObject_HK AND cocad2bo_wse_l.[LoadEndDate]= cast(''2999-12-31'' as datetime2) ) Where cocad2bo_wse_l.YearMonthCreation = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #link ADD CONSTRAINT C_IX_COCostActualDocumentToBookedObject_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK],[COCostActualDocumentHeader_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required Equipments,Responsible Cost Centers,basic settlement Cost Centers. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_2 = ' Create table #MaintenenaceOrders ( MaintenanceOrder_HK binary(20) NOT NULL, EquipmentDimId INT NOT NULL, ResponsibleCostCenterDimId INT NOT NULL, CostCenterforBasicSettlementDimId INT NOT NULL ); ALTER TABLE #MaintenenaceOrders ADD CONSTRAINT C_IX_MaintenenaceOrders_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([MaintenanceOrder_HK]) ; With cte as ( Select Distinct MaintenanceOrder_HK from #link ) INSERT INTO #MaintenenaceOrders ( MaintenanceOrder_HK,EquipmentDimId,ResponsibleCostCenterDimId,CostCenterforBasicSettlementDimId ) Select MaintenanceOrder_HK , COALESCE( [Equipment_HK] , 0 ) AS EquipmentDimId, COALESCE( [Responsible_HK] , 0 ) AS ResponsibleCostCenterDimId, COALESCE( [BasicSettlement_HK] , 0) AS CostCenterforBasicSettlementDimId From ( Select mo2io_wl.MaintenanceOrder_HK, COALESCE(edi_bs_x.[DimensionId], 0) As Ref_HK , OrderType=''Equipment_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToInternalOrder_WLNK0] as mo2io_wl INNER JOIN cte mo_wh on mo2io_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[InternalOrder_WHUB0] io_wh on io_wh.[InternalOrder_HK] = mo2io_wl.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WLNK0] io2e_wl on io2e_wl.[InternalOrder_HK] = io_wh.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WSATE_' + @SourceSystemVar + '_X] io2e_ws_x on io2e_ws_x.[InternalOrderToEquipment_HK] = io2e_wl.[InternalOrderToEquipment_HK] and io2e_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_Production_MD_CSC1].[Equipment_WHUB0] e_wh on e_wh.[Equipment_HK] = io2e_wl.[Equipment_HK] INNER JOIN [BUSV_Production_MD_CSC1].[Equipment_DimensionId_BSATC_XX_X] edi_bs_x on edi_bs_x.[Equipment_HK] = e_wh.[Equipment_HK] Union All Select mo2rccent_wl.MaintenanceOrder_HK, COALESCE(ccentdi_bs_x.DimensionID, 0) As Ref_HK, OrderType=''Responsible_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WLNK0] as mo2rccent_wl INNER JOIN cte mo_wh on mo2rccent_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WSATE_' + @SourceSystemVar + '_X] mo2rccent_ws_x on mo2rccent_ws_x.[MaintenanceOrderToResponsibleCostCenter_HK] = mo2rccent_wl.[MaintenanceOrderToResponsibleCostCenter_HK] and mo2rccent_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = mo2rccent_wl.[ResponsibleCostCenter_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x on ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] Union All Select mo2ccentbs_wl.MaintenanceOrder_HK, COALESCE(ccentdi_bs_x.DimensionID, 0) As Ref_HK , OrderType = ''BasicSettlement_HK'' From [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WLNK0] as mo2ccentbs_wl INNER JOIN cte mo_wh on mo2ccentbs_wl.MaintenanceOrder_HK = mo_wh.MaintenanceOrder_HK INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WSATE_' + @SourceSystemVar + '_X] mo2ccentbs_ws_x on mo2ccentbs_ws_x.[MaintenanceOrderToCostCenterBasicSettlement_HK] = mo2ccentbs_wl.[MaintenanceOrderToCostCenterBasicSettlement_HK] and mo2ccentbs_ws_x.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = mo2ccentbs_wl.[CostCenterBasicSettlement_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x on ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) AS S PIVOT ( MAX(Ref_HK) FOR [OrderType] IN ([Equipment_HK],[Responsible_HK],[BasicSettlement_HK]) ) AS PVT ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_3 = ' ;With cte as ( Select Distinct COCostActualDocumentHeader_HK from #link ) SELECT cocadh_ws0.[COCostActualDocumentHeader_HK] , cocadh_ws0.[PostingDate] , cocadh_ws0.[DocumentDate] , CAST( cocadh_ws0.[DateTimeDocumentWasCreated] AS DATE ) AS EntryDate , cocadh_ws0.[IsReversalBooking] , cocadh_ws0.[IsReversedBooking] , cocadh_ws0.[ControllingAreaCurrencyCode] , cocadhdi_bs_x.[DimensionId] AS [DocumentNumberDimId] INTO #TempHeaderItems FROM cte cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentHeader_WSAT0_' + @SourceSystemVar + '_L] cocadh_ws0 ON cocadh_ws0.COCostActualDocumentHeader_HK=cte.COCostActualDocumentHeader_HK INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentHeaderDimensionId_BSATC_XX_X] cocadhdi_bs_x ON cocadh_ws0.COCostActualDocumentHeader_HK = cocadhdi_bs_x.COCostActualDocumentHeader_HK WHERE cocadh_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadh_ws0.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_HEADERITEMS_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentHeader_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_4 = ' SELECT cocadli2po_wl.COCostActualDocumentLineItem_HK , ccoll_wh_po.CostCollectorObject_BK , COALESCE(cocodis.DimensionId,0) AS PartnerObjectDimId INTO #partnerAndBookedObject FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WLNK0] cocadli2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WSATE_' + @SourceSystemVar + '_L] cocadli2po_wse_l ON cocadli2po_wl.COCostActualDocumentLineItemToPartnerObject_HK = cocadli2po_wse_l.COCostActualDocumentLineItemToPartnerObject_HK AND cocadli2po_wse_l.[LoadEndDate] = cast(''2999-12-31'' as datetime2) Inner Join #link as hub on hub.COCostActualDocumentLineItem_HK = cocadli2po_wl.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.CostCollector_HK = cocadli2po_wl.CostCollector_HK INNER JOIN BUSV_RB_CSC1.CostCollectorDimensionId_BSATC_XX_X cocodis ON cocodis.CostCollector_HK = ccoll_wh_po.CostCollector_HK WHERE cocadli2po_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #partnerAndBookedObject ADD CONSTRAINT C_IX_PartnerObject_WLNK0_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]); ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Purchase order objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_5 = ' SELECT cocadli2po_wl.COCostActualDocumentLineItem_HK , COALESCE(polidis.DimensionId,0) AS PurchaseOrderLineItemDimId INTO #purchaseOrderObject FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPurchaseOrder_WLNK0] cocadli2po_wl INNER JOIN [BUSV_PUR_CSC2].[PurchaseOrderLineItemDimensionId_BSATC_XX_X] polidis ON polidis.PurchaseOrderLineItem_HK = cocadli2po_wl.PurchaseOrderLineItem_HK INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPurchaseOrder_WSATE_' + @SourceSystemVar + '_L] cocadli2po_wse_l ON cocadli2po_wl.[COCostActualDocumentLineItemToPurchaseOrder_HK] = cocadli2po_wse_l.[COCostActualDocumentLineItemToPurchaseOrder_HK] AND cocadli2po_wse_l.[LoadEndDate] = cast(''2999-12-31'' as datetime2) --testing Inner Join #link as hub on hub.COCostActualDocumentLineItem_HK = cocadli2po_wl.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_PUR_CSC2].[PurchaseOrderHeader_WHUB0] ccoll_wh_po ON ccoll_wh_po.[PurchaseOrderHeader_HK] = cocadli2po_wl.[PurchaseOrderHeader_HK] INNER JOIN [BUSV_PUR_CSC2].[PurchaseOrderHeaderDimensionId_BSATC_XX_L] cocodis ON cocodis.[PurchaseOrderHeader_HK] = ccoll_wh_po.[PurchaseOrderHeader_HK] WHERE cocadli2po_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #purchaseOrderObject ADD CONSTRAINT C_IX_PurchaseOrder_WLNK0_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]); '; /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Material objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_6 = ' SELECT link.[COCostActualDocumentLineItem_HK] , COALESCE(bsat.[DimensionId],0) AS MaterialDimId INTO #material FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WLNK0] link INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WSATE_' + @SourceSystemVar + '_L] sat ON link.[COCostActualDocumentLineItemToMaterial_HK] = sat.[COCostActualDocumentLineItemToMaterial_HK] INNER JOIN #link as hub on hub.COCostActualDocumentLineItem_HK = link.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = link.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_' + @SourceSystemVar + '_X] bsat ON bsat.[Material_HK] = m_wh.[Material_HK] WHERE sat.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND sat.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) ; ALTER TABLE #material ADD CONSTRAINT C_IX_Materials_MT_P_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- INSERT result set into TEMP Fact-Table. This result set will then be SWITCHED into the target Fact-Table. Example... [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_G5_Temp] will be switched to [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_G5] --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_7 = CAST('' AS NVARCHAR(MAX)) + ' INSERT INTO [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] Select ' + CAST( @YearMonth as VARCHAR(6)) + ' AS YearMonthCreation ,iomodi_bs_x.[DimensionId] AS MaintenanceOrderDimId ,cocadh_ws0.DocumentNumberDimId AS COActualCostsDocumentNumberDimId ,cocadlidi_bs_x.[DimensionId] AS COActualCostsDocumentItemDimId ,cocadli_wh.[COCostActualDocumentHeader_BK] AS COActualCostsDocumentNumberId ,cocadli_wh.[COCostActualDocumentLineItem_BK] AS COActualCostsDocumentItemId , ''' + @SourceSystem + ''' AS SourceSystem ,coalesce(cebcadi_bsc_x.[DimensionID],0) AS CostElementbyControllingAreaDimId ,COALESCE(MO.ResponsibleCostCenterDimId, 0) AS ResponsibleCostCenterDimId ,COALESCE(MO.CostCenterforBasicSettlementDimId, 0) AS CostCenterforBasicSettlementDimId ,COALESCE(MO.EquipmentDimId, 0) AS EquipmentDimId ,COALESCE(Concat(cocadli_bs_l.[DebitCreditCode],''_'',cocadli_bs_l.[StatisticalIndicator],''_ACT_'', COALESCE(IIF(prt.[CostCollectorObject_BK] <> '' '', left(prt.[CostCollectorObject_BK],2), NULL),N''0'') ), N''0'' ) as JunkDimId ,CONCAT(cocadli_ws0.[FiscalYear],cocadli_ws0.[Period]) AS PostingPeriodYearId ,CAST(convert (char(8),cocadh_ws0.EntryDate,112) AS int) AS EntryDateId ,material.MaterialDimId ,prt.PartnerObjectDimId ,pur.PurchaseOrderLineItemDimId ,Coalesce(cocadli_ws0.[OffsettingAccountNumber],'''') AS OffsetAccount ,cocadh_ws0.EntryDate AS EntryDate ,cocadh_ws0.[DocumentDate] AS DocumentDate ,cocadh_ws0.[PostingDate] AS PostingDate ,cocadli_ws0.[COBusinessTransaction] AS COBusinessTransaction ,Coalesce(cocadh_ws0.[IsReversedBooking],'''') AS DocumentWasReversed ,Coalesce(cocadh_ws0.[IsReversalBooking],'''') AS DocumentisReversalDocument ,cocadli_ws0.[ControllingAreaTotalAmount] AS TotalAmountCOAreaCurrency ,cocadli_ws0.[ControllingAreaFixedAmount] AS FixedAmountCOAreaCurrency ,cocadh_ws0.[ControllingAreaCurrencyCode] AS COAreaCurrencyCode ,cocadli_ws0.[TransactionTotalAmount] AS TotalAmountTransactionCurrency ,cocadli_ws0.[TransactionCurrency] AS TransactionCurrencyCode ,cocadli_ws0.[ObjectTotalAmount] AS TotalAmountObjectCurrency ,cocadli_ws0.[ObjectCurrency] AS ObjectCurrencyCode --,cocadli_ws0.[TotalQuantity] AS TotalQuantity --,cocadli_ws0.[FixedQuantity] AS FixedQuantity --,Coalesce(cocadli_ws0.[UnitofMeasure],'''') AS UnitOfMeasure ,cocadli_ws0.[EnteredTotalQuantity] AS TotalQuantity ,cocadli_ws0.[EnteredFixedQuantity] AS FixedQuantity ,Coalesce(cocadli_ws0.[UnitOfEntry],'''') AS UnitOfMeasure FROM #link bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WHUB0] cocadli_wh ON cocadli_wh.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WSAT0_' + @SourceSystemVar + '_L] cocadli_ws0 ON cocadli_ws0.[COCostActualDocumentLineItem_HK] = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentLineItem_BSAT0_' + @SourceSystemVar + '_L] cocadli_bs_l ON cocadli_bs_l.[COCostActualDocumentLineItem_HK] = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentLineItemDimensionId_BSATC_XX_X] cocadlidi_bs_x on cocadlidi_bs_x.[COCostActualDocumentLineItem_HK] = cocadli_wh.[COCostActualDocumentLineItem_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bsc_x on cebcadi_bsc_x.[CostElementByControllingArea_HK] = bo.[CostElementByControllingArea_HK] INNER JOIN #TempHeaderItems cocadh_ws0 ON bo.COCostActualDocumentHeader_HK = cocadh_ws0.COCostActualDocumentHeader_HK LEFT OUTER JOIN #MaintenenaceOrders MO ON MO.MaintenanceOrder_HK = bo.MaintenanceOrder_HK INNER JOIN [BUSV_COOM_CSC1].[MaintenanceOrderDimensionId_BSATC_XX_X] iomodi_bs_x on bo.[MaintenanceOrder_HK] = iomodi_bs_x.[MaintenanceOrder_HK] LEFT OUTER JOIN #partnerAndBookedObject prt on prt.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] LEFT OUTER JOIN #purchaseOrderObject pur on pur.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] LEFT OUTER JOIN #material material ON material.COCostActualDocumentLineItem_HK = bo.COCostActualDocumentLineItem_HK WHERE cocadli_wh.[SAPSystem] = ''' + @SourceSystem + ''' AND cocadli_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadli_ws0.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) AND cocadli_bs_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadli_bs_l.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2); ' SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = @SQL + @SQL_0 + @SQL_1 + @SQL_2 + @SQL_3 + @SQL_4 + @SQL_5 + @SQL_6 + @SQL_7 ; --Select @SQL_7 EXECUTE sp_executesql @SQL; SET @DateTimeEnd = SYSUTCDATETIME() DECLARE @PartitionNumber INT ; SELECT @PartitionNumber = partition_number, @RowsInserted = [rows] FROM sys.partitions as par WHERE ( par.object_id = OBJECT_ID('INFI_Costs_SSAS_CSC2.ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp') ) And ([rows] > 0 ); IF ( @PartitionNumber IS NOT NULL ) BEGIN SET @TruncateSQL = ' TRUNCATE TABLE [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '] WITH (PARTITIONS(' + Cast(@PartitionNumber as varchar(4)) + ')) ; ALTER TABLE [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '_Temp] SWITCH PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' TO [INFI_Costs_SSAS_CSC2].[ActualCostMaintenanceOrder_BRG_' + @SourceSystemVar + '] PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' ; ' EXECUTE sp_executesql @TruncateSQL; /* Call the procedure to inform the successful loading of the data for the selected partition*/ DECLARE @return_value int ; EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar, @SourceOfData = @SourceOfData, @ConsumerOfData = @ConsumerOfData, @YearMonthCreation = @YearMonth, @StartDateTime = @DateTimeStart, @EndDateTime = @DateTimeEnd, @RowsInserted = @RowsInserted; ; END SET @minCounter = @minCounter + 1 ; DELETE TOP(1) FROM #PartitionList ; END DROP TABLE #PartitionList ; END END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G4;1015062752;V ;VIEW;9050;"/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G4 */ /**/ /**/ /* V01.02.01 - 2020-08-26 Tatjana Derdus CI/DAV2.3 */ /* New view Dimension Maintenance based on optimized data model for SAPP81 */ /* Update: */ /* - V01.00.00: Initial version (2020-03-30) */ /* - V01.00.01: Cast BasicStartDate and BasicEndDate as Date */ /* - V01.01.00: Adjust MaintenanceOrderId to trim variable number of leading zeros */ /* - V01.02.00: Make independent of LanguageCode; Use BasicStart/End DateId instead of Date */ /* - V01.02.01: Make Dummy-Record (DimId = 0) exclusive for view of leading system (POE/G0) */ /* - V01.03.00: Add column FunctionalLocationDimId */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefCostCenterReportingScenarioBP_V1_IREF0;1019918755;V ;VIEW;1141;/**/ /* View: V_RefCostCenterReportingScenarioBP_V1_IREF0 */ /**/ /**/ /* V01.00.01 - 2020-07-16 - Tatjana Derdus CI/DAV2.3 */ /* Reference view for BP-Scenarios in CostCenter reporting */ /* Update: */ /* - V01.00.00: 2019-07-30 - SHH4FE - Initial version */ /* - V01.00.01: 2020-07-16 - DTD7FE - Renamed view & moved to scheme INFI_Costs_SSAS_CSC2 */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_ECPCA_CS_V2;1023707095;V ;VIEW;2075;/**/ /* View: V_INTF_PNL_FACT_ECPCA_CS_V2 */ /**/ /* =*/ /* V01.00.01 2023-03-31 Ilja Frolov GS/BDD1 & Yannick Sigwalt GS/BDD1 */ /* Transactional data for TM1 */ /* Outgoing Interface #0057 https://inside-docupedia.bosch.com/confluence/x/e8J9Vg */ /* This view is used as interface between persisted fact table INTF_PNL_FACT_ECPCA_CS_V2 */ /* and consuming TM1 application of P&L.Series */ /* Restrictions: */ /* This view should be only used for fact data loading between Data.CORE and TM1 Input cube */ /* -------------------------------------------------------------------------------------------------------- */ /* updated */ /* - 01.00.01 - Changed WBSElement to internal WBS Element */ /* - 01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G5;1029279122;V ;VIEW;6219;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G5 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G5;1031062809;V ;VIEW;9050;"/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G5 */ /**/ /**/ /* V01.02.01 - 2020-08-26 Tatjana Derdus CI/DAV2.3 */ /* New view Dimension Maintenance based on optimized data model for SAPP87 */ /* Update: */ /* - V01.00.00: Initial version (2020-03-30) */ /* - V01.00.01: Cast BasicStartDate and BasicEndDate as Date */ /* - V01.01.00: Adjust MaintenanceOrderId to trim variable number of leading zeros */ /* - V01.02.00: Make independent of LanguageCode; Use BasicStart/End DateId instead of Date */ /* - V01.02.01: Make Dummy-Record (DimId = 0) exclusive for view of leading system (POE/G0) */ /* - V01.03.00: Add column FunctionalLocationDimId */ /**/"
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_DimProduct_V2;1034851149;V ;VIEW;10038;"/**/ /* View: V_INTF_PNL_GM1_DimProduct_V2 */ /**/ /* */ /* V01.00.03 2023-05-08 URA1FE & DTD7FE */ /* This view provides the product hierarchy and material data for Profit&Loss.GM1Analysis */ /* Moreover this view extracts some master data from facts data, which is not recommended */ /* Data.CORE Outgoing Interface #0174 https://inside-docupedia.bosch.com/confluence/x/3BnAcw */ /* Changes: */ /* - V01.00.03 Added products from iGPM; Adjusted view name suffix to ""V2"" */ /* - V01.00.02 Added fields [ProductHierarchySubClassDescriptionInEnglish] and */ /* [ProductHierarchyClassDescriptionInEnglish] */ /* - V01.00.01 Removed PERIO and MaterialByDivisionAndProfitCenter_rank, added field WW02 */ /* - V01.00.00 Created View - initial version */ /* */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefCostCenterReportingScenarioCF_V1_IREF0;1035918812;V ;VIEW;1141;/**/ /* View: V_RefCostCenterReportingScenarioCF_V1_IREF0 */ /**/ /**/ /* V01.00.01 - 2020-07-16 - Tatjana Derdus CI/DAV2.3 */ /* Reference view for CF-Scenarios in CostCenter reporting */ /* Update: */ /* - V01.00.00: 2019-07-30 - SHH4FE - Initial version */ /* - V01.00.01: 2020-07-16 - DTD7FE - Renamed view & moved to scheme INFI_Costs_SSAS_CSC2 */ /**/
INFI_PnLService_TM1_CSC2;118;INFormation Mart as Interface;V_PnL_Service_COPA_CCI_V1_MFCT0_D7;1039707152;V ;VIEW;2813;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 14.04.2023 13:16:46 */ /**/ /**/ /* View: V_PnL_Service_COPA_CCI_V1_MFCT0_D7 */ /**/ /* = */ /* V01.00.01 - 2023-04-14 URA1FE */ /* This View points to the PnL.Service Persisted Fact Data of CO-PA for D7 */ /* Data.CORE Outgoing Interface #0267 https://inside-docupedia.bosch.com/confluence/x/9ZYyp */ /* Implemented Soft Rules: */ /* Restriction: */ /* - Tailored loading for PnL.Service only, no reuse intended */ /* - Covered sources: D7 */ /* - Used for loading of PnL.Service Input Cube and Dillthrough from application to Data.CORE */ /* */ /* Update: */ /* - V01.00.00: Added column KSTRG */ /* - V01.00.00: Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_ICPartner;1040878925;V ;VIEW;1372;/**/ /* View: V_INTF_PNL_DIM_ICPartner */ /**/ /* =*/ /* V01.00.00 2021-05-18 Yannick Sigwalt GS/BDO12 */ /* Interface provides Parent/Child Hierarchy for ICPartner Dimension */ /* Data.CORE Outgoing Interface #0142 https://inside-docupedia.bosch.com/confluence/x/_iJyZg */ /* Update: */ /* Restriction: */ /* - none */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_TradingPartner_ATTR;1043079052;V ;VIEW;1531;/**/ /* View: V_INTF_PNL_DIM_TradingPartner_ATTR */ /**/ /* = */ /* V01.00.01 2022-06-23 Michal Erdman */ /* Interface provides the trading partner attributes data from SAP */ /* History: */ /* - V01.00.01: removed condition on LanguageCode */ /* - V01.00.00: initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G6;1045279179;V ;VIEW;6222;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G6 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G6;1047062866;V ;VIEW;8955;"/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G6 */ /**/ /**/ /* V01.02.01 - 2020-08-26 Tatjana Derdus CI/DAV2.3 */ /* New view Dimension Maintenance based on optimized data model for SAPP99 */ /* Update: */ /* - V01.00.00: Initial version */ /* - V01.01.00: Adjust MaintenanceOrderId to trim variable number of leading zeros */ /* - V01.02.00: Make independent of LanguageCode; Use BasicStart/End DateId instead of Date */ /* - V01.02.01: Make Dummy-Record (DimId = 0) exclusive for view of leading system (POE/G0) */ /* - V01.03.00: Add column FunctionalLocationDimId */ /**/"
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount;1050590931;V ;VIEW;11833;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 19.02.2021 08:55:09 */ /**/ /**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount */ /**/ /* =*/ /* V01.00.00 2021-02-18 Yannick Sigwalt GS/BDO12 */ /* This view provide the Cost Element Hierarchy in Parent/Child format for Pnl Consumer PT */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_DimProduct_V3;1050851206;V ;VIEW;13634;"/**/ /* View: V_INTF_PNL_GM1_DimProduct_V3 */ /**/ /* */ /* V01.00.04 2023-05-24 FRI3SH, URA1FE & DTD7FE */ /* This view provides the product hierarchy and material data for Profit&Loss.GM1Analysis */ /* Moreover this view extracts some master data from facts data, which is not recommended */ /* Data.CORE Outgoing Interface #0174 https://inside-docupedia.bosch.com/confluence/x/3BnAcw */ /* Changes: */ /* - V01.00.04 Added MaterialDescription; Adjusted view name suffix to ""V3"" */ /* - V01.00.03 Added products from iGPM; Adjusted view name suffix to ""V2"" */ /* - V01.00.02 Added fields [ProductHierarchySubClassDescriptionInEnglish] and */ /* [ProductHierarchyClassDescriptionInEnglish] */ /* - V01.00.01 Removed PERIO and MaterialByDivisionAndProfitCenter_rank, added field WW02 */ /* - V01.00.00 Created View - initial version */ /* */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_B4;1054887075;V ;VIEW;2271;/**/ /* View: V_FactActualCost_D0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G3;1055707209;V ;VIEW;16799;/**/ /* View: V_ResultPlan_V1_IFCT0_G3 */ /**/ /* =*/ /* V01.00.05 2023-04-04 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Corrected Copy/Paste Issue in satellite name */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_TransactionType;1059079109;V ;VIEW;1398;/**/ /* View: V_INTF_PNL_DIM_TransactionType */ /**/ /* = */ /* V01.00.01 2022-06-23 Michal Erdman */ /* Interface provides the transaction type data from SAP */ /* History: */ /* - V01.00.01: added condition: LanguageCode='EN' */ /* - V01.00.00: initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G3;1060407047;V ;VIEW;1281;/**/ /* View: V_BridgeSparePartToFact_IDIM1_G3 */ /**/ /**/ /* V01.00.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P79 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G3] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Bridge Spare Part To Fact_IDIM1_G0 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_V2_G4_DemoSystem;1061279236;V ;VIEW;7923;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G4 */ /*=*/ /**/ /* V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from POE */ /* Changes: */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_COREWriter_PnL_CSC1;62;INFormation Mart as Interface;V_INTF_GLAccountMappingAS2POE_ValidationASAccount;1063062923;V ;VIEW;1187;/**/ /* View: V_INTF_GLAccountMappingAS2POE_ValidationASAccount */ /**/ /* =*/ /* V01.00.01 2020-09-11 Patrik Just CI/DAV2.3 & Yannick SIgwalt GS/BDO12 */ /* This view provide CORE.Writer the information about valid GL Accounts from AS source */ /* Restriction: */ /* - */ /* Changes: */ /* - V01.00.01 - Replaced Temporary Solution through select on [RAWV_RB_CSC1].[GLAccount_GPM_WHUB0] */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostElement_CDP;1065367160;V ;VIEW;1914;/**/ /* View: V_INTF_COOM_Costs_DIM_CostElement_CDP */ /**/ /* =*/ /* V00.00.03 2021-08-26 Ismail Okadia */ /* This view provides the parent child hierarchy of CostElement for CDP */ /* Restriction: */ /* Currently, only CostElement hierarchies 'RB-E' & 'RB-E-LOG' are used */ /* Changes: */ /* V00.00.03 - Use function for hierarchy, function uses [RefCDPHierarchyApplicationControl_WREF0] */ /* V00.00.02 - Replace hierarchy list by control table [RefCDPHierarchyApplicationControl_WREF0] */ /* V00.00.01 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_B4;1070887132;V ;VIEW;1035;
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_ReportingEntity;1072879039;V ;VIEW;1937;/**/ /* View: V_INTF_PNL_DIM_ReportingEntity */ /**/ /* =*/ /* V01.00.00 2021-05-18 Yannick Sigwalt GS/BDO12 */ /* Interface provides Parent/Child Hierarchy for ReportingEntity Dimension */ /* Data.CORE Outgoing Interface #0143 https://inside-docupedia.bosch.com/confluence/x/LkZyZg */ /* Update: */ /* Restriction: */ /* - none */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_TransactionType_ATTR;1075079166;V ;VIEW;1300;/**/ /* View: V_INTF_PNL_DIM_TransactionType_ATTR */ /**/ /* = */ /* V01.00.00 2022-06-21 Michal Erdman */ /* Interface provides the transaction type attributes data from SAP */ /* History: */ /* - V01.00.00: initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G3;1076407104;V ;VIEW;8044;/**/ /* View: V_Equipment_V3_IDIM1_G3 */ /**/ /*=*/ /* V01.00.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-09 Initial version copied from V_Equipment_V3_IDIM1_G0 */ /*=*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_O1;1086887189;V ;VIEW;2269;/**/ /* View: V_FactActualCost_D0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_DemoSystem_Backup_20220627;1089647175;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;14912;/**/ /* V01.00.03 2021-11-23 Andrs Szvs */ /* Fact View for Maintennace Application for DemoSystem purposes */ /* */ /* Update: */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.02: 2021-10-22 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_DemoSystem ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcp_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,case when [DebitCreditCode] in (N'A',N'L') then N'C' when [DebitCreditCode] in (N'S') then N'D' when [DebitCreditCode] in (N'H') and Upper([COBusinessTransaction]) in (N'COIN', N'RKU1', N'RKU2', N'RKU3', N'KZRI', N'KZRP', N'KSI1', N'KSP1', N'RKIB', N'RKPB', N'COIE', N'RRIB') then N'D' when [DebitCreditCode] in (N'H') then N'C' else N'U' end as [DebitCreditCode] ,cast(IIF(pcs_ws.[ValueType] in (N'10', N'11'), N'1', N'0') as nvarchar(1)) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(IIF(ccoll_wh_partner.[CostCollectorObject_BK] <> ' ',Left(ccoll_wh_partner.[CostCollectorObject_BK],2), NULL) ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cebcadi_bs.[DimensionID] = vdce.[CostElementbyControllingAreaDimId] INNER join ( SELECT ccdis.DimensionID FROM [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccpa_wl WITH (NOLOCK) INNER JOIN [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccpa_ws WITH (NOLOCK) ON ccpa_wl.[CostCenterPlantAssignment_HK] = ccpa_ws.[CostCenterPlantAssignment_HK] AND ccpa_ws.[LoadEndDate] = CAST('2999-12-31' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccpa_wl.[Plant_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis ON ccdis.[CostCenter_HK] = ccpa_wl.[CostCenter_HK] WHERE p_wh.Plant_BK = '9830' ) ccpa_wl ON COALESCE(cte_ccoll2ccent.[CostCenterDimensionId], 0) = ccpa_wl.[DimensionID]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_D3;1097367274;V ;VIEW;7733;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 8/29/2022 3:29:42 PM */ /**/ /**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_D3 */ /**/ /* =*/ /* V01.00.00 2022-08-29 Sanja Mihalic CI/XAD3 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_G0 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_O1;1102887246;V ;VIEW;1035;
INFI_Core2Stage_CSC1;54;INFormation Mart as Interface;V_REF_GL_Account_Filter_PnL_Series_RB_E_XBIT;1104215184;V ;VIEW;1290;/**/ /* View: V_REF_GL_Account_Filter_PnL_Series_RB_E_XBIT */ /**/ /**/ /* V01.00.03 2021-08-31 Yannick Sigwalt GS/BDD2 & JUP8FE */ /* This view is to list all vaild account numbers from custom RB-E-XBIT account hierarchy. */ /* Update: */ /* - V01.00.03: moved logic to a soft rule und now view consumes the Soft rule */ /* - V01.00.02: Replace source by GLAccountAttributes_WSAT0_G0_X from global hierarchy */ /* - V01.00.01: Replace source by GLAccountMasterData_WSATM_G0_X from global hierarchy */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Period;1104879153;V ;VIEW;3684;/**/ /* View: V_INTF_PNL_DIM_Period */ /**/ /* =*/ /* V01.00.01 2021-05-18 Yannick Sigwalt GS/BDO12 */ /* Interface provides Parent/Child Hierarchy for Period Dimension */ /* Data.CORE Outgoing Interface #0148 https://inside-docupedia.bosch.com/confluence/x/_QTTZw */ /* Update: */ /* -V01.00.01: - Reworked Dimension due to issues with TIProcess in TM1 */ /* - changed Fixed Fiscal Year for a more dynamic solution */ /* Restriction: */ /* - none */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceOrder_V3_IDIM1_G3;1108407218;V ;VIEW;8575;/**/ /* View: V_MaintenanceOrder_V3_IDIM1_G3 */ /**/ /**/ /* V01.00.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* New view Dimension Maintenance based on optimized data model for SAPP79 */ /* Update: */ /* - V01.00.00: Initial version copied from V_MaintenanceOrder_V3_IDIM1_G0 */ /**/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G3;1113367331;V ;VIEW;7391;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G3 */ /**/ /* =*/ /* V01.00.00 2022-08-29 Sanja Mihalic CI/XAD3 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_G0 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_A2;1118939358;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_A2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_A2] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_A2_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_Core2Stage_CSC1;54;INFormation Mart as Interface;V_REF_GL_Account_Filter_PnL_Series_RB_E_XBIT_GPx;1120215241;V ;VIEW;1515;/**/ /* View: V_REF_GL_Account_Filter_PnL_Series_RB_E_XBIT_GPx */ /**/ /**/ /* V01.00.01 2021-08-31 Yannick Sigwalt GS/BDD2 & JUP8FE */ /* This view is to list all vaild account numbers from custom RB-E-XBIT account hierarchy for GPM system only */ /* Restriction: */ /* - This view is only for usage with GPx systems */ /* Update: */ /* - V01.00.01: moved logic to a soft rule und now view consumes the Soft rule */ /* - V01.00.00: Initial version */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Period_ATTR;1120879210;V ;VIEW;1184;/**/ /* View: V_INTF_PNL_DIM_Period_ATTR */ /**/ /* =*/ /* V01.00.01 2021-05-18 Yannick Sigwalt GS/BDO12 */ /* Interface provides attribute for Period Dimension */ /* Data.CORE Outgoing Interface #0149 https://inside-docupedia.bosch.com/confluence/x/KgXTZw */ /* Update: */ /* -V01.00.01: Added Documentation */ /* Restriction: */ /* - This viel only provides 1 empty record!! */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_B2;1121087430;V ;VIEW;15911;/**/ /* View: V_ResultActual_V1_IFCT0_B2 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_B2;1134939415;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_B2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_B2] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_B2_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G0;1137087487;V ;VIEW;15912;/**/ /* View: V_ResultActual_V1_IFCT0_G0 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_B4;1150939472;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_B4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_B4] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_B4_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G1;1153087544;V ;VIEW;15912;/**/ /* View: V_ResultActual_V1_IFCT0_G1 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Product_iGPM_ATTR;1158451351;V ;VIEW;2863;/**/ /* View: V_INTF_PNL_DIM_Product_iGPM_ATTR */ /**/ /* =*/ /* V 01.00.03 2021-05-21 Patrik Just CI/BTM-FI1 */ /* Interface provides RB product hierarchy texts for TM1 */ /* Contained levels ProductClass, ProductSubClass, StatisticGroup, Material */ /* - Filter on Product Hierarchy set to 'WORKING SET' */ /* - Texts are restricted to LanguageCode 'EN' */ /* - Valid_from, Valid_to, and type are placeholders */ /* V01.00.03: Add V_SR_Material_Text_PrioritizedNon10Digit */ /* SoftRule https://inside-docupedia.bosch.com/confluence/x/ECQoa */ /* V01.00.02: Replace V_SR_Material_Text_iGPM by V_SR_Material_Text_Prioritized */ /* SoftRule https://inside-docupedia.bosch.com/confluence/x/8lrTZw */ /* V01.00.01: Add hierarchy level prefix 'PHx_' for hierarchy elements */ /*= */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D0;1166939529;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D0 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_D0] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D0_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G2;1169087601;V ;VIEW;15912;/**/ /* View: V_ResultActual_V1_IFCT0_G2 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D4;1182939586;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_D4] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D4_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G3;1185087658;V ;VIEW;15912;/**/ /* View: V_ResultActual_V1_IFCT0_G3 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D7;1198939643;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_D7 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_D7] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_D7_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G4;1201087715;V ;VIEW;16735;/**/ /* View: V_ResultActual_V1_IFCT0_G4 */ /**/ --/* =*/ --/* V01.00.07 2023-03-15 Michal Erdman & Ilja Frolov GS/BDD1 & Yannick Sigwalt */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.07 - Changed WBSElement BK */ --/* V01.00.06 - Added additional BKs */ --/* V01.00.05 - Added #FBI-SR-000000096 */ --/* V01.00.04 - Added Update from #FBI-SR-000000092 */ --/* V01.00.03c - Added COPADocumentLineItemToProductHierarchy_WLNK0 */ --/* V01.00.03b - Corrected identification of [JunkResultRnDDimId] */ --/* V01.00.02 - implemented new DimensionId for ProfitCenter as Business Unit & Division as was */ --/* - implemented new JunkDimensionId */ --/* - moved left join to subselect due to necessity of inner join with enddating satellites */ --/* V01.00.01 - Corrections regarding view structure */ --/* V01.00.00 - Initial version */ --/* =*/
INFI_COREWriter_Optravis_CSC1;93;INFormation Mart as Interface;V_INTF_CompanyCode;1203079622;V ;VIEW;1268;/**/ /* View: V_INTF_CompanyCode */ /**/ /* */ /* V01.00.01 2022-06-23 Michal Erdman & Martin Urban CI/XAD2 */ /* This view displays all white listed CompanyCodes */ /* Data.CORE Outgoing Interface #0171 https://inside-docupedia.bosch.com/confluence/x/7t4ucw */ /* This view implements the following Soft Rule. */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* Changes: */ /* - V01.00.01 format SQL code */ /* - V01.00.00 Created View */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G0;1214939700;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G0 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G0] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G0_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G5;1217087772;V ;VIEW;16738;/**/ /* View: V_ResultActual_V1_IFCT0_G5 */ /**/ --/* =*/ --/* V01.00.07 2023-03-15 Michal Erdman & Ilja Frolov GS/BDD1 & Yannick Sigwalt */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.07 - Changed WBSElement BK */ --/* V01.00.06 - Added additional BKs */ --/* V01.00.05 - Added #FBI-SR-000000096 */ --/* V01.00.04 - Added Update from #FBI-SR-000000092 */ --/* V01.00.03c - Added COPADocumentLineItemToProductHierarchy_WLNK0 */ --/* V01.00.03b - Corrected identification of [JunkResultRnDDimId] */ --/* V01.00.02 - implemented new DimensionId for ProfitCenter as Business Unit & Division as was */ --/* - implemented new JunkDimensionId */ --/* - moved left join to subselect due to necessity of inner join with enddating satellites */ --/* V01.00.01 - Corrections regarding view structure */ --/* V01.00.00 - Initial version */ --/* =*/
INFI_COREWriter_Optravis_CSC1;93;INFormation Mart as Interface;V_INTF_PlantCode;1219079679;V ;VIEW;1445;"/**/ /* View: V_INTF_PlantCode */ /**/ /* */ /* V01.00.01 2022-06-23 Michal Erdman & Martin Urban CI/XAD2 */ /* This view lists plant codes with status 40 ""Released"" and Status 49 ""Discontinuation"" */ /* */ /* Data.CORE Outgoing Interface #0172 https://inside-docupedia.bosch.com/confluence/x/Ft8ucw */ /* Restrictions: */ /* Changes: */ /* - V01.00.01 remove db prefix, format sql */ /* - V01.00.00 Created View */ /* */"
INFM_Costs_CSC1;70;INFormation Mart;usp_DeltaLoad_INTF_COCostActual_V2_MFCT0;1227567857;P ;SQL_STORED_PROCEDURE;63533;"/* =*/ /* V01.00.05 2023-07-20 Philipp Staiger GS/BDD1 */ /* This procedure populates the persisted fact for data based on CO-OM cost based on CostCenter */ /* CostCenter Data.CORE Outgoing Interface #0005 https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Logistic Costs Data.CORE Outgoing Interface #0015 https://inside-docupedia.bosch.com/confluence/x/4DFfVQ */ /* PlantResult Data.CORE Outgoing Interface #0229 https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* GS Trust SG&A Data.CORE Outgoing Interface #0166 https://inside-docupedia.bosch.com/confluence/x/J2JNcg */ /* It populates all CO Cost Actual_V2_MFCT0_xx */ /* Consumed Soft Rules */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw - Debit Credit & Statistical indicator */ /* Restriction: */ /* Update: */ /* V01.00.04 - Added Source System SL to table #Material */ /* V01.00.04 - corrected the way how delta CO Cost Actual Header are identified */ /* - Correct Step 9 for correct IBV identification of conform and non Conform Cost Center */ /* V01.00.03 - Added handling of TT system A3, A4 and H1 */ /* V01.00.02 - Optimized query to handle delta based on document header */ /* - Optimized querying on COCostActualLineItem_WSAT0_xx_L */ /* V01.00.01 - implementation to also take care of delta based on document header */ /* =*/ create procedure INFM_Costs_CSC1.usp_DeltaLoad_INTF_COCostActual_V2_MFCT0 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem nvarchar(15) = N'SAPPR1' --DECLARE @SourceSystemVar nvarchar(5) = N'D1' --DECLARE @DeltaTimestampFrom datetime2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo datetime2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 789 --DECLARE @EntityId bigint = 123 --DECLARE @AuditTrailId bigint = -2 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel int = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FiscalYearToLoad INT; SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_init NVARCHAR(MAX) = '' DECLARE @SQL_CostCenter NVARCHAR(MAX) = '' DECLARE @SQL_ActualBookedObjectLink NVARCHAR(MAX) = '' DECLARE @SQL_Header NVARCHAR(MAX) = '' DECLARE @SQL_LineItemHub NVARCHAR(MAX) = '' DECLARE @SQL_PartnerObject NVARCHAR(MAX) = '' DECLARE @SQL_Material NVARCHAR(MAX) = '' DECLARE @SQL_SourceObject NVARCHAR(MAX) = '' DECLARE @SQL_Plant NVARCHAR(MAX) = '' DECLARE @SQL_InsertFact NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #temp_deltaHKlist; CREATE TABLE #temp_deltaHKlist ( [SourceAbbr] nvarchar(5) COLLATE Latin1_General_CS_AS NOT NULL ,[SourceSystem] nvarchar(15) COLLATE Latin1_General_CS_AS NOT NULL ,[COCostActualLineItem_HK] binary(20) NOT NULL ,[LoadDate] datetime2 NOT NULL ,[YearMonthCreation] int NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 0 : Retrieve oldest FiscalYear to load --------------------------------------------------------------------------------------------------------------------------- */ SET @FiscalYearToLoad = (Select COALESCE ( [FiscalYearFrom], 2021) FROM [MEAM_DataCORE_CSC1].[V_DataCOREPerFactHousekeeping] where [Element] = N'CostActual'); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Save the timestamps in temp table --------------------------------------------------------------------------------------------------------------------------- */ IF( @DeltaTimestampFrom >= '2022-01-01 00:00:00.0000000') BEGIN /* When not in initialization mode, then delta from CO Cost Actuals must be considered as well, else not */ SET @SQL_init = ( SELECT CONCAT(' UNION ALL SELECT N''', @SourceSystemVar, ''' as [SourceAbbr], N''',@SourceSystem,''' as [SourceSystem], cocali_ws0.[COCostActualLineItem_HK], cocali_ws0.[LoadDate], cocali_ws0.[YearMonthCreation] FROM [RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_' , @SourceSystemVar , '] cocali_wh INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' , @SourceSystemVar , '_L] cocali_ws0 ON cocali_ws0.[COCostActualLineItem_HK] = cocali_wh.[COCostActualLineItem_HK] AND cocali_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws0.[FiscalYear] >= ' + cast( @FiscalYearToLoad as nvarchar(4)) + ' WHERE exists ( select 1 from [RAWV_COOM_CSC1].[COCostActualHeader_WHUB0_', @SourceSystemVar, '] cocah_wh inner join [RAWV_COOM_CSC1].[COCostActualHeader_WSAT0_', @SourceSystemVar, '_L] cocah_ws on cocah_ws.[COCostActualHeader_HK] = cocah_wh.[COCostActualHeader_HK] and cocah_ws.[LoadDate] >= ''',@DeltaTimestampFrom ,''' and cocah_ws.[LoadDate] <= ''', @DeltaTimestampTo ,''' and cocah_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and cocah_ws.[FiscalYear] >= ' + cast( @FiscalYearToLoad as nvarchar(4)) + ' where cocah_wh.[SAPSystem] = N''',@SourceSystem,''' and cocah_wh.[ControllingArea_BK] = cocali_wh.[ControllingArea_BK] and cocah_wh.[COCostActualHeader_BK] = cocali_wh.[COCostActualHeader_BK] )' ) ); END SET @SQL = ( select CONCAT(' INSERT INTO #temp_deltaHKlist SELECT distinct * FROM ( SELECT N''', @SourceSystemVar, ''' as [SourceAbbr], N''',@SourceSystem,''' as [SourceSystem], [COCostActualLineItem_HK], [LoadDate], [YearMonthCreation] FROM [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' , @SourceSystemVar , '_L] cocali_ws0 WHERE 1=1 AND [LoadDate] between ''',@DeltaTimestampFrom ,''' and ''', @DeltaTimestampTo ,''' AND [LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND [FiscalYear] >= ' + cast( @FiscalYearToLoad as nvarchar(4)) + ' ' ,@SQL_init ,' ) temp_deltaHKlist ') ); IF(@DebugLevel >= 9 ) print cast (@SQL as ntext); EXECUTE sp_executesql @SQL; Set @rowCounter = @@ROWCOUNT; -- select COUNT(*) from #temp_deltaHKlist); SET @ProcessStatusMessage = (SELECT CONCAT(ISNULL(@ProcessStatusMessage,'') ,' || Amount of records to process : ', FORMAT(@rowCounter,'#,###', 'de-de'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; SET @SQL = CONCAT('ALTER TABLE #temp_deltaHKlist ADD CONSTRAINT C_IX_COCostActual_deltaHKlist' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([YearMonthCreation],[COCostActualLineItem_HK]) '); EXECUTE sp_executesql @SQL; IF(@rowCounter > 0 ) BEGIN DROP TABLE IF EXISTS #PartitionList; /* Retrieve distinct of YearMonthCreation in order to be able to process the data partition wise */ select distinct [YearMonthCreation] INTO #PartitionList from #temp_deltaHKlist; DROP TABLE IF EXISTS #COCostActual_V2_MFCT0; create table #COCostActual_V2_MFCT0 ( LoadDate datetime2 ,AuditId bigint ,EntityId integer ,TechnicalReverseFlag tinyint ,YearMonthCreation int ,COCostActualLineItem_HK binary(20) ,SourceSystem nvarchar(15) COLLATE Latin1_General_CS_AS ,ControllingArea_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,COCostActualHeader_BK nvarchar(10) COLLATE Latin1_General_CS_AS ,COCostActualLineItem_BK smallint ,CompanyCode_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,Plant_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,CostCenter_HK binary(20) ,CostCenterId_BK nvarchar(10) COLLATE Latin1_General_CS_AS ,CostCenterPlant_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,CostElementId_BK nvarchar(10) COLLATE Latin1_General_CS_AS ,ActivityType_BK nvarchar(6) COLLATE Latin1_General_CS_AS ,Material_BK nvarchar(18) COLLATE Latin1_General_CS_AS ,PartnerObject_Id_BK nvarchar(22) COLLATE Latin1_General_CS_AS ,PartnerObjectControllingArea_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,PartnerCostCenterId_BK nvarchar(10) COLLATE Latin1_General_CS_AS ,PartnerObjectActivityType_BK nvarchar(6) COLLATE Latin1_General_CS_AS ,SourceControllingArea_BK nvarchar(4) COLLATE Latin1_General_CS_AS ,SourceCostCenterId_BK nvarchar(10) COLLATE Latin1_General_CS_AS ,FiscalYear smallint ,FiscalYearPostingPeriod int ,PostingPeriod char(3) ,EntryDate date ,DocumentDate date ,PostingDate date ,ValueType nvarchar(2) COLLATE Latin1_General_CS_AS ,COBusinessTransaction nvarchar(4) COLLATE Latin1_General_CS_AS ,SAPDebitCreditIndicator char(1) ,DebitCreditIndicator char(1) ,StatisticalIndicator char(1) ,DocumentWasReversed char(1) ,DocumentIsReversalDocument char(1) ,UnitOfMeasure nvarchar(3) COLLATE Latin1_General_CS_AS ,TotalQuantity numeric(15,3) ,FixedQuantity numeric(15,3) ,COAreaCurrencyCode nvarchar(5) COLLATE Latin1_General_CS_AS ,TotalAmountCOAreaCurrency numeric(19,5) ,FixedAmountCOAreaCurrency numeric(19,5) ,VariableAmountCOAreaCurrency numeric(19,5) ,TotalPriceVarianceAmountCOAreaCurrency numeric(19,5) ,FixedPriceVarianceAmountCOAreaCurrency numeric(19,5) ,TransactionCurrencyCode nvarchar(5) COLLATE Latin1_General_CS_AS ,TotalAmountTransactionCurrency numeric(19,5) ,ObjectCurrencyCode nvarchar(5) COLLATE Latin1_General_CS_AS ,TotalAmountObjectCurrency numeric(19,5) ,FixedAmountObjectCurrency numeric(19,5) ,VariableAmountObjectCurrency numeric(19,5) ,COCostActualHeaderDimId bigint ,COCostActualLineItemDimId bigint ,CostCenterDimId bigint ,PartnerObjectDimId bigint ,SourceCostCenterDimId bigint ,CostElementDimId bigint ,MaterialDimId bigint ); DROP TABLE IF EXISTS #CostCenter create table #CostCenter ( [CostCollector_HK] binary(20) NOT NULL ,[BookedObjectCostCollectorObject_BK] nvarchar(22) COLLATE Latin1_General_CS_AS NOT NULL ,[CostCenter_HK] binary(20) NOT NULL ,[CostCenterID_BK] nvarchar(10) COLLATE Latin1_General_CS_AS NOT NULL ,[NonConformCostCenterID_BK] nvarchar(10) COLLATE Latin1_General_CS_AS ,[ControllingAreaCurrencyCode] nvarchar(5) COLLATE Latin1_General_CS_AS ,[CostCenterDimensionId] bigint ,[ActivityType_ID_BK] nvarchar(6) COLLATE Latin1_General_CS_AS ,[CostCenterPlant_BK] nvarchar(4) COLLATE Latin1_General_CS_AS ); DROP TABLE IF EXISTS #Material CREATE TABLE #Material ( [COCostActualLineItem_HK] binary(20) ,[Material_BK] nvarchar(18) COLLATE Latin1_General_CS_AS ,[DimensionId] bigint ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required cost centers. no partition wise processing as Cost Center Information are common to all partition --------------------------------------------------------------------------------------------------------------------------- */ /* Special case where translation non-Conform CostCenter to Conform CostCenter is required - ETAS D7 - P42 - TT A3 - EP1 - TT A4 - P78 - TT H1 - PTH */ IF @SourceSystemVar in ('A3','A4','D7','H1') BEGIN SET @SQL_CostCenter = ( select CONCAT(' insert into #CostCenter SELECT ccoll_wh.[CostCollector_HK] ,ccoll_wh.[CostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccentc_wh.[CostCenter_HK] AS [CostCenter_HK] ,ccentc_wh.[CostCenterID_BK] AS [CostCenterID_BK] ,ccent_wh.[CostCenterID_BK] AS [NonConformCostCenterID_BK] ,ca_ws.[CurrencyCode] AS [ControllingAreaCurrencyCode] ,ccentdi_bs.[DimensionID] AS [CostCenterDimensionId] ,ss_at.[ActivityType_ID_BK] AS [ActivityType_ID_BK] ,ss_p.[Plant_BK] AS [CostCenterPlant_BK] FROM [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl ON N''' ,@SourceSystem , ''' = ccoll_wh.[SourceSystem_BK] AND ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent on v_sr_ccentnc2ccent.[CostCenter_HK] = ccent_wh.[CostCenter_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccentc_wh ON ccentc_wh.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] LEFT JOIN ( select /* New 2020-02-28 SYA8FE */ at_wh.[ActivityType_ID_BK] ,ccoll2at_wl.[CostCollector_HK] FROM [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl ON ccoll2at_wl.[ActivityType_HK] = at_wh.[ActivityType_HK] ) ss_at ON ss_at.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs ON ccentdi_bs.[CostCenter_HK] = ccentc_wh.[CostCenter_HK] LEFT JOIN ( Select ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws_mf on ccentpa_ws_mf.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws_mf.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] LEFT JOIN [RAWV_RB_CSC1].[ControllingArea_WHUB0] ca_wh ON ca_wh.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] LEFT JOIN [RAWV_RB_CSC1].[ControllingArea_WSAT0_' + @SourceSystemVar + '_L] ca_ws ON ca_ws.[ControllingArea_HK] = ca_wh.[ControllingArea_HK] AND ca_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ; ALTER TABLE #CostCenter ADD CONSTRAINT C_IX_COCostActualBookedCostCenterCostCollector_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([CostCollector_HK]) ; ' )); END ELSE BEGIN SET @SQL_CostCenter = ( select CONCAT(' INSERT INTO #CostCenter SELECT ccoll_wh.[CostCollector_HK] ,ccoll_wh.[CostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent_wh.[CostCenter_HK] AS [CostCenter_HK] ,ccent_wh.[CostCenterID_BK] AS [CostCenterID_BK] ,ccent_wh.[CostCenterID_BK] AS [NonConformCostCenterID_BK] ,ca_ws.[CurrencyCode] AS [ControllingAreaCurrencyCode] ,ccentdi_bs.[DimensionID] AS [CostCenterDimensionId] ,ss_at.[ActivityType_ID_BK] AS [ActivityType_ID_BK] ,ss_p.[Plant_BK] AS [CostCenterPlant_BK] FROM [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl ON N''' ,@SourceSystem , ''' = ccoll_wh.[SourceSystem_BK] AND ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] LEFT JOIN ( select /* New 2020-02-28 SYA8FE */ at_wh.[ActivityType_ID_BK] ,ccoll2at_wl.[CostCollector_HK] FROM [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl ON ccoll2at_wl.[ActivityType_HK] = at_wh.[ActivityType_HK] ) ss_at ON ss_at.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs ON ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] LEFT JOIN ( Select ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws_mf on ccentpa_ws_mf.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws_mf.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] LEFT JOIN [RAWV_RB_CSC1].[ControllingArea_WHUB0] ca_wh ON ca_wh.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] LEFT JOIN [RAWV_RB_CSC1].[ControllingArea_WSAT0_' + @SourceSystemVar + '_L] ca_ws ON ca_ws.[ControllingArea_HK] = ca_wh.[ControllingArea_HK] AND ca_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ; ALTER TABLE #CostCenter ADD CONSTRAINT C_IX_COCostActualBookedCostCenterCostCollector_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([CostCollector_HK]) ; ')); END EXECUTE sp_executesql @SQL_CostCenter; IF(@DebugLevel >= 9 ) BEGIN print cast( @SQL_CostCenter as NTEXT); END /* --------------------------------------------------------------------------------------------------------------------------- End STEP 2 : Collect the required cost centers. --------------------------------------------------------------------------------------------------------------------------- */ /* Start Processing Partition wise */ DECLARE YearMonthCreationCursor CURSOR FOR SELECT [YearMonthCreation] FROM #PartitionList order by 1 OPEN YearMonthCreationCursor; FETCH NEXT FROM YearMonthCreationCursor INTO @YearMonth /* begin reading amount keyfigues */ WHILE @@FETCH_STATUS = 0 BEGIN SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Start Processing <', cast(@YearMonth as nvarchar(10)),'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; /* --------------------------------------------------------------------------------------------------------------------------- End STEP 3 : Collect potential records to be reverted, especially in case of correction in source system --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); SET @SQL = CONCAT(' TRUNCATE TABLE #COCostActual_V2_MFCT0; INSERT INTO #COCostActual_V2_MFCT0 select [LoadDate] ,[AuditId] ,[EntityId] ,[TechnicalReverseFlag] ,[YearMonthCreation] ,[COCostActualLineItem_HK] ,[SourceSystem] ,[ControllingArea_BK] ,[COCostActualHeader_BK] ,[COCostActualLineItem_BK] ,[CompanyCode_BK] ,[Plant_BK] ,[CostCenter_HK] ,[CostCenterId_BK] ,[CostCenterPlant_BK] ,[CostElementId_BK] ,[ActivityType_BK] ,[Material_BK] ,[PartnerObject_Id_BK] ,[PartnerObjectControllingArea_BK] ,[PartnerCostCenterId_BK] ,[PartnerObjectActivityType_BK] ,[SourceControllingArea_BK] ,[SourceCostCenterId_BK] ,[FiscalYear] ,[FiscalYearPostingPeriod] ,[PostingPeriod] ,[EntryDate] ,[DocumentDate] ,[PostingDate] ,[ValueType] ,[COBusinessTransaction] ,[SAPDebitCreditIndicator] ,[DebitCreditIndicator] ,[StatisticalIndicator] ,[DocumentWasReversed] ,[DocumentIsReversalDocument] ,[UnitOfMeasure] ,[TotalQuantity] ,[FixedQuantity] ,[COAreaCurrencyCode] ,[TotalAmountCOAreaCurrency] ,[FixedAmountCOAreaCurrency] ,[VariableAmountCOAreaCurrency] ,[TotalPriceVarianceAmountCOAreaCurrency] ,[FixedPriceVarianceAmountCOAreaCurrency] ,[TransactionCurrencyCode] ,[TotalAmountTransactionCurrency] ,[ObjectCurrencyCode] ,[TotalAmountObjectCurrency] ,[FixedAmountObjectCurrency] ,[VariableAmountObjectCurrency] ,[COCostActualHeaderDimId] ,[COCostActualLineItemDimId] ,[CostCenterDimId] ,[PartnerObjectDimId] ,[SourceCostCenterDimId] ,[CostElementDimId] ,[MaterialDimId] from ( Select CAST(''', CAST(@LoadTimestamp AS NVARCHAR(MAX)) , ''' AS DATETIME2) as [LoadDate] ,', cast(@AuditTrailId as nvarchar(10)),' as [AuditId] ,', cast(@EntityId as nvarchar(10)),' as [EntityId] ,(ISNULL(fact.[TechnicalReverseFlag],0) + 1 ) as [TechnicalReverseFlag] ,ROW_NUMBER() over (partition by fact.[COCostActualLineItem_HK] order by fact.[AuditId] desc ) as [RowNum] ,fact.[YearMonthCreation] ,fact.[COCostActualLineItem_HK] ,fact.[SourceSystem] ,fact.[ControllingArea_BK] ,fact.[COCostActualHeader_BK] ,fact.[COCostActualLineItem_BK] ,fact.[CompanyCode_BK] ,fact.[Plant_BK] ,fact.[CostCenter_HK] ,fact.[CostCenterId_BK] ,fact.[CostCenterPlant_BK] ,fact.[CostElementId_BK] ,fact.[ActivityType_BK] ,fact.[Material_BK] ,fact.[PartnerObject_Id_BK] ,fact.[PartnerObjectControllingArea_BK] ,fact.[PartnerCostCenterId_BK] ,fact.[PartnerObjectActivityType_BK] ,fact.[SourceControllingArea_BK] ,fact.[SourceCostCenterId_BK] ,fact.[FiscalYear] ,fact.[FiscalYearPostingPeriod] ,fact.[PostingPeriod] ,fact.[EntryDate] ,fact.[DocumentDate] ,fact.[PostingDate] ,fact.[ValueType] ,fact.[COBusinessTransaction] ,fact.[SAPDebitCreditIndicator] ,fact.[DebitCreditIndicator] ,fact.[StatisticalIndicator] ,fact.[DocumentWasReversed] ,fact.[DocumentIsReversalDocument] ,fact.[UnitOfMeasure] ,(fact.[TotalQuantity] * -1 ) as [TotalQuantity] ,(fact.[FixedQuantity] * -1 ) as [FixedQuantity] ,fact.[COAreaCurrencyCode] ,(fact.[TotalAmountCOAreaCurrency] * -1 ) as [TotalAmountCOAreaCurrency] ,(fact.[FixedAmountCOAreaCurrency] * -1 ) as [FixedAmountCOAreaCurrency] ,(fact.[VariableAmountCOAreaCurrency] * -1 ) as [VariableAmountCOAreaCurrency] ,(fact.[TotalPriceVarianceAmountCOAreaCurrency] * -1 ) as [TotalPriceVarianceAmountCOAreaCurrency] ,(fact.[FixedPriceVarianceAmountCOAreaCurrency] * -1 ) as [FixedPriceVarianceAmountCOAreaCurrency] ,fact.[TransactionCurrencyCode] ,(fact.[TotalAmountTransactionCurrency] * -1 ) as [TotalAmountTransactionCurrency] ,fact.[ObjectCurrencyCode] ,(fact.[TotalAmountObjectCurrency] * -1 ) as [TotalAmountObjectCurrency] ,(fact.[FixedAmountObjectCurrency] * -1 ) as [FixedAmountObjectCurrency] ,(fact.[VariableAmountObjectCurrency] * -1 ) as [VariableAmountObjectCurrency] ,fact.[COCostActualHeaderDimId] ,fact.[COCostActualLineItemDimId] ,fact.[CostCenterDimId] ,fact.[PartnerObjectDimId] ,fact.[SourceCostCenterDimId] ,fact.[CostElementDimId] ,fact.[MaterialDimId] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_', @SourceSystemVar, '] fact inner join #temp_deltaHKlist tmp on tmp.[YearMonthCreation] = ', @YearMonth ,' and tmp.[COCostActualLineItem_HK] = fact.[COCostActualLineItem_HK] where fact.[TechnicalReverseFlag] is null ) as ss_reversal where ss_reversal.[RowNum] = 1 '); EXECUTE sp_executesql @SQL; IF(@DebugLevel >= 9 ) BEGIN print cast( @SQL as NTEXT); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the required Links. --------------------------------------------------------------------------------------------------------------------------- */ /* Special case where translation non-Conform CostElement to Conform CostElement is required - ETAS D7 - P42 - TT A3 - EP1 - TT A4 - P78 - TT H1 - PTH */ IF @SourceSystemVar in ('A3','A4','D7','H1') BEGIN Set @SQL_ActualBookedObjectLink = ( select CONCAT(' DROP TABLE IF EXISTS #BookedObjectLink; SELECT coca2bo_wl.[COCostActualLineItem_HK] ,coca2bo_wl.[COCostActualHeader_HK] ,ccent.[BookedObjectCostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent.[ActivityType_ID_BK] AS [ActivityType_BK] ,cebcadi_bs.[DimensionID] AS [CostElementDimId] ,ccent.[CostCenterDimensionId] ,ccent.[CostCenter_HK] ,ccent.[CostCenterID_BK] ,ccent.[NonConformCostCenterID_BK] ,ccent.[ControllingAreaCurrencyCode] AS [ControllingAreaCurrencyCode] ,cebca_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] ,ccent.[CostCenterPlant_BK] INTO #BookedObjectLink FROM #temp_deltaHKlist tmp INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_' , @SourceSystemVar , '] AS coca2bo_wl ON ', @YearMonth ,' = tmp.[YearMonthCreation] and coca2bo_wl.[COCostActualLineItem_HK] = tmp.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WSATE_' , @SourceSystemVar , '_L] AS coca2bo_ws ON coca2bo_ws.[YearMonthCreation] = ', CAST( @YearMonth as VARCHAR(6)) , ' AND coca2bo_ws.[COCostActualToBookedObject_HK] = coca2bo_wl.[COCostActualToBookedObject_HK] AND coca2bo_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh ON compc_wh.[CompanyCode_HK] = coca2bo_wl.[CompanyCode_HK] INNER JOIN [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh ON cebca_wh.[CostElementByControllingArea_HK] = coca2bo_wl.[CostElementByControllingArea_HK] INNER JOIN [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl ON cenc2ce_bl.[CostElementNonConform_HK] = cebca_wh.[CostElementByControllingArea_HK] INNER JOIN RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c ON cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs ON cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] INNER JOIN #CostCenter ccent ON ccent.[CostCollector_HK] = coca2bo_wl.[CostCollector_HK] ; ALTER TABLE #BookedObjectLink ADD CONSTRAINT C_IX_COCostActual2BookedObjects_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK])--,[COCostActualHeader_HK]) ; ')); END ELSE BEGIN Set @SQL_ActualBookedObjectLink = ( select CONCAT(' DROP TABLE IF EXISTS #BookedObjectLink; SELECT coca2bo_wl.[COCostActualLineItem_HK] ,coca2bo_wl.[COCostActualHeader_HK] ,ccent.[BookedObjectCostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent.[ActivityType_ID_BK] AS [ActivityType_BK] ,cebcadi_bs.[DimensionID] AS [CostElementDimId] ,ccent.[CostCenterDimensionId] ,ccent.[CostCenter_HK] ,ccent.[CostCenterID_BK] ,ccent.[NonConformCostCenterID_BK] ,ccent.[ControllingAreaCurrencyCode] AS [ControllingAreaCurrencyCode] ,cebca_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] ,ccent.[CostCenterPlant_BK] INTO #BookedObjectLink FROM #temp_deltaHKlist tmp INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_' , @SourceSystemVar , '] AS coca2bo_wl ON ', @YearMonth ,' = tmp.[YearMonthCreation] and coca2bo_wl.[COCostActualLineItem_HK] = tmp.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WSATE_' , @SourceSystemVar , '_L] AS coca2bo_ws ON coca2bo_ws.[YearMonthCreation] = ', CAST( @YearMonth as VARCHAR(6)) , ' AND coca2bo_ws.[COCostActualToBookedObject_HK] = coca2bo_wl.[COCostActualToBookedObject_HK] AND coca2bo_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh ON compc_wh.[CompanyCode_HK] = coca2bo_wl.[CompanyCode_HK] INNER JOIN [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh ON cebca_wh.[CostElementByControllingArea_HK] = coca2bo_wl.[CostElementByControllingArea_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs ON cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] INNER JOIN #CostCenter ccent ON ccent.[CostCollector_HK] = coca2bo_wl.[CostCollector_HK] ; ALTER TABLE #BookedObjectLink ADD CONSTRAINT C_IX_COCostActual2BookedObjects_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK])--,[COCostActualHeader_HK]) ; ')); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_Header = ( select CONCAT(' DROP TABLE IF EXISTS #TempHeaderItems; With cte as ( Select Distinct [COCostActualHeader_HK] from #BookedObjectLink ) SELECT cocah_ws0.[COCostActualHeader_HK] ,cocah_ws0.[PostingDate] ,cocah_ws0.[DocumentDate] ,cocah_ws0.[SAPCreationTimestampUTC] ,cocah_ws0.[IsReversalBooking] ,cocah_ws0.[IsReversedBooking] ,cocah_ws0.[ControllingAreaCurrencyCode] ,cocah_ws0.[YearMonthCreation] ,cocahdi_bs.[DimensionId] AS [COCostActualHeaderDimId] ,cocah_ws0.[FiscalYear] ,cocah_ws0.[PeriodFrom] INTO #TempHeaderItems FROM cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualHeader_WSAT0_' , @SourceSystemVar , '_L] cocah_ws0 ON cocah_ws0.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocah_ws0.[COCostActualHeader_HK] = cte.[COCostActualHeader_HK] AND cocah_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [BUSV_COOM_CSC1].[COCostActualHeaderDimensionId_BSATC_' , @SourceSystemVar , '_X] cocahdi_bs ON cocahdi_bs.[COCostActualHeader_HK] = cte.[COCostActualHeader_HK] ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_COCostActualHeader_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualHeader_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 6 : Collect the HUB objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_LineItemHub = ( select CONCAT(' DROP TABLE IF EXISTS #LineItemHub; SELECT cocali_wh.[COCostActualLineItem_HK] AS [COCostActualLineItem_HK] ,cocali_wh.[SAPSystem] AS [SAPSystem] ,cocali_wh.[COCostActualHeader_BK] AS [COCostActualHeader_BK] ,cocali_wh.[COCostActualLineItem_BK] AS [COCostActualLineItem_BK] ,cocali_wh.[ControllingArea_BK] AS [ControllingArea_BK] ,cocalidi_bs.[DimensionId] AS [COCostActualLineItemDimId] ,cocali_ws0.[YearMonthCreation] AS [YearMonthCreation] ,cocali_ws0.[ValueType] AS [ValueType] ,cocali_ws0.[COBusinessTransaction] AS [COBusinessTransaction] ,cocali_ws0.[DebitCreditCode] AS [SAPDebitCreditIndicator] ,usrcoomdbi.[DebitCreditCode] AS [DebitCreditIndicator] /*#FBI-SR-000000025*/ ,usrcoomsi.[StatisticalIndicator] AS [StatisticalIndicator] /*#FBI-SR-000000025*/ ,cocali_ws0.[UnitofMeasure] AS [UnitOfMeasure] ,cocali_ws0.[TotalQuantity] AS [TotalQuantity] ,cocali_ws0.[FixedQuantity] AS [FixedQuantity] ,cocali_ws0.[ControllingAreaTotalAmount] AS [TotalAmountCOAreaCurrency] ,cocali_ws0.[ControllingAreaFixedAmount] AS [FixedAmountCOAreaCurrency] ,(cocali_ws0.[ControllingAreaTotalAmount] - cocali_ws0.[ControllingAreaFixedAmount]) AS [VariableAmountCOAreaCurrency] ,cocali_ws0.[ControllingAreaTotalPriceVarianceAmount] AS [TotalPriceVarianceAmountCOAreaCurrency] ,cocali_ws0.[ControllingAreaFixedPriceVarianceAmount] AS [FixedPriceVarianceAmountCOAreaCurrency] ,cocali_ws0.[TransactionCurrency] AS [TransactionCurrencyCode] ,cocali_ws0.[TransactionTotalAmount] AS [TotalAmountTransactionCurrency] ,cocali_ws0.[ObjectCurrency] AS [ObjectCurrencyCode] ,cocali_ws0.[ObjectTotalAmount] AS [TotalAmountObjectCurrency] ,IIF(cocali_ws0.[ControllingAreaTotalAmount] <> 0 ,cocali_ws0.[ControllingAreaFixedAmount] / cocali_ws0.[ControllingAreaTotalAmount] * cocali_ws0.[ObjectTotalAmount] ,0) AS [FixedAmountObjectCurrency] ,IIF(cocali_ws0.[ControllingAreaTotalAmount] <> 0 and cocali_ws0.[ControllingAreaFixedAmount] <> 0 ,cocali_ws0.[ObjectTotalAmount] - cocali_ws0.[ControllingAreaFixedAmount] / cocali_ws0.[ControllingAreaTotalAmount] * cocali_ws0.[ObjectTotalAmount] ,cocali_ws0.[ObjectTotalAmount]) AS [VariableAmountObjectCurrency] INTO #LineItemHub FROM #BookedObjectLink bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_' ,@SourceSystemVar , '] cocali_wh ON cocali_wh.[SAPSystem] = ''' , @SourceSystem , ''' AND cocali_wh.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' , @SourceSystemVar , '_L] cocali_ws0 ON cocali_ws0.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali_ws0.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] AND cocali_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws0.[ValueType] in ('''+'03'+''','''+'04'+''') INNER JOIN [BUSV_COOM_CSC1].[COCostActualLineItemDimensionId_BSATC_' , @SourceSystemVar , '_X] cocalidi_bs ON cocalidi_bs.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (cocali_ws0.[DebitCreditCode],cocali_ws0.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (cocali_ws0.[ValueType]) usrcoomsi ; ALTER TABLE #LineItemHub ADD CONSTRAINT C_IX_COCostActualLineItem_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 7 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_PartnerObject = ( select CONCAT(' DROP TABLE IF EXISTS #PartnerObject; SELECT cocali2po_wl.[COCostActualLineItem_HK] AS [COCostActualLineItem_HK] ,ccoll_wh_po.[CostCollectorObject_BK] AS [CostCollectorObject_BK] ,ccolldi_bs.[DimensionId] AS [PartnerObjectDimId] ,COALESCE(ccent_wh.[ControllingArea_ID_BK],at_wh.[ControllingAreaID_BK]) AS [PartnerObjectControllingArea_BK] ,ccent_wh.[CostCenterID_BK] AS [PartnerCostCenterId_BK] ,at_wh.[ActivityType_ID_BK] AS [PartnerObjectActivityType_BK] INTO #PartnerObject FROM #LineItemHub hub INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WLNK0_' , @SourceSystemVar , '] cocali2po_wl ON cocali2po_wl.[COCostActualLineItem_HK] = hub.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WSATE_' , @SourceSystemVar , '_L] cocali2po_wse ON cocali2po_wse.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2po_wse.[COCostActualLineItemToPartnerObject_HK] = cocali2po_wl.[COCostActualLineItemToPartnerObject_HK] AND cocali2po_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.[CostCollector_HK] = cocali2po_wl.[CostCollector_HK] INNER JOIN [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs ON ccolldi_bs.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] LEFT JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl ON ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] LEFT JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] LEFT JOIN [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] LEFT JOIN [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ; ALTER TABLE #PartnerObject ADD CONSTRAINT C_IX_COCostActual2PartneObject_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 8 : Collect the booked material objects. --------------------------------------------------------------------------------------------------------------------------- */ /* Updated V01.00.09 */ TRUNCATE TABLE #Material; IF @SourceSystemVar in ('B2','G0','G1','G2','G3','G4','G5','G6','G7','G9','GK','SL') /* Added only BBM systems as only these have harmonized Material Number*/ BEGIN Set @SQL_Material = ( select CONCAT(' INSERT INTO #Material ( [COCostActualLineItem_HK] ,[Material_BK] ,[DimensionId] ) SELECT cocali2m_wl.[COCostActualLineItem_HK] ,m_wh.[Material_BK] ,mdi_bs.[DimensionId] FROM #temp_deltaHKlist INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WLNK0_' , @SourceSystemVar , '] cocali2m_wl ON ' , CAST( @YearMonth as VARCHAR(6)) , ' = #temp_deltaHKlist.[YearMonthCreation] AND cocali2m_wl.[COCostActualLineItem_HK] = #temp_deltaHKlist.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WSATE_' , @SourceSystemVar , '_L] cocali2m_wse ON cocali2m_wse.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2m_wse.[COCostActualLineItemToMaterial_HK] = cocali2m_wl.[COCostActualLineItemToMaterial_HK] AND cocali2m_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = cocali2m_wl.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_XX_X] mdi_bs ON mdi_bs.[Material_HK] = m_wh.[Material_HK] ; ' )); -- ALTER TABLE #Material ADD CONSTRAINT C_IX_COCostActualLineItemToMaterial_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) --; END ELSE BEGIN Set @SQL_Material = ( select ' INSERT INTO #Material ( [COCostActualLineItem_HK] ,[Material_BK] ,[DimensionId] ) SELECT CAST(NULL as BINARY(20)) AS [COCostActualLineItem_HK] ,NULL AS [Material_BK] ,CAST (NULL AS BIGINT) AS [DimensionId] ; '); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 9 : Collect the Source objects necessary for IBV. --------------------------------------------------------------------------------------------------------------------------- */ /* Special case where translation non-Conform CostCenter to Conform CostCenter is required - ETAS D7 - P42 - TT A3 - EP1 - TT A4 - P78 - TT H1 - PTH */ IF @SourceSystemVar in ('A3','A4','D7','H1') BEGIN Set @SQL_SourceObject = ( select CONCAT( ' DROP TABLE IF EXISTS #CostCenterSource; SELECT cocali2so_wl.[COCostActualLineItem_HK] as [COCostActualLineItem_HK] ,ccent_wh.[ControllingArea_ID_BK] as [NonConformSourceControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] as [NonConformSourceCostCenter_BK] ,ccent_wh_c.[ControllingArea_ID_BK] as [SourceControllingArea_ID_BK] ,ccent_wh_c.[CostCenterID_BK] as [SourceCostCenter_BK] ,ccentdi_bs.[DimensionID] as [SourceCostCenterDimId] INTO #CostCenterSource FROM #LineItemHub hub INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WLNK0_' , @SourceSystemVar , '] cocali2so_wl on cocali2so_wl.[COCostActualLineItem_HK] = hub.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WSATE_' , @SourceSystemVar , '_L] cocali2so_wse_l ON cocali2so_wse_l.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2so_wse_l.[COCostActualLineItemToSourceObject_HK] = cocali2so_wl.[COCostActualLineItemToSourceObject_HK] AND cocali2so_wse_l.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_so ON ccoll_wh_so.[CostCollector_HK] = cocali2so_wl.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl on ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh_so.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[CostCenterNonConformToCostCenter_BLNKS] ccentnc2ccent_bl on ccentnc2ccent_bl.[CostCenterNonConform_HK] = ccent_wh.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[CostCenterNonConformToCostCenter_BSATM_M2_X] ccentnc2ccent_bs on ccentnc2ccent_bs.[CostCenterNonConformToCostCenter_HK] = ccentnc2ccent_bl.[CostCenterNonConformToCostCenter_HK] and ccentnc2ccent_bs.[StateTimeFrom] < SYSUTCDATETIME() and ccentnc2ccent_bs.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' and ccentnc2ccent_bs.[StateTimeBefore] >= SYSUTCDATETIME() INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh_c on ccent_wh_c.[CostCenter_HK] = ccentnc2ccent_bl.[CostCenterMaster_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh_c.[CostCenter_HK] ; ALTER TABLE #CostCenterSource ADD CONSTRAINT C_IX_COCostActual2SourceObject_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); END ELSE BEGIN Set @SQL_SourceObject = ( select CONCAT( ' DROP TABLE IF EXISTS #CostCenterSource; SELECT cocali2so_wl.[COCostActualLineItem_HK] as [COCostActualLineItem_HK] ,ccent_wh.[ControllingArea_ID_BK] as [NonConformSourceControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] as [NonConformSourceCostCenter_BK] ,ccent_wh.[ControllingArea_ID_BK] as [SourceControllingArea_ID_BK] ,ccent_wh.[CostCenterID_BK] as [SourceCostCenter_BK] ,ccentdi_bs.[DimensionID] as [SourceCostCenterDimId] INTO #CostCenterSource FROM #LineItemHub hub INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WLNK0_' , @SourceSystemVar , '] cocali2so_wl on cocali2so_wl.[COCostActualLineItem_HK] = hub.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WSATE_' , @SourceSystemVar , '_L] cocali2so_wse_l ON cocali2so_wse_l.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2so_wse_l.[COCostActualLineItemToSourceObject_HK] = cocali2so_wl.[COCostActualLineItemToSourceObject_HK] AND cocali2so_wse_l.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_so ON ccoll_wh_so.[CostCollector_HK] = cocali2so_wl.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl on ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh_so.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ; ALTER TABLE #CostCenterSource ADD CONSTRAINT C_IX_COCostActual2SourceObject_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 10 : Collect the booked Plant objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_Plant = ( select CONCAT(' DROP TABLE IF EXISTS #Plant; SELECT cocali2p_wl.[COCostActualLineItem_HK] ,p_wh.[Plant_BK] INTO #Plant FROM #LineItemHub hub INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPlant_WLNK0_' , @SourceSystemVar , '] cocali2p_wl ON cocali2p_wl.[COCostActualLineItem_HK] = hub.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPlant_WSATE_' , @SourceSystemVar , '_X] cocali2p_wse ON cocali2p_wse.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2p_wse.[COCostActualLineItemToPlant_WLNK0_HK] = cocali2p_wl.[COCostActualLineItemToPlant_WLNK0_HK] AND cocali2p_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[Plant_WHUB0] p_wh ON p_wh.[Plant_HK] = cocali2p_wl.[Plant_HK] ; ALTER TABLE #Plant ADD CONSTRAINT C_IX_COCostActual2Plant_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 11 : INSERT result set into TEMP Fact-Table. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_InsertFact = ( select CONCAT(' INSERT INTO #COCostActual_V2_MFCT0 SELECT CAST(''', CAST(@LoadTimestamp AS NVARCHAR(MAX)) , ''' AS DATETIME2) AS [LoadDate] ,', cast(@AuditTrailId as nvarchar(10)),' AS [AuditId] ,', cast(@EntityId as nvarchar(10)),' AS [EntityId] ,NULL AS [TechnicalReverseFlag] ,cocali_wh.[YearMonthCreation] AS [YearMonthCreation] ,cocali_wh.[COCostActualLineItem_HK] AS [COCostActualLineItem_HK] ,cocali_wh.[SAPSystem] AS [SourceSystem] ,cocali_wh.[ControllingArea_BK] AS [ControllingArea_BK] ,cocali_wh.[COCostActualHeader_BK] AS [COCostActualHeader_BK] ,cocali_wh.[COCostActualLineItem_BK] AS [COCostActualLineItem_BK] ,bo.[CompanyCode_BK] AS [CompanyCode_BK] ,plant.[Plant_BK] AS [Plant_BK] ,bo.[CostCenter_HK] AS [CostCenter_HK] ,bo.[CostCenterID_BK] AS [CostCenterId_BK] ,bo.[CostCenterPlant_BK] AS [CostCenterPlant_BK] ,bo.[CostElement_ID_BK] AS [CostElementId_BK] ,bo.[ActivityType_BK] AS [ActivityType_BK] ,material.[Material_BK] AS [Material_BK] ,prt.[CostCollectorObject_BK] AS [PartnerObject_Id_BK] ,prt.[PartnerObjectControllingArea_BK] AS [PartnerObjectControllingArea_BK] ,prt.[PartnerCostCenterId_BK] AS [PartnerCostCenterId_BK] ,prt.[PartnerObjectActivityType_BK] AS [PartnerObjectActivityType_BK] ,ccents.[SourceControllingArea_ID_BK] AS [SourceControllingArea_BK] ,ccents.[SourceCostCenter_BK] AS [SourceCostCenterId_BK] ,header.[FiscalYear] AS [FiscalYear] ,cast(header.[FiscalYear] * 1000 + cast(COALESCE(header.[PeriodFrom],0) as int) as int) AS [FiscalYearPostingPeriod] ,header.[PeriodFrom] AS [PostingPeriod] ,cast(header.[SAPCreationTimestampUTC] as date) AS [EntryDate] ,header.[DocumentDate] AS [DocumentDate] ,header.[PostingDate] AS [PostingDate] ,cocali_wh.[ValueType] AS [ValueType] ,cocali_wh.[COBusinessTransaction] AS [COBusinessTransaction] ,cocali_wh.[SAPDebitCreditIndicator] AS [SAPDebitCreditIndicator] ,cocali_wh.[DebitCreditIndicator] AS [DebitCreditIndicator] /*#FBI-SR-000000025*/ ,cocali_wh.[StatisticalIndicator] AS [StatisticalIndicator] /*#FBI-SR-000000025*/ ,header.[IsReversedBooking] AS [DocumentWasReversed] ,header.[IsReversalBooking] AS [DocumentisReversalDocument] ,cocali_wh.[UnitofMeasure] AS [UnitOfMeasure] ,cocali_wh.[TotalQuantity] AS [TotalQuantity] ,cocali_wh.[FixedQuantity] AS [FixedQuantity] ,bo.[ControllingAreaCurrencyCode] AS [COAreaCurrencyCode] ,cocali_wh.[TotalAmountCOAreaCurrency] AS [TotalAmountCOAreaCurrency] ,cocali_wh.[FixedAmountCOAreaCurrency] AS [FixedAmountCOAreaCurrency] ,cocali_wh.[VariableAmountCOAreaCurrency] AS [VariableAmountCOAreaCurrency] ,cocali_wh.[TotalPriceVarianceAmountCOAreaCurrency] AS [TotalPriceVarianceAmountCOAreaCurrency] ,cocali_wh.[FixedPriceVarianceAmountCOAreaCurrency] AS [FixedPriceVarianceAmountCOAreaCurrency] ,cocali_wh.[TransactionCurrencyCode] AS [TransactionCurrencyCode] ,cocali_wh.[TotalAmountTransactionCurrency] AS [TotalAmountTransactionCurrency] ,cocali_wh.[ObjectCurrencyCode] AS [ObjectCurrencyCode] ,cocali_wh.[TotalAmountObjectCurrency] AS [TotalAmountObjectCurrency] ,cocali_wh.[FixedAmountObjectCurrency] AS [FixedAmountObjectCurrency] ,cocali_wh.[VariableAmountObjectCurrency] AS [VariableAmountObjectCurrency] ,header.[COCostActualHeaderDimId] AS [COCostActualHeaderDimId] ,cocali_wh.[COCostActualLineItemDimId] AS [COCostActualLineItemDimId] ,Coalesce(bo.[CostCenterDimensionId],0) AS [CostCenterDimId] ,Coalesce(prt.[PartnerObjectDimId], 0) AS [PartnerObjectDimId] ,COALESCE(ccents.[SourceCostCenterDimId],0) AS [SourceCostCenterDimId] ,COALESCE(bo.[CostElementDimId],0) AS [CostElementDimId] ,COALESCE(material.[DimensionId],0) AS [MaterialDimId] FROM #BookedObjectLink bo INNER JOIN #LineItemHub cocali_wh ON cocali_wh.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] INNER JOIN #TempHeaderItems header ON header.[COCostActualHeader_HK] = bo.[COCostActualHeader_HK] LEFT OUTER JOIN #PartnerObject prt ON prt.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #Material material ON material.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #CostCenterSource ccents on ccents.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #Plant plant on plant.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] ; ')); SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_ActualBookedObjectLink , @SQL_Header , @SQL_LineItemHub , @SQL_PartnerObject , @SQL_SourceObject, @SQL_Plant, @SQL_InsertFact) ); BEGIN TRY BEGIN TRAN IF(@DebugLevel >= 9 ) BEGIN print ' ='; print ' = Material ='; print @SQL_Material print ' ='; END EXECUTE sp_executesql @SQL_Material; IF(@DebugLevel >= 9 ) BEGIN print CAST(@SQL_ActualBookedObjectLink AS NTEXT) print ' ='; print CAST(@SQL_Header AS NTEXT) print ' ='; print CAST(@SQL_LineItemHub AS NTEXT) print ' ='; print CAST(@SQL_PartnerObject AS NTEXT) print ' ='; print CAST(@SQL_SourceObject AS NTEXT) print ' ='; print CAST(@SQL_Plant AS NTEXT) print ' ='; print CAST(@SQL_InsertFact AS NTEXT) print ' ='; END IF(@DebugLevel >= 12 ) BEGIN print ' ='; print CAST(@SQL AS NTEXT) print ' ='; END EXECUTE sp_executesql @SQL; /* --------------------------------------------------------------------------------------------------------------------------- STEP 12 : Collect the booked Plant objects. --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = ( SELECT CONCAT('INSERT INTO [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_' , @SourceSystemVar , '] with (TABLOCK) Select [LoadDate] ,[AuditId] ,[EntityId] ,[TechnicalReverseFlag] ,[YearMonthCreation] ,[COCostActualLineItem_HK] ,[SourceSystem] ,[ControllingArea_BK] ,[COCostActualHeader_BK] ,[COCostActualLineItem_BK] ,[CompanyCode_BK] ,[Plant_BK] ,[CostCenter_HK] ,[CostCenterId_BK] ,[CostCenterPlant_BK] ,[CostElementId_BK] ,[ActivityType_BK] ,[Material_BK] ,[PartnerObject_Id_BK] ,[PartnerObjectControllingArea_BK] ,[PartnerCostCenterId_BK] ,[PartnerObjectActivityType_BK] ,[SourceControllingArea_BK] ,[SourceCostCenterId_BK] ,[FiscalYear] ,[FiscalYearPostingPeriod] ,[PostingPeriod] ,[EntryDate] ,[DocumentDate] ,[PostingDate] ,[ValueType] ,[COBusinessTransaction] ,[SAPDebitCreditIndicator] ,[DebitCreditIndicator] ,[StatisticalIndicator] ,[DocumentWasReversed] ,[DocumentIsReversalDocument] ,[UnitOfMeasure] ,[TotalQuantity] ,[FixedQuantity] ,[COAreaCurrencyCode] ,[TotalAmountCOAreaCurrency] ,[FixedAmountCOAreaCurrency] ,[VariableAmountCOAreaCurrency] ,[TotalPriceVarianceAmountCOAreaCurrency] ,[FixedPriceVarianceAmountCOAreaCurrency] ,[TransactionCurrencyCode] ,[TotalAmountTransactionCurrency] ,[ObjectCurrencyCode] ,[TotalAmountObjectCurrency] ,[FixedAmountObjectCurrency] ,[VariableAmountObjectCurrency] ,[COCostActualHeaderDimId] ,[COCostActualLineItemDimId] ,[CostCenterDimId] ,[PartnerObjectDimId] ,[SourceCostCenterDimId] ,[CostElementDimId] ,[MaterialDimId] from #COCostActual_V2_MFCT0') ); IF(@DebugLevel >= 9 ) BEGIN print cast( @SQL as NTEXT); END ELSE BEGIN /* in Debuglevel >=9 no writeback to Database */ EXECUTE sp_executesql @SQL; END SET @rowCounter = (Select @@ROWCOUNT); COMMIT TRAN SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Successfully finished processing <', cast(@YearMonth as nvarchar(10)),'> with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; SET @RowsRead = @RowsRead + @rowCounter; SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing <', cast(@YearMonth as nvarchar(10)),'> - ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = 'INFM_Costs_CSC1.usp_DeltaLoad_INTF_COCostActual_V2_MFCT0' ; IF(@DebugLevel >= 1 ) print @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @rowCounter = 0; /* get new YearMonthCreation for Processing */ FETCH NEXT FROM YearMonthCreationCursor INTO @YearMonth END /* End reading Quantity keyfigues */ CLOSE YearMonthCreationCursor; DEALLOCATE YearMonthCreationCursor; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; END SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(sysutcdatetime(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) print @ProcessStatusMessage DROP TABLE IF EXISTS #BookedObjectLink; DROP TABLE IF EXISTS #LineItemHub; DROP TABLE IF EXISTS #CostCenter; DROP TABLE IF EXISTS #Plant; DROP TABLE IF EXISTS #Material; DROP TABLE IF EXISTS #temp_deltaHKlist; END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G1;1230939757;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G1 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G1] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G1_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultActual_V1_IFCT0_G6;1233087829;V ;VIEW;15912;/**/ /* View: V_ResultActual_V1_IFCT0_G6 */ /**/ --/* =*/ --/* V01.00.01 2023-03-15 Michal Erdman */ --/* This view provides information, which R&D result bookings were done */ --/* Data.CORE Outgoing Interface #0203 https://inside-docupedia.bosch.com/confluence/x/YUo4fw */ --/* This View consumes the following soft rules: */ --/* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ --/* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Cost Center Cost Types */ --/* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit as was */ --/* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ --/* Restriction: */ --/* none */ --/* Changes: */ --/* V01.00.01 - Changed WBSElement BK */ --/* V01.00.00 - Initial version (copied from G4) */ --/* =*/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_MD_CostCenter_M2;1243567914;V ;VIEW;13185;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 7/25/2023 1:48:16 PM */ /**/ /**/ /* View: V_INTF_MD_CostCenter_M2 */ /**/ /* =*/ /* V01.00.00 2023-07-25 Prachi B (BD/XAD5) */ /* This view provides the attributes of CostCenter for Accounting */ /* Reference - [INFI_Costs_CDP_CSC1].[V_INTF_MD_CostCenter_M2] */ /* Data.CORE Outgoing Interface #0357 https://inside-docupedia.bosch.com/confluence/x/W6oeuw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version (2023-07-25, bip6wz) */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G2;1246939814;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G2 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G2] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G2_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_B2;1249087886;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_B2 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_B2;1252511841;V ;VIEW;11274;/**/ /* View: V_FactActualCost_Short_YTD_B2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFM_CONFDIM_CSC1;10;INFormation Mart;DimBridgeCostCenterToFact;1259867555;V ;VIEW;360;/**/ /* View: DimBridgeCostCenterToFact */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G3;1262939871;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G3 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G3] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G3_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G0;1265087943;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G0 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_B2;1265139998;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2677;/**/ /* View: V_FactActualCost_Short_YTD_B2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_B2] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_B2] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_REF_ExchangeRates;1266155606;V ;VIEW;3920;/* = */ /* V 01.03.03 2020-03-11 Yannick Sigwalt GS/FBI2 */ /* This view delivers the exchange rates from EURO to x to TM1 */ /* - Filert on [ExchangeRateType] = EURX Daily rate (from European Central Bank) */ /* - Filter on [ExchangeRateType] = ZAM0 Monthly average rate */ /* - Filter on [ExchangeRateType] = ZAY0 Annual average rate */ /* - Filert on [ExchangeRateType] = ZCBP Business Plan (Average, cross rate) */ /* - Filert on [ExchangeRateType] = ZCCF Current Forecast (Average, Cross rate) */ /* - Filert on [ExchangeRateType] = ZCFE Current Forecast (End, Cross rate) */ /* - Enhanced View to deliver CURRENCY_DY for each ExchangeRateTypes and ExchangeRateDate */ /* V01.03.03 */ /* - Bugfixing due to issues with Factors */ /* V01.03.02 */ /* - Added Dummy Exchangerate 1 for conversion from EURO to EURO */ /* V01.03.01 */ /* - Reworked View for improved performance */ /* - Added special behavior foe ZCFE and ZCCF because no direkt rate from EUR to x available */ /* V01.03.00 */ /* - Added Filter on [ExchangeRateType] = EURX EMU regulation, variable exchange rates */ /* - Added Filter on [ExchangeRateType] = ZCBP Cross Rates Business Plan based on EUR */ /* - Added Filter on [ExchangeRateType] = ZCCF Cross rate curr. forecast average rates */ /* - Added Filter on [ExchangeRateType] = ZCFE Cross rate current forecast (End rates) */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_D0;1268511898;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_D0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PTT in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_WBSElementSettlementRulesPlan001;1275568028;P ;SQL_STORED_PROCEDURE;22631;"/* =*/ /* V01.00.01 2023-06-30 Philipp Staiger GS/BDD1 */ /* This procedure is used to test the validity of Settlement rules for RnD Analysis Cost Plan data. */ /* Test Case checks if for a relevant WBS Element Settlement Rules are available in the respective fiscal period */ /* or if the SettlementPercentageRates don't add up to 100%. */ /* It populates [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] with results of test case */ /* execution. */ /* Implemented Soft Rules */ /* Debit Credit & Statistical Indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Profit center cost allocation */ /* #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw */ /* Convert Period >=012 to 012 */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg */ /* get Profit Center information for WBS-Element without settlement target */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk */ /* Update: */ /* V01.00.01 - Extended with test case for exceeding SettlementRulePercentage */ /* V01.00.00 - Initial version */ /* =*/ CREATE PROCEDURE MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_WBSElementSettlementRulesPlan001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) AS BEGIN /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem NVARCHAR(15) = N'SAPPOE' --DECLARE @SourceSystemVar NVARCHAR(5) = N'G0' --DECLARE @Usecase NVARCHAR(50) = N'AL2_MERM_RnDTesting_PDM' --DECLARE @TestCase NVARCHAR(50) = N'WBSElementSettlementRulesPlan001' --DECLARE @TargetDataBase NVARCHAR(100) = 'FBI_CORE_CORE_Q' --DECLARE @TargetSchema NVARCHAR(256) = '' --DECLARE @TargetTable NVARCHAR(256) = '' --DECLARE @DeltaTimestampFrom DATETIME2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo DATETIME2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId BIGINT = 113 --DECLARE @ProcessStepId BIGINT = 790 --DECLARE @EntityId BIGINT = 124 --DECLARE @AuditTrailId BIGINT = -2 --DECLARE @ProcessStatusMessage NVARCHAR(4000) = null --DECLARE @RowsRead INT --DECLARE @RowsInserted INT --DECLARE @RowsUpdated INT --DECLARE @RowsDeleted INT --DECLARE @ErrorSeverity INT --DECLARE @ErrorState INT --DECLARE @ErrorProcedure NVARCHAR(128) --DECLARE @ErrorLine INT /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel INT = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnDTest_WBSElementSettlementRulesPlan001]'; DECLARE @TestedElement NVARCHAR(100) = N'WBSElement'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FiscalYear INT = IIF(MONTH(GETDATE()) = 1, YEAR(GETDATE()) - 1, YEAR(GETDATE())) DECLARE @FiscalYearPeriod INT = @FiscalYear * 1000 + 1 SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(MAX) = '' DECLARE @SQL_4 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #WBSElementList; CREATE TABLE #WBSElementList ( [SAPSystem] NVARCHAR(15) COLLATE Latin1_General_CS_AS NOT NULL ,[WBSElement_BK] INT NOT NULL ,[MessageId] INT ,[WBSElementDimId] BIGINT ,[PostingYearPeriodId] INT ,[ScenarioId] BIGINT ,[Version] NVARCHAR(3) ,[JunkDimId] NVARCHAR(6) ,[TotalAmountObjectCurrency] NUMERIC(38, 6) ,[RowId] INT IDENTITY(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)) --Get list of SettlementRule per CostCollector SET @SQL_1 = ( SELECT CONCAT(' WITH cte_SettlementRule AS ( SELECT ccollsr_wl.[CostCollector_HK] AS [CostCollector_HK] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) AS [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) AS [YearPeriodValidTo] ,ccollsr_ws.SettlementPercentageRate AS [SettlementPercentageRate] ,ccollsr_ws.[Version] FROM [',@TargetDataBase,'].[RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl ON ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_',@SourceSystemVar,'_X] ccollsr_ws ON ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] AND ccollsr_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND ccollsr_ws.[SettlementTransaction] = N''KOAP'' AND ccollsr_ws.[AccountAssignmentCategory] IN (N''EO'', N''KS'', N''PR'') AND ccollsr_ws.[Version] IS NOT NULL AND COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) IS NOT NULL AND COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) IS NOT NULL AND COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) >= ',@FiscalYearPeriod,' ) ')); -- Merge CostCollectors from Primary and Secondary Costs with the respective Scenario and PostingPeriod SET @SQL_2 = ( SELECT CONCAT(' ,cte_Cost AS ( SELECT 1 AS [CostCategory] ,pcp_wl.[CostCollector_HK] AS [CostCollector_HK] ,wbse_wh.[SAPSystem] AS [SAPSystem] ,wbse_wh.[WBSElement_BK] AS [WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) AS [WBSElementDimId] ,CAST((pcp_ws.[FiscalYear] * 1000 + IIF(CAST(pcp_ws.[Period] AS INT) >= 12, 12, CAST(pcp_ws.[Period] AS INT))) AS INT) AS [PostingYearPeriodId] ,sdi_wh.[DimensionId] AS [ScenarioId] ,pv_wh.[Version_ID_BK] AS [Version] ,CONCAT(usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', ''0'') AS [JunkDimId] ,SUM(pcp_ws.[TotalValueObjectCurrency]) AS [TotalAmountObjectCurrency] FROM [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_',@SourceSystemVar,'_X] wbsea_ws ON wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] AND wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND wbsea_ws.[FunctionalArea] = ''0500'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl ON ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh ON ccoll_wh.[CostCollector_HK] = ccoll2wbse_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl ON pcp_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_',@SourceSystemVar,'_X] pcp_ws ON pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] AND pcp_ws.[FiscalYear] >= ',@FiscalYear,' AND pcp_ws.[ValueType] IN (N''01'',N''02'',N''10'') AND pcp_ws.[Period] <= 12 AND pcp_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh ON pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] AND pv_wh.[Version_ID_BK] <> ''000'' INNER JOIN [',@TargetDataBase,'].[BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl ON pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh ON s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] INNER JOIN [',@TargetDataBase,'].[BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh ON sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode], pcp_ws.[COBusinessTransaction]) usrcoomdci CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi LEFT OUTER JOIN [',@TargetDataBase,'].[BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs ON wbsedi_bs.[WBSElement_HK] = wbse_wh.[WBSElement_HK] GROUP BY pcp_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) ,CAST((pcp_ws.[FiscalYear] * 1000 + IIF(CAST(pcp_ws.[Period] AS INT) >= 12, 12, CAST(pcp_ws.[Period] AS INT))) AS INT) ,sdi_wh.[DimensionId] ,pv_wh.[Version_ID_BK] ,CONCAT(usrcoomdci.[DebitCreditCode],''_'', usrcoomsi.[StatisticalIndicator],''_'', ''0'') ')); SET @SQL_3 = ( SELECT CONCAT(' UNION ALL SELECT 2 AS [CostCategory] ,pcs_wl.[CostCollector_PlannedObject_HK] AS [CostCollector_HK] ,wbse_wh.[SAPSystem] AS [SAPSystem] ,wbse_wh.[WBSElement_BK] AS [WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) AS [WBSElementDimId] ,CAST((pcs_ws.[FiscalYear] * 1000 + IIF(CAST(pcs_ws.[Period] AS INT) >= 12, 12, CAST(pcs_ws.[Period] AS INT))) AS INT) AS [PostingYearPeriodId] ,sdi_wh.[DimensionId] AS [ScenarioId] ,pv_wh.[Version_ID_BK] AS [Version] ,CONCAT(usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', ''0'') AS [JunkDimId] ,SUM(pcs_ws.[TotalValueObjectCurrency]) AS [TotalAmountObjectCurrency] FROM [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_',@SourceSystemVar,'_X] wbsea_ws ON wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] AND wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND wbsea_ws.[FunctionalArea] = ''0500'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl ON ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh ON ccoll_wh.[CostCollector_HK] = ccoll2wbse_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl ON pcs_wl.[CostCollector_PlannedObject_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_',@SourceSystemVar,'_X] pcs_ws ON pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] AND pcs_ws.[FiscalYear] >= ',@FiscalYear,' AND pcs_ws.[ValueType] IN (N''01'',N''02'',N''10'') AND pcs_ws.[Period] <= 12 AND pcs_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh ON pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] AND pv_wh.[Version_ID_BK] <> ''000'' INNER JOIN [',@TargetDataBase,'].[BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl ON pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh ON s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] INNER JOIN [',@TargetDataBase,'].[BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh ON sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner ON ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode], pcs_ws.[COBusinessTransaction]) usrcoomdci CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi LEFT OUTER JOIN [',@TargetDataBase,'].[BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs ON wbsedi_bs.[WBSElement_HK] = wbse_wh.[WBSElement_HK] GROUP BY pcs_wl.[CostCollector_PlannedObject_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) ,CAST((pcs_ws.[FiscalYear] * 1000 + IIF(CAST(pcs_ws.[Period] AS INT) >= 12, 12, CAST(pcs_ws.[Period] AS INT))) AS INT) ,sdi_wh.[DimensionId] ,pv_wh.[Version_ID_BK] ,CONCAT(usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', ''0'') ) ')); --Connect planned WBSElements with SettlementRules valid in the PostingPeriod --Filter for WBSELements without a valid SettlementRule SET @SQL_4 = ( SELECT ' INSERT INTO #WBSElementList ([SAPSystem] ,[WBSElement_BK] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency]) -- SettlementRule is missing SELECT cte_Cost.[SAPSystem] AS [SAPSystem] ,cte_Cost.[WBSElement_BK] AS [WBSElement_BK] ,11 AS [MessageId] ,cte_Cost.[WBSElementDimId] AS [WBSElementDimId] ,cte_Cost.[PostingYearPeriodId] AS [PostingYearPeriodId] ,cte_Cost.[ScenarioId] AS [ScenarioId] ,cte_Cost.[Version] AS [Version] ,cte_Cost.[JunkDimId] AS [JunkDimId] ,cte_Cost.[TotalAmountObjectCurrency] AS [TotalAmountObjectCurrency] FROM cte_Cost LEFT OUTER JOIN cte_SettlementRule ON cte_SettlementRule.[CostCollector_HK] = cte_Cost.[CostCollector_HK] AND cte_SettlementRule.[Version] = cte_Cost.[Version] AND cte_Cost.[PostingYearPeriodId] BETWEEN cte_SettlementRule.[YearPeriodValidFrom] AND cte_SettlementRule.[YearPeriodValidTo] WHERE 1 = 1 AND cte_SettlementRule.[CostCollector_HK] IS NULL UNION ALL -- SettlementPercentageRate exceeds limit SELECT cte_Cost.[SAPSystem] AS [SAPSystem] ,cte_Cost.[WBSElement_BK] AS [WBSElement_BK] ,13 AS [MessageId] ,cte_Cost.[WBSElementDimId] AS [WBSElementDimId] ,cte_Cost.[PostingYearPeriodId] AS [PostingYearPeriodId] ,cte_Cost.[ScenarioId] AS [ScenarioId] ,cte_Cost.[Version] AS [Version] ,cte_Cost.[JunkDimId] AS [JunkDimId] ,cte_Cost.[TotalAmountObjectCurrency] AS [TotalAmountObjectCurrency] FROM cte_Cost INNER JOIN cte_SettlementRule ON cte_SettlementRule.[CostCollector_HK] = cte_Cost.[CostCollector_HK] AND cte_SettlementRule.[Version] = cte_Cost.[Version] AND cte_Cost.[PostingYearPeriodId] BETWEEN cte_SettlementRule.[YearPeriodValidFrom] AND cte_SettlementRule.[YearPeriodValidTo] GROUP BY cte_Cost.[CostCategory] ,cte_Cost.[SAPSystem] ,cte_Cost.[WBSElement_BK] ,cte_Cost.[WBSElementDimId] ,cte_Cost.[PostingYearPeriodId] ,cte_Cost.[JunkDimId] ,cte_Cost.[ScenarioId] ,cte_Cost.[Version] ,cte_Cost.[TotalAmountObjectCurrency] HAVING SUM(cte_SettlementRule.[SettlementPercentageRate]) <> 100 '); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1, @SQL_2, @SQL_3, @SQL_4)); IF(@DebugLevel >= 12 ) BEGIN PRINT ' ='; PRINT CAST(@SQL AS NTEXT) PRINT ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (SELECT @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'S' --Success ,0 AS [MessageId] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,[WBSElement_BK] ,N'W' --Warning ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency] ,@StoredProcedure from #WBSElementList END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'E' --Success ,999 AS [MessageId] ,@StoredProcedure IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage DROP TABLE IF EXISTS #WBSElementList; RETURN @ReturnProcessStatusNumber END"
INFM_CONFDIM_CSC1;10;INFormation Mart;DimBridgeCostElementToFact;1275867612;V ;VIEW;419;/**/ /* View: DimBridgeCostElementToFact */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4;1278939928;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G4] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G4_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G1;1281088000;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G1 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_D0;1281140055;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_D0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_D0] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D0] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Debitor;1282155663;V ;VIEW;1327;/* = */ /* V01.00.01 2020-03-16 Patrik Just CI/DAV2.3 */ /* Interface provides a flat list of SAP Debitor (Customer) */ /* History: */ /* - V01.00.01: Add Customer_GPM_WHUB0 */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_D4;1284511955;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_D4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PC4 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G2;1297088057;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G2 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_D3;1297140112;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_D3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_D3] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D3] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_D7;1300512012;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_D7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P42 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D7;1306748008;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16426;"/**/ /* V01.04.00 2022-08-09 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ Translate Non-Conform Cost Center to Conform Cost Center */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* #FBI-SR-xxxxxxxxx CostElement conform to nonConform */ /* Update: */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_D7 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D7_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D7_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.PlanningVersionToScenario_HK = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] left join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] --non-conform ,v_sr_ccentnc2ccent.[CostCenter_HK] as [CostCenter_HK_nonConform] ,v_sr_ccentnc2ccent.[CostCenter_BK] as [CostCenter_BK_nonConform] ,v_sr_ccentnc2ccent.[ControllingArea] as [ControllingArea_nonConform] --conform ,v_sr_ccentnc2ccent.[CostCenterConform_HK] as [CostCenterConform_HK] ,v_sr_ccentnc2ccent.[CostCenterConform_BK] as [CostCenterConform_BK] ,v_sr_ccentnc2ccent.[ControllingAreaConform] as [ControllingAreaConform] --Dimension ID ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccoll_wh.SourceSystem_BK = N'SAPP42' inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent --#FBI-SR-000000069 on v_sr_ccentnc2ccent.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(cte_ccoll2ccent.[CostCenterDimensionId], 0) as [CostCenterDimId] --,cte_ccoll2ccent.[CostCenter_BK_nonConform] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_wh_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_wh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh_c.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(cte_ccoll2ccentSource.[CostCenterDimensionId],0) as [SourceCostCenterDimId] ,cte_ccoll2ccentSource.[CostCenter_BK_nonConform] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,COALESCE(pc.[ScenarioDimensionId],0) as [ScenarioId] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_nonConform] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenter_BK_nonConform] and (cte_ccoll2ccent.[SourceSytem] = cte_prio.[SourceSystem] or '%' = cte_prio.[SourceSystem] ) /*CostElement conform to nonConform */ inner join [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl on cenc2ce_bl.[CostElementNonConform_HK] = pc.[CostElementByControllingArea_HK] inner join RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c on cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTESGAFV;1307919781;V ;VIEW;7885;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTESGAFV */ /**/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Cost Element Hierarchy PT-E-SGAFV from PPT in Parent/Child format */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G5;1310940042;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G5 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G5] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G5_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_D4;1313140169;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_D4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_D4] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D4] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G0;1316512069;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from POE in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G4_DemoSystem;1320599993;V ;VIEW;2474;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 28.01.2022 13:24:49 */ /**/ -- Commented drop column, already changed on databases --alter table INFM_Costs_CSC1.CO_CostMaintenance_PerFact_G2 -- drop column StatusCDC --go /**/ /* View: V_BridgeSparePartToFact_IDIM1_G4_DemoSystem */ /**/ /**/ /* V01.00.00 2022-01-27 Martin Urban CI/XAD2 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P81 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G2] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Bridge Spare Part To Fact_IDIM1_G4 */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_D0;1321368072;V ;VIEW;9817;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_D0 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTESGAFV_ATTR;1323919838;V ;VIEW;19595;/*=*/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTESGAFV_ATTR */ /*=*/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Attribute for Cost Element Hierarchy PT-E-SGAFV from PPT */ /* The view is implemented as per the standard view definition for TM1 */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G6;1326940099;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G6 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G6] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G6_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;uspSendMail;1328424202;P ;SQL_STORED_PROCEDURE;85745;"/* Updated 20202-02-28 SYA8FE CostCollector links have been changed */ CREATE PROCEDURE [INFI_Costs_SSAS_CSC2].[uspSendMail] ( @environment NVARCHAR(3) , @emailRecipient NVARCHAR(MAX), @servername NVARCHAR(200), @jobName NVARCHAR(200), @failureSuccess BIT, @tableInfo NVARCHAR(MAX) ) AS BEGIN DECLARE @subject NVARCHAR(200); DECLARE @body NVARCHAR(MAX); DECLARE @isImportant NVARCHAR(20); DECLARE @mailHtml NVARCHAR(MAX) = ' <!DOCTYPE html> <html> <head> <title>Cube loading failure</title> <style> body { font-family: ""Bosch Office Sans""; font-size: 10px; } #signature, #salut { font-weight: bold; font-size: 12px } #content { max-width: 640px; } td.MrRobot { width: 50px; white-space: nowrap; } img.MrRobot { max-height: 100%; max-width: 100%; } table.notification tr.OFFLINE {color:red;} table.notification tr.ONLINE {color:green;} table.notification th{ color: white; background-color: #44546a; font-weight: bold; } table.notification caption{ color: black; background-color: white; font-weight: bold; border-width: 1px; font-size: 12px; } table.notification tr#Row0{ background-color: #d5dce4; } table.notification tr#Row1{ background-color: #ffffff; } </style> </head> <body> <div id=""content""> <p id=""salut"">Dear Agent,</p> <p> SQL Agent job <Strong>{{JobName}}</Strong> executed with the following message for server <Strong>{{ServerName}}</Strong> on {{CurrentTime}}.<br> <br> <b>SSAS Cube loading {{FailureSuccess}} information:</b> </p> <p> {{TableInfo}} </p> <table> <tr> <td class=""MrRobot"" rowspan=""2""><img class=""MrRobot"" src=""data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABNCAYAAADkSzelAAAAAXNSR0IArs4c6QAAAARnQU1BAACx jwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABHVSURBVGhD1VsHYFRVuv6STHolAYEkkAQSSCB0 kNBFQAHFtaGyi9gbNlSwrIhgec9VngULoq6uiyu6uooKihEFqUE6qEAoKUA6kN4z2f/7595kksyE gOFFv3iduefeO/d85+/nHFBrh107d9ROmXRx7SOzHzJa/jhwhR2WLH5d/l+LzRs34MD+/bbGPwga EJl+w00oLSlFaHgYesbGGq1/EBiSqcPmTRtrx40ZaZz9cdBAIkT36GgUFhYhNyfHaGmIvLwc7Nq5 DWvWJBotvw+4kI3xvQ6jhw3FY3PnYdIll+DgwQPIOJ6Oo0fTcerUCZGg6KOrq3xace99DxtPtD2a EElLTcWyZe/D398XNdU1cHVzhZubm3Seh02ALi4uKC0twdRrrkfnzqHa1tZooFqLX3sV06ddi1pr LXx8fOHj6wsvL2+4u3soGRLgQVgsFqSmHtbvvwcoEUrhmisvx1dfLEeHDh1w/FhG3eg7AoXo4uKK lCOHjJa2h+s7by3BTTP+gurqavj5++vIZxzPhLuHu3bYarXKtSr9TvCzorxcVC8AxcVF2vZ7gFtE eOj8yspKUR93owmorqpCaGioSEU6LkRiesSioCBfSZSXl2H69bdi6NARQtYDxUVFCA4OMZ5sO7iO HD0GVdJxE7QBGvixo8cQ1S0Gd858AOPGT0JkZHeVGo0+PS1F7+0RE1tnJznZWfrZVnAdMHAQKisr jFMbaB/Z2TlCJtVoAcLCwlXNKLlfft6Nr778D/7xjyUSV3Kx/PNPMOv+O/Dj2u+Nu///oe534vgL 4efnV2fgVCG63klTLkbHjp2QlZWp0iAJSoyEeLiJ5GpqahDg307iTBpuuPE2dGojd6w979U7Hlbp EDtPEuxsjbUG+acKRDI2lTFJECRM90vPVVVVjXETLsYjjz3ZZiQIV6t02MMT6N03DmFdOysRHvRe mRlZ8BDvxY6bJBrDIvft2/eLcdZ2cOWolpdXqKoU5hc1GPWszOw6dXMGN4ubxKEjxlnbQYi44OVF S7Bz+x4UFRVrI9tIoLCwUEhWyrk2OwQHorAwv4HnawvUDTezXkrFXoUsMtoMjnS5zmC73wVH0+s9 XFugjsiw4SPEDVcaZzbQTrJFvfhJu3EGGn5KStumK3VEhiYkaMph32GqV0ZGBqyGJ3MGXjt0KNk4 axvYqVYMRkmUP5GXJ7ZSpPkVQWJ5uXkOjZ7XyiXv8vb2QXyf/kZrPaozM1G2fqNxdm7hsLD6esVX WP7ZZ8jOypJ0xQ1R3SPRr38fDYpUM37yMdrUsISR6Nt/kPFkPbLvvh8n3likI+UKb8SU5MHFx8d2 8RzAIRETC+Y9iu3bdknk9seUKy8VYtlIS0lHr/g4JcKjqopezRXnndcJV109TZ+rlvQmuVNHuPu1 V7WrLSqE5fLLcPKFBQhysaB79xi9rzXRVF8MvPfuYkR2i1JDLq+owGefLMf3iWuw/9cDyM3OVVXj 4e3lg5MnT+K7xG+Qbniu6mPHxI/Rl9ng5umNE7/+inUb1mLFV//B0n++Y1xpPTgk8v3qVVrKsidh 4aG23KrGKlHeQztfK+0kWFpaKjV9MkrEpgIDg/DF8k/1ea9BA2Hx7wBrcT7cJe3xqyjD8Ylj4SOS Y+WZn38SP/20We9tLTQhcuxoOvbu3Smd9tTcKzw8DGWlZagQqdA9jx47EuFdwiSap0klKSMvqkM7 IrGDyfvriq2YwhyE3H0P9vp54aWhA/GDvze8RIl5P/O2zIyjel9roYmNLFnyCjyMBJFX5AOnJHkk 2gUHobS4RDLdo3rddtSrUHlFJQYMHIzJl/wJWbnZSMnJwNtvvYuqwiK4SXJ52RWTRbpSYVaUo0/f gRg9+kLjyd+OBkQ++vADbNywHv4B/tpBH/EyPDw8PVStmM6XFBer5yIJccDwdrPiVKUFFpda+Flq UFxZi4jICEnvrfCU54qF+A/frVWJdY/uhp5xMZox3zVzlvyGUxM9YzQgsmP7dsyedR8Cg4L0nJd4 0D5COoSgS9dQPbehFl5utXg7uQPSC7xULEM6FmFKaB6CO0fAy9tbbcvLyxOrViZqYsqYM++p+Vom tzYaDMnAQYOkA1464tRjSsHT01PbigqKtM0k4uFai3VZ/kgv9JJ2qRwtVmzNCkBqqXixvBy9r6ys VEd/+g0zRDK2hPTAvnOTATSRbXR0D636CHaGwY+ZbYWUw0WFxeK1bBbBj+xyd/nC9MVmS/yeV+mJ 0pIiKY27SsV4B26+ZSYmTb4MvaV4Y+2y7F9L7aTaemhCZOiwYeqd+DJ6qi5dwzF5ykSMHD0cBSIV qosStLogPqhUgoarfJcP+mS4IaRCvJGrBXt271SXbOKeWQ+gRFy6q9jF399aYrS2HpoQGT5ihEZr khkxajiGDB2sqtZRIvWIUcPQvsN56m7Lq2oQG1CCy6Jy4e8uscJajNG163BegDciu0drZblzx1bj V4Fu3bqhb7/+sIh6frTsQ6O19eAwRZk04UJ06tQJEyaN1/USe9BbMSjScKn31soyWFAt0quCu3cA OoWHqySJYklNRo0Zh0GDhur5MXHb10+7Fr5+vph86WWYec+92t4acOj/+vUfIDZRiUwpquh1LO6c aLDZBnnThmj4wSEh6NA5HMGhUegc1QMhHTvWkSB8/fzFna81ziCBtIvEmUEiYQs+//QTnWNuLTgk MnLUaJw8cRI/rlmPLz9fiV/37tPoTi9GAmZKz1lI2gyJ8eD3xmgs8Admz1FJenp54dVFLxutvx0O iQwfMVJtxEtexs4dTD6ExFWr8c2Kb7F96w4x+gKdPiIh1i3My3jQ3ZrOgH+cmCgukpzNDl26dsWA AQNFKq5Y8eUXTarSs4XTNP5qSbt5iYZOaOfkqJa40LFzRzH6dtrxq66+TtTlfFSUl6FS3PTyzz8W +ynT51jrr5aMOVzsZtHri/V3iLS0NNw8Y7oUZN4YP+EizHpotnHl7OFQIsTg84do/DBhGjnthbMt VDGum+zZs0vTmHbBIToreced9+Oaa2fgppvvxMEDR1AlI37wwAE8+9QC45eAiIgIw1bc8OUXyxu8 52zhlMiwYU0nIwgSKpP0vVqCh7uQ2vfr3iZGy1UsX19/PDZ3LphO+fj6Ye2aH/Du2/Xx40GxlUJR UV9fXyx6+UWj9ezhlMiQhIQ6fbeHKRlOp7pQQhYPbNiwxrjaEKwaBw0eIM9AgmMgPlj6T3y9coVe Cw0Lw/lDE+S3XKS0XtHEzZ8pnBLx8fbRNRIzXbEHyRTkF8BNbICebOOGH40r9Vi/bg1mP3i3uuMe sd11QLiOsvC5/9XklLiX0V6yY6rma7/RgzklQgwecr5D/SWRkpISIWnV9Dwj47jkYbaa5eefd+OJ x2fjs08/UpK8t0o8W2RUF5SXlYstBWPOg7OQmZlZF1co4cRvV+lvni2cei1i547teHTObAQEBGiH 7MFkknlYQKCf2FIF4uMHIDv7uNTtaaL3fmrI/Okiie5jL7wIV1x5Dfbv34c7b71FJBOsdc3KxNW6 Ejb1isvVVhIkz3t83nzjDWeGZiXC0WK8cATTThgPLBZ3kcRO5OXlCelAORfXK+1lpeV48eU3lQQR GxuHv859QtQyX1eMp029CiEh7XVykL+3OjFRCZ4NmiVCcOKOo98YlFCRlLAsXfmdrphqxiBYVVmN IwdTsWvHbpFStvGEDRdNnITpM27Q6E77uf3mG/HkU08rAX+R/IsLXzDuPDOclkjC8OGSrpzQJNEe qmryX2GBbQTZKXq59NTjOLD/kFaEXCVe+v57et0eN916m6jbhRpjaF8Ln/8bJk6+RH/zx7U/4IS8 70xxWiJTr70Ozzz3N4ybMKEJGaoDZ+uZpky+9E/YsW23ECtUyfAaq0uqiyP89YknEdOzp3xzwZbN m5EjkmPqz+mi1145cw92WiI0Qs4JJyQM1xG0BwPjjJtuxnPPL8LYsRNw8cSJGkRNx8BP2tCWJMdz WExbgtq1U9KHDx+S+23k161dc8ZSOS0RE9R1BkB7WGut8JMIbuLGW26TwFbSIIh6enrhh9XfGWdN 8cGyj5nI6TM8SJ4q+eILzxt3tAxnQCRLR64BpL+1qE/d28noRkRFNQiizMm2b9tmnDnGex98KI6j sG4AGH82bVivKwMtRYuJpKelamywB1N1by9v48wGswQwQfLMqTg/7AyMK68veQunTp2sk0qApDQL n3/OuOP0aDGRI4cPqxHbg643IDDAOLOhb99+avwm2CmSST7NHskePWPFDT+DvNxcJUOpbP1piziT 48YdzaNFRJimcEQbqxaDZYfzOhpnNnTrzq0etvV6E24yAKmpKcaZc4wecwFuuf2OOukxQ3i1hR6s RUR279qpnTa9EWGqALdF2aO9nHvKaNrDTQYgV0a6JWCwnHzpFE1tKJWkTRtxvAVSaRGRpE2b4CFu 0R40aKbijbElaaNOF9mDu4g2bVyHpKQNRkvzeGjOw4jv008q0DJ1z0/Pn2dccY5miXy98gss+/B9 KYrWqH+3B+2gj9iDCRr4s0/P1fvZcXtQcqz/P162FG++8YrR2jwWvvSy1jBUgrSUFCx66f+MK47h lAhzH+762bxpA2ok17K3D6oVo/zFkyYZLcAp0eufkrahffv24sk8NV0heC9tJigoEH5+/hL4kvHw 7Hsljc/Q683hlTcWS2pfqnHl65UrNf1P2rzJuNoQTonk5OTCy1Ncq9hs40DIzgVKlmsvEXo0LiEc PpSGnnHRKkFKiSRCwztpus/nGCDpxv/nmSd0ua45tJfMmOpLZ+MvZA4mJ2PuY4/ihum2tUp7OCWS l5uj7pVrJZy/YicIfrCg8vb1FO/SMI3gJDUrx5QjR9G7T085YhHfN1akFKzPmCARpvvc87Xw+WeM 1qbYtXOH7rds1y5Yk1IOFoMuXfSzT81H4qpvkJlhk6xzInm5mmozMneJCNNlOKbztA0/P18Zqc4O S1x2kmQOJaeq1+EAmGpmgud0FuFduooTcdf9xI7A2EUCb779jqb63HZIcKbyu2+/xYJ5czH+glFa ADolQnfJiQXu2wpqF4jY3jHy4lBEdeuKbtFd1Wa2bU0y7m4Ijhwn8VJTjuomT+qnSYhqwk1u0TE9 6lx34/hkglNM3F+ZLCo1aPAQnJ8wTFOZMWPHYvE7f8f6pK3492fLsXXLluZUK1cN3lXcBjvAlwUG BegENNWEmSpVK1dUkGBH60NgvWRSDqWrF6MEaDfcvGNz27a1l+bAmoUBdv4Tj+s5V5D5jofmPIK4 uF7ap97xfXD7XTObM3bJdhut8WlnaSQCulQaLuMDwc4yrTfViNdJhlulSCZSksmIyCh9uTmhYR9g neHd9z/QmcpffvkZwWIrjmIX4ZRIaGgYKqTKaw4shLZssblDnbf66N+q0+USyEi4jowUWyyFzRys JQRMePt44xWpW7jixYj/8549ElOaTug5JRLfpw/yC/LlpbzFXmnqwWvcLGDGhIjISKxYlYiesXE6 wWBKr7qmWjcXNCbA63TRNY2cgTNcMmWKzua/9+474MZrezglEturl+pwY/UyYXaSc8GbNtjUy8QL EpVvveNOrSeoai7yx5Vh1vgEn1XJSVAdNny0qEzLN0D/efr12LZrLy4Y23CNvlnV8vXxQf4pm1T4 ch7qOoUgjZfrgfTx2TmZxlP1uOa6aXhv6b90xLlBgPtZyINzYJRO//4Dce99czBixBjbA2cAqmt0 TMONOc1O0M348zQEhwSJnnpqp+lKOR/l6+Nbt4xNww0SMlOn/sV4qinum3mXqFcF+vSLR3x8f4xq xR0PJpol8sxTC5BxLB0DBg8Qb8MCibOHxkKOcdSI/neNiMLkyZcbTznGlqRNOgXLYHYu4FS1iLi4 OFhdWK3ZNgrQ61C1TO40XqYxTAZPh6EJw88ZCaJZIrESdGqqbLvlCEduk9daQuRco1kiNCiTRGOw nQZPQ248AdEWaJYIUwp/yVLNaM3O0yXTbXKdkP8Y5oILJiCmR5xeb0s0a+zE20teV4+j/wBA/kJD wxEb2xs9esZptP694LRE1q9bi6KifMT1ikdUVLTR+nsD8F83V77crriNWwAAAABJRU5ErkJggg "" alt=""MrRobot""></td> <td id=""signature""> <br> Best regards <br> Mr. Robot </td> </tr> <tr> <td id=""subsignature""> If you have questions or suggestions regarding this report, please feel free to write an <a href=""mailto:MrRobot@NOEMAILYET?subject=FBI%20Failure%20{{JobName}}%20job"">Email with the subject ""FBI Failure {{JobName}} job"" to Mr. Robot</a> </td> </tr> </table> <img src=""data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABQAAAABzCAYAAADHaq8/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAB//0lEQVR4nOydB3RVxdbHLyqggAJSktAJNVjokISiglhROjZ6b9J7S +ikQELoHVSkJoTeQVHpJYR0ei/Se9P9zeyZc+65NwESyXvve3n/31p7Td8zc4C48nfPjI0AAAAAAAAAAAAAAABpFtt/egEAAAAAAAAAAAAAAIB/HRAAAQAAAAAAAAAAAABIw0AABAAAAAAAAAAAAAAgD QMBEAAAAAAAAAAAAACANAwEQAAAAAAAAAAAAAAA0jAQAAEAAAAAAAAAAAAASMNAAAQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAAAANIwEAABAAAAAAAAAAAAAEjDQAAEAAAAA AAAAAAAACANAwEQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAADSMBAAAQAAAAAAAAAAAABIw0AABAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAACANAwEQAAAAAAAAAAAAAAA0jAQAAEAAAAAAAAAAAAAS MNAAAQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAAAANIwEAABAAAAAAAAAAAAAEjDQAB8QXrN+ZXK9PiJKvdblCpWpucC6jpjW5JzvdVlHlXqm0Kfor9X/8VUa1gYtZ28maatO 0QXrt5O0R6PnbtKxTvPS3KtHaZsSpaPmNNXqGSX+eTeYS5bvjazqHHAam6zVfahdfuOp2hNAAAAAAAAAAD+/3L69Gnatm0b/frrr7Rd2G+/bafff/uNNm/ZTJs3b+b6a1ev/qeXCcD/DBAAX5DPR64g2 +eBZKsfnDpWO5A+9AlNci7bh6P+ud96QWSrM57922qOoWxNp1HYziPJ2mP0iUtizOgk1jqOqg5clCwfO+POk63WWLpx6z7Fn7lKcaev0qlLN7lt1Z7j9PjxX8n74AAAAAAAAAAA/l9y+fJl2rBhA23cu IGOHT/GdY+fPKaHDx/S/YcPlD14QHfv3aWr167Rhs1baPqs2bRi5Up68uTJf3j1AKRtIAC+IPXGrGJxLcPXkyi9MCNN71TO4GTOfY289PXp8OVJzmX71I9e+Wpikv6SsvROedOED1vDCWT7cAx59l/83 D3GnLxMtk/8E6+1fjDVGLI0Wd9pd/x5sf6AJNtqDl1GCefU//n5dGQ4/fxLDLm1nknFOs+jG3cecP3Vm/foo2HLKeNXk6jKgMXiPw5KMFy5+xj1nPMrNQ/ZQBkaT6SJqw+afh88fMz7yyDGtJ2y2ayXw mOxTvPotW8mU/DKA8laPwAAAAAAAACApLlx4watXLmSIg5FqPLtm7RgyVJq1b4jNWnZilqLtF3n76n9992og7DWHTtRfx9f+uWPHfTo8SM6e/EChUydTvPm//Af3gkAaRcIgC+IIQA6i31JCYDOwp2zQ JchmQJgcsQ/Z+Ev6faJZPs8gKoOXPLMPRoCYKK1sgD47LEGe6QA+FkA3brzgI6cu8ZRgOa+aoyi3fHnOP9KoxB6p/uP9PDhY6ozdhW93e1Hrg/dcYRGLNnF+YYBq6naIDXvjPWRZPPypd+jz1LMqStke 3eg+I/Nfe13DI1ZtofzhdrPoRkbIlV9haEULfYkealhSLIjIQEAAAAAAAAAOLJ161basWMH5w/HxlKjb5tS81ZtaN26dc8cd+/uHVq8ZCm17tiZfMf60Y1bN+n46VPUf4gPHY6M/HcsHYD/KSAAviDOE YBWwS1doxCyNZiQMvtiHNXyDUtyLqsAaBX1Xm48kcc91eTR34YTxJjEYzPIaMCaY2hzxKmn7tEaAWgVAVMiAO49coFsH42ld3v8REU7zaPiHefY9/WxH+1NOK/ywqcU8yRbI0+LbxJs9rtz7yFN3xBJ9 f1WU2E9ftq6SCr5/Xy7ry/H0z4x174jF8lWa0yidUxeE0HpG4fQ5HWHKCB8P1Xqu5DeH5y8PQAAAAAAAAAAsLNo0SK6eu0qi3dfN21OXbv3/Ed+Ll44T5269aApc+bSk7+e0MRZs+mHH39K5dUC8L8NB MAX5GlHgKX4J6PO5MMXJTrPp+LarHlnk20F282mlhM2JDmX8xHg9Fr8e73JFBoXvp98F+1MZMMW76LvZ24jl1YzxHj/RCKgIeSV7/3zU/foLAD+kwjA3ToCMMl9fexH+ywC4JZDSoxcu/84vdJoAuf9w vbyXYuzNh6m7rN/paKd5nL91LWHqFTXH+2+vhhHEccv0S+Hz5Ct7vhEc40N3UN528yiZX8kcESgTGV0IgAAAAAAAACA5PPzzz/Tw8ePaMfu3VTJu1qqPOixa+dOatOlG924dYuWr11HgeODUmGl//94c u06PYiJpfuHo+nxxYup5vfx5cv0ICqG7kfH0ONLl1LN798PHtDDEyfo4fFj9OT6jVTzC/69QAB8QawCoIM49qm/wzHX1CApAVAKjS4tZyRrfPDK/Q4ioBm1KKMAa4196rjUiADcJR8B+dgv6X2Juc0Iw LrjaVPESc6v2XecXtIRgBnFGlftOcr51pM2UaH2szk/Ze0hKtHFfk+EPNK8K04dJ7aVGWT+GYxbvo/8QvfQ7bsPyVZxqNl/1NI99FvM2WTtAQAAAAAAAAAA0cKFC/nuvsVhYVS3QUOz/uzZM7Rr164U+ wsTfu7fV1c5PRF+23TqQhcuXaKwNWtoxqxZqbZuKw+Pn6DTDb+ms63aCWurU2ez159r24ku+Y6kW+s2/qP57u7eQ6cbN6GYLLko+tU3Keb1XCKfm6Iz5aDojNnoZK3adDN8ZYr93lq9lk58/AVFZcyuf Em/r2u/GbLS8Wof0rXZ81K+3h076cw3zSkmmxuvLzpzTrX2197k9cs5b61c/dTxj06fplPm99XWsi2d/uqbZ857vmtPOtu8tcO40199R3d+3Z7iPQBHIAC+IM4CYAaLALgz9lyqzmUVAK3HjHM1n55sH 4U7zOHjwI73BCoB8O7dB0mOsd4BmP6fRgBKAbB2YNL7+izAFAAziv1s1gLg2n3HKbNYG+f3nyCb9zB+SGTS6oO83g37j9P8LdH0bnd7aPhLdYJphxb09h+9SLaP/MhWZThl/mYyXdd3A8qoP9v7o0T9M HJtNZMePnqcrD0AAAAAAAAAwP86q1etous3b9Ka9Rvp62+/M+s3b95M8Qnx1L1vvxT5O3jwIP3555/kM3oM7d2716zv1L0HXb1+ncZOmOhQn1rcPxBBUa+8TnGuhZNphSg2V36KecOFol/NTn8GJC868 e+//6ZjVWrwmDg3d4ovVJLi3UtRgrB4dw+KLyzSwh4Ul6cIC3fxhTzo0ekzz/d7/z4leJShmMy5KC5vEfbBvhz8CstXlGKzubHvG0tCn+v3ye3bdLScFwt9xnrVWrVfd71eMWd0llyUUPRtepxE9OeDq GiKetnp+7oUouiMbzxz/iOlylJszvwO4+S3u/HToueuHTwbCIAvSFJHgP8dAqA1AjBXy+QLgN/P3Mp3Ajo/FCLv57t07XaSY1LjCDAAAAAAAAAAgP9uEuLjaX/EIdodEUk1P/rErF8WuowuXLhAN2/fo iat2qTI5+HIw3Tm7Bm6cfMGjR4fTCtXruL6v/96Qv2H+tKpCxepSdv2qboPyYNDh1kUSzCEMncPFroSWDyzC3Ns7qUsdaVYFJPi16kvGz5zjscXLnEkHgtp2o+cjwW1wnYR0JxXWv5iFJUuE93evO2pf v+6d48Fuvi8RUxxziEtXErvy0Ol7nrNr2anM9+2fKrf+4cilSiq/Sbw2vT69P7V+j3sImM+sd6Xs9D9g4ccv29sLEc52kXJUixuxmR1eeY3k+JjnPgGdtGxFMVmz0M3Fi195jjwfCAAviDPigDc9e+KA GyRfAGwx+xfWAB0OM4rjwB/OIYeP0w6Es75FeB/cgQYAAAAAAAAAMB/N6tWraI/Dh0m7/dr2utWrqJLly/ThUsXOW3Wtl2KfB4+fJhOnzlDx0+coPsP7tMw/0D6/fffuS02JoamzplPS9ZtpNF+/qm6l /taAIx3EONK2YU/M+LNwxQIHQU8D4rJlIOu/7AgSf8y8o/FvwLFLSJiKVNMS7D6NcQ6Y/5CHiwCPoiNS9J3QsnSFJ+3qDkmwSpUFixB8QVK6LKjeCn7RtpeoWtzEh8Jfnz+AkW9lMWMUHQQQI11m/XWC EYPHiPHPjpn10CUAJjbIkqqvs8VAMt6sQhq+oYAmGpAAHxB/hNHgDM4CYA5UyAAVu67kIW7RK8IP+WBDklq3AEIAAAAAAAAAOC/l927dtGO/Qeox5BhtCI8nOsiIiLoyNGjdPP2TfIbH0wPHj6gpq1TG AF4+DCdv3CeVq/fQCs3bqKHD+5Ty05d6MG9e9w+Y+YsCt+8jb5t29GsSw3uR2gB0IhQ02JTnFthju6LyaLu6OM0qyvFScHNIgiy6KbFvaQ4WrEqxeVxt4hp9nnkHLFv5lXmUlAfs7WLjiyYFShBMaLdm TtbfmFhMd4iqqnIweIc4RdfpBQdebu8umdQrFvWG0KhvMvv8qik7+aXR5BZeHNaqzqe7E6xOfKK9eShuNwFKL5gSYd+8lvEyUjAlzKb/kwB0CGC0oNisj0/AlCtwwMRgKkMBMAX5D91B2AGiwCYO5lHg GNOXeG789JbREQW8uqMp8YBT7+80yoAOhxzToEA+OTJX3T+z9t0+tJNOnnxJj/G8SIs25FAD3B3HwAAAAAAAAD8W9i0cSNN/mkJ1fzkc7Nu7dq1dP3GdRb/AgIC6d79+ykWAGNjY+nsubMUf+QIvV2+I h0/dYpOnD5Dnbv34Pb79+6R/8TJNGryTJowaVKq7ccUAC0RcvK+ufNdutGj8+foQUK8sqNH6N6Bg3S8Sg3zrj3zuK0YE/XKG/T340cOvm9v2KREOofjsh4s6kmR7mzL9nT9x4V0Y9ESutCrP69D+XaMO pSi26Xhox18n2vXhe/Ss0YVSsHsyFvl6a87jtd63d68lRJKlmE/8kGQP/2TvrfwyoRJfE+gGeFnHEmWx4YzZqNTdRrR9bk/0M0loXRp6HCKzVWAv5XxLeR6pFB6a9Ua06c1AjA+JRGAxhFgS0QkBMDUA QLgC5LUHYDptQC4J/58qs6V1B2ALzUOoTebT6O9CRdow4GTiWyjsKW/J1CzCev5nr/0liPExh2C8vgv/f33U+dNjTsA/4g5S7ZKQ6lEl/lUpNM8sn0eSPnbzv7n36L0QFq999g/Hg8AAAAAAAAAIHmcP 3eOQlevpTa9BtDSJep3wK1bt9KZCxfp6PET9GXd+nxc9/qNG3wEeO+ePbR//37at2/fM+3gwQh+UfjixYt07MQJGj5qDI30D6Dr129Q/xGj6JSokywNXUb+0+dS7UZfp9qe7AKgh3lEVUa3XRzs89QxH FFnEQClSeHr4RHH302Plvfmu/Gsx1jl0VwpnD25eTNJ30ferazv3vMwTQpwMgrRyvHqtXQ0ov1hDvkwyYPY+Keu+8y3LejyqKef+ovNkY/XZ86rj/VGi7mfdgz5xIe1+VGU6IzZ6VS9rxK1SwEw2oywt EcBJjsC0LwbEQJgagEB8AUxBECrOMYC4GcBtCfuXyMAOouNUgSU8z3VPhdWN8hR/JP3/tUZT7aP/enkxRvPnPfZEYDJ+0e4O/58omPGsrx+/wnO37j9gO9IkDx89ITu3Lf/H5Qnj/+iHbFP/5Y376jXi 49fuEEXr95J1B554k86cznxD9md4s/nltPLxyfEt4g4dilZewIAAAAAAACA/wV27viDpi1cRuWr1zDr1q1bRzsORlLTNu3p5vXrfG/f2fPn6EBkJF3+80+6evUqXdF2VZtj/gqbfPzj3PnzdPT4MRrlH 0Bbt2ylrTt20YbfdtCQ4SN4roiDB2jqjwvpi2at6fixo6myJ0MAtN7pF5e7IF0cOOSpY45VrOZ4PFWk8qjt4wsXzT5Pbtyg6PRvJHpAJCpDNnp09tmnBGOyuTm8upugxb3bm7aafY57f8Av+yZY7g9UA mDSQt3zuLtzN4uYdiFUHemVEYMP4hOeOVauVUY7JgVHAGbJbb//L4WPgFjvYIQAmDpAAHxBnCMAHaIApfhWa8zzzdOHJq+JeO5cSUUAPi91zpviX4Ng6jhtS7L2mNQjICmNAGQB8HMnAfD9UXT03DWVL zuIIo8r4W3Igt+pWMe5nJdHfW01R1PVgUs46u/IWd2/yjDaGa2eRrfVDqSCbWeryMLKPjTJ8i1tdYLorW4/0mtfT6YPfcK47tL1u2R7b5TyWXUEjV+xj+s/Eu1Zvp0s/Mwl24djk7UvAAAAAAAAAEjr7 N+7l5r3GkDfNlcvyJ45fZo2/bqd1v2+gxo0VlF5v/zyCz/mcfHSJdq9fz/tPXiQ9h2MUBYh7SDt16mqP6j7HKSTp0/R0WPHTcEvMGQSrRe+633X1FzDuImTqVGHrrRg4cJU2dODCOsrwOq13FgZAegzL Mn+8lXimMw5LUdk1cu6zoLW9fk/Ueybeeyv7/Kdf+50unGT567pSvAkis2ZXx1/1QJfnEtButCjr9nn9FdN+Q5Bq3/j0Y/7EYee4T1pLg4ZxpGJ1tePpf8zTVql2JcV4wiwIbAa3zkmu+szxx2rWJVFV vvrw6XEGAiAqQEEwBfE+Q7ApEQ3qyjn/JIuC2mfB9L8LdHPnetpEYDO/pKa16FNCoANJ1CNoctoR8zz7ylM6hGQlAqA+45c4PsH5XFjW01h5QfTB5boQVuN0RR7+grnx4bu4cdKJJVEOvTnHYm/hfhmB xJUVGD6hiE0ae1BzoftOEKZv1H3QjSbsIG+Hr/WPkbMLSMBg1bupxJdEr96JAXGB/df7G5CAAAAAAAAAEhrLF66jL5s1YH8AwK5/Mfvv3GEnt+U6TRjxkyu27ZtG527eIladexMIZMm0/gJE2hcsDAjD Q7R5RAzHxQykfoPHkJxCUfocGw8DRk2nH0tFfP9tHINfdO+M125fJnrVq5aRXXadKIhvkkLdCnF4Q5ALejJI7inv2lGt9asp5tLl9PNZcLCVtDVaTMp1q2wemHXeHVXPqqRKQddmTjFwe/5Lj3sd/Tpf jKy79b6jc9d0183b3FEoSkwSgEwX1E6XtX+6vL1+QvUUWTrq8L60ZDoLDlZvDvboh1dmzGbHsTEPnfOk5/U0UePS5miohQ17+7em/KPakEJgLkc7hVUR4tV1KS8C1GZNZ/dHmFpPjCCI8CpBQTAF6RuE ncAJleMM4W0FAqAzn74FV95nPdZ1iDY8fEPKQLWD2ZRrFzvn585778qArByv0XUPGSD2luN0RR3RgmA/mF7TQHwxMWbZKs9jmzew6iWb5j9WwhfhgBoqxdM26PPcl7eefiq2Juk5PfzKaP4NhkbhFDGh iF83HnRrzHcVqj9HLKVG0xFO8+jc1fURanT1keSreJQjtwcvnhXsvYFAAAAAAAAAGmdyTNmUrV6jWl52HIu79uzhyb/sIhadetNUZEq6kzeCbg/Oo6+atYiRb6PHT1K8cI2/b6TfEaM5Lrtv/5KP4at4 jsHf/3lF647cGAffdmqPbVs3zFV9nT/kGMEoHFXnXwNV0acSdEphs2NYnOqO/LiLdGC0Zlz0pmmiaPkTn5Wl31Yj77GZMpBT65fT9a6ZPQgHwM21iXy8hVehz7yqDC/QGzMYXkNuGBJ9cpwjnwUkyUni 5Rnvm4m9huZ5HwJxUuzL2O9vLeM2VP+QZ0wBEDnV4Xt83hYoi89zLkd7ljUeQiAqQMEwBfEegeg8x15TxMEnYXBfxoBmF6Lf1m+m0IDfvidus7cxva9xbrN+oXaTtlMZXstUBF4DYKd5p9Iti/HUbam0 546b1ICYPp/IgA63QE4Y0MkFes0V+3t/ZF07Lz6gTh66W7y6pc4rNtrwGL6KlC9KmSNAJQC4NbI05xfv+8EvaYjAGX0YMjqA89cl8/CnZShcYhD3bWb9/jY8R9aVAQAAAAAAACA/1UePXxI0+f9QN5f1 Kdt29RddAf27aOBAcH0WaNv6f7du1wnBcC12/+get8+/6irlZjoaNobEUkLV6+l4aPUi7d7du+iZWs3UtPve9HycCU6Hjp4kFr26k9fNE6dh0CsdwCar+laI9X0wxUJliO/RlSePDJ7bdbcJP0eq/w+x eUr5vBQSFT6bMle15G3Kypxz/JyrhQbrTyIi6fDtkxaBLTfM5hg5u1j1RHkwnwv4cnP6yeaL861IIuG1sdQnB8e+SeYrwAbdyw6RwIaLw2bUYz2I8jOrydDAEwdIAC+IM86Amz7Yhy/Bvxcqzqcpq17/ ln9pCIA5Su+Lq1mJHu9BWTkW/3gxC/6fhZAfef/luQYZwHwn7wCvCP2HNmqj6AJqw/SyCW7afCCHWTzGkbhu45wu0fXH8iz/yKavzWGI/48tQCYXuyv8wzxH5J9Jyh7s2k0bPFO9S0+GEW7Y5VAZ/vEj zYcPMn5lbuPccSj5Mj562Sr7MtCY4iY1/bOAK7/dvw6jnqUPj8dEU7ley9QfryH08yNh2nh9jiyefrS5euJHxQBAAAAAAAAgP8lpAA4+6cFHAFoRONFH46kzkNG0Ptf1qe/HqsHHKUA+EP4aqrdKPGLs M9Cvh78667dNPnHhTRytLqLfe+e3bRA+KrXugOFhqmTYIcPRVC7/kOpdsOU+X8aRgSgEXlmimfuduHMPGZb2B5hl6Cj0uTYUw0Si5HHKr2nHrGwHM+NSp812es6+m5lh4g8FgAz5UjU7+GJkxTnWoiPA 5uPZlgeBrGWjfsE5f2C8pENK7F5CrMAaAqcLDimlgCYKwmRz55PcBZcncRAox0CYOoAAfAFcY4AzGAR/2auj6T9Ry7Szphzpu1wSqX9evgMP0zxPJK6A1AKgLlaTE/RmuWjGa80nugg6PEx4s8Ck+xvF QATvwKcPAHw4rU7LPz5LtxJPj/vpBFLdtGZy7cc+shHSQb8+IeY709a+Kv9roKBP/3BkX8/bIsx6/yW7RE+1dHdccv30WntS77iO2GVPervsviurSdtotaTN9G1W/fM+slrI9in9aivfEVY9pV3B8afv ZqsfQEAAAAAAABAWmfGvPn0yXctae3adVzet3c3dR48jD7+uimdPX2K67Zs3UrjZv1IH9VJHGX2LI4eOULrtv5Kw4Kn0uixfly3f+8eCpo1j2o1bkKbNqq78yIjDlKznv3p6xQeMX4apgCoRT8jSk0et 43J6sbCmmGx8hiwS0HzSKpxfDUuVwGKK1zCwe/Jj7/gO/WskW7yCPBfd5//O7+E5ylUUs+ljgDLx0mexrW5P9DRsp4U/cobaq258vMrwUY0XYL2Y97vlyW3Q/TikVLldMShXTiMSsUjwKbIZ3kIRO5HW pxOY3MXNOs4GtF8mVm/hAwBMFWAAPiCPC0CUEb2HTh68fkOUoBVALRGAKZUAGwStI5sdYMSHVGWR4RPX7qZqH9qRAACAAAAAAAAAPjvZObcufRVpx40Y9YsLu/8Ywf1GTGWPm/a2hTotmzZSgMDJtDH9 RrRkbg4OnzoEEUaFhGh7JCRqvqYqChavXIlrd+2nbr7jqGx/uraKCn2te4zkCrU/IROnTjOdTv++IOa9uhPnb/vlip7Mu8AtAhNUvw726It3du9l+5s/UXZtl/p9vqNdKFXf35kI6GwNcLOg2Jz5OWHP wzOtevMkXkOR2qzutKd7b8/d03ypeHojNnskYgyzVeMjlWq9vwN/f03r/fyyLF0/L2PKDpDVrGOwpa7CHUUY/5idLR0JXPYqS8a8Z2F5hFo+eruGy50d8++f/RdDVgAzJLbcpRZ+Zbf+M/R/nRp8DC6N GgYXRykUmmXR/lTQsnS6g5Ey52EiABMHSAAviDOAmAGiwC4K/b5L+ymBGcB0IgAzJlCAdDn5z/43r9ER5bFmjdHnEzUPzXuAAQAAAAAAAAA8N/J2jVrqd1AX+rRpx+X42JjaVTwJKrdoi0N9vHlui1bt lDbvoOp14ixtHz9Jgpdu5HCRbpy4xZauWkrrbLYig2bdZ8N3DYkMIRa9xlE/oHqOqfwlSupdst29FZ5T3MNP/68kFr06E9BwRNSZU8PDh2maH0E2Ii2k5Fol4Y+/ZXhW2vW8aMg9qg2NdZ6xPfqtFksC sZbIt9iXQrR+c7dn7um6z8tpNg37WP5AQzXQnSu/ff/aI+nv2qmxEjz8Q0VERj1yhtmHykYyqjBBEskpBQOz7V+scdWEgmAhhiazeWZ445VqGIeoTa+HyIAUwcIgC+I9QiwcwTgzn+RAJj+BQXAzjO28 D15zi8Uy3sA1+47nqi/IQAmujeQBUD8IwQAAAAAAACAtMzmzZtp7NTZVKN2HbNuzPjx1LBDV6r2aW0ub9u2jcvt+w+lxiL9tktPatqtD7Xo2Y9a9hpArXsPZGsl8i169KOmXfvQt517sDXr3pcad+xKE yZNpuNHj9IPS0Kpfrsu1Fa/+Hv0SAKFrllPdZu3od07d6bKnoxHQMx752SkWe4CdHHgkGeOi8qQzfHREClqZc5JD48c5fZHp89Q9KvZ7UdwjXv1Xn3+sdr4AiXMB0CMu/BisrnRzbAVifreDAunv+7dS 8KLIzKaz/qyLt9JmDEb/f3kifoOh6P4jkHrPXy8XrHPx5cuPdP36Ubf0e3NW5Nss78C7OFwn2FM1mcLgEfLeeo7De13MSICMHWAAPiCWCMAHe7H+xdHABriHR8BbpkyAVC+GizHJVrzJ/58N6EzzgLgP 4kAfPToMVUZmLy+t+88eG6fbZFnyFZF/Z+Zo/Kxj5J9OH/+6m11l+HffydrLgAAAAAAAAAAzybqcCRNX7CQWnbvQ7t27OC61atX0fdDR9JXnbrRpMmT6cD+/Ry151nrE/ppwQKaPnMm27QZ0mZom2lPR dvM2bMpIDCQQmbPo0+atKCpom3Prp3UvGc/8v60Du3bs4fn2rnjD5qxMJQqVa+RansyXwG2PJYRl7sgXRw49KljHl+4SDFZcjm8aCuFQ+nnXkSE2S+hyFsOL/RyVF2+onTkrfJP9X2q/tcsQCY4CWZSc HTm1roNdNiWkYUyQ8h7GjFv2KMczVeJLRGAEr6zsEAJy8vFHlyWrx3/dft2kn7/HB9C0Zne5KPGZ75rmajdfAXY4XGS5AiAXryvBMs3hgCYOkAAfEGSigDM8C+OAHR+BCR3CgTA7rN/4UdA0n/t+Jpwe uHXVnMMPXzwKNGY1DgC/ODBQ7K9PeC5/a5cv0O2Un2f229n7Hmyfa7uhzh16SbZvFTY+d9//c0PiQAAAAAAAAAASD0CJ4SQ3/S51LlHTy4/fvSIBgwbSa36DKKGrdrR6pUrqGHHblT+vQ9S5PfsmdM08 6eFVKd1R2revDktWrmWWvUdTB/U+tjss2LVKho5aSZ17PLPjsImhSkAWu7zkwLgJZ+kjwDf23+QEkqUtgt7xoMg7upIrTUa7/oPCzjyzvGV21J8154U+a5Omkb3o6LpQVw8XV+wSPh9l8U260vD3F/0d T46fDN0BUW9lFn5zl+Mo/euTJya5JrPdexKcfrxEmO9cQVLUFzeog79rs2Zz8Kc+RKyEbko9iojFy/0HkB3d++lh8eO0e1NW+lk7foUzdF9+l4/+YjHm3no7g77I5vWCEDzPsRCzz8CLAXA+PxW8RQRg KkFBMAXxDkC8N8hAFoj8V5qFEI5mk+jhHPXaWfc+cQWf4F+jz5L0zdEknuHuXzMN71TFCFHEjYMoazfTUly3tR4BOThw0dkq2D/PyktQzZyhKT3gMX09bi1Zv17g5exsPfN+HUUd0a9xBu28wiV6/Uz1 Rmzkv766y+u2xHnJAB6qx/Sjx//xa/4GkSe+JMq91tEHw9fTsErD1Dvub+abY0D11LpngscXhfuP/83+kN8r1q+YfTpiHB69Nj+f1MOHL0k1rtErHEpvzZssHznUV7fl2J9f+v1AQAAAAAAAEBaYuXKl TQ/dAW17t6Hjh09wnUb1q+n3iPGUrt+Q+jn0DBqN8CHKr5fM0V+jyQk0KyfF9PnTVvRpl9+pQ6DhtHbnlXpwrmz3L5t61ba+Psu+vKbZnTyeOIrq/4pDxwEQOO4aSm+B1Aef43KkJWj72QanTE7C2QOr +Xq/jJa7chb5RL5l6/ZqqOspewv+spxBUtQbM58HJkn5+c7/4TfBKtfLZbJB0GsXJ02k6JezmI+WsJ95SvBOfLxGo9XrUlnmrem0181oZic+VlANMU87V/e93ehz8DE63VXgqL12LJVGOUXkbPk4iPJ/ GiIw3o9eF8RNhuLhPx9Y2MpOksue/Qfv2icHAHQU63D8ogKBMDUAQLgC2KNAHS4T+/fFAFoiIByvmda7UCyNZjA4p/zWlnM+9iPZm06nOS8z74D8J8JgLYao6l0j58o4vhlytt2Fn0XrJ6TDwjbS7YPx 9Cavcfp/oNHtOCXWLJ9OZ4uXrtDszYe5nVKdj5FALx795EZQXj3nsiXG0wJZ6/S4RN/ivmH0K+Rp9X8H/nTuBX76Oqt+/RywxD6eXsc17/ZbBq92XQa7TtykYW+d7r/yPWHxDptFYfS1kOnaPnOI2Qrr X5g8vrqWNYnvhMAAAAAAAAApEV8Ro6mxes2Uot2Hcw6v4BA6js6kLr5jKJBARPIs+ZHKfJ5JCGe5i1eRt19R9EA/yD67OumNG3aNG67cf06bdq6jeYtX0ENGn2VqntxeAXYcuQ2wb2Uw315Dvf9WY6lG tFph9Nlpru7dify//jCBYpKl4UFOoeXcN1LOb0kXMrhGLKRRr2UhR8dsfJnYBBFvfy6Y1SdIa5JoS5fMYpzK8wv7fJLuoUdxUpZ5ywqGjy5elX55nEWUdTy2InhK8HdfrTZ+GYyEvHPgCDTnxkB6CCYJ k8AVI+A2CMhIQCmDhAAX5C6Tq8A/zsjAJ0fHnGucxYKk8qzWPnleCrUYe5T57VGADqMexEB8P1RdPrSTc7P3RJFhTvM5vzFa7fNu/0kUpD7fsY2WrvvBO2Qx34r+9Cx89c4Gi8pAfD+fSX6SaJO/slCo zlnZV+6fOMObYs8TbaP/PjPR/ptPmEDlegyj/tkazKVVu9V/8fi4DExx2dK0Ks2aCn1++G3RPvK0Xy6WN9W9sPHkj19KFZHLgIAAAAAAABAWmLTxo00d/EymiVsXJBd7Bk41IcG+QfTsAlTqerHn6XIZ 0J8HC1esZp8g6dQ3WatqV+/fmZb+PLl9NvBQ1Szdh26dfPGM7ykHFMANB4BcRa63K2CXCkzQi/BEPAKleRovMtjA586x92duygqXSYzws/hjj2n48GmSCb9vpSFrkyYlKTPazPmUJQtk3lnn/m6ryHKF bYLgwnulkhB0V+Ou7d3/zO+SSTPHe/wCq9HInHSekchPxiSKQeda9fFwZd5B6A5JrkCoJc9ctIYAwEwVYAA+IIkeQT4q399BODzxL7ktL/cOISFvfxtZz9z3qQeAUnpK8CJBMD3RvLjHZJpGyOpaMe5n D958YaDACjnaBK0jvr98Dv1mrudxobupeu379HehIvPFQAl7h3mUAYZIVkniPprAW/+1mh6RdSNWLyLes75lXwX7aQfRZ0ka5MptHK3CmfnKMPaag6P73+giWsOJtpXugYTnNa3hy5cvZOsbwIAAAAAA AAA/20MHTacftmznwKmTKfw8HCzfrSfH/X0HU3VP/0iRf5ioqNpxcYtVPG9WjRl8mSzftmypRR15DiNHB9CISEhqbZ+g/sHD1H0a2+q++bYijnlExtH2LkWVsdh33BJFKGXFI9OneaIPDlG+kiwRNU53 BEojwbnyMti2u0Nm5/p80FUNMW5ufMa5H1+9pd2HYVMFt3EfuSx3dic+elBfMJz1/v4zz+V6CZ9m49x6ChDh4jDkuJbFGKB87LfuMRrjIlRryHL72b5ftFZcjxz/qPvVuIoRvt3L85C4o2fFz937eDZQ AB8QTgCsG4QC3NWk4JZqguAn4yllxtPTDRXskyM46PCDYL5yKrtEz+yfR5IgeFPV/8NWAD82C/xHusF0QcpiQAsb39O3fb+SDp67hrnp22IpCJaAJTRfbbKdqHwo2Fh1H6q/Yefz0L15PuuuAtJPgJiF QDPX7nNfzbnRBp96gpdvakuZb1554GDSCjvSNwdf4Hzb3w3hVbs0gJgrF0AHPTTH5S/nV0o/XbcOn5pWN4TmNT6AAAAAAAAACCt0qVXb4o5fpLGTZ1By5YuM+s3bdpEg32TfkTjqYjfq4YMG2HeKyhZs mQxHTt9hsI3bKL6DRul1rIdeHA4mqPtjpb1fIp5OZUr07HK1elM09Z0Y0loiueTD20cebs8Rb/yBotrsVKUy+7GdwvKY7nyleDLo1J2pdSNxcvo+Hu1KDr9G+p+vqyuyme2PDyHfJxE3k94dfqsFK9XC m5Hy1RmH/b15uE5ojPnpOjXctDZZq3p8ZUrSY6XD5zEFyqR6BvGF/F45rwnanxMR96t6DAuoehbdDMs/JnjwPOBAPiC1BoaSraao8n2aYCjVRlO2w+fTtW5bFV89Z1+ASk0dQdg5m8nU9leC6jj9K20J eJUsuc9dPQiR9gl8vvhGKrY66dk+bh77wHZivSy76XMQIo5pX5QjF+5n7I3sb9aJI8ky2/qF6qefM/WdBpH8NneG8WCm2Tb4TNkqzqc8zKS0Oah7v27fech2dx7mL4yNp5IHwxZRu8Ls9Uaawp0czdH8 Z6yfDOZjyNHn75izr1oeyznf4kUc1QbbvqSD33YPhrLx4fLi+9ooNY3nv18NhI/lAAAAAAAAABpm3t37lDHHr3o7IWLtGzVGvIPTBwB9k+4fv06R/5duX6Dtmz/nd6vWStV/P5/4u/Hj/m13JvLV9DN0 OV055ff6MmNFz/e/DA+gW5v3MI+pe+7O3fT308ev/h6//qLfd0MU+uVrwA/PH7ihf2Cfz8QAMH/S+7df+RQfvzoyVN6Pp2G/qup7/ztZlm+9ltS3/VncPvOg5Q5/Tvp6n+yPgAAAAAAAAD4b+Xh/fvUo n1HioqLpyMnTtLw0WNp+/bE96Ynlw0bNtCOHTvo4aNHNPuHH6lOvQapuFoAAARAkGY5Lu8T/NSf3FrNJFdhttrj6OyVW//pZQEAAAAAAABAmqHPgIEUPG063bp9i37btZvGh0ykNWvX8gu+z+PkyZN8b Hjjxo105+5dOnfxPNX/5lsKHJc6EYUAADsQAEGa5+HDx4jQAwAAAAAAAIB/Ebt27aJGzVrQgmWhdO36NTpx5jStXreeFi1aTOvXr6dffv2Ffv/9d/rtt9/Ytm/fzhF/CUcS6N79+3T2/DnqN3go1a5Tj 65dvfqf3g4AaRIIgAAAAAAAAAAAAHhh1q1bT83btqfOPXvRqg0b6NTZM3T5yp905dpVunn7FtvV69fo8tU/Kf7oEZrz4wJq9M131LRla34NGADwrwMCIAAAAAAAAAAAAFKNhw8e0NJly6jvwMHUplMXa tmuAzVp2YqatmpDzdu0pVaiPGDQEFq/bv1/eqkA/M8AARAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAAAANIwEAABAAAAAAAAAAAAAEjDQAAEAAAAAAAAAAAAACANAwEQAAAAAAAAAAAAAIA0DARAAAAAA AAAAAAAAADSMBAAAQAAAAAAAAAAAABIw0AABAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAACANAwEQAAAAAAAAAAAAAAA0jAQAAEAAAAAAAAAAAAASMNAAAQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAg DQMBEAAAAAAAAAAAAAAANIwEAABAAAAAAAAAAAAAEjDQAAEAAAAAAAAAAAAACANAwEQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAADSMBAAAQAAAAAAAAAAAABIw0AABAAAAAAAAAAAAAAgDQMBEAAAA AAAAAAAAACANAwEQAAAAAAAAAAAAAAA0jAQAAEAAAAAAAAAAAAASMNAAAQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAAAANIwEAABAAAAAAAAAAAAAEjDQAAEAAAAAAAAAAAAA CANAwEQAAAAAAAAAAAAAIA0DARAAAAAAAAAAAAAAADSMBAAAQAAAAAAAAAAAABIw0AABAAAAAAAAAAAAAAgDQMBEAAAAAAAAAAAAACANIzNP1Nekub3Wh5OAzLnI3+2vCrldtGm202TZdnO9brN7K/yp s8shj/pX6X+Wex9jTllPx5jzK19y7oAi28/Yz1yDj3e7zU3Ydp3JsfxAZnzmuP9LOsz+rI/bs/jMHas8Ml1mfPrVPjJJMcVpFG2l2iYzUY/v5SOFqV7iX62pROm0oUiXWjJG/U/c729zjFN5+DDPjYdL ZDzcFnm0zmMWWizzu3sy9GPsS7rvNIWOIxz9Pez03w/O/mwlpUv65zW/aZL1H+B07eyfr8fhP0uLFLYQdsrdMj2Mqf7dXqILT3nlaWnCFsGbj8gytIidPuBp5hs2yf8H9DjD2j/Rvt+p7LRLi2C/dvrI nh+6SO96fugpb/jvLKP3MfLvA9Z3p/E+iJ0v0OWuaxrPKjnPGjxa/9G6cXeXtbrMdb3Cs8p66TPBPH3amSuL2ig69c01LUR+bg2IB+3xjTE7Ssa7PoVDXX7hoa4fivK35JPnu+0NWXzlWneZjQ0T3PTf PO2oKH5mot2WW4p2lvREJEOydeGBgsbom1wvnY0OG87kW/PNjR/JxqSvyMNLdiJbUj+DjS0QCfRr7NIu4j2LjQwf1caVKArDS7YTaQ9aFD+7pwONvLahhTsaW8TKZvID9TpIJ0OLtCL6wYWEH0L9iJfM e5rd1+qX2QYNXAXJtL6hX04X7+wqBdt9US5nruwIr5Up9gw+kLk6+p8HZHK+i/YhlHtoqKdzVrnS58WHU6fFxMm0to6/Uy0yfpPZSrsM1H/ibZPZVp8BNd9VHwk1RJ5mX4oyjJfQ1gtka9RYiTna4i2G iVG0Aci/0HJkWzvlxxB73sIE3XvlxwlbCRV8xhJ1UuNpuoeo6iaKFeVdaKtquhbRZgsV5H1wpe3GOsl6rzEGK9SKvUUdZ4yX0rUcX4kVRK+KpcS9tYIqiDaKoh+FUV9BVH3bomhVKJwLypVpD95uPenU sI8ivSlEkX6UMki/ai4ex8qJsqGFbWUiworItOi/cjdSEV7IWEF3XuLtC8VKtaP8st8UZnvTwWKyHw/yle0N+Up2kukfSgv5/tQvmJ92WTezb0XuRXpxamLew9yFX1civQkt2IiFeNyFelBOYv2pFzCc mqT+azFulO2Il0pq7DsRUWerZuo70bZRFtWmRf2etGunGYq9j29VrwrvSbaXy0u8kW/p1eLaSsu0y72tGgX0c+5vrOo70wZi3em9NpeKaHzJbqIfBfKULyTsI5cx2kJUS7WQRnXq3ZZfqWETDsKnx0oo 0gzFO8g+nekV4q3o4xF23PfV3RfWf9yyU6U060l5XBtTtnZWghrRm+KOi67tdD1zUVdC7M9u5u9L/c3261jWug6a/8WlnmsqaO/xG3NndbRXPdr4dSvmaW+WeI6Yz3m2tR637SWHcbY7U1Om4p+0uSem iaew83o35Syuap+0rK5NlH5PMrPm65NuU9OkZeWQ+RzuDSl3C7NKLdYR27hU9bnku0uTbiNyyLNJcrZxZ9PZvFvIUvhbpRF/P3O7N6Tsojy64V7COsu6ntyPrP4N8Btos/rol3mZV0WrhMm/l1ky9+NM pYbRbb3J5Ct2nhhQcqqjCNbVZnKumCRH6/KnI6ndNXsee5T1Rg73l5f1TLW6C/7St/WsjGPtZ/VzLbxiX3I1Huc3Y8xxqjjfTi1WX2Z6w5yXId17irjLd/Evh7+BjLvHWif3zOAXmq+kNK1W0y21j9rW 6isjbJXRP6lNotUWbS/LPIv6byt1QLdX9Qb47Qf1ccypu0iSmeMa7nAzL/USs6jxsi5XhHll435RH06Wc/lRaJ9EfdLp9fGvhzyapycO51lPbJ/Oj1/OnMvCx1S2Sb38Epri1+ZfjePbON3kG3yTrKF7 CLbJJFO+INsE0U6UdSHGPaHJW+pmyjGTNyj0skinbxbmfQjU/aj/YbIul26fZcy6WeS7meOtbQbPiftVX2M+il71Pom6Tbup9fBfUR98O8qlXNM/EPZpB3KQnSe17NL+TL7yLXofhN1ntt0We5DplN2q Xr57SbpOva/U/n/8SDZfjosLFLYIWULdPpThDZrncUWRNr7/RCh+nCdsB8PWVJni3CcY4FOue9h7fuwfV0LonRbEuv5McLu90dL+48RT1nzYad9JrVvS3mBZU0O69b7dCgn4efHyMRrMO1w4rUae3BY/ 2GVN+oMs+7dnEua+DNdcIZsMwaKP+8y4s/6A/Hn/774uyDSSSKd/IHKGybbptZwrJ+s+022jDVN9q1h6avzU3Vq+Jmk/cpUjpkiy05zT7X6McbWtOcnaf+Ta1jWY+zDqHNqM3xNqE6dw+uT/7rG5Lumk TB76rNa/K4j82tVncwPE3mu03lf3T5M9l+jUu6jx/qsbmj2911rLxvma/QRxnMa86z5ypzDOp91jFpXY3PNck5zD5Y2H05lf/G7Gs9j34taawPt17520+9ap32sNXw2VP2M/tqX76pG9N3iRtRiaSNqu bQBtVjSiJovbshpC5mKulbLGlIrnbbk1J5vsaS+ahfWWtaLutahDamtsHZhjdna6jLXLf+K0zZL64tUWgNqs6wetQmtp9Jl9cUY0U/4aifybZaIuqX1qL3Itxd924U2oraiLNvaiTEdwqTVpfZhX1DH8 DrUYXldrmsfWlfXS6tDPVbWp3KBnuQ+7F0qOqI0W7FRZaiYSIuPLKPKXK/a3Ye/Y+aLDH+XinD6jirL+uH2tqIjS6uyMOnTY3RZVafHm21Gf1FfxOLfaJNjiom1yD4qfcecx5iXx+t1FDXWZJnLWI9tc uGyNLlIOZrsLlKRnyLzsk6Wi5TndIrMu5ejKUXLcyrbp4r8FN0u85OMse7K36TCZcQ4VVb15cyU/RYpZ6nXfnmuxPMbPiYVLmvOr/Ll9Rzl7P0sc5r93Z1SvX5j71McxpYzv4EsTypsaZN9C4txRSuIf Fka75KLlrvlpeWuysJc7Xmrhbvmc+hjlGUaznV5Eo2x1+Vz8pNH553nsI7L5+TLeU2O7Sss65FpqPCh1pbPYayzH+c1GL7DdFu407jwp6RqTB6xDqN/Plrq5kaRLvkpOldeisyZj6JzFqSo3AXocO78F CnscK4CXC/L0g7pvEyjXApwGpkrv2k8juvyqfEu+fXYAlyW9XLcYWm5VPmwnk/OK9u4PbfdZ4xrQTqUK5+9Lmd+cz3Sv/RrjIkWqezDfvSc0WK8nOOQdR+58pnrkhaVXZRz6D3r9Rjrk8ZjDd+iPSJHX nNOu281X4xYX7TwFZVDre941py0rrA3+ZTvTQHvtCG/0m0o8J32FFCmLfmX7kD+74p86Y6i3Nm0wLLfi7QLjSvblQLLdSP/Ml3ZAkQ5oEw30d5T5cv2EPnuok9P8i/Xi/wcrA+NLdtH1PelgPL9ya9sP wqoMID8Rd5fpH6yrrxIy8m6gSIVVmEIja00lPwqDqWx5YfSGGF+5X04L82vgq8l78PtY0W7n0xFWdYZ48Za2yoOE3MOFu0jqIXnOGotrXKgMp1vVTmA2hh5kbbyDKQWXoHUUvwi19JrnJm2ENZc1DfzG i/y40V+PDWVfcUvmNKaCftWjG/iLeq9g6iJaDfsWzH2Oy/VLtPvqgTRt6L/NzKV9WKMzH8tfnH8ii2YvhLlhlVEKtoaVpX5IGpQReUbifZ64hfPhuKX6vqi3EBYfdFev/oEaiDqpNUVVseS1hNtdcQvq jL/pUi/1Pna4hfgL94TafUg+kL88s8my+8F0efVRVs1Vf+ZGP/5e8I+CKJPRPqJ6CPt0/dDqJYYW63yCKruOZLe8xwt0lH0ntcI8q48jKpW1qn3aPL2FHmvUeRdZRRV9Rop8iPJq/JwLlfxHkVeYoxMv YVV9BzOVkmMqST6lZdlb5EXbRW8VF05r2FUzns4lfUeRmVFvqxoLyPKZUS+tKevSr2G07uePlTGU+aFib7vevnSO14+VMpzKL3l7UslPYfQ296iLM1rKJWo4kMlvEXqNYSKew2mkka+iioX9xpExbxF6 j2Eiop8EVFfuMpgcq8q00FUuOpgKug9gArJVJQLsQ0WNlCUB+qypb6qqPcW9WJMgSoDKL8o56s6iNP8oj+nbP2FDRBtIq3Sn8v5qskx/XS9GCvzoq2Ad1/hr79Zzle1r+jTjwp59bWPkb6r9Wd/77zbj UqU6U4e4t93ydLdtHXXaVdlZbpZ2rSVsbQ7tHV1qrf66vaUORKnHmW6O/W1jOe27pR4Td2d1uG8ru5P6d/Vsh+jnIT/p+5H7bdE6S7Cvhdjvxfr78pWUpRLlemmyuIbv1W6B3kY8737vcN39BC+S/C47 0W/rlRKjuVU2Vui/9vC3irTk9zF3/ki4u96UfH3uwjbUCpa2UeYqKs8lNMi4u+/7KNSH+5bTPbhOmHi30xx8TM4/wf+5NJwNrnUn0G56wn7chq51ptJLsJkWeZz150hyjMoZ51plLuOyNe11s/kstFf9 jPac9WdzvncupxT+Jb9jLFGauSNcVYfLhafLpa2XHWUbzf2MV30naX61xfzyr2I1KWBqJPlOtO5LU/92WqMqHPjeY31TTfnyi391pP+p/F+3Ix11Xfcr/wWvKd69rXn/GIquXZdTrl7r6DcPUXaaznlE mlOYbl6yTSM8sh6kcqy7OPaO5zchMk6F13n0iuccvYK57wcI/246joe1yOU+7r1MuYJ536yj4tIeYwel5P9hnN/V9FXzi/7uen1uci6HqKuh15nz1CeQ647Rw/lI4/sL+dmv2qNubR/NZ8qu+p51Hi97 p7LeWxuHi98dVpCb87eT1nm7aNMs4XN2kOvifS12XvptVl7KYuwTHP2UmZRzjxrn0j3UZa5+ynznAOUad4ByiLKmeeK/Jz9nJdtr4tyZuHzDdHn1dmyr/Al2jOLtldnH6CXRR2PnXuQXhf10rLymH3s9 1WRzyLqMs0R6xF9MolxvKY50r9oF21vyDnlHKI9C693H/t5VYx/XdhrM3eLdahxWUQ585w9on4fpZ+9h+fJNEv1N9cu0mxzpf99vF+eX3yLrPPU+rOIsZnnybn2U/qZop+sF75kXzk+02z1jd7gvnspu xj78tJosoXGChNpWAzZlkXZ89JCtS2N0vlouy0X45ZFO9aZ/WK0X+2TfUercpjVpx4XpttC4/SYGPu6jHaHuWLs611maXNeD9clsfawGEff5vqiE/VNJ9cRFm03Xl+svZ7nMNZimWuZ5RskWpNlXcus5 STWYN1fqNM6zD8zsZ6wOHO+V5b/Sbb5Xck251OyzWtItrkNRL6+ys9vqNJ5om5uQ0ebr+tlu+w/X4/lcTo1+zfQ1sjR53zdV6Y/GP6SmMuwObrNWKeZt5SNunmNdLmRXpfVbyO97gaq38z61Di8Gc3ZL n6P2dSWAje3Yxu3pb3Kb2lDAZtbcxq4pZ3ItyP/jW24PWBzWwqwjLGabJP9zXwSfbhNj1d92gq/Yu6tMlVlnnOTYyrnNua3ziHbuX6TU/3mNpyO29qOzT6/fQ61ljZ6z/Z1WecN3NzeXKexJ/ve2tJ4k QaL79RjVTvqsrI1dVvVlnqsaU/dRdp1RRvqtrqdyCvrulKURZ/uq6WJMatFX5F2XyXya3Qqy9p6in69RNp7TVtOe4k+vde2ZeO8Wa/KPVe1VHXC5Njea4StakW9V2tbZVhL6iPae65sQb1WtmTrI8b3X dOS+q5tLkyWW3Aqrd+6VsJa0kDxd8AruBZ5jvuAvINrUhVhlYM+FHU1yTOoJlWdUIutsiyPr0Gesm9QTbvJuiA5piZ5SQv+kCpb6rhPsPLnbY6T7aJOmGr7kMvGOC7L/AR7nRoj5xN+5BqC1XyePLam6 ifycq2y7C3y3iIv9yTn9mJfNcmmRD0thBUpb4pvhqBnrZuiRTtDFJtsEeSmOIh15S1CnhID2WehMk5iXFklKmohUPXT/gqXM31OMcXGcg5CnlFniHNG+xQt4k2xiI6GMDjVXKfaB/dxL+swl/V7mIKo0 Vf7nVysMoXkK0bL3HLTCjclYEkxMEwKgmz5HNIwtzwULvs5tNst3NLPPtbeN9ypv8M4V/v4cEt9uC6HJ/KXV68ln7nmMD2PnD/MbM/jsNZwy56MvYQ77NNxrjDdx/CZ1L6te1xh5F3z0tI8eSjGJS9F5 cxL0dnzU6SrFAOlCJePonIbopYW67QAd9hJpFP5Aiy+HZa+XAqK+gJaACxgim6GmGYIgSy0uWhRT/eNNMQ5Y5xFQDTEwUO58plC3GGrPxclDhplU8yzipCGSGmImXqeQ7m1z1wF9BgnMVKLezIfIb6VI RzyGNeCdhFS75sFUlclnsbkzEPxOVxoRGkp3rWmcaXFD/x3xX8wS7cn/zJSAJT5jsI6UaAUAMtKAbCrKHfhNKDs91r8k0JgN04NAVAKf1IElOZfvpew3uRfoY8WA/sI6yvq+nIqxb+x5fuRXwUpAPang IoDRN0gFv4CKg7mvH/5wTSmwmDyr6RFvApDWcDzr+jrIAT6V/AV/WTq4ygGyrSiMlnnV36YEg3F+HEVh9DQiqNYsGvnpYS/NiKvTORZDAwU6Thq5RWoBEDvcdTaaxzXy3xzkbb0VmKgFACbe9utmWiTw mBTYVLck4JfsypBWgi0i4AsAIo5vhN1LAAKX99UDRL1or1qMH0rrLFo+1qLf1+L9kacDzZFPykANpDCoBT9qgmrLupY9Ati0Y8FQGH1pPAn0rpa+KtnydcVY+pok3VfVA+i2lLkk6kW/gz7rPo4ql3dE AhDWAD87P0g+liM/VSLgB/L9IMJ9B6LfiOpuudokY6m6l4jqBqLgMPJ23M4VZHCn+cIe+o9ivNeIi+FP2/vkSIdyam0SiwADlMCoChX9FLin0wrakGwgvcIKldlOIuA5byVAFiuykiRDrcIgL5UmsvDl Dgo81IE9PSht7yGsuBXykvktQAoBcFi3kNY9Csp2gzxr6QwFgariLJoL65N5ouKeikAFqwyhIU8KQBKYY/TqoNYCLSLfVr4qzpI9xvEAqBRn6+aFOVkOkiJgdUGi7Q/Fag6yBTuDMFPCoAFqvQ386rcj 4W+gt7S+nMq+8ixBbne3lcJiGJur94sAJYs14M8ytiFL5n30CKchyHISeGLhSzVZuRZuOIxXbmvhx5vCGVWIc/DIrJ5lHEU4uxju5uCo30djvOVEj9/1LyGf/uajbx9Totvi3BplD1Mv/Zx5r4t38Gx3 rq3rmadh7Emi2DoYRVDpSCov1NJyzd8q0wPNg9T6NQCYZmuSlDkshIWS73bhUqJvkXE33kl9A0ld/H3XYp7UtgrJsrFpNhXeQiXi4p8scq+FuFPpzzGh+sLVR1DuRvNIZe6002hT4ls08mt/izKJfNS/ DLENRbxZpAri2ZaRGMRTI6b7iTkCdPiG1td5ZfFO+5njLWLai51jX5akNR5Q4jLredy1cJh7rrT1NxWsbG+8p27jlori4R1prO5GcKlXotVcLQKia56LhdDDJXrM+a1rqv+TLuQKL5N3m7LyaV3uDIpn vU2RLAwcukZSvl6hbMIl1e359IioKsW5lykeNhruRbtVB8W+6QP0S+HFhPlGGOs2b+3EtpYeOylREYXLby5mvkwyi3n66UFwF7GvFJgXE45u4eaQqL05SbWk0+Ym/abu7daV84eSliUfvL2VP2kscjXZ 4Vatyi7inxeLTzK/nm7LKHX5++nV+cdpEyz9rJwJ8U/FvNE+jqLcvvpDdEuBT1ZJwU5KeYpge4A22vzDrF4l3nuQcowS4l1mWZrcU2KhXNl3SHKLvqm5zn2U8Y5SnSUoqEU9OT41+bt57rXdBvPL/y8M UcLeXP3K5FRrkkKeMKyzTvIop9cuxQfpWiZxdjDHCnsHdQi3l56Q+5p7j4W67Lw2rSIKNc1az+LkllnS7FwL2WUexXzynImYUqAFN9ozj5uzzRrNwt+2YW/N0S79P/6nD08R7YZu+jVRZFkC4u1C2UsJ kUlFskSiWhOfZMU32IsAlm0RVB08rfMImw5CIlOwlxS4l4iUc/aP8pxrHX8sujEot8yp307CHLRSa/dXJdl7qT247DPGMc9Gv6sAqzz+GXO/izCKpfj7PVLYyjD8vNkm9dUWF2LeNYgsUBntlkEN0NEm 28RBOc30mKbVXRrYBEWrW0N7D4N0W5+I0ehbq5FzDP6GULgHCex0Co6zmtkL89zapvbwOJTpLPqU4mfv6b529tT4CYlbI0zhDEWtqTwJwVAJ6FOimFSMGMhTotypkDmKOwZdeO2WIRFJwEwkMW7Drp/a xbtlNDWzmG8MWacFucCzbb2Zptcl9l3s5Fvo0XMtuYeDEFznLEeXkt7ZVvamcKgEiate2tj7s06j+wfsqUV9V/bjrqwsNeWRb4eOu22qhV1X9WaBcBuK4229iLVQt8q1VeO6ynHaBGwxxqZb8353hYRs I+YhwVAKfzJelGWdb2kmLiqtVnfU8zba7WwNa1MgdAQAaXwJwVAQxDkPJfbcF4Kfob4ZwiA/YX1FvmyAe+RZ1At8g6pyWKgl0W88wqqoQU6o1yTvCco4U6KcYYAaKZBH9oFPGFexjgpDApflYNrmH68p LCoxUAlFBqCXg1T8FNCZA0lFo5X9d5aMPQyxb+adnFQi3+V9ZzeFkFQ+rJJUW6qjGgzIud0ZJwRzWeKYO726EBVV94UxaaaY+xjTfHQEOWkiGeJBjQi7eyRg5Z+RexReI5iX1kHQdC6romFytgFv8L2d Rtr5YhEyzyTjXVr31OKlrcLkJa9qvnsAqIhDIYUKUsh7pVoeV43JbS5Ogp+VnEr3CK0hSfRHqqFNkcRz1EATFzWIpyrFvlcjbGqPVQLieFOwp+zCGhdb5hTXahFDEzeuhKLn4awGO4k9jmuLZ8WSHVko Ft+WuHmRnE5lTgW/WZ+OiTqolnwUiKXFNvM6DstcrEYpiMAzeg9M+JOCW9RFoHMiJCTkXyG4GdE43F0nvSTQ5RzKhHwkI4gNCPrLJF3hkjI42TE4ps66i+3PXrPKtwZazikBUIzus8SPWiKmOZ+Cph97 VGDBXhNct4oF7sYyEJfbi2a8twqWjE6l+jHYqrax4msb9Lc4nVoWLmuFFC6DfmXbm1GAAaU6Uh+HAnYicaV7aIiAMUvlgHldMSfFPrKdjNFQBkRyBF/ZWR9D9FPiYAc9Ve+tyXtTQHl+9HYcn04ApBNR /7JVAqA/lL0E2YIgf4VhpBfpSEUUMmHo/fYKgxlsc9PR/iNKT+Ezd+IBrS0sQBolKVoKFJ/HuNDQRWHUo9KY6ilFP6cogDb6DoW/2QEoJdql0JfKy0Cysi/llIYZMFPRQAa1lxG/3mpiEFZbuIdxNF/h vAn81Lwk2Kgiv4bT995GhGAWgC05L+uPoEFwEZaCJRRf19pwU8KgI2rTaBGwpQAGMzCX0MpAsoIQR39V6+qFvqqKbFP5YOo3vshnP9C9K1TPYgFwjpa+PtS9PuSo/+C2ewiYDBHAap0AtUWfWp/oES/j 8U4Gf0n048/CKIPvP2omudwFv+qVR5F1b2GswBYxVOmKsJPRvwZkYBenlIYHKmiAquMYtGvikg9vZQgWMmMABypBEBvqwAoTNRVqDLSjACUQmBZMWfZKiOojJchAA7nqL93pRBY2UeLgSoCUNpbUvir4 ktvVxnGwh+LgaJc3HMwC3tS+GPzHkoeor5kVR8qbhEAS1RRadGqUgSU0X9DqbAW9gqaUX+DWRSU0YGclxGAMtqv6mDdb6CKAORIv0Es9OWtpqL/8nE6gAVBJQL2UyKgFvpkPn81FflniHwsEFZVUX9S/ JNRgDKysGBVIwqwvykiSstbfSAVqdyHI8qKl1PiVwnx791DimtltVhmjcYzBLPSdgHNKvB5mEKeFr60SGdEtsk6JdxZhDPu7yTEaVHPQWg0BTGrYNjdLuaZfrs5iXDdE6/dFAK7W0S/7g4CodmvTDdz7 aYwadSZ6zTEz+4OYqRdPOxqWVd3iyCoIwQNUdMifL4lv5WM+LOIph6lv6cSWgB8S+yXo/8q++jovqEs5LF5KgFQin6GKFiExT/RT/zdL+blyymPlf3Fz99i4t9XrvqztICnRTmOrlOWhwW5mZy61bGLX i6mADhN5fU4KZ5Jkc1V9OWxMq2jhEA3XXbTIh/3rasFQ55jBs+RS0bSSYHNGPOlEu9c6qgIPde6dlGPhUouzzAjFl1lnzpKAHTTwpxRl8cQJaWvL5VPOUfuejN0pKDdh2xz0ZGGvN46ao9yjbxe/T2UT +Hn82mUt3so5ekdRnml4NcrlNN8vWTknz3N23s5C4F5eylRL4+w/FIY7BPO/Qv0VHUFeq8Q9VKAW0luok2KfXm1ICfHSh/5e2pfLPKFiT5qblcZbSjX0Hs5zyfzrn1k3+UO68nbM5TnYr99VrK59JYiY ChH/uXpqfrK8fnlunvLqL9lLGjmY4FTjO2zggXKfFIIFHlXLV669rZHHuZloVD46BZKOX84xEJd5pl7KIOMBpTRbtI4mu+gGan3GkcDRlAGYa/KaDmO0jPEO5mKPnNF+9yDLNi9roVCFd13gF6X4p7IS 5+v6zEc0SfFRDmWxT8x5/wDLNzJPtKnzEvhTUbzcXQei4l7WPBTIp+cI4Kj+pRQuc+sf2P2PjO6L+scNV6OlWt+Xc8h+72uBUMpDr4qxTy5v/lq3uxi3Bvi20i/WdnPXvb1hsxLsc+onyvFxb0cGfi6F AwXRCQh9DmJX0a7g4DnHElnFbWs4lSMXcxaZmlzFvSM/s7+rFGDSy2ClxExt9TiKymRz1ncs+7LKeouHUc0RiX24/wdnP2aEY5Ogl4ScyQabxUbjf0vi36GCJmUoChTi4gbFktZQ0+Sbd4Xwuprga6RP UrPEPWcI/HmNXIS8Cwi4HyLCGgV4JxTZ7HOoV2X5zfW0XpOAuC8JMYkNX6eJUpwXiO7KGjdE/dtIP69NqTZ28TvL1uksNaRAoWN39KRAra2pwApyrFJUawDC37jtop0a0caJ8ZIYWz81vYOkYAqMq+9m QZyf+FfCnpSdNuqRDczYo/7CV/Sp54jYLOeb7PKjxPrMX1tUfMHGqLfZktUoBbueB6er73qy2toz2sO2NqBxxjrGretoxq3tb05TomDbSwioBYXrZF/WtAMMKMJ21PQ1rbku6E9dV4po/7asYjXc01bU +BTwp+M9tPRgKvbc2pE//Vc3daM+pNmCH8qQrAt9RTlnlrsk2KeFANlntPVRrmtEgJ1m4ocbKNEQM63VnmO/jMiAlty2mulEgs5ulALgobw13etjARUAmCnsCZU2v89qhRckyoFfcACnBLqarJYJ4U0z ou6SsIqTrCXPXmMFvUmWMbJfsGqb4XgD6hSyIeO/sbXUP6kuKfHeeqxlaw+xHo4P6GmXTy0zG3UGfNKX5W0iGjtY6xF9rWZ0X6GeOYkrFkj/qYUKW8eFzYj4QxhzBoVaBXudB8pNE6xRNWZx23NiMByK jqvsHHctrzZNsk48qvNEOrMCECrWGkV7wxBr4gh+FUwjyZbRUZrlONkSxsLhzJqsYjyKdc31Zy3PIWUqEgr3SvSijwufGyVhS1XI/rNLsYtdxIAHQU/e5tzhJw9cs7ezx7RZxnn6iiyhVlEOOcIvWeJk 87zJO3Lug5nv/b1hVmEzaQj/vKaEYbOUY/yCPJaUU5gATCfGYkXmdt+3NY4RsupFuiMKEAWyVzsUXZKaLNE+uWyR+YZx2MP5VC+OTpOzyej7qKkkPdmfnskoRk1aAiPSlgzIwVFfWzOAhSTowALgVEul rXpsYYIaRf9lIjHEXwu9iPJ1mPFhoBpRj0aEYbanyGGWgVDOTZGrj17PrV/FyWiRucuKHy4UZRoT8iVm/bmKUm+8shumTbk93Z78tMCoN+77bUQ6HgE2F9GAUohUOSlAOgnfuEcV667OgIs07LddPRfT 0sEYB8KqKBsbNne+vhvP1Hfzzz6Ky2gvBQA+yvxr+Jg8is/UNQNpDHlB9PYikPIv+JQLfQpAZBFQFHmaD8t7I0pbwh/KhqQjwBbogRVZKDuX9GHgkW+g+WYb2stArbxDNRHgAPtx4KNqD957FdG/Okjw FIYbMmRfuNY6GsqxjfXgqCqC6Qmol0KgNKaeasIwO887Ud/jSjA77zVkV9pX8tIQS0AfstHgFX0X2ORyrZG1eQRYHX8VxpHAVazHAGuPoGPAEsRsJ7sI0XBqioSkAVAjgR0jALkyD8pBIp9yfznws+X7 8lIQLvw9+UHE5TwJ48Ff6COBX9ePYQFwE/fD6JPqksRUB3//eQ9KQAGU61qgXwEuHplFQEojwBX9dQiYOXhVJUj/kY6mhT/OAJwpBIBdQSglxT9vBwjAOWx3/KiTubLVR7GaXkW+HxZ/CsjBT8ZAShFQ G8lApbRUX989LeyL5WuMsIU/9728qG3pejnrUVA72FKEBR18pivcQRYRQJKIXAwR/8VF/liXoNYCCzmpY4BF/Y2jgEPcYj4K2g98mscC7aUzQjAKvLIr+hbfbA5pmCVASwAsghYTR0BViLgAI7wM6L/5 FFfJeY5Hgfm474yClD4KcSRgKJfNSNCUI8Vlve9QVSsUg96i4WlLlSyXFcWAlmEKquOorKJfMmyShy0R611twtjZQ0BsLspjhmRbGb0nykWGoKak6hmRvMZZhUYuzml3U1R0H7M1jKXcdTXUm+PbnSKz nMWMZ0iD0sakYws8Bl7N6Ikuzt+Bz2vGTnpIDBa9l7WLh6WNKP7pODXXfxZCOP9deFjwHwEWORLiZ/Nb+s1l9LRhkWqjGQBj8U8FvyGWsQ/H/PYL0f6yWhAkcpIQdm/iO5TTI8vJv6dujacYwpsUmwzR Lmcdaay4CWj/qRYZkTwSbHNVUYCGlbXEMakWDaNI+LcDBFN+5IinIuOwnPVQp4SDmdaBD9D9NOinRbdVKqFOi3C8Vq1SJib16gFu7paIJR9LD7cOMJRrV36djPGyr1p4c+IGmTx0PCjxxlCoBzv8qX6J q56L/K4MEcG1p5K+XqEUd6+/8fYm395Xd15/mgnKrIvVZ/aEVAKjEptUCs7Gjsalc0sJjFCLYBQUFVQKDu4Qe1lbI1QVUC6k3TCUlUUmO4omOme75wWBTfAznSf+fbMOTPf+S/u9/1a7+vez4fM/HDPe 7/v+/4YyOFxnssIwi4EcLtJBVjYOoKgrqBtlMAYXj+PIK2wbRhBHkA7gnfn8VmBbwDjCloJ6gHggwHP5TFkhOv5LQT7cvEdBP3yUSlI99F85/Hdeaw0RPCIcI6u41pg/btH9P0FrQQN89tGUelXhGpAA IqgSqRncgVuouoQ3pF8D0JKXj9CyWEEm2BNnvyrL914ttICEJs0eN1NOf05Wn6nDt1w9wwRFJt8iuy596PaL7kHoGBybTyrAEEVd8/gDYSA9w1+7ibBHKAOZPXexNM33LQhAn8TEKAR6JvMSrxJQwQf7 wXF3alrqK67b/ATN3mQ7MHjQcGH6r1rCOHGszrxPl73RJ6XBqkD4f2gXLx/6Jr79sAnZGVGO/ANBIMT1AaczHGavvN+sPeC3fkkrQHfmTw7Fdf2CX4nAD48TvanIsCk5wEWjodrA8k8f3fDjRs20Mmq4 gJFWmxjjWGYgVHnjLotgHY3w/nORdd1jm8yg7MYwFn4lwm2xcAS4Zjdz/ANAczLoMqz1mX7m50VtWEmu+9fgJSxwvGcf/6uC7dCm7T93WVd8nwALv/sJsA8g8uN/TcCeoFKb4OHbGfWhRbg0+Z+eVaAo txnnxcwF9t6GciF1mG5d30I9GIgmdF2vM7AwA38vnX+XThPMk5scB0fNrk+gGEIwgCgGcB1lQEgArIGVtHV431dH3rgRpbZJoaDW3Dr4WE9AzujDOR3dAp4Y4AHxwjnGAJ2GtAH+x0fsfKQn++S5wzEw y0DR7lHhoeODTgX3sPrxS1CSJqjS9b1obcYi0qQvpGAZCfvg3352EdgAW5yzQDwLoKabzOCvh0XCfg1o/Jvk2se3YjQD6zCBAbrWRVIsFCtwQAQxRI85tWAOy6Kos9bga0NWCzAAgfx+uWNbA8GkEjwr w1AXzInwL7drAwEOLjrD6QGBFswbMUKvP8fN7qf/GaDe6RzmavuY3uvALbelQFEq2JLMEA5hHZyvv9xBocG1KGabyUPY9/to+fg/GKFenyeQeDinpU0H6sMFfrx+yt5Pnw3g0Q47wGmXwPNt8J8E+Rtz ikL1HKBEnAOqefeezCy9861ijwLCxkezvVw793Yoju7NIB+qqyb7bP93p1L11HVN7c8eCeq/wKVolfySeafwr05pcEW4J9mFyr888+/N1eUisaiHFmB35tTzjCy3PUn18eKl7mLBbPdiGT2GTVerOpLt /HeCdxlgnXp2xgGxupAsfmOGPjo7b52bZGqMA1GpqsPh818oY04kxoQoKcHfrEK0q+VbNJnk3NXk9/yX1HpRjCPAF2RUeIRWAPABZl2X2Z7WEjqtyKGZAIEBRjOUjBIIG6WArmbkVUX52YFIQLAaSYXM DkPeXpemecVerdYuWfz/AAsCmC8OZ1UhRb03QZ7smQcZrFSkAHlzewQIIriEX+HbA81cf7pZBu+lSIF4y3MKYT5+ZunF7JKcpa7BfMm3/Dv02a4rsfq3Vtg9X10s+soacDsv66S5Lh0qzv+WLJfuo1sw CXbEf7B6Cqj3D8CfjsQAhIA3Om6ASiCAhAUgaWt7nh5Gyr/AAQeL+VR1u66NPvvFbQAYxZgxSuq/gMICDmAby06gOM4bDnzT9V9CPcO8PagqgER9qHtVzIDyTLcwYrA47h/2HUuPoLZfpuqutKUfwgC+ dzGxZ0I+eAcWHoBAG6EvL/aZIAFGJR+tQD+egkAVpP9F3IAfwrKQFb6/bS2V9V/mgMISsBqUgAiCKwlZeCPGATCMWQAQv4fgL/nGQ5uYCi4XgZDQcwDTO5dA5bgJWQHhgxAVADKWNZvMgBJ8QcQULL/Q PUH5582KkCyAPcZK3Cfe2pJt2YAIgBc2uOeTLYwwAr8ZPLsk6AKXP42WX+rXiMrMKr/AP4dScZrBACrXsf9GgGANawMZAVgVXJ/FduBKzHnjzIARfWHCkC1A7+OsI8swK+hEhChX/URzQB8LBlqAa485 EpAHZgMzQFMtgj+WP33aLJdUHMIrb8A/ObXHmIL8MHAAgzn5lbvIztwcm4u5P8tOeAeqDng5jDUI/vvfm//xUzAfWoLnlXDULAWwN5ehICzwZ67hJSAhQYAghW4qM6fB8AHKj+BeXjMENDagFH9h6CvP Zk3ua6AkHL/RAFYXN6CyjMCfQz5GFAp+CvZngYCCQ4yKITzZS0MDlsI9lm1XGmLsdF6qyzCLIZzxQIOFf6lW40D+7Aq9AzUs1ZgeVdG9aKHjPONIi9NPWjWsEAgoFE4eugZzm9BpFc6tmh+YHid38EKx jCHMMwmXFCyzT1SQgAQ5iMF4EFS9jEAJIvvEbYAJ9eTPxei/AMQOFfOV4p6kLID5yV/J0MGYPZatvUC8FrzvsuF/Dy0AbNab+1Jztjj+9ay0g+HXCd7LjyrNuG1/Ize4y3DeLyWwF6uPCvnYF5+NsXrS Ml8yfyYz7eWMv7EspzDdt8cez+uXezJJ3SI1ZnWyO+Wc2u9PRmfW0dzZst3r/V2ZlkzWooBku644HLaRxGMAUgDZV0+WoDJBpzfSjCtCJV/wwrnCKSRYpDg3QUEaando3gdLMP5bSOuCFR/oNZrI9Udw DdU1rURZBMwiIo7AHUt511Oy3lWDF5A4CfQEGElrMEo/GANuQgSzyvgQytzKwPEFoKNOj+su+U8gkJaP23zeAuKQXwXKBpbKe8w6zdfu0lDX6D67f6hz1Gxdy9bghHIcfbeBLbeorIP7b9g4/2CLLsIA AEK3sCcPLjn3lNf4PkpqCKEe0ktOPkUXUfgCBmBAPhA1QcKutOfKQxESzGq+T5JxjU3FdV1dH18cg0hJWf/oe1XFImg7AO1INp9b6hdGADkDHgGBkLCT3EdaDNm5d7k06QGhHfhGCKV30TMQfwEVYCT2 Uo8NRlwbRo/M/kUwUIAhAAC7z1zzY0bkaw+AE4WckU21wDkxYq02+nQ6+zNCExFcDFQ80X3qPLP5BMGyreboYU2uH47/RkL26xVWNZngVoatDPKxRj+xfmDal2+AyS1wC8GmBb22VzA2MYswDECgt869 4379tlv3F0j/+7G/f6f3bhTyxigbQgBXpADuD6y+sp5BoECAa31N1bunTIQL8jyW+fhYCbYiNsN3vZr51OIl0EZmKYIjKChfsPzbtzJ59ymS/Xu3T+Byo1AH6j6uow9VrL1EHpFNl5R+5EtlyAi2GTVu vvxZgZ6Ygm2+XwMGq96C6/aej8iCIeKQ1ETovXYqPKukkJRYdxHRsV31SgCJbvvw/RnukXBeMUr/DoETl6heQQoSi4gQUf6LlIoimqx0fUm920fq6ecP1T3NbHqr0lB385Lja71cpNrHt2EsA+2LagGr Ge7MEE+Ug82JNt6tgSLepCvwX2XCQ7uYugnFuFdlxs1A1DyA+lcPSr+Wi+xNfgSKQJ9NuBLrv0SKQYxOxDzAxkGJtcPfFTvnhl81pV0LmMl3eMK5FSJp+q/FWS5FaiHwI/uIyC4WiEh3bNaAdziPgF9q xD8IbBLzlf2+2fkulcXrkYYGKwF38VKQgaMohqsEjUhnHs7eabfqwJFfQj3jBMY5vP+SrjEo9S9Mye20lq1n7HICqSbU+rBmQFygWrQQDtbuiEKP2/ZhfeXaXaglnbMKfV2XoWKVhFY6ryy0KsSrf33n Qj8WfWfv14eZgg+6NWP+C2z6b6LxbXu8rwlbhgLQUIFYJyXN5wGyzycsyDuQpplNpzzfBoQvBOoS79vJNcr+f7SGm0mYaZcw3TwmEkpmK4+HNE5wxxDUjJSnuHvcnPcf84hC/BXKQPOAHrNMNZbgHMzP DD7Mivf3copUlUfWmKzwkxAsQdr6YdAtZlexScAEXLzUC2Xkn1j051ZiBZbst0WqMX3awMcrd33pub+FSGgs/mBFurdVFjolY1i+dVCj6xCBYqS66d2YgMLsezDFIqQdbpQrcL4vTOL3H9Mn+HGHqhzR 0HZ99hmsgA/tsV1Igzcwso/sABv5dy/7Wj/Pb5wmy8BARAI++U7XEfyj9RuUP1hEUiL6yzf7Y6VtbluUP+VEfw7hgAQ9qkIhLL/9iIMBAswlIAABAQFIALACoJ/kAHYUeEtwAD0yOp7OFT4lRPgk/w/W wAihSDwHOT/Ha04gqUdCv20BKQLcwA3iQ24ilR+cA1Uf/U1PXgPwEDIAcRswNpu97MqKP3oZQVgt/spji73k2oqACHo143jpwz+fmJswD9B8NeF4O8nbAGGDECBfz9a0ofQT0Dg81gCYuAf24HRBry0j 4tAWA3ImYDPcb7fGrEBL/Pqv2cYCAocBOWfloBwEYgUgCAEBEC47G33PVQA9rnvLe92f72cMgDRArysx313RT8BwJq33LKq19zymtdRDSgW4BpW+tVVQfmHVwKCBbgagGANAUBVASbbSrYBWwWgFICAH XhRcr6Ubb6UAcggkDMAsfgDIF/VQQR+CgWrD6Mq8JHkvCoAEQDSFktBagT87XcLAPqB+q+ac/9Q9bcfC0EAAEIZCNh7YcyqOUDKP7D4cukHAsAaLvmo5S1nBM5C6OfhIDxL6r29BP0YAooasAhLO141K r52PMahmYB7NN9vFtiAa8kynL+ErMEABKEI5AG2COcv26tQb76q/RgAItgTCLhTgd+CshYGhMm5sp1uXtl2er5UrLY8hwLFnXxMQPBhgYG21INho80cDHIExQJsbccK/EIoF1h/F5p9USkGFt2d0ZzNH uSVhO/wmYT8HSUtwT0KBUvS8w1xfQj4TI6ghaE285DvW2CBJQPN75RCVuB2mre01c2tPoQAcG6VwD3O/0Mb8CHO/JNxWCEhnacykLmVpB6cX7bPpZ59z+VsGFQolrvOADABaXKOIWEugzMEdAzIJBNQ9 rNELbjupM/pwwIOhoCYp/c+FZCslVIQApAIBxXgEWyE92QhQKQh4E5AnLwf1H1ZAgHXvK9KwZx1J3T9+NxazidU+BnOZ7fZ/O0p8x470M78zPsuv3XU5bWPIGTLZYtvfivDuVYP5/LYGpzD0C/PXMsRe +1usNReJKCGoA8suSMIEAtaRxX24bO7/Px5rMrD7S66lmqDTL/zLtVyjmzArQT5chj05bBCEObKZSViHtt281hNiGAS7cICLgk4FjCcpG9giIjznue5SDEI4HDG7lE39ddfI1CbhPZYLvlA2+6nCP4ms 1V20tDnqJjDvD1Q3A2SRRbVfWjP/QzvHX+K1HcI5BgaAhScBlBxSK7dQKXcZFbMAXibiAUd11BNd9+AvI/gG1pyh7i4A8Db6S8IIDJUnMilJaIinMDW3wmcI4g5hQOU30cZg1QKMtXCPJgft5TvNwnVf cm5k5/gd07F72Pb7ykqB4FnIf8PzoEN+L6ha5gZOG2AlIakiougWSYrrc3Isyo6q/YLVH8ZrMV3stVmBHA8x9mv00FYmvIvBn6309es67kd3msLTzKp9OT8hVvh2uJ12HeIItBaojOpGnX+TN9nwWZkg 86Ui8jfcc/wf3ff+vtRN25gqcnGW+dz/0RV96v1YR6gBYQK2tYZoLc+fT+GdNZGrCpDuWdduBUrcBrYM2q/APbJ/BkgY1AWwqrAU8n8g+tc3dkfu1//01Z3/KrALc74i4o+RA0nkK7jw3oFbt1s0dUyD YF9rB60dmC1/1q1nsnzU7stwjexC4viEPIGeR5eq9p8BdCpes+fQ9B3xQNCySwMwB6DR7Qpf9ykSkV4Vu2+VzgvkKFfJyodWa2Y3Pf2FYB7m902gH1jDWTxTY4B/DUjAJQMwEZWBm6kYpBRsvkS6GtkM PgSKwFBvdfIdmCvEBQISMBwk4F/3h5MdmBWBkJ24B+aNDNQ8gF3fbBJlYGiCoTzu8dIMYjlIAwLD/yx0S195wlX1kOKPFXxGcuvV+mtUpAmQK6K4Z/af601V64JGBRQ12tsxXKuf7W+I1AemuuL7ToYE Mpz1UaRKO9YbNbh17+SW4CD8g7fjKvgL4BqfO3Bcl8cMsfaaMtUpYdgDyy0bNv11tty81yYyyfvV9imaygz74syA2Ues25d51xb9hHalhXqzRagVxJAxHcMFFRl4WzKBHzngTLXN/cxd3Fejftg/lI3/ MACdyEnmyBWBMJChV+ogBMgdqeMvXAOqyzMDN68NTecT/ZDW26+WnXvnPOXl/Y9IaSM1XzpVuZMJSLh95ON+SKrJ3+XvPNaVoH7ZjpZXm2m31fcgqsgjQGcWmal1Te7gEs/PHgLYJiUfGQJHJyFIO1W6 gEFeLeC9l0pDxFbbpFX3rHtlqCibRYu1GIQOYfKvGx/v80jtO+Reb/Ktq3A9PxXBkLqb8J5f7DmWzwnqv/YVvy1zhmu9xbYhKEgZUaBe62szXUubCAFYMlW173wZXccykC4BIQg4DZvA4ZGYM4AFOsvA EBQ/YH6rwtVgG1U/AElIKW7ggZgKgB5Jdnuwfw/tQEv2uuOlb1K9l8sACEF4DFo613MZR/Q3rvosMI+KgA5ZFSBHvQdF/An9yfn3yw7gGCwZ9F+117xhvtZFRSA9KjdFzL/6tkOXM/qwI2LOikDsJILP 6qoIRigH+QAbkRVINh/ufxDFIA1VAACuX8vSAEIwr8eBn+i/gMrMIHCF4zyTzIAf8C5fz+CrD8AgXW9uBUF4IZaGtgIzOdE/YdlIKACXNKPQ6Dfs2wBfo5hnxaAYAswHZMCsI9swJj110s5gFD+sRwsw t3umeVvkwUYrMHLe9D2iy3AoABc3u+eWN7r/nrlL9zyJZ1uSeURVAACCFzK9l9U/tW84eok86+KASCDwLq6N111Dd1TBcCwhgDgomSuyqrXWfXHW4CBAgVrAfgdwTZggH2lNWT/hYGlH9VHNAOwREpBu AQEWoDB8isA8DvVBP8erjrAAJAhIBaC0ABb8ENoBT7gHqolCAgtwHO4AfiBmv3a7juL4R8Av1kKBa0dmMpCZtURABR7sMC/wlppBN5H2YC1PvtPYR+rAMn6+0pavh/l/73iCvCe9uS9dA6uYT5g9W5Xs HQv2krnlQGAayaIV9ai0K64ZEdgA16ASkGGelxmQYo/glTzypojBSEDRNjndxSrgtBbaBGysXJQlXbGXrxA7by2dGQH2mcVFMZFH6qmC2GjPl/abOYx5SBBAUpsIfZ5gL6QRBSCzbzWyFoMjb9qL24O8 wFNnmFYluKLRvT3UZDItmcEgEeo9bfqICv7yAI8l+HeQ8bmS4Phn7k2l9uAiysOuIKn3nXZGwY4w88XfKhajkFeyqj3pERDQJ5VC4pSL4cttQTI6F4EfgISGf55Fd37oWpv7QlWA54I1uPff0LfkbKqP bDwChxce8Ks8YSqGFXZKEpE3H/fw0SGngIU8R285mxWMmKb8BoPFVNPQwvweQSAlMc3QnbZ1vNe3WdUepLTl2ugHYE22s+Gc7tHWRU4gnmAqChMtoWcA5jf6kFdvlpzyTIM25zdYMs951JiHWaVXj4We pwnizAr9lAlCGuWOdu8tTeX7cgCL1VlyDAQ1pTXZuYHWzBnBubxb1AA+X/7Lrupv/4SoR3YfaewZRe294AiD4o8TlExB+XrEQScwsUZ9wB445w/sPxibl9yjy3YuA+z967ROcwA/NTdh3MTVLsfrbnXE NRNHKImXiz7ACtuct+9Q9fweQBtoNibdvoLbAKGlt5JBlASCPwMi0gmDRLMA1UjvA9beqUEBDL+2MI7hcs7JqLF+TO8PmWIClCwNGSIQB4AvkkMAKfDfrJmODeZi0CmQGPwwDV6Dt538pPkvmvuboVu1 voaQaoYsFnVnAVmtrwDYdhNc58ZsTrPgqw026sBYlb1dzYDqLP3aWOvVdoZyHchw7rjEpE42y9jIUmG/D/7e6XZiO1ab4VzxzDTKhBjBWHafHTPPRf+p/v2b9934wZWZVD5rQ8hYFzYERRwGAWfQMQY1 GU83hDOF6j67gT4InVgWvafhYlGiajH66J7GRgOrHPZf/tDN/gngmOQ/9eBwCuEcXCtW624jQzgfJtux0dkF5aiDJuX181AjvL2NnuwyGq6brb0arPvFW/h7bxiAV0DF45QDiBYbztYjdfJSkFRGHZ9v NmoFAnqKVQ0OX56v8n58/mFAhLh+mYDP70VGH+H5L4OzkvsvVrv9v3DZrf1IrX9AvRD8DdGikCbA9hs8wAvNmhBCJzfCaAQICAXieAWFYHUHtxy2SsFd2p24CZuCG5UC7DCPgCEYBUeqzfXNrEt2BeF4 P7lTdgG3Db6c1YGclFIcv7VD5pcOSj0AJj1P+Hz/2AIlJOMvj6vwosz+PBa/ypvuzUAj7L+ViosDOChAXo2/8+f92rCxVZ52LcquK+qP4SOmjXYv1qtx1W8rnHvqoLPKObEumtAmjT5esuvUcTN9tAwB Iplfi6xEc8uNbCvzLyTW4ClvRdKOcwcVmmo749LPyIwaBuI5f2+HbjcfGdUEhK0A5eZNYuykXIBf5Fcuzi/yl0GFWDxMnc+L9eN5uRrK6+HbfnB/oUIglk4FkOyCwHYi4GbnzNW9Y1Ec1qbrTwzGikN4 +vxmi7k+lIPv42tzflp91hwGZeCBN+VQwDx98kavsBiCw/ObqZ8Np8CMW25ZfXeDCoMuYmNvXnu6xTAs3yj0rPP+5xAmRdgmRaB5NC52zMKFTCKqk8Vdgas0bkCbgsuVCWfrjmrSBt4g3lMuQgpAAsxP 1AhIFuTPbQs0PxDHGyRhu++DQAwy4NGhYgz5dsB+BWRepGh6k2Ghv8xdZo7OX+9ez35hz0oAI89ttl1QwMwqP4U/r3suhH8QRPwdgWAx7kEBBSAnaAALIECEIB/LbQPxR8AAMva3DEoACmj7L9OHK8k5 wkAAvjrXLwXFYAAADvKCf4dNxbgjsUHjdJPCj68ss+q+46XRyUgkfoP9nuT7fbKTrTyNlZ3BypAAYCqBqzi5l/I+6th4FfNduDaHjyPir8qyPzr5gbgTvcTBoA/qyHIl9YAnJz/UfIOKQFBC3ANDVD+/ YhB4A9gfwkr/2CfC0AwE3ApF3+wGhCO13H2H4I/aQVe9jaqAMPm3z7fAMzKPwGDWAKyjAAgZgAupfw/VAEu5SbgJT1YAIJjeS8qAAn+9WIOIOw/sRwswP1uVbL1CsCjpP6DFmC2/dYJ+MM2YIGAVAICO YDVNZID+IZmAFYmx5WsACTr72sIAGEfwR8UgLACEFt+q19jBSDZf9ESnDyDisAqKgEBKAgZgI+yAhBLQAAGQi5gNYE/hH7V0gR8CBWAD7EtGGy/D7ECEDMAxQIMOYBaALKPwB9n/Enb7+xaDwlJCUiZf 1geAvdr5p9XABZI/l9tu2kCDmFfIRd/+EbgPVoCAuCwcMnu5FmxCbNikOeCzDksAAFlH6v7EPZxEYhYe7EchAEZwr9SD7Is8BMoiJBwYbOqB72qsBktxd5KvCO4RsrBFl+goapAow405+YbCGdttw8Hr b07PEzjZx4p8wq9h02ByPwAJhpbcjB/pO4z1l5rPdY2X2v1NTmBCg+D3ERTOiLqxBLzW7MN+WFWAFIGIIyj3gZcSTZf2BdlIOX+cVagsQvjPclxcfJ3cv6T/S57/SCCLoVfDPCkITeXAZm0/qbYEiz21 5w1J40l9oTP0LOFIQz8VFlnbbiB4u6XBP2ee1+tu6k1Hg5ifp9Yjhk8YgEIW4dzBfIxDJSyEoGK2Qr5uDxELMr8Hbq2tb6hOJebgSXbUKCntT6nvp+seydZe1Fdx227hWqXHea8vGEFa/mt3kqbx5bbf LHb7qLGX1ILEgDMaxnWVt68FgZ9LefVCuzLPRjYgWUXs/xov8C8K1+tvaL4o63ARIKDdJwrDcZtwx7+sYqQrMHn6DkpDWEQmGcgYkHzOZe1/w8u9ZtbqNCDAo7xQ9fdPVBgMUDqPVQDDhCQA+Xd/dy0C yBuPFpoKedvAkM4zOQbIqUdwjxUDBJ0g3bh+06z1RbUcqeuJc9ecxMhLw9Vd5Trh7bcIVLWTWDVH8x1H7bsckEIFICc/hxVffcOfoY5gOOHuAUYgNxpAoug1JuGRSKfIuybgo3DDAfhnUOUJwj7sA5QB E4aoCZfAHvQ/gvHYFGeIfZfmJftv5P4vilsKZ6ABSOfkrIwue9uAGmSu2eBUgDFbkbgywA8UbvdCZSdjSDVHfP3MkEtq267w32BDTdSKd7pe9Lg4+3wWiYQZ+e3eYaZlIBBocmtUMkXr/tctA77W8bzx NcM+KPxlZt5/n+7u/7ukBs3uIpssFa1p7BMmnstcNsQwre0Qo5I+RfbdmNoJ/bjWKGn9z6friq07xmKLMSZGoHtfGeiY4WQ613/lc2u70qj67jawGo6gWG+gbcHyzi4ZOMqZeV1K2BjFRxDsm5zrUtLR Dxs8wrARrL1XrGZfY0mq0+KPjarorBTQCQXkogd187v199ANuIrTV7lp0rGxsDSrEpDBX8eSlrlIwFGgo9dCiC3MEBtdK//Y6PbOlJPar8xyP1rVPgHOX5i+RXYt/0iW4axPKSegCDeT1uAf2QNrg+Uf zvHGP7xeWwRZnWg5P9pHiDnAEpBCGxBDbjrg3oEfqj0Q8vvRtdi1IDttiUYriVzPNa1lC21qwOwZtVzi02Jhqr1OFOvkht94dyi/pWm1IOAnjy7WAChsQeryq9nBcNG3z5cqc8zwGOVoliIKzVfcBWWf CzmMhDK/FuNrcF2/ZQXKBbgwCabwf5qbcIG3mnBx2yvwHtndqSae7A8hHQC3oylVyHbXA8BBe69Z56nOcvdew95+BesSVSIqiosMbDQwsSy4Hu1yERVhmVa/OGVkPI7kFoQ3glNwBcfqnaXHqxyowuWu rHZ5e5CzkyCdjkC09JLMsKCjzsVdYStwXFRRljIkRkoSqZe3MAbgz3Zjkb3XYj2Lxj1YHqeYXquX5gVWJBxLfZZhKQ5+e5cLlh58wmaZbMd15RpKLxKGcUcl2HcnOGh4dcK5qThN9+r7rJJnad2WFHyC ViDzL+ZBONELWgz+EBdJ8/ctApDgHxgU5b7pR2YbcxfKkgUJV+RwkexCkNO322eX2y/X3P5h6gHbwo85DIQgHhkhy7QNXlAKXMUhAAxiwpBYF3/NiPL/efChe5I2W7Xs7ABlX/dJcn/KQIELH3ZdZZt4 xzAbQgAxQoMILCTLcCgAuzgJmAo/+jmDECwAHcgANzljkEWINt/yQbMJSCwrXiFG4CT40X7kue4AXjRfvcWq/+gCVjBHtt632IYeMwoAI+XhwAwHm+VH07mPep6Fu93TQj4Ol1DFUA8nwFIW1IFohW4s jO53oNWXwCAL1Zzw29NFykAofGXz4sC8MWqLoSBPxMAaNp/sQSESz90n+3AL3DpByoA6/pUCfgjLgEBGPjDOlL/PV8jBSBk/d0gikDYLu1za5dQHiCpAftRDbhGbMDaAuy3z9QxBDQZgJIDqPl/S3tJC biMts8s/0Vy/m33FFiAOQNQ4N+Ty/pxAAR8YuU7bimq/ygDsA6yAKveQBUggL7a6jewBdjDP9qC6g8UgND+S9vXXWXVa66i8jCqAFH9V/26twBzBmAF5ACyvbe0mgo/wAIsWYAIADnvDxWBta+5x2oIA mLhR9VB2kL7bw2oAVkBCNl/tZIDeFgVgGT7PeTmcQkINgEnAwtAAOAhDNzn7b8G/pEikMFg3V4uANnvz9eR1ReVftwC7JuABQi+gjZgUfsBDPRAsB2hnygEi+raEQDOggIQUAAyFBRYiHMkz4IKEAFTG dmAEQQqjGNVHu8/LHAQAF2yvyD5868ZgCUmF5CfKy7x1l5SAJJlWBSAoDqUwhGaZ4daiwV0AThTGGlAo0BJDwItfNvp4ZwpJkG14EJp65VW3Z1ewbjQAEcFhtYGvENz/GIA6KFgswGFHjhqo7HNNzTW4 QViHVZ1484INvpMwIdLfa7i3OR/81Li8SCXe1AeIMM+zP07iqBPr6MK8CDbhSkDcE41AMADrmB1t0ttGFJ1Xo5V5VkQZ0Be9hq+tsZk/2E+3oDP/Evuz9JsPq8YDDL9RAloVIdhpp9kBRJsFIuxVx96O zBZjL2VN3ettybLuWwLG5/z51M8j1h9LbgU5WPKKAbl98AcQn4m++l3XX4LWIChSRdacEdx5IFaD5p8YR/acduo5TeFyr6LuJ8jOYDQossZgHnJvpR1gPIPnodnc3nOPC7kgBZenGMX7efLNcwZpC3Ay IL2MW3mRXsx24Mx82/XiN6fv4syC3O4wESszLltI9panC9zt9Hacvj5VBsVkYB6sYDXBfPDtxTuOOeyj37opv7mKwRv34byDwRuN1C5BzBvPDcAT2Qb7QTMuruOarhJCOU+R/gHqrfJgwTMqKiD7LAT+ R5q3CUVHqgFQb2HAHHwOgIzyuS7gRBwgjT1AkQ7fcPdB+dO+fxALAOB5wZBHcjnWIkHwBHgHJRwYF7fIOXyTTU2X1D+YbPvmetuOlqCKdtvGrf6TuFij8l47RoBTFD3DREMRCXgADX93sswcfopeh4AI NqDQRGY/Abf+vuv3LjhbzxgygTPgty/DKq4TPZbHJFqz6rtMmXuZVLhxWDtjgo4e0+kNIyLPjKVm8TruhP8i9+n4M5cV2Xh15mh418EmLcjyBeDzQxqQs5F/Kuzt929I/+fG3dmuxs39GSokAtsvRvSc /YEuImN1mb+BTl+633unwI5AX4W8m0wz0dwLi1L0IBChY/2XKZ7I0VgUDryPEPKZJxc7175xwb3LhdvdBsVnlXLCUBTFeAVAndh0UajL+WQtt2PuTlYGniD8o4mtNR62Mf5fR96dWGX5gtuRvWfzREkC 3FjUBYi8E9hHduFPUQ05SVXPPwjyMeqPsn402ZiySH0W7EFd+Pv5mEjKB6xCRhg30UCec0XG1kJ2OCVgGMb8ZgAXz3CQswIHGtk2NfEbcH1XBiyUWEfQMAW0xRMykCvBpQMQWgNBtXfbmkE/oCtwGwN3 mWLREQliLmAnA2IIHGTa03W+Mof6l3D73/svsMNwADRKhjWAcjTfS7sKIc2336GcH0exmHLb/J8ee9y3Idnaa4VrqLfHPf7ZxbzuUW9q3WUd6+id/auoHn65LlVCvHwOVkT5gmSMrC8l5qGaY0MLGXwM xW9tP5xHqSVK8izwE3LL1hRp1bauRYQGvXfXK++U5Ufl3fofHi/L/Ig0FfhCz4EupmMPgsnRYkXqBHlPSbb791A8WfLSfzabTGJzSS0oDCtWATvhxKQMjc2r9J9ML822Va5sQUr3Ej+LHcxJ5dbgcPG3 VjZlw79vBU43S6bKVsvs9X3TnbeCxnW4y3GmYs+MhV+pK+vgDP9zPWc9Psv5KYrHOP5IN/wYjK+mVHgbs0gUCYQSzL65PhLHlLSIXBQ8/Ay5P+JRRgKPiTTT1qFfbEGwUMs+eB8QZ8fmF7G4W3ChdTkK 1bfFFuSNZ/PqwZ9W69X6ymMxMzBvORcfmAXtpASlY5Q5JEigPd1DpWUfBP9DoFaMVUQKBhhbV9m56Ny8OtUvvtv02a6txa+7I6VbHE9JdtcZ7LfUZr8pf/YVtcF+2Uvu66S7e54CWX/dZZSFmAHKwC7c NuM8I8gIFmBO8vZAswgEOAfWIA7ytsxA1AAIMK/RdwCbOy/0P77Zvm+ZLufcgBZ8QfAr4Obf4/puYNe6WfUfl4VCOcoG7ATrMCLX3MvVna7hurOZPT43D9WANZXm0xAKAKppiZgaf/9Oef/IfirISD4M 4R/pAKUawAAX4AcwBqf9/ezWl8CIgUgOGrp+Id1BAF/DBZhyAKsIdsvAMAfivIPrMF1Pvdvg8kCXFfrlX+kBIRmYACCNMgC3OthoKr+OAsQQSCDvyUM/Jb3k/2XISCVgPRgBiAoAKEI5KlkH0tAsAWYQ CDkAAIAfHzFL9yKuuNuWdWbav1dxgAQ1H91tW9S8QfnANbgPaQARBVgDbUAiwV4cTLAAryYrb/lVUddRQ1nASb75WD5rSX1X3kt2X/Lal9TK7BCwFouBwFlYDUDQFD+aRHIYcz6W4BqwMME90wDMA0q/ JhXQ+fnMRCEPMC5bAGenTwPcA9LQKzSz9iCZ2P77z6y/uJ9e/WZAoV+Fvzt4yE2331B4UfasHmANdQEXKSqQCj/aEcoKGrCuYt3MYBjMFfG2X4MAWU8nPxZFxg4r7wVwd28Us6r4/OaDWgUf8V2XzIBE QQ2KxiU5wPAZ1qI51vwqEPWaHP87H6LKvlgfl8KYtR1rPIr1sKRMFvQF4I0szrP5wB6O69kGBpbcFDy4RV+XmFoik4WRiDQqBoXGHuyqBeLoTE4ee5hzhScm/z5IfuvUfiBEhBh3xECgAIELSQEdSAAw KpDbCE+4uYlfwc/sPy4y94w5JVuDLssLBMbrViApaRDIZ3m/v2ScgQBBCIkPBnMiapBaP4V+PbcSaO8E5jIhSOwXXdSASBlEfK8z7G9dy3Pu/aEwkdYDzbz8n1Be7GOcG1BoYmCQlYTstpPLMq5rFJM8 T1qSX76ly63ZcTl7iHwXEVyTAAAVWxJREFUBxAwt53gGB3TyAEwlpzP20PnsxGwXcTzCPh2J/vtF1z2Ltqf2TqcDLAEjyAghPNQDoL5gDBXsk1xsy+cg2N9/256n9ybre+jNWYh6KOtro/fi3O0jTDco 2vZCPeGdd2wFhi4Br4H39l2kd6zm57BNWw/62a8+ZHL+u1NNx4UgEOfY07ffaDIG/RZffejqu8GF2xcd1O5fAOAHDw3Cc99hio+UvxR6y/m7yX33ottwpTxh1ZcsBSjzZhsxAgKwYLMhR3T8BxBxMmS5 QeA8TQBObg28fRnmtE3FaHidc3omzxEyjy06PJ2Ilt4JzIIvF9g5RBbg/WZa3r/dAR71ynjj63JU/hegYVyDWDfVLYXT+EWYpjrrr//wgAtC7MyKOXS2oJvp0MvgVKB6i3K9rMlF7HSL1bapanoIkiYU T1onrFWXgsGJZ8vsC3/n74lAwyMr8UWYIV7t91dab9FtM5zd/i+YK47fDv/d7l7+H+6cad+7MYNfj+zOk/AXGzDDdp3I+AW5O1lgIIx3EtTEUbATq3BGYpFgobfDOq/NKuwUTlq6ckGvz251j05/BM38 Kct7vjHyb9lPqRsO7G3dlkF3RVrA45bgjdzi7ABbJz7JzCtUwo0BAqCLVjgH8zDNmGBhR7aicpP1iLzbtFjhXWqEtzs7cECKM1a/L5fL+X9+fvx/Ve26G+AIBF/G5nPtBiz9RiUlM1jTW672H8vbUbo1 wztwAwGKQOwgTP96rnZl6y/pP7biErBHagGbPBWYFAPjjWo8g+fhyKQMbpOELCey0PoWO2/l6QVuD7ICmwd2xQUiIiNmGzByfUPIBdwk9v/4Ra34Vdr3SOdANxWI6wDQFYmAE5BIMA4ugb3COSr6FvOk E8AG4C5ZJ4+2Segt5jnwS3cD8COAV8ZQD8AgP2PJ+efoP2+x/F5GOW9AvBWKhQkCLjCr0VgYT+DQL6Og9+HABNtzo+DAtBCr3Twp5Bsrth0GZTN9vZZC+tUtSdquqBoo8xAv/KgIdirAA08jBqAQxBoL cRha68t/7DqPg/9QtWhVf7FYDAAgfb9DAAvFVe5D+bVurH5Ve7SvKVoCR7OSZGazhSCZGrrtTAsvWgjfd9aa8NSkczg0ALAdDVfJriYDg2tRXfEzJupMETny+FzOentwPYbMmUCwricPPdngH8zjb025 W27aOeVhlwu6FCVG0M8b/e1eXt0DMALAeBMq/wLQd9XmpUn8MyXbfhRoDDwS16TlnKAcnEm5/SlaIBC7+bUArTdqpIwmfsLhntB2y/amvPRToxZhDMFYhIsvJ3twaNkEt6cWajAlCzIrDKE57E8JVQA6 vtAtZj8/v99+nR3fvZ33dHkH+9dC+td50LIAdzqjpdtdV1lZAEGAAjW367SZoV/mAFYulObgKEFGMBfNzYAt7iOZHuMLcAdFbvcsdJdaP89jhBwT3L+FRoVr7quxVD8sUetvwABsfm3Yj+CQNg/Hlh5f d7fcYZ8CgXN9WNRTuCxRUeSNex3+xa9jg3AAPsauPBjk2T/GSUgjW7KAKwi6Ic5gGgH7tHjFxH8sfoP8wC7MAfwRVT2dbkXIONPVIBcBkLW324PAVkN+CMAgHW9nAdISkCEfwABofyjVjIAe30JCOT+1 fpSECgA0RZgLAXpx7EGMwDfDrL/nuN24GeXigWYAOHTkgMIGYBYANKHEPD72gRMJSBPAwBcRlZgBIBLSf33XWgBXs4AcPkv3Kql3W5pJeT9MfSr5CKQxUep8VdyAI0FGBR/tQwAQQVYW/smFoAsSkZlt QeAi7kBWEpAwAKM9t9qAH6w/7rJADysxR/Y/FtFINA3AB9G8Pcd3gL8gwGKwHlc+rGg9jDm/sE+Ds4EhPGQAkBRAO5HACgtwKTq2x8BQK8EnMXWX1AIzkHbMFhy95H6r/bVCP5Z6LdXbbxiAxa4h8eSE 1jLhR81/JwAwyXtyTr3Unbgsn2uuKKN1XVgA24hOFcS2nIXqJqPgWDyd0hxGUHA+ZwXCICQsgN3+EZgUAmWmmZgVfg1oxqPjq1qcKeCPckRDKzDWlDSws/tCIpKRLno7cQGZHLbrwDGUH0nGX8GAC70A HC+hYNpisCoyCMAfncoGhHAKfPpewQCehUh2Z29ZRiufad0O2cA7mR77xEq+ADgx23ADyZ/LuZyAcicKgKBDwoElFxALQk5jC3ADy0+mPxv83WX+sFplwNqtjUnuV13wOWuoW0O5+3l8nWEZ+sHEMYpK AP4JlAvOZ/Lz+H96wa5bGMgsNTa+XIUKJ70Tbxy/jmzD3M/R/t5sl6FeQPUXrzG25Jz9b0DHtg95wGlfg9+70nKElxH8+j3mLXmwTtknQoxGSh+/5cuv2XEpdpJyYdKvd3DrqB9lFR6vAUlXu6uYVbaE TzLgcbg9ouk9NtNikA4zuE24DyGbKQQHCGlX3I9lxWFRcmcKSwNYZUegkG6Jw8txyM8H6wHYF3yfmgrRtXgCJ6D99DzpCBM4TNjqGiUc7iFdSbnC1BtSPPSc8OoAES14a6LOGcerwWAYtGO827G8atu5 m9vunughRcbfSmnD5R3pNqjll44lvbe8ZzFN2GQlHtTsKDjUwSA3x76BBV9ANvuOUnbKWzlvQdLQ66jWg6tspDXdxrm+8RNOs3qwkHOFwSAOEAWY5gb7MLQEjzh5CcIHiewqm8yqPIY6gGME2su5fixo u/0Z3gfwju2904a8hZfUAGK7RdzATnLbzJCxU+14GMqW4XRPsyZf5NFNSjqQlwTKQ9RLfjbr6I8PwOiMkG+oBk3A6w7F92X6Z647Td+V5zNJ43CcXNwDNL0fQY+6vfEQO5WuAabMRjbbeN3pikhzXozl pXQu++Kf7NM896pOTlel303A9m7z//Z3Xv+v7pxp56MFHwbIhWggXwxVDvzvIGDMWy7wzN3Oo6LPO44VwbwFzyTScWYAWIGdmE+P7DGPfTrF9zf/vPL7vgVKshQcMegrJsVfATtDFD7eEsA09CSG0C/L f7eK9zqy/NiE695vpPVgtQ2TMcKIHU+OpZnu674c/T8VrUF0/NbtKBEy0Is/Lva5AHmRw38rZsDWNgl8+DcNC+1CMt77Ps2u/7k2T0fgApwM0M/aQVuYNtvPasD7WDr76VGvE+yAVsQADZxYUgDtwVzV uDoRm8DviQtwQQUW2H/cgPnBibXLlJTcJuxB+/GrEAuCblU7wGgKgU34n7rpZdc6+WNbv8ft7jVJ55yj3Ytd4v6nkAVXkXv466ih5V4OACcrXJlPTTKe1YjpMN7kn04tyh5BkEeXEtGOV8r71mZ3EsDl Xy9dC+q/XgOeqc8s0rXUN4Dc67GLV7j+/B6tz1+HOeCrZ0f18cQUkY5rmk1KQC9ok5KPspMEYcBYQL9HvRqQZvPl8le6xuCrQ04ytVjOzCUa6hiz4K6OdL0Gyn65oTqPl8QUoqZhhYW2ibgdx+06/HH7 wXfxYUfUenI38z2cLI/mRsUgJcfqsEykMsPJfvzl7uRovluJCcXswAFgNkiELHzXlCw5rexndc+H9tw43kzQcMQAuZFgC+GhT7rL5M6L5NNOVNxybBRAErO4IXc/DTwmJZrmDxzNtn+MSff/dvMQvdFD rXzWuWdLwQpQPDl1W4FgdpPwJ212SpEhHlm+uuiwBOFoVcMzgoaczVLL8vDRVX0cSsvWIZvZwt4IwiIUDDFsFBhZgglrTKPRgFmG2IZCdiRzXfqd2mOoC8MERB6M9vCSLL6fpUi+HdTmo1NJiIAzz+D6 jDZHlnU5rpKtrhjj73suhc2ut5HQQm4FS3A3SXbsQQEsgA7y5q5EXiHwj8AgV2sAIQmYLIAEwDsBOUfNAFjGUg7KgEhA/B46R5t/8UikEXUANzJA9R/AgA7Fh1Ue6+1/R4T268o/4xK0EPCw9wWfCiZ7 5DrSUZL5VsM/0jtF2QAGvgn+wALNzIA3FRNQBDhH+QA1gEI5PIPzAb0SkBQAP6Ei0CkBdjbgL0KUI5BBfhjLPnoUQAoqj9tADYZgL74I0MDsCkCoRIQ3wT8LFt/AfQpDGRl4DOcByglIN8X8Ifwj9V/3 AQMYPB7rAAEKzAq/5aKBbgPAeDjyTkAgE+seBttv3WQ8wcAEItAyP4r8E8swKD+E9svZf+97qqraKsNwFUM/dj2u4jzAEEBuKjudVdWS/CPxlHM+xMLsGQBgvJvIef/IQzkdmCAfaD4+04tl4BgEcghs gCjKvCwNgAX11AeIMDBh6r2EfwTAFjHI7kf1H1YCKItwFYFuBdB32yr/quhc3AtP4B/BAALluzVEhACffsYAhLkKzLFH97iS8BvdnU7NgETHHyVSkOWtGPhCMHAV7BIYj4DNACAouorLvUgkMAewTxs8 OUMwAV8/zyx84IyEPbLQR3o4SFlBu5UMFhs4ZxYgg3oI2twcwQgm70dWUDgwma8d34pKQLny9pLwmxBbSJmEEn3eiBov1OVd0G+X9jcu0DbhU1zr83us6CPgeDD2jzcbABkrEa0UNIWm/hmYcr/20ZFI KAAxNw/VvlVH6FcP4aCcyXbL/kzIwpAgIGkAAxbglE5yHmBWRuGtG1XgZbJxcszYDBPAKEAPAF9z3klnQA+D+BOBtDPblV9BzmEDBL1ubUEGnMZ0uXY+6ORCgDiQAANVVEo65P3s6IwmxWEMjdlB5r5k zXRd58MvjmXwSMWnEAGIOTg7Rl1RbtG3Syw07aed4Wc+1e0i/IA81ppi9mAu0fQjgvZeYVcmlHYAucvkgUXrrddcEVtI1jQUdjKBRttdC8+x62+mN/XPozX4NlCthLnc7ZgARd24FyQ07eb1lDAhR+4J lgbFo4kA9aF5y7g/EVS7sHrz9tFa5Y8QXhnPswJQLF1mMEjPY/ntp91M3v+yU39zRdYmjFh6As3fsCXdQCMu2+QlH2gcLt36BNU3kGW372nqGADrbqnwB78KZVtMPybxmAQngWF33hW/93Lrb4T+B1Tz rDCjtt6J6D1mIo7sMBD72eVHoC40/ReUeMheBsg5d5UsfgOim2Xm3xhy63DU9DC+wlmA04y8A7G9CFS+U3ltl+w/d4LwPPkJ/QcW50n2CIRXgNZnz91M898jjbg6cn5rL/90o0b/lejkGPwZEsyku23z n0Twb0MsBAA2Nlb6SBN23BvoU1VFGsAxO6GebHpNwZ7tzyUk2FhoOYJ3grPWzAW5BNa5aEFfnGJx62obOSm2dK5v0rWfNd5sE0bWGebf9mSK8q/4LvOmmcC1Z8Be2dvhvOci67b9mWz9nt//1/dlN8l/ z0HlkeAbMMd1HZWOWdhnIF1Vq0XlIKsN7ZhA/MylnjE4M4AyADyGXAXW4qDd5tng3VtMDZhaQNe5+4ZWu9+iTCOIZnCNQ/YAoimEGxzMLoNqEM77McM3KJ7RZXXae5RcHhlczqw07w9b9GVtaGK0K7Dv svm9JnvoEKSpmCdnVYZaNds7pNr2j7M78c5cX+r673S6I78ock1jdUHxR47uAxE8/4ECppyEFD+tVxuQuhHLcKb9FmChA0GBJosQLYGI/y7LI3Cm5L9em4PblDbcKtAPlUBckuwKRDZzVtRDMLY+w+Nm JVX2g0w7Qm3WOAaQjdoBn4cQd7iXoJwoMzzAHC1qvcE+FUwYKvoEagn5x7nOdnmKxCwW0Agvb+saxVeL+/xsA7euagHLMBPuErM9Htc3wPvt1CSjlfrMUFEP5/cM86q62wBiIKzqAnYFoW892Co1qNzF R7U2ey9uDGYAVuQOah5guF6CA5GmYExqLRKxkjJp9DRgkej7vP25/JQARk1FEtRiEDN/rllaP39hwW1CABHiqvdxeKa5NxSdyE3xw3neGWehXUhbMuswLPPBHl+kbX2L0G44ej6+TQAGEK4C8EcVl2Yb gmOFYyZLL7pQNOej57NyXej3AD8T8n2zwCvZhRqZp6o6lDtJuUYOR5+UYOvAXY2sy/LWIizTRuwwD4LwmzGoC0gwS0XaZj8P5mLFHWFqlq8leOhpUJIAxklH/BrzvkTgKgKxCwP84LzKT+nQE3IA/yGL c1iXxYVJNma8/33ZfvfDJ9FWJmPikI4998nT3HvPfJz9yaq+7a6bmgBRuXfy64TsgCTLUC/7uQf1R2SAwj239Id2gQM225uAoYykLeSf6AC+IMswOPl0Aq8G62/XgX4Cg1sACYACOq/Dh7HKg4g/KMBY O9AZPs9lFkRaOCgDL2v/KjrSuZqZODXVN3lGqq6QgswbwMYCNAv2f6cSz9eMhbgn3MhCALAmm6Ff3Dup1UEAH9W2xMpAHtQAfiTIAeQSj+g/APgHmYB1lD+H5SA4DnYghKQLcHraz38w7y/Wmn+7dMGY MwDBAUg5ACyBRgzAJf4DEDYJ1twHwFALv4AGzBafcECzPZfUQACBAQFoNh/n2LrL1mA30YQ+N3lve67K/rRAvx4sl1Re4zUfzVvuCVY/kEwUMEfDjqHJSA1b2ABSDXuMwCsPOKqQP3HhR+La99g9d/rB P9gv/Z1BH9Q7iElIKWYA0gQEKEfNv8mo/IQ7VcTBHyk+iBagCEH8OFqzgLENuBDrPpjFSAXgBSz7VcKQiQDECzAs2pI7Te75iAWfVC2HxeAcCkIWoLrTC4g5/4hCOQtqPoA+BVlVAAyyEvmIxD4aqT+C /dn1bS7B2oIABIElOuUESgFIWTbbUFFH2znlXsbr1h6F5SZQpBSD80QAIIVuJxAYDFag1sQ/uEQhSAPyfwT+zCdk2s7cesBoId3gaJPrcUE0uaVUh4hlYqQMnABfstOXzTCeYICEaW9mCCjfFcIJheU7 lQoFxSI2NzBOK9PIJ8pJFlgVIILDAS0WYP+HaY0REHkdtx/uHQbq/524BBVpbQAo/0X9w+6h2q4DAStwIeDQXCQCkIwF7DysDYBw/G85O/NbASAosg7kQbKctb6/dRzBqRFYM0qCFXtJ+rADABOrbhrW b2n7/OwLZuBXq5RJUrZh5/rRHAs74XG3tTakwGYFMCYJ4o/gXui6oPn10XfZCzDuQYy5vC64Vz20+9R8cUroHgT5d8wWn3z22kUtY9i9h+cg3uwJRhag3ddYCUePCsKQp6D1YJwHZ6H+3Pb6RxCOr4G5 wkoDrtZu2h+gH4A5lK7CfjBuVTbeVfYTmtEG3I75Qei0nA3PQftwXntw5zfN6zPFsEadlPRCa47ua9gz0WEk/n8PlhTIdp+qeAkfzd9e+H2s25q///jpv/dVwiu7jv1OWb/jee8uwnc3Ev5fADRyPoL5 +7Hsg4q6BBgNxmh2GeYf3c/5/jdf4rLQFAFCDbe66jsAysxNgMDuGOAeD+q7m5o7t4MsN8m9wpMnMpKw2nwnlME3CYyIMQyDijxSM5NF7XeIDUH3yeADktBCCCicg9tx59pw+/UIbb+Jvv3cobgtDNkb 4aMQ2oo/pRzEqXFmG3IAPxO33AzkgEAcNqZz5ItNBbfSG/0Zah0l7GgfgtBViYFXrQNVHAGUvG8d5+9rUq4u5L9b52l/EHY/tXvYzVcBONE7Wbf8XuBjRnUcsGzN8O1WyWdAMgACGYo3zhr5jhv15FBQ cklHQg5f8/fqYCQf9+ztzM/f/ZWuF75BlFAno2+hX+Tey78R/J7fOTGnVzufMlGlO2XZuHNpPSz0M3AvdPrfFNwWgNwnMW3IQSApyJlX1oO4HqXpgoMSkDWhXNnLAaJQKPkFJ7Y4I582ODe+dNmdxyB2 xZWvW1hy2tosVW1X7LfE8M9gXmq7tti4GD6vQFExEy+JgMDm7Bso0cg3xUPHrvNmuy8nbHi72P7fj+HhZXwvd28H8DEq1u8zZhVh91X/ffdCWh2ftjkNrPyD1SAO8Y2q/IPgd8YFX4IBJTGYIJ6jVwgU o/lH5QJ2BhuLQRktSApAjexIhAswZu0NRjO74hswm0GAFIhSCMq/9AyrCUiDdg4TErBBvdo50oCb72rXCmAsl5S9ZX3hpCNFH6r3CI417US9wHg4bMM9sotmGPQp9teAnGiFEQwx89U8HlVEdr9ZB2lr D6EOSosIDT34VzdPG+P39I1mhOBIwLATBZZgWPGZktlHr5p910FYuUBAIyPM1pvDfTzkI627z1oikICdaJvB1YoObfUrKFUwR+ek2OTXRjn+wX5hrNDFaOuzViF9dv4migAyQIM4K/GXZ5XjQBwdO5CN 5LKwSzAC9xue2fbbAgGPeCL7uV2YbIW3ynrL5Niz84d247/TxmFfzk30KoXrc03hJf5GdYXzZl822guNQD/Syrf/atRuAm8AwXerWnJdrqHggK1bovdNrbyZnuVnWbfia13ZhEq8xDczfAKP5x3RoG3F 5vcPw8QfQaglm2w2k6A4ZdZBAtF+XczqyhQK9pmY5wHcvxsuQgDQoGPX0qBiVUrmlzBW6lZ5tioJnENRbqeoPQEvm9mvrsFysKZs9y/T89yV/MXuQMVe6gFuDT5P6mFWxH+gQqwE7IBS7ahCtBbgHdQC QgqAXdSE3DyD0/IAgQFIFiAj4P9txSyAHcTACwjAAgW4GMIA1/lEhBqAVYACBZgzP874I5V7McWYCrxOEAAsCK09h4vNy3BFX50LKIWYDo+nLzjaDLXYbexshvbfxtgVBHcQxswt/7WmxZgGKD+28jQD 8tAwN5r7MBQ+kEtwD2YBQg24Bf5flQBAuir9jmAP8VG4F6EfgACpQn4xwAKpQQEcwB7qAFYiz96NAPwh1z6oeq/JX2qAly7lK2/sJ/cC8q/tWzv1RKQJf2aAwjbZ4z6jyzAMHqoAXhZPw6y/fZhLuDTC AYBAPZhCchTy3rck8l1agJOxgpfArI6Obc6uXdlXZdbWvmaW1J1JBlvuJrKI5r7ZwtAUA0ImYDaAkz5f9WY/fca2X+rXvPWXwaAi9EW/JorR6Ufwb9S2NZCKchryf5RrwKspdw/BILJMZWA0D5Bv0NsA T7oFlTTvsC/+WL55X3NBoScQD5+MLl3DluAH6glAChZf2T35abfGg/9MAOw1luEZ7MlmHL/XmXl3z60BNO5fXqN7Lyk/CPFX7vP/Kv1kE/A3wM11AY8ayk9NwtVgMmoSa4l935nIcG3+aAERHDWypl7r QrnsJEXriV/zgEUFjPk0205wT0EeKICLN2haj9RGM63FuFSAYE7FQoWSwFImQGNDAvnyTvURhy1D6eVkOxUFSCpD7nJWIo2jPKPMgWjc6UmFzFDW3HQUGzKRsRSrOszrcRe9bcjgIYCFhE8cnbhw6Vi+ zW5g6xy1EbhslaEetTme0iVfQj4uPlXLcGs9JN7fQMwX0P78MHkv98hztkzqjyjhgtUfTHsQ/XcSQMPWYnHAA9tuWlw0EA7+9y6AXNfBO3WnEh/ntWIgT3ZKBO9hTgGmgMBCMwxc+t1MwcMeU9qzYn03 4UzCkEBiAUZe0YRsBUACGtnENZO9lzaDivwAxVdbjtBuxwBb2ABbifAJvfn8T25uwXsjZCqEMo1dpFaD5/n5xAQAnDcRVAQnpu1m57B/MHdBOYKeU05Aul4nsJdHizm8PtF5VfAa8ljuCjqQhhFvK5Ce S/PCXMVNP/eTf6b/+Km/upzBG1TT1M5x6Qhar1F1R5k+p2GrL7P3Xi03V7D/D4AhVNOU2Yf5gWe+pSB3CeojhsvikAAhlj0cR0h30SFgtcR0CFQO03ZfaDYu2+IoBqo80BZB3MBXEOAyPl8ABgBPk4c4 IIOLOLg0g8GdHDfNFYOTpTWXi76mMxZgRMZECL8g0KPgX/htmDJBKRWYLIrS4kIZwVCu/Dp6wwcaa3T2SY9M9lOPX0dYSLcR2q/WGmWCfJFkCseCKe+zqDCu+mVgedsDl4E+Wwunz2v0O9mOnjLlP2HS sNvEDYGykarCIxUfcG8meCmft+tzM8Gz92mdmVR71lVpAWJ9n1nM6zzvDkXZwSaOe7m9/3V+f/hxv32N27c4Eo37tTzoTJO1XEMy4asIi8GcwbgWYVdnA+orcLr3B2tuJkswRlzA00ByNC69PMxuNTyE bueaO4zAgDXuR+NvuROfJz8W+ajzQr90oa164oKMFLWibpOn/kIIJ5/Rp81sK7zqlfbeYXeZsraCxSHWzKuxwPKzSa7z6v2uo21t1OAoIGAHhSG81sAap/R+YxdWdbT8VGD6/14s9s6RmUgqNob28wWY Lb/ih14TOzA9aHS75KoAjdpGYiFf2QVNlAQC0EacX5Q+u3AfMBNWhRCEFDUgFIqQudR+XepIbABS1uwHLdfbnQvD//cFXfUkjIOAeBKV9K9ItmHHEA6R9vkuAdy+5LjvtUMCgHKJff2LOd9uW8FZgjCt hzvpXOlyX2wX2pAY2mvKPZWYXZfGcNHeEdJD62hlNdQiu9fzfur8Dpco3Mraf1oLRbYuJLeneyXdCf73bR+2I57R9R1AaxLb/IlqCYtvx4QWjVgCPTKw3sMYNM2Xduuq5l9AgeNXTjI5zMFIIEisFSfC XL/zHdZwBk0HJvvlcbjIP9vjlcH2m/oAwA4v9p9UFzj/lBc7S7Nq0QF4MV5te7Sw8vdSH4hWYEZ3l2IAFucjXenTLwA0OXY4o10VWFcFCLqQT9HXtrcFxg2xnNkUvjFAG8kupYJbsZ5hZkAINmGCQDeS OVT7h1n6qEqL6coUNKJgg3UbaCAuzmtgMBdKrT73kyFSj6cJytUBSKIm8mZfTMK0MIrMPGrlFcLfskFH1gukuLG3pkeEEIJB6kBi0JQZ/L6tHk4i0o4vLrQtwKj7VcApy3zSEnLr/+2L2G900l5iOdnh rBSIKKeS5nsP7yf2o5vgbIRIWq++/eZWe6N5B+80ATc9dhWzv7bhhCwS/L/0PpLELATMwB3uM7yna6jBOy/YAduwRKQToR/LVgC0llGRSCdpVQAAgCwM9liA7C0AUsTcPk+gn9lr2IbsABAyAAEuPdWm Sn3KKfcP1UDajHIIS3+OM4QEMaxiiOuM5nrMBeANFZ3JaMT4V8D2oBZ/ScAEKBfZXJ9cScCv01s+91o92t61Bos1t+fVsm2C+Hfiwb+gf0XSkDQBsw5gGoHTu77sSj/wArMrcBQ9gElIAgCjf33Byb/T 7P/6no1A3BtXY9RA5ICcA0rAAn0cREIbEEBuFQyAftR+Qf232cZDPo2YAaDaAXuwfy/pyD/D1qAofBjaTeq/57EAhDKA3x8OY3VyfHqZFtXeRTVf7WVr7MFmBSBoQqQbb+sArT7UgIiALCCs/8WGwVgG UI/gn+YAVj7Gpd/HNUMQACEj2FT8FFuBabtYwIAaykHcAFDQFADSs4fWH7nVx8i+Fe9n1p/oR249qBmAD5Yvc89WEsW4Dm1hwjy1XARSN0BVffZRmCyCO/zWYGcB+gB4F4Ff94KvI8hn7T9vqJW3xj+k VLwFcwABPg3G0o/lohlONkuIYA4q7rdPbKwlRt92wiuAeBD1V8bDlQFWtsuZP/xOVH6CRT093hAiABP1X87GPiJbXinqgBFESjqPVEgKgBUGMjzMpQLYKGcY+ssKAD1WNSDavtt9gpHsQfLfQu363WBf qKA1DzEUt+QPJ+howDDjGBQ8wGpUESLRxbuUPAplmLaig3ZKxER/IEFGwEiKR7n1oDt9wCrAI94S68o/qAgpJpAn+T+kfrvED73ENuHBQoWJ38vz/z+e2SVNWo4C/yyDWSL1Xxipc1b69WCqSA770SYC WjBmVUBxvusxrPblJ4PQWXKvEOsy7kmo4+uhVmCdp3WWpxnYGFG6MnvsUpD3H/6lwi6Zu25SICtnVVxvAXol8egDWHeLr4HgRydA2hYoA29XrWXy/MVsOpuFkM/tNbCPgyAjgztPGQc1rkB4qFll9WDM FcBZhKO0vtkbXtG0K6cx2uhMaowL4+/p4hVinieFYW4xl0EAAvkXl530fazbvIv/4ubceZzdx/bVycOkbJvIqvm7kel3g0CeQDOwH7LVl8Aa2AHBlvwlCEu1jj1OeUIDlJe4FRU95EVdzLbgUG9N/HkN c3Sm8xZepOlnVeLNahpFxR544esVdfn8k0a/JSh3TV8dior+QD8Tce1E1CcrIUgBA3hnROGODvwFOX+jed5YI7xg9f0GbEVZ525gQrGafxdAABhDTMY+M3A89dddnLfdL4vO7n2rd9FYCzI7TPQKQ2iC dD6Oh3gxVl5AgYjS3DGbLtYpRe37MbKPp7zblHUnWPQKMrGs/IeM4e1+8bfEXz3LQ8h7TfF77fr1Fw+AzClAMSuJxNEDey9FjZG4NB8w13wrb+/6Sad+1/uW3/f7cYNrs6sksuouIuUe0Hzbga7bay0U xBnzt3JciwKwrgA5HS0pkyAMFAZ2jk2hN8XPw9NwCfWu+/89qfuV/9pizuullkGXQz0uq9uMZbZSP1mroU2282kELSWWYaCmQpCdF5jwe1kG2/Px7GaUBR74Xslh9CDunAeyTRUdaLafkltqOUkknGoo M/kDxqFYmdkQYbrvckW1HbbRhvdloub3LaxJlb8NXhL8BgDwIsN3ALM58QefJGzAAH2jdazJVgUf/X4DCr6xggU7uBnsEkYj6UhuJ4VgfWqDKSCkAaGgGTx9U3BZP9tgy1kCSb37PuHLe7Hv3neLeisU xgnWX8AzDz84/MMCGms0C1CQX4+hHSrCQL2wrnHEdqVIlxcxWOlB4S9VApSat5dKgCyZ5XeA2ARQCLsV/Qx6NM5WCnYu0rBH61lFUJNWt8KhItkAX6wLIJvxvpqrLDv2SZfhWqlEVALCzlsWYdvAA5Vd u/OyTyHVQC+Mzu91EOPDUh8h7MCQyuzyR2cbb5xrlnDg6aUxBaVBGUj9KyoFAEAQunHH9D6W+kuzqtzY8U17oP51e5S8VJ36aFqdyGVIriWEzftxjAwz4XQzgA0tRKHeYAxKByJhrUKh4DRqwsvpCkG7 1Q+kgkmhusPLb9hTuAFfV/6exQIYgZgHjbZQsutqPy0nZetqwDxsPmXIR7Ar9sM4lRxlzIQLotssmoLtqo7gWQpgnOoDpT5DTzUJmIDDVHRN8NDx1tZHvppmzArAX0eoQdxNsPPqgFFyScKR5t9+CW/T 9cLqsjpVPJhG3/JVjxL24e1xITX8xWDTCwXAWt1DoDEWfjb/I9pU93fPfS0e71il+sqAQVg8n8CZdvQEtzFGYDQ+NtRRvl/qAAsbXbHtQGYAaCUgJS3IgDsQuUfKAGNAhCzAKkIpFMswIsJAHYt2u9tw Iu4AGQRwD+wAB9BK7DYekER+JbJAfRWX8oKhOvHFwP4O5zcd9j1JPO0L36LFIBVXWgBRuCHJR9eASiFIJj/BxAw2RfVnygCJQMQjl+qpSKQF00O4M9rpAhEFICk/MPMv+oetf7KPtqCWfX3AsDAGrIAA +xDAGgyAEUJSNDPK/8QCNb2afYfloAYAEjqv37N/aMcQFEASgkI5f+B9ZeKQXrdM2ANXpaMFawCXM45gAAAl77tnoaGYLD7GgXgd5cLAOwnBWBy7YkVv3BLqt/EApAloPyrZNhX9ZpCQNp/01VXHTXtv 36g+q/6KJZ9SAGIBYEAAMtrSOFHBSBs/+X2X1ABPlZ9yC2sOoSKv5KqI2wHJkXgowD/qgn+Ye4fwD9UA5LlV/L+YH8eF4Hgce0hhH80CAo+CEAPwd8BbfedxRAQVX6o9GNFYM3e4NosVP9RBmCBKv7Cf QGABUskB5C2YPMt1AzAGAS+SgAQy0BeJQC45BVXULs7udaObcEPQgMwwjyCfvOw3IMg3jxp92VVoIA9VAZyk6/aecu8qk9z/Bj0FRuL7zyFgS1oFy42yj+BgQjXynwr8DwD/XB9pTv8PMnfSfNKDWAUG 3Ip5xaWcBmJzkPZgQsMABTF37wyqxwki7EAPf2uMskivINqsEQyD5t96UjJTgWSmLfIAPJhbQG2jcE7A9uwLSPxrcNyvRn/W3gASHl/cysPR7ZgAnyk9KPWXx1gF1b770E8V5z83Zz312+77HWDJpsvV LlZ+Jat0Myo69aGkExKRNKKPtJgmtk+FynxGNrlRuDNviMngnVpuYLGvkuKP8rro1xAW0biMwCthdnOkem99vuhBARz78SKy3ZYsd0K+FMgt3skAHRi2cXsPrYIF7BaL0/AXTur6TCnb9ir7dhqC/uzG LzBvKldXjWYxxZeUOzN2j2qELJwz6halHPZjgxZgfDOgt2i+htFdR8oC1OgWtzN7+a5STl4gd8xymByWFWDsJ6i5nNuwol/QQUglm6coqZbAHBo04WiD874m4RqPABrUNbxCSr+JnEpxhRUAV5DQAhtw TDXJGzxJdg3gZV8k0CJh+24n6L9d8KpzzjDjyAevHfaKX5u4BqBNlT+fYqZfpLNN5HBoeTvwfxYJMItvNMUCpJacCrbgyeyZReenTYk9mHOBBz8lMpNVOH3GVmQk2szTxPYm8jQL+v0DdzCgCITBH1g+ 4VMwSF6Nif5TVPJfdnJ/l0WzqVBNqu0E4jF120ph1XpnYvnMOcCdaEBgRYMyrOahWefuZV+Ltm/6+wto/iLlHY229DageMcPfvuTPmGAai8dYdvi0BlJot0fD4Yt6PvjGCr/Qa1BN9GeDnt/P924/623 Y0b/Ot0tVym1l1r0w0y/daHUC7tOav8EzAXqfuG1qW/OxPEOx3tnzbznrHrW3eH78hwfjAZA8m1oed5rE3+jtjgTl/d4o5/lFld13nVKgO9yk9hnIVgouYzluFu+9wVnkvKNGRuAwE7r3jVn7cUNwVZf UEpyNVQedht7teWYpnbrPfOz2yO7MAhCBTbb2CR5vn6Pt7qDvxjg9sy2uRevtTktiVj61gDjmbM95PRoLZgsgNDachm2o41BMCQwB+BvebRlzAvkI43sgLQzHOxkY83IQzEIpDLDZoV2MLlIZgJeLmRC 0TIKtwq1uAPkvOXCQ4e+HCbe+IkFYCgzbZ7hSrtPPxbTdCsh+BcqRz3rlDVnQ5Q8vX550XtJ/OU6PlV0ZbhHioECdrJPHIPHa9gALhCnxfgSPet1v0SBZGrgu8RuDjOwzKBapHKzqjnwpIND9UE3L1jV Hy2oMOWhqgKz1iB05p6OWPvHQviTBPv3ygQLDMAsNxZiy5cf2d2mc8PNDbi4JszQMcwP9CrAi3IhG/tS47HigEA1qLy79L8Ojc2r9pdBjUgtALPX+2Gi+a6i7lUCBKAtZw4/y+Tgo9Ucdb2O2zAnVXpn Q/A3J0LO9KVhgXRcQzq4vy/EDamqxTT54oVjpkUgGCTPo/fkeu+AavqTJO/J5l/WUVoAYaiDZ+/x1bbaV4t+GWWt8vC8wDIQCX39dT8wF6rlmAGdGq5FXgneXtZRVpGohCPVYC2NERsuV7V563IX9v9w I5chJZmUDx+ne3VeprlJ/ZnVT0WeRUfQkL6XrsWVSSmDAyVa7bIJIuKTr4BG3QW5ADmuy+Teb+ZmeuuZ891hyr2uM6SLdgG3FkGFuCXSflXsk1LQED9d3zhdir/KNtBqj9QApbu5AxAtgADAIQCkLI2V AAeZxswKQF9EQjk/4ENuKOCGoA7EQKGTcBvlftmX4R/YvUtN7mAnBOoWYFQALLoSLKOI+7Y4kMIALdVdiDYa+IMwPrKTl8AUulbgEMrMBV/vIgKwG5VAL7EpSAA+Xz5B0NAsP+CNZhLQH7Kyj9f+tGt4 O8FbgRG+IcQsFttwD/kAQpAgIBYAiIAUKCfVQPW9nL2Xz8XgfRjBuBagX5LPPSTFuBn1frb555J5vw+W4CfquuhIpClVvnHOYAABpdzBuDyXve9ZQAAe7AJ+LtsAQYICKo/GKuW9iAAXL6k09VVHlIVY A2AwJo3XB1bgWuMFRhaf2FQIcgbeA4UgIu4CEQKQED5t7jmDT5+A1uAAf6VowX4iFqASyTrjwcq/6qOkPpPRvVhzf1bwPBPWoDno833EFqB57MacF4VwT7J/iP4B0BwP7YAo7IPrMCY9edbf70acD8Xg PjrmBvIKkCAg2H5h8//8/sE+SgncA8CQZv9ZwecxwxAHHvcLIB/dbQFFWB+8uy8ijYGfwTX5pW3KQScJ1bfskjRV+JVfgTKyCJMgG5nAOkI7LVqwch8hYg7M0BBOCeWXoZkouoLFIQEH0VZWFxqlYU2X 9ArAmFNWiAi69b171BISDmBFtrZ7EB5Z7PmD9qSEbUXp+UVxvbhHfx8ZCVG26+3+hab/EEtBGEFIGUEbicAiLDvgKr4cF8z/7wtWJSBfv+wtwBjMQg1Cc9L/h4ufKLf5UAOoMA+tscCLLNtuKKay80A4 PTZtVHhx3MnM4A/DwcFKAa5frHiTjL31HI7kA7j+Lk8q9xTGHgis7pRikPWhhBT8/6M9Te0/RrIyN8LGYC5nO+Xs4uAH0EyyvEDqCbWWIF+AsfyWHmXEktw+zA2AOcxwMtjRR9kACJsg321AJP1FnMFk 2dTDBNJhSiqPDoPUA7zAWFuzv7LNwCykNWIoirMl/Vx5l++bFkZmG/zBXd5pWIhW4FhndmoOEy+veWcS2Ez72cI8TAL7xSo9KD8g8o47hn6BKEWKOmgwfe+Ac7pA0sv5/9Bnt+kIQ/zsBzkFO1P46y+y UOS2XcN75vBNtwpA58oIMSykSFSC5INWVR/Xrknx5NOEbSbzNl+AvEmsIIRgSMDQcoq9FbfyWwLnshKwGncTIxW3lOfoYV3EgPAmWduoPJvGsLAT1HtR/bkZE5Q/UHuHz5Hir9Jp7hE5PR1VSp+63eif COwdFegcLNKuKj5NlbJWRVfJhVdbMG1RRwZM/VuhnAsk3XWzHGXWV+oBswA3KSwJA0o3gxBZBr8M++NfqO7zt82Tb8R7LQlJfqN0e+Y9vvFv1cGAAnv5ONvX/hfbtypF5Px/Qz22/UG3sn+hvD6/02uX qb7guuxrdgAxrTzFvxtiBSE8TsMOIR1D/2AxiCDvkEZG/x5OAYFIMx3Yo07dmWz6zNALMjY47KODlbreSgYW3mbtGBDM/ckH8+CM7UTk81WrlsQ18XNuyGMM1ZdYzfuuepViwLiug3ww/Ub5Z5X/W1WN aBXCZp24CveotwZ/zbBt5v3Jts3/9jkGkcb3daLDe7li/Vu21gjjUtNbju0+l7azErAerUA07bRtAMn92qDMKn+sBUYGoKxGRiy/yjfDxSGVhWIuYBaNkK23zYoAwnuqddMQAGEMFe7lIBAG/DlTW7/H 7e66rcJzAlokyEwsKxnpQI8hW5s0y1Vey7Dt15vyRUgh5ZiA+lACYgZg30M4/qoBITsv2QZlvWIzRjtuz0mnxDvXxUASKs8VNVf14pgfWoT7l4uLcDe/ooqP1UBmlw8zMEr5yzATMpA27YbNucGpR1pN mHT+mtz9qzybrZpKZ5tyjnwvH+3FHmACvAdgZixstAcx2UfNk9Qi0+i4hGvjCxHAHhpfo37YF61+2A+tABXJ6POjc6vdGPzat3l4lp3qXiZG87JdaPGugswbzS3kKFeCOYygbeRHAvR0kGbLQnJnLUXQ 7s7Q0Cr8JP9WJ2YWclnrcOhnTjej9clc53PyXNjyfbPM/INgPOlHniOS0Bsdh4qA0EZB8q9GVCIQaDwm5kEDRGqmUKRAJTNYDjIwA1UfDezvIoO751pS0S8FVeKOKh8ZJZCvS8NLPzSwMU4S1DyAOGdt 7II7H0101+X+bUFWQtASJl4S62/xurLv9lNbhmG579J5oZv/MrAxVuyHvjmGaSgxN8Kfsfk3H9Mmer6H93o3oJMv5KtOKAFWDIAuwH+YQkIAMBmUgKWQw4gQL8d7njJTs0AxBZgtP/ucm/BtmyPFoAA/ IPj42AH5gIQ2AL86+AB+8cXH0T411l5mHP/DpCqz5R+iAW4o+Iw5wGKMvAgQr9jFUfRCnys/LDrWnTYNVZ2uKbKzmTbicq/huoetvzS2IhAsAtBoCoBEfT5FuCfJ/f8nPP/XmKVHwJAyAEECzCrBX+G8 M+DPoGAtv1XG4DhGEtAPAh8AVR/kv0HSr9kK/uwFfXfBmkDru3RBmC0AC+hYpC1DAFF/SfKPwGAa5bR8bN8Hmy/T9V1I/gD5R8CQW4AJhtwT3IejvuxCAQzAJf3uO8x/Pvu0m733WUCAfvcquTe1ckzU ATyePIMlH+gChByAJN9yv173VVXHlUVoAd/nAFY+4arQuvvUVQAghKQFIAA/mhfgWDNa6j8AxswbV9XCzAMKgM57BYC/FMFII1HqyT/j6Ff7SFs/SULMCn+iusO0ag+4JWACP3I/vsQ7h90s2vA1rvfz V1yyMA+a/3dxxmBe92sur0BICQ1ICn+8pdy7p9YgLEB2LYCW9vvq6jiIwD4qlqBrQoQ8v9msw24EBWA7XpfwZJX3MPlbQzuRJFHWzn2WzsYFpZxRmCpL/IoxtKPNs77a3PzS/icAW4Cx8hq7PMF07aiD tTnBTx6aDhfQWOzKfAg0EaZgb7Z2OcNtvg5Sv11sT57e7EFngLwxK5rrMZqAabrcs23FrcYtaAoDptNXiEAve08l7cbUxPzDlUSan5gKcHABaYEZG7VAS33mFt9EMHfg1ViASZrMAJBVPsd8ZmAAgI5N xCVgsnfxbNWdbus54cChR2Bv/cRnqV461V6oV0WIFjemgFvFZYSj3Wi5jupjb6p506kQb6UAWnWZuwtvqH11sK6vHWD3s4rKkF8Pt3CiyUiPL/NCMxVEMjFHs+GysZcAaExpFznm45TT71Hyrk9FylXb xerADEPkEs72PYL4K0ICz5ITQdKuQJWDYL6r5CVf1LOAbmCeckAcIcKPcwZJACXr+8YIeXgrgu+EKTdl3BIUQiCvjZSDeYxbMT794gykY4Lknfk8DFm/bXLNpljj2T9DbOFmYtCxLbMsPABzhIEOFi08 7yb/usvsJF3wsAnmJ+HZR6ogruOUHDSacrTu+/Up1gAAlZgbPVlW+3EgWu+4IPBF5ZigMIOm3Y/Q5A3/hTZeieznRZA4BQGdDNEOSftuzw3Fntw7h+WgbBicIKq/2iuSZzXN0Gag6HIY5DUiaj4O/kJF nlMERXjaSoVQegHdl1U+UGm4XWXg/bdG6gGzMLcQrYlC7BM5gC1H4LBIcr8m86WX5gT5oD97F99jirAmaCKTH7jcReojONuKfsQCDXsiyqo+fY2qu20zTeGYhdu+1KNAAzGINGANQscBQReiHP1bvrrc SFGhgbgu87e0nWHkO9mBORupYO+wAZ8O4RuAZwzEDNWKQYKQGthhry+b/j4Zvh9gc3aHMcwMfpN7j5P/83uO/8fbtzQc27cmbWZrb9xicbpDXeAb+sygMAMkDATCAz2N2SeL74/k/U32H+eoZ8MA/sUA G4g5Z+c02sbCB6+/7xrGNvo3v/YFHhEYEwy8CxoC8s8bCsvK/o+atIsv6CxV+AeQ7oeye8T9aG1Bcs1fh63HzWFNl1RAl7xz3fraOJik83BOwU+6jMKCL29mN5L36O5fyYXsCNoSZbfognfuWVsi3t5r N5tu9SI0E8gIEJBAHTaAtyoZSCk4mtkheBmBoQNrOhrMo3CBPkgIxDOtYw1GTswX8OykU00LkqpCOUAtkp7sCkIaZECETjH97R9UO/aP2hyj3Yvd+V9KxGKkZ13BWX9cQYg5Ol5+y3n9okNOFL5lSq4Y 4UeFHZwTiCpCCNbLtqDqaCjtGulloKQSm+1q7AKvh4PFr0SkICiWH81V5DfU9H/uFqO6d5V+sy4sATDq+PUwivAz7b1mky+dzMUgPxNGnxjeGgLOAKrbWjrDQFiSaAmtDbeOKvwndmlup7QilyuikNVF c4pDyGgsRe/KzZlmU+bgcsNCCzFFuBLWPxR6y49VIPADzIBoQjk4rxKNwLbBXVuZNYjbiSVYhUg5/jl5AeqQFua4QGZbxGOVXMexNk54jy+WKEXbjNl/cUWYX9vpvXF78mkGMxse7bQErc5VFDyx2T7b 1l5CgDB8ir5f2LLFVWbZPfBfQjxGIaJVRiBGF/3GYImAy/Z3gaVHAA7zhlECJfN5SGSEwjz5XilnwWJN43lV1SFWsLBrcGBklEBpM0CLPBzZPssQLHp+mbjULmIsBJzBfPZnmyzAk3mYFaRtwJn+wZhA atot57OeYDJM18k/w3+24ws94fZte4gqADBAozFH9tcNwJAsgF3IATkEpDkH8vHwfoL0K+kGdt/BQJ2le/CFmBQ/3XgEOvvbrYBk/33WDmpADsXvYIlIMfL9qICEAFgBSkAoQSElH6RzVcUgHErsAzO/ oNG4c7kvjcXH0X7bhNDQIJ/XQoAJfsPwCCoATdKAzDbfl9k6IcW4FpSANbXsNqvkpuAq6kARBSALzLkwwxAbgB+gXMBFfxVk+Lvx7Ct6/VKwDqf+4cgsLaHbcCgAOxzG5b0eRswKADR7ksZgOuXUesvN QP3uzV1ovrrZ9UfHxs1oEDBZ03uHyoAAQIu72PrL4FAVAUufxttwKD++x4AQMz9IyWgAEBQBK5cAuq/tzEH8PHlv3C1APqgDbjqTSwBqQO1HwPAmipTBsLgD/P/ku1izv+rqDySjKNq/UX7r0LA18kCj LbfI5wDeJSHB3+QBfgY2IC5EbikluDgI9WH3MNc+vFo8jyAP1AAwhYLPhD4HUDL73ywBbPqr5iz/9D6y8eQATinTopAJOtvL6oB0fabbPFazat8vNcV1e31CkCw6IIKsM6rAAEAwj3QCIyDIV8Rwz9U/ 9X5Y6/+e1XtwFgAIi3AUAhS146WYASAyb5X+MloMftyvEPBYHH5Tt62YvFHsQGBBNZa/XOqDmxVMFes0E5AH+cHGsAHIG5BaRuXjrR6ACjzaTEJ5f9JNiBmAZa18nt2Bt/lAeAOPS/w0mYQimVZSkyoH CVsP9Y2ZFUG7uA24h2q9psvSkCrEgxyCMUy3RKWlpQ0s/U4fF6gZjFbiR8u4UZhzAB8zc2tgjIaBn6VBAPJEnyYwR5vq1npV+1bgMUKTNeT/50nfyfPXnrMpX54xuWsIwjmIdsJP7jUQ2AdtPNC9l9KI d6JQPmXw2o8gITZktG3jo5TcePvOmrszY3hIKxh/SDnE9J68taktwAj2ONsQCnuQHAp80MjMNy7fsC0+frWY20BXktri78Dn4VvXUdrlWFbkLO/Dy3A1IqLbbq7Rl3unlFu1QUoRjbaQi7HsKq6Im4AF ptwjikKEQgnDb2z2kYQrIHlFodaji/44pB2yRQcVeiXy1bifLYpA8DLZyAJluAizu0D0Ef25VFUAhbxtUIGfrDVTEGcm/IDsR14zyhbmyn3r5AzAQGAFu684Kb9+ks3fug6lnFMGKJmXMzpGyJwh1tUz H3m7h/4FGEfKQWpRANhHavvECBqfh/BxEms3Lt3kEDhRC7WmMLNuQL6ZB64dj+oArmNdzLnEk7k/L+pmPXn4eBULv6Yyu+ELD84j3beU7Q+Kv+4jgrE+7lURPL7JnHuIBzDbwAZh3AvwT0Cjvjsacr6g 28htSA1/k7FDECwBVMLMNqWz1x3qV99juUm8A1T//YL961zDADPf3MH1dzNEKZZ66wCudsBnIIiDmi/vcsCq7gMI1DI3TKFGVGWoGbrReuxsCy288aZhXH+X2B3vh2uib9bf49AdWhB3O3wd4qVjhEAR Yiq32gAogWUmay/MaDUnEHKALz7/L+58We/cuMGn2S13IZQYZdR7RcXd2yIMvkMOPyLSsENd4Z7GVWI8XwMCU/b9fA1UfKJpdcCP1X6bTCKPwMDhwwE/OUaV3X2BTf0T1vZZtsUFnFc8TbablHNmUINg YWhKq4ptMyqRdiUfmBxSNTqyxmBChbTIJ9v/sV3yBoZXGqW39VQEaj2X1U2hjZitf+a1mEp+RBLcveftoYNwJKXyEBT1tl/lVR6L481IQCEQhCBgC/zAEvwtrF6Vvk1GSuwlIRs8nmBFwUAEhBs4SIQK gUxqkCjFhQQSOcbST14SZR+VBjSwsetlwgGtqgisBGtwu0fbHbbR19yC44vdxV9Hs6pXVast6Zcg3L6oKCDVHQK8wL14Gq1B5dysYdk9nm1ns/1I7uvqPmoaIRKRFZyFuEKVhvKczDXclILmmcE/vnSE Z5f4GD3Sv0egILjApCWQb33N0ZZFwC3O2T2KRQ0mYJ0rdxn9dlyDdy39l0GjQ9aq3HcMJzhWqBYLPPwbo7PKbTFIO/OseunOd5jq7Lak6MGYZ8fSN/SnxxfBPUfqv0IAF5GIFiDx5eKa8gSPH+FG8nzW X6hqi8T3MtPU875PL64RCRdSZepVXjkjgAwLiNJV/vZTEG5HucG+nxAO2eoOLwQvCOyJOcUuN8n+x/n5bt/nQ6QrIDz+QoVbol1FaEWt+UK6PpmhlHYSUaewD8L2gy8o4Zcr9STYg5rn7UWZIKHvqjjN luS4R2kAvSqO7s2zR5M2TkEwBUokLTjZqQAlLltLiCCyiyClV9m5YWNxBGsDHMJi3xZScr/pvI7Y7lJVr77ZnrKvQ4gbyG3/5Z5+IctwGXUAowFINACnNzbgcCP7b+Q/5f8I7SjvI1KQCrA9rsLlX8A/ 8D+Sw3ApALEAhDIAayAFuBXMfsP4V+yFfsvWIE7yr3q77hCPwJ/bzHwE/uvWICPY/YfgMAjrnPRQbdv0Wvu55XdCP+aFpP1F/P/qrkApFIyAEkJKLmAL8E+KP+qKfcPG4FrezD3bxPbfV+sAlswZP/1E gCs8gDwBQaAWgCCx9QC/EJVsg8W4Bou/qjt0QZghX8IAH37rzQBI/hbQgpAVQHWUf4fQEAAgGtrCACCAnANW4C1CXhpv45n6nrUBvwsZwCqAhABYL8BgHT9acj/YwUgQMCnknmeWAo5gN3ur5eR+u+7K 8AGTOBPcgCX1ryFBSB1APsg+y/Z1lRS9h+q/6rpvALAGgKCoP5bVHWEMwCPevAnTcA8Kmp8C3CoADziS0BqjoZWYLb/PiIZgLWUAUhqwCM4IA8QByv/iqv2USMwlH+ANZjVf3Or9ykAnIsQcL82+z6gL cDe7itgcBaAQG4EpoxAvo8BodiAacvwjxWAuK+FIFz4ERWCSBEIAMAHal5RuzBm/0ETcO2rCAJB3Ya5eNyuS7DP2meb/XH5ToZ+sm1RCIgtwGgfbvFDgWBLkC2oqr/S8FjuVbWgAkFbJrJTC0uwrZghm i8Z8QpBUtHt1DxBvFYuxSVhNqFCPzlnQKFm/PEWi0PEvotrESC40wA+0wIcKRNjuLdAykOMqhCyAum42bQZk6JQAKNVAIoFeK7k+knLbyVbfEUdiCDwsCkFgXsPal4gbOctPuRmJ3+GUj84RbBt7YDLW kvAC7frCXbBfvY6tgHDOYBpDMxS5noK7sHrg3oeVHpqs11HzcF564cIovF9qA6U+RDYneBzA/g+uSeb74F54f4sAH1r5dmT+ozOJ1BvPa9hnT+m+bgQhO/PNtBR12WgH97D6j85ht8KAGBu2zmCYm3nX d7uMbbQDpN6D87vEkvtBQJtXPxR2EqFHaCsy5PmYM7mQzDHFl9RB4qqL5dLRh7YNapAMVdUgAziwKJb1EZgj7L/WGnI8BFsxwgfpYQE12rKR3b5ge822YbSOCyqQ/vcrF0+CxEtwMkaZ/z6Szfx1A1U+ wF0uxfy+QYJzI0fYpiHRR6fuXuHCKhhiQe27H5GCkG23EphxiTO15vMDb+ThqQE5DPMFJyC2X5k+xUlIGUEEnhEEMetvwDbpkjrLqv+4Py0AbL4YjbfELULTzUNvnA/rA0UeDO4kResvaDQgy3AO7D8o lrvzOduRvIbzPxVcu7MdQSe954Wuy9Bvels6QXF3wx57jRZn2ecuYHvyDnzBWUDoh0YVIUEFgGkknLvNhVKWIWbBWIxjMsIujykApXgPTJnbF1Ng4h8XsozMtlgL9h5IiBpCzeCLD65z3xXbCHWNX0dz gu2WlTrZfruCEDqt99h7fZ6XCqS9jtG4DAuAhGFppn7vrP/r5v4u3924waWuHGnf+Bts2mFGlGRx/+V/ddubYbfhigLMHouBoBWEai5fuYYVX7mOVX1PW/y/Az8g/0Bvm9AQKHc/wOvFByieWck7zj9p 82u4yoNtcAG1ldQ6TWpOq/TwDhtATY2XZ/lx6o8k9dn57b7miFo7cBXPWC0jbwyT9gSbNqJGQr6NZi5roRzdhoVoKxHVIaBBZghpILBq/775Pm+5Dfa94cm13Rxi7f/jpESkEAgbDcbZSAp+f5/vs7sN 6rrjuOklSoRQQqMbTzGHsfE2AlthWfGEG/gBatSUpIGGEPTlDYiicFNDNgGGqBQklQFG29AGykEGxOpQl0wwZBIbUSatyplS3BMpb60L/07Tu9vPb9z76QPR3c799wzFuLho+9ywLQBWyAoGYGgFuz/c LfJ/BO1Xy9l/tnBbcL+eS8CQIKJMo9svwMfvWZKQ2iADRjUf7uu/MitHdmkijxU0012M1ADiNbOMK/TZcfaERQC0Guc7HKNCuEI8Ily0FuJuz0UNHbgMJdP5nRqS7B+T87hCNmAE5IFuJmfddAR1Yvt0 T46dB95fi9r9i9rNcDcSQWAuVDZp1mAHpb5zD6vgFP7rKgIrQpvda4IrAtzARXa1YRAUDL2fDZgNmYPzmsrr9p2a7y6z+cJSrFHNsgcfNfYejXjz9iHpRREweIT4Vqy3lloAa5rcR+vaUUlIIyP69ui0 YqNwAj/6prcjfp291HtBnd1ZTkq3a6lbZlGCMiuqu3WloN8faafVerZZuFkrmB4P5nfF1cMJtt+ixePeNBXTKlo584W+Q323T9Ev/XvZauwBASgFthqEdCVeABnLbSkCqx282C/VdstQz7J0WNYJ4pCa ycW6IX5eyv8M4R0KQ/RHjC0+yJVqcBOYN5DzQKsCrL+RGk4z5mEvknYQ0lSDVYrsEP7bmnGqPQqeU2av1CeCRSE/u9Q6e6n0r5UpEwgoMktDGzI3KBsLcbwvET2RA3M/1mx3F2u2+HezkOj7xtuFNuAq QkYMgAh829kXT9ZgAEEAgCEgVbgAS4EGUTVH6r/8mQDRsuvlICAFVggYOMRHNQCfBRLQAAA/qbxKCr3Tq0/jhBwxKj7TplzKQAB4HfK2oI1E/AdzA+c3HDc7Xt6GAEfwL89bAFW+68p/qDzUVQAAggEm +/LWPZB6j60/koGICsAf8bqv59iAciYNgHvYmuvWH53tYwHGYAvNVP+34vR3B8zBMQykGgdyPzbyQUgkv+nQwCgZAGqHZhKPwpQAgIwsG0SLcBbuQwEgV+7z/+TAbZfUAdKG/AWVAEKBDzrnkXgN+l+g O2/kgl41m3pOB/dm3TPdky4ZzrPY/HH9zeNkxUYLMCdUgQyER3P4TnkAbY2MQBk9Z9mAAIABFswNv9CDiADwBawAEsG4FuoBAT4BypALQOB59H8fDMpAPOt76AKsKGFW4Cx9OOkQsB1rABsaKYCEMgA/ E7TCQJ+nAO4FrIAm45jHqBYfp+Uc1ACcguwDIGA8Gw1KPyiUcsW4Gps9T0WFH0g/MPzX/ocwDZS/9VAMUgbKf5EASjKP58BeMTYgY8Y+OcLQKQkxBeCUAmIqAQpB/BNXHd1dB+Vawjwhoyqz0C+XFzxN xA7t/MPeJUg2IA1V9DCQWshtmrDAYV5fgySjThrn+83TcD7w9ZhhpZ1DDE9DNzvcw5zvN+gQMRbiuvzdp0Br9IT9R/sQ9SHAidFHcjlJd6K7MGf2oPFAixqP7UOHzAZgdw0nOW8Qc4nrNffz4UlbA2m7 D5S+9VG/67V1ttE2X61rOxD22/0nEpBfPbfGrb/omIQS0FOuLoNJ13ZjksK70q3yfECAjEYJQDbtvm8PIRuBo4BFCvjOai6K0zpuwj0ttO7JQrY2ELLcK/MAL4VWy/gtYeDHvqVRseS6LkAR9oXf09yC nn/8k65WQNHgRV90bNUtBYMhYoK+zwUXMl7XlkIQWVK9xpdP/+eNvtWDv3ZrYSsPWn3HWIwhjl5s67qF3MIzTIHWX3HxRkZLvNIHxbAdk0VhATquFTkEGUNIjwcomw/WANtvawOlOdS/gEQENSDso8Kh osAFWE+2owZPFYwWMR5Nt+P7b1UQkJWZgGKPkfQNwWTZZkAYMXhOQSAYJFdMkUW18Wo8iMghyq8qTuk6mMQB3OWqgqQ1HFQ6AEgbjGq6wgIUuMuW3lRuQfnn6siD2y8BArvaOEHFnVcJOiHll6Gg0u4t GPpNNt7L1FeISj0FoN1WXIDWZVYevk+Z/+RLXg5WnLvIdhDdR8DO1QhMrBDZV80p/yDe1zuwXNnKNcPij9W8P1lnPNX/sEXrjSaj2o/AH5QmhJ9F66hCRhKTh5lteIj1/5JTbp/jOX8WdWZBW02I0/zA xf8s8D+GlPHxe21AVg037PfFNVcYLGdD/cYh21/KrIutgMbuGZbdxO5hQ8NVBQw99BDvrgykvf7yKyFqAvFf2Mxi3Tw282aukfTJGzeB9v2N2b/7b555ZpbNLXJgL54E29PqAicsbl9Fgz2mIxAAXSF5 EhYfQuxNePzt7vAbgzjskBEhnYC7wToIcQrEBhUoCf3doT3LpnsP2sHxrUL2AY88UkfNu6e+dTbbUdveTgmJR6iALT3wzZer/ATACe5gYEikCGbLRjxMK6Ps/32KFyzbb4W9tlcQgKEtL/xz0jROILAL iwa0eIRs36gBAx+U5gRaCHjxGek/huTI1iaozmn/7rX9c7tQfXfG3N7FQDitYGCAP9ADdiPdt5eb/kFtd+NUAFoVYD+fhwEkjUYlH9UHvKagkC0G0fngzfZdnx9N4E/KQhhJSCpAV9xx/7yc7dl+ofuu wgADYxDtR2DvPEuVQZKHmAelHbwbIxtuSZzD/P9JNsP7o+bQpHofuNYWOyR00y/zXofm33Zpov5gWOcHzjmVX45874q/1SN2BWARlIv0l5z2jbcTRmAiUy8mN03AH4JC7BVD4bKud8peLMqQQPjFKjFg Jso+WrM2saC65t+BTiaUhI8zwalHbbBOICYJv8vKCEx+/XzvfoR4WU0zgEAhNZfUADyuFkPJSBt7saaZjy/Xt+EBSFzazvcjcwaN5tOqxLQ2n7jyrlkzp5XACbVdB6wFSv5+Hrbb3JesffjeX/J1uBi7 cHFYF8xCMnQs5wA4D1Q06VWIZRDCFbiAZWo9DD3LuUz+ObLKhXuiVIOYZbk9gVgTOy3pNiDQpEF+MYKgn6imoN79l1tCxb4Z1R68wzxFso8/FP1YFkRFaDJ4/uyJLQkW/We2J5t3qHCQrUWV5Na0hSPW NBpf/uXqqQ0AFG+W2LgY4rO/7W83H1eUefezh5yo+ui//xz/W4k2++GG0j9BwAQCkDAAgxKwDOQF5iFwg8PAKUEBMDfMANAAH4jXAAyzC3AAADPNL6JKkCEgI3H3OkcHxtJAQgAECzAw3mCgJgBuP6kK gCH86L2Y4uw3F9/EhWAp9eTCnAsWqd3w4jrhQbg6LiXrb9gA0b7L0O/V2whSDOpAREGmuIPUP+RGnDM7W6hEpCXwfrbwhCwiZp/yQpMCsBdxgr8E27/fYkH2YKjo7X/MgiU9t8XOQNwp4GAhTaxAE9Q/ h/aglnx1zaOxR+gAMQMwI1UBLK1HYAfNwGbDMAXsAl4gpp/2wjwPcfjebD/dnoFII3x6P55VP2B+u+ZzglS/aECMBod50gB2EENwN0dE27zpkkGgWdJAdicBIBwBAjYbCAgHJui6yZQALL6jzIACQIC9 PMKwF9T+Yeo//i8gS3AAP3gGvP/RAEIduDmX6ENGCEgwz9Q/yEAhCIQzgB8UtqAwQLcbEBgC4FBsAHXcyEIZAAC1IMSECz0AKDXetRnALIaUAo/algpCEpABIYC/rj118M/UQKarD8AhabxF883eguwt wrTswxnAGZaD7vMRrIDAwR84ulDaCOtwxzAQQP3BmOgbzA2horMYVtunpV8+SF/TxV8MYuwLR7JHYiBQQJwBO0Gg3VobqxYJEv3bY5fnSkuEcjn9+ELQORcgJ+8K/DQF3qw1VezBff7dfm9p7IDDCB57 fyAsT4zMNSWY5r/FLYsi314H72LKsCB2LdNc3G2n1SA2QOcAcgWYFYBIvxDq68UgbylWYAEC0H9d1KbgWvVKiwA8ASq9Cp6ptDKC0ArzRAMIBzZXxmECRzbxvZbyOAzxR4wz7/PgPAFsgsHuXoM0ioA9 MkokBqPVIdeMViuz6f0vGL7RYV9af5e2ijzZN82kxBhY+F9t0p+UyHMKkzjehfUllzOQDTNQJH+HqxIxPemaE9wjgDwQ7QAV2EJyBzm48F4/KDYYq9rSQYo5Co5u08AXiVbb6vZKixlIQDTMgfJZluFB R1zWv6BVt1DBPMyB6kV+PHo21VoOSbbLoLCQ/5blZxLWMXwsZLhYxVDQhjwXrXsiduGESQaKzN98zo2D1fyt/F38TcABma4BCV99KYrufLALQZFHkM5AGvLuAV32RS16wJcW8ZQDmEeQz6y+v7DpWZAI Xib793mUhHK31vyPll2H5sWizC19n57WkDaHbbt3tbsQCkUWYqFHXe5bfgOAsLHGDwu45IOUO6BynDl5fsI6cpm7iE4XH6ZzkHtB1AQnqNNeOYu5hcCsASFH1iCH52hfaBSkK3JqRn+LpeDlM7cR5gHj cCwVmqGVH6QLQhwkezDd0n1yOUnqHoEa/DUnaQiLgGpvgoBnL1OFFzEgFY8F8+2Bycy7QQ8Wrj3MHx21QAxff5/IFsxRV7MRlu0oCShdIwBu0Sb71cuAf3if5v4t4oVkARzpKF5nsdCEspefeC+Nftft +j3v3WLLm4mEBZAuh5/bq3A02IVNkq9wKJbTMlX5FozBc110NLbQwBOgOJ0IVbYUQiVfvqMYaCshzBvp7H59phzowa0isAp8833trvem5AD2OeGEYD1mZIPaeTt4/tGjfdpn1phA2WdZgiKoq5P4du4Z AAaK67Ct1iunlfk+f2I4k+KRSSX0KoHRaUne4d3Rsz3Rv8W7nEsvnfY4y3Ya19iL6MWat4K1YOjrIKEXMO91wHw7UUA2B/LAnwdC0I8DERLMDYG92Jb8D6xAs/1KuQLz1/FnMB90vo7ZxuFe9n+SxmAU gyyX+GiPZf8v1eDRmBQBh775HW3/ly3+954B2fqdSMoa+DSjuwk226jY8ME235xRM+x7KMLM/xCa6+sI4CuE+fnueijQWFil7bxZgU4yvpcJNLA9+CddbhOqBqE69zZbtwD7onn5GLrZCf978qKnTl6/ j8AAAD//1GcYjEAAAAGSURBVAMAvSi5xbEtyb8AAAAASUVORK5CYII="">' SET @tableInfo = CASE WHEN @failureSuccess = 0 THEN 'The execution was successfull.' ELSE @tableInfo END; SET @mailHtml = REPLACE(@mailHtml,'{{ServerName}}',@servername); SET @mailHtml = REPLACE(@mailHtml,'{{databaseName}}',DB_NAME()); SET @mailHtml = REPLACE(@mailHtml,'{{CurrentTime}}',CAST(SYSDATETIMEOFFSET() as varchar(34))); SET @mailHtml = REPLACE(@mailHtml,'{{JobName}}',@jobName); SET @mailHtml = REPLACE(@mailHtml, '{{TableInfo}}', @tableInfo); SET @mailHtml = CASE WHEN @failureSuccess = 0 THEN REPLACE(@mailHtml, '{{FailureSuccess}}','') ELSE REPLACE(@mailHtml, '{{FailureSuccess}}','failure') END; -- assign the values to XML variable from the table information_schema.tables.. you can change it SET @subject = '[{{Environment}}] - OH -{{FailureSuccess}} {{AgentJob}}'; --'Process failed: Error on '; SET @subject = REPLACE(@subject, '{{Environment}}', @environment); SET @subject = REPLACE(@subject, '{{AgentJob}}', @jobName); SET @subject = CASE WHEN @failureSuccess = 0 THEN REPLACE(@subject, '{{FailureSuccess}}','') ELSE REPLACE(@subject, '{{FailureSuccess}}',' FAILURE - ') END; SET @body = @mailHtml SET @isImportant = CASE WHEN @failureSuccess = 0 THEN 'Normal' ELSE 'High' END; EXEC msdb.dbo.sp_send_dbmail --@profile_name = 'MrRobot_D', -- ?????? @body = @body, @body_format ='HTML', @recipients= @emailRecipient, --'waldemar.kessler@de.bosch.com', @subject = @subject, --'Testing an HTML Mail', @importance = @isImportant; --'High'; END"
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G4;1329088171;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G4 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_D7;1329140226;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_D7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_D7] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_D7] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G0_DemoSystem;1332512126;V ;VIEW;13500;/**/ /* View: V_FactActualCost_Short_YTD_G0_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from POE in a YTD logic, but anonimized for DemoSystem purposes*/ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G4_DemoSystem;1336600050;V ;VIEW;4426;/**/ /* View: V_SparePart_IDIM1_G4_DemoSystem */ /**/ /**/ /* V01.00.00 2022-01-27 Martin Urban CI/XAD2 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* Data.CORE Outgoing Interface #0034 https://inside-docupedia.bosch.com/confluence/x/hdGUVQ */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P81 */ /* View copied from V01.03.02 V_SparePart_IDIM1_G4 */ /* Restrictions: */ /* - Restricted to demo plant 9830 */ /* Update: */ /* - V01.00.00 - Initial Version */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_D7;1337368129;V ;VIEW;9817;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_D7 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G0_DemoSystem;1338748122;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17430;"/**/ /* V01.04.00 2022-08-09 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G0_DemoSystem ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G7;1342940156;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3551;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G7 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G7] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G7_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G5;1344059874;V ;VIEW;1344;
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G5;1345088228;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G5 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G0;1345140283;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G0] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G0] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G1;1348512183;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P45 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G0;1353368186;V ;VIEW;9817;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G0 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_B2;1355568313;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_B2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2023-02-22 - Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;uspLoadBRGActualCost;1358679938;P ;SQL_STORED_PROCEDURE;19313;"/* Updated 20202-02-28 SYA8FE CostCollector links have been changed */ CREATE PROCEDURE [INFI_Costs_SSAS_CSC2].[uspLoadBRGActualCost] ( @SourceSystem VARCHAR(10) , @SourceSystemVar varchar(10) ) AS BEGIN /* Declare variables , Set variables Example : @YearMonth = 201901 , 201902 Example : @SourceSystem = 'SAPP87' , 'SAPP81' Example : @SourceSystemVar = 'G5' , 'G4' */ DECLARE @Counter INT ; DECLARE @maxCounter INT ; DECLARE @minCounter INT ; DECLARE @RC int ; DECLARE @YearMonth int ; DECLARE @SourceOfData varchar(30) = 'COCostActual'; DECLARE @ConsumerOfData varchar(30) = 'PerFact_Costs' DECLARE @DateTimeStart DATETIME2(7); DECLARE @DateTimeEnd DATETIME2(7); DECLARE @RowsInserted INT; /* --Sample Test Select [YearMonthCreation] INTO #PartitionList FROM ( SELECT 201901 [YearMonthCreation] Union SELECT 201902 [YearMonthCreation] Union SELECT 201903 [YearMonthCreation] Union SELECT 201904 [YearMonthCreation] Union SELECT 201905 [YearMonthCreation] Union SELECT 201906 [YearMonthCreation] ) T */ SELECT DISTINCT [YearMonthCreation] INTO #PartitionList FROM [MEAM_DataCORE_CSC1].[V_DeltaLoadSourceSystemByYearMonthCreation] Where [SourceSystem] = @SourceSystemVar AND [SourceOfData] = @SourceOfData AND [ConsumerOfData] = @ConsumerOfData ORDER BY [YearMonthCreation] ASC ; Select @Counter = COUNT(*) FROM #PartitionList; IF ( @Counter > 0 ) BEGIN SET @maxCounter = (SELECT COUNT(1) AS CountRows FROM #PartitionList) SET @minCounter = 1 WHILE (@minCounter <= @maxCounter) BEGIN SET @DateTimeStart = SYSUTCDATETIME() SET @YearMonth = (SELECT TOP(1) [YearMonthCreation] FROM #PartitionList) Declare @TruncateSQL NVARCHAR(500) = 'Truncate Table [INFI_Costs_SSAS_CSC2].[ActualCost_BRG_' + @SourceSystemVar + '_Temp] ;' EXECUTE sp_executesql @TruncateSQL; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(1500) = '' DECLARE @SQL_2 NVARCHAR(1500) = '' DECLARE @SQL_3 NVARCHAR(1500) = '' DECLARE @SQL_4 NVARCHAR(1500) = '' DECLARE @SQL_5 NVARCHAR(1500) = '' DECLARE @SQL_6 NVARCHAR(1500) = '' DECLARE @SQL_7 NVARCHAR(1500) = '' DECLARE @SQL_8 NVARCHAR(4000) = '' /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Collect the required cost centers. --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL_1 = 'SELECT ccccl.CostCollector_HK , ccentdi_bs_x.DimensionID AS CostCenterDimensionId , ss_at.[ActivityType_ID_BK] , ccoll_wh.[CostCollectorObject_BK] AS BookedObjectCostCollectorObject_BK into #costCenter FROM [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccccl INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.CostCollector_HK = ccccl.CostCollector_HK Inner Join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccccl.CostCenter_HK = ccent_wh.CostCenter_HK LEFT join ( select /* New 2020-02-28 SYA8FE */ at_wh.[ActivityType_ID_BK] ,ccoll2at_wl.[CostCollector_HK] From [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[ActivityType_HK] = at_wh.[ActivityType_HK] ) ss_at on ss_at.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [BUSV_FBI_OH_CSC1].CostCenterDimensionID_BSATC_XX_X ccentdi_bs_x ON ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ALTER TABLE #costCenter ALTER COLUMN CostCollector_HK BINARY(20) NOT NULL; ALTER TABLE #costCenter ADD CONSTRAINT C_IX_CostCenter_CostCollector_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([CostCollector_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required Links. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_2 = ' SELECT cocadlitbol.[COCostActualDocumentLineItem_HK] , cocadlitbol.[COCostActualDocumentHeader_HK] , costCenter.BookedObjectCostCollectorObject_BK AS BookedObjectCostCollectorObject_BK , costCenter.ActivityType_ID_BK AS [ActivityType] , cecadis.[DimensionID] as CostElementDimId , costCenter.CostCenterDimensionId INTO #link FROM [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WLNK0] AS cocadlitbol INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentToBookedObject_WSATE_' + @SourceSystemVar + '_L] AS cocadhtlis ON cocadlitbol.COCostActualDocumentToBookedObject_HK = cocadhtlis.COCostActualDocumentToBookedObject_HK AND cocadhtlis.[LoadEndDate] = cast(''2999-12-31'' as datetime2) INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cecadis ON cocadlitbol.[CostElementByControllingArea_HK] = cecadis.[CostElementByControllingArea_HK] INNER JOIN #costCenter costCenter ON cocadlitbol.CostCollector_HK = costCenter.CostCollector_HK Where cocadhtlis.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + '; ALTER TABLE #link ADD CONSTRAINT C_IX_COCostActualDocumentToBookedObject_LINKS_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK],[COCostActualDocumentHeader_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_3 = ' ; With cte as ( Select Distinct COCostActualDocumentHeader_HK from #link ) SELECT cocadhs.[COCostActualDocumentHeader_HK] , cocadhs.[PostingDate] , cocadhs.[DocumentDate] , cocadhs.[SAPCreationTimestampUTC] , cocadhs.[IsReversalBooking] , cocadhs.[IsReversedBooking] , cocadhs.[ControllingAreaCurrencyCode] , cocadhs.[YearMonthCreation] , cocadhds.[DimensionId] AS [DocumentNumberDimId] , concat(cocadhs.[FiscalYear],cocadhs.[PeriodFrom]) AS PostingPeriodYearId , cast(cocadhs.[PeriodFrom] as int) AS PostingPeriodId INTO #TempHeaderItems FROM cte cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentHeader_WSAT0_' + @SourceSystemVar + '_L] cocadhs on cocadhs.COCostActualDocumentHeader_HK = cte.COCostActualDocumentHeader_HK INNER JOIN [BUSV_COOM_CSC2].[COCostActualDocumentHeaderDimensionId_BSATC_XX_X] cocadhds ON cocadhs.COCostActualDocumentHeader_HK = cocadhds.COCostActualDocumentHeader_HK WHERE cocadhs.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocadhs.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_HEADERITEMS_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentHeader_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the HUB objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_4 = ' SELECT cocadlih.[COCostActualDocumentLineItem_HK] AS [COCostActualDocumentLineItem_HK] , cocadlih.[COCostActualDocumentHeader_BK] AS [DocumentNumberId] , cocadlih.[COCostActualDocumentLineItem_BK] AS [DocumentItemId] , cocadlih.ControllingArea_BK AS ControllingArea_BK , cocoadlids.DimensionId AS [DocumentItemDimId] INTO #hub FROM #link bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WHUB0] cocadlih ON cocadlih.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WSAT0_' + @SourceSystemVar + '_L] cocaadlis ON cocaadlis.[COCostActualDocumentLineItem_HK] = bo.[COCostActualDocumentLineItem_HK] INNER JOIN BUSV_COOM_CSC2.COCostActualDocumentLineItemDimensionId_BSATC_XX_X cocoadlids ON cocoadlids.[COCostActualDocumentLineItem_HK] = bo.COCostActualDocumentLineItem_HK WHERE cocadlih.[SAPSystem] = ''' + @SourceSystem + ''' AND cocaadlis.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocaadlis.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) ; ALTER TABLE #hub ADD CONSTRAINT C_IX_BookingCOCostActualDocumentLineItem_HUB_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_5 = ' SELECT cocadli2po_wl.COCostActualDocumentLineItem_HK , ccoll_wh_po.CostCollectorObject_BK , cocodis.DimensionId AS PartnerObjectDimId INTO #partnerAndBookedObject FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WLNK0] cocadli2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToPartnerObject_WSATE_' + @SourceSystemVar + '_L] cocadli2po_wse_l ON cocadli2po_wl.COCostActualDocumentLineItemToPartnerObject_HK = cocadli2po_wse_l.COCostActualDocumentLineItemToPartnerObject_HK AND cocadli2po_wse_l.[LoadEndDate] = cast(''2999-12-31'' as datetime2) Inner Join #hub as hub on hub.COCostActualDocumentLineItem_HK = cocadli2po_wl.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.CostCollector_HK = cocadli2po_wl.CostCollector_HK INNER JOIN BUSV_RB_CSC1.CostCollectorDimensionId_BSATC_XX_X cocodis ON cocodis.CostCollector_HK = ccoll_wh_po.CostCollector_HK WHERE cocadli2po_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #partnerAndBookedObject ADD CONSTRAINT C_IX_COCostActualDocumentLineItemToPartnerObject_WLNK0_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]); ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 6 : Collect the booked material objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_6 = ' SELECT link.[COCostActualDocumentLineItem_HK] , bsat.[DimensionId] INTO #material FROM [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WLNK0] link INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItemToMaterial_WSATE_' + @SourceSystemVar + '_L] sat ON link.[COCostActualDocumentLineItemToMaterial_HK] = sat.[COCostActualDocumentLineItemToMaterial_HK] INNER JOIN #hub as hub on hub.COCostActualDocumentLineItem_HK = link.COCostActualDocumentLineItem_HK INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = link.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_XX_X] bsat ON bsat.[Material_HK] = m_wh.[Material_HK] WHERE sat.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND sat.[LoadEndDate] = CAST(''2999-12-31'' AS DATETIME2) ; ALTER TABLE #material ADD CONSTRAINT C_IX_COCostActualDocumentLineItemToMaterial_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 7 : Collect the [Indicator] for the requested partition, example 201901, 201902, etc. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_7 = ' SELECT cocadlis.[COCostActualDocumentLineItem_HK] , concat (cocadlis.DebitCreditCode, ''_'', cocadlis.StatisticalIndicator) AS [Indicator] INTO #bSat FROM [BUSV_COOM_CSC2].[COCostActualDocumentLineItem_BSAT0_' + @SourceSystemVar + '_L] cocadlis INNER JOIN #hub hub ON cocadlis.[COCostActualDocumentLineItem_HK] = hub.[COCostActualDocumentLineItem_HK] WHERE [YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' ; ALTER TABLE #bSat ADD CONSTRAINT C_IX_COCostActualDocumentLineItem_BSAT0_Indicator_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualDocumentLineItem_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- INSERT result set into TEMP Fact-Table. This result set will then be SWITCHED into the target Fact-Table. Example... [BUSV_COOM_CSC2].[ActualCost_BRG_G5_Temp] will be switched to [BUSV_COOM_CSC2].[ActualCost_BRG_G5] --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_8 = ' INSERT INTO [INFI_Costs_SSAS_CSC2].[ActualCost_BRG_' + @SourceSystemVar + '_Temp] SELECT bcocadli_ws0.[YearMonthCreation] AS [YearMonthCreation] , convert(int,convert(char(8),cast(header.[SAPCreationTimestampUTC] as date),112)) AS [EntryDate] , header.DocumentNumberDimId AS [DocumentNumberDimId] , cocadlih.[DocumentItemDimId] AS [DocumentItemDimId] , ''' + @SourceSystem + ''' AS [SourceSystem] , cocadlih.ControllingArea_BK AS [COArea] , cocadlih.[DocumentNumberId] AS [DocumentNumberId] , cocadlih.[DocumentItemId] AS [DocumentItemId] , COALESCE( CONCAT ( bsat.[Indicator] , ''_ACT_'' , Coalesce(LEFT(prt.CostCollectorObject_BK,2),N''0'')) , ''0'' ) AS [JunkDimID] , header.PostingPeriodYearId AS [PostingPeriodYearId] , header.PostingPeriodId AS [PostingPeriodId] , COALESCE(bo.CostElementDimId, 0) AS [CostElementDimId] , Coalesce(bo.CostCenterDimensionId,0) AS [CostCenterDimId] , Coalesce(prt.PartnerObjectDimId, 0) AS [PartnerObjectDimId] , prt.CostCollectorObject_BK AS [PartnerObjectId] , material.DimensionId AS [MaterialDimId] , header.DocumentDate AS [DocumentDate] , header.PostingDate AS [PostingDate] , bo.ActivityType AS [ActivityType] , bcocadli_ws0.[COBusinessTransaction] AS [COBusinessTransaction] , header.[IsReversedBooking] AS [DocumentWasReversed] , header.[IsReversalBooking] AS [DocumentisReversalDocument] , bcocadli_ws0.[ControllingAreaTotalAmount] AS [TotalAmountCOAreaCurrency] , bcocadli_ws0.[ControllingAreaFixedAmount] AS [FixedAmountCOAreaCurrency] , bcocadli_ws0.[TransactionTotalAmount] AS [TotalAmountTransactionCurrency] , bcocadli_ws0.[TransactionCurrency] AS [TransactionCurrencyCode] , bcocadli_ws0.[ObjectTotalAmount] AS [TotalAmountObjectCurrency] , bcocadli_ws0.[ObjectCurrency] AS [ObjectCurrencyCode] , bcocadli_ws0.[TotalQuantity] AS [TotalQuantity] , bcocadli_ws0.[FixedQuantity] AS [FixedQuantity] , bcocadli_ws0.[UnitofMeasure] AS [UnitOfMeasure] FROM #link bo INNER JOIN #hub cocadlih ON cocadlih.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualDocumentLineItem_WSAT0_' + @SourceSystemVar + '_L] bcocadli_ws0 ON bcocadli_ws0.COCostActualDocumentLineItem_HK = bo.COCostActualDocumentLineItem_HK INNER JOIN #TempHeaderItems header ON header.[COCostActualDocumentHeader_HK] = bo.[COCostActualDocumentHeader_HK] INNER JOIN #bSat bsat ON bsat.COCostActualDocumentLineItem_HK = bo.COCostActualDocumentLineItem_HK LEFT OUTER JOIN #partnerAndBookedObject prt on prt.COCostActualDocumentLineItem_HK = bo.[COCostActualDocumentLineItem_HK] LEFT OUTER JOIN #material material ON material.COCostActualDocumentLineItem_HK = bo.COCostActualDocumentLineItem_HK WHERE bcocadli_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND bcocadli_ws0.[LoadEndDate] = CAST(''2999-12-31 00:00:00.000'' AS DATETIME2) ; ' SET @SQL = CAST('' AS VARCHAR(MAX)); Set @SQL = @SQL + @SQL_1 + @SQL_2 + @SQL_3 + @SQL_4 + @SQL_5 + @SQL_6 + @SQL_7 + @SQL_8; EXECUTE sp_executesql @SQL; SET @DateTimeEnd = SYSUTCDATETIME() DECLARE @PartitionNumber INT ; SELECT @PartitionNumber = partition_number, @RowsInserted = [rows] FROM sys.partitions as par WHERE ( par.object_id = OBJECT_ID('INFI_Costs_SSAS_CSC2.ActualCost_BRG_' + @SourceSystemVar + '_Temp') ) And ([rows] > 0 ); IF ( @PartitionNumber IS NOT NULL ) BEGIN SET @TruncateSQL = ' TRUNCATE TABLE [INFI_Costs_SSAS_CSC2].[ActualCost_BRG_' + @SourceSystemVar + '] WITH (PARTITIONS(' + Cast(@PartitionNumber as varchar(4)) + ')) ; ALTER TABLE [INFI_Costs_SSAS_CSC2].[ActualCost_BRG_' + @SourceSystemVar + '_Temp] SWITCH PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' TO [INFI_Costs_SSAS_CSC2].[ActualCost_BRG_' + @SourceSystemVar + '] PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' ; ' EXECUTE sp_executesql @TruncateSQL; /* Call the procedure to inform the successful loading of the data for the selected partition*/ DECLARE @return_value int ; EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar, @SourceOfData = @SourceOfData, @ConsumerOfData = @ConsumerOfData, @YearMonthCreation = @YearMonth, @StartDateTime = @DateTimeStart, @EndDateTime = @DateTimeEnd, @RowsInserted = @RowsInserted; ; END SET @minCounter = @minCounter + 1 ; DELETE TOP(1) FROM #PartitionList ; END DROP TABLE #PartitionList ; END END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G9;1358940213;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3682;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G9 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G9] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G9_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G4;1360059931;V ;VIEW;1346;
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_ResultPlan_V1_IFCT0_G6;1361088285;V ;VIEW;16679;/**/ /* View: V_ResultPlan_V1_IFCT0_G6 */ /**/ /* =*/ /* V01.00.04 2023-03-09 Yannick Sigwalt GS/BDD1 & Ilja Frolov GS/BDD1 */ /* This view provides Plan result booking for R&D */ /* Data.CORE Outgoing Interface #0210 https://inside-docupedia.bosch.com/confluence/x/foO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000087 https://inside-docupedia.bosch.com/confluence/x/OyG_hQ Determination of Settlement Object */ /* - #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg CDC for Business Unit & Division */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Added BK for improved support capabilities */ /* - Added EndDating Satellite */ /* V01.00.03 - Added Update from #FBI-SR-000000092 */ /* V01.00.02 - Added BusinessUnit as was */ /* V01.00.01 - Corrected identification of JunkResultRnDDimId */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G1;1361140340;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G1] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G1] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_CapEx_TM1_CSC2;67;INFormation Mart as Interface;V_INFI_CapEx_REF_WBSElements;1364408130;V ;VIEW;3454;/**/ /* View: V_INFI_CapEx_REF_WBSElements */ /**/ /* =*/ /* V01.00.02 2021-11-05 Yannick Sigwalt GS/BD22 & VST9BA */ /* This view provides wbs element hierarchy data from SAPPCR for TM1 CapEx */ /* Access Layer Definition */ /* Data.CORE Outgoing Interface #0180 https://inside-docupedia.bosch.com/confluence/x/IK3Gdg */ /* #FBI-SR-000000055 https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* Implemented Soft Rules */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Renaming of View */ /* V01.00.01 - Reformatting */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G2;1364512240;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P72 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G1;1369368243;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G1 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_C3;1371568370;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_C3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2023-02-22 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBE;1371920009;V ;VIEW;7869;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBE */ /**/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Cost Element Hierarchy RB-E from POE in Parent/Child format */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_GK;1374940270;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3631;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_GK ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_GK] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G0_X] cebcoagh_bs ---> currenctly it refrers to G0 as this object is not yet created in Data.CORE INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId]
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_B2;1377088342;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_B2 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_B2_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_B2_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_B2_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B2_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B2_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_B2_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_B2_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_B2_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_B2_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_B2_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_B2_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G2;1377140397;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G2 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G2] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G2] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G3;1380512297;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P79 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G2;1385368300;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G2 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_D7;1387568427;V ;VIEW;2347;/**/ /* View: V_INTF_MD_Customer_D7 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2023-01-26 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBELOG;1387920066;V ;VIEW;7879;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBELOG */ /**/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Cost Element Hierarchy RB-E-LOG from POE in Parent/Child format */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G0;1393088399;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G0 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G0_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G0_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G0_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G0_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G0_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G0_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G0_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G3;1393140454;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G3] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G3] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G4;1396512354;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P81 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G3;1401368357;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G3 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G0;1403568484;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G0 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBELOG_ATTR;1403920123;V ;VIEW;19587;/*=*/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBELOG_ATTR */ /*=*/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Attribute for Cost Element Hierarchy RB-E-LOG from POE */ /* The view is implemented as per the standard view definition for TM1 */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G1;1409088456;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G1 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G1_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G1_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G1_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G1_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G1_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G1_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G1_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G4;1409140511;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G4] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G4] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G4_DemoSystem;1412512411;V ;VIEW;13500;/**/ /* View: V_FactActualCost_Short_YTD_G4_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P81 in a YTD logic, but anonimized for DemoSystem purposes*/ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G4;1417368414;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G4 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G4_DemoSystem;1418748407;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17430;"/**/ /* V01.04.00 2022-08-09 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G4_DemoSystem ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G1;1419568541;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G1 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBE_ATTR;1419920180;V ;VIEW;19571;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_RBE_ATTR */ /**/ /* =*/ /* V01.00.00 2020-07-30 Yannick Sigwalt GS/BDO12 */ /* This view provide the Attribute for Cost Element Hierarchy RB-E-LOG from POE */ /* The view is implemented as per the standard view definition for TM1 */ /* Update: */ /* - V01.00.00 - Initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G2;1425088513;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G2 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G2_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G2_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G2_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G2_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G2_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G2_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G2_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G5;1425140568;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G5 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G5] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G5] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G5;1428512468;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G5 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G5;1433368471;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G5 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G2;1435568598;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTE;1435920237;V ;VIEW;7952;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTE */ /**/ /* =*/ /* V01.00.01 2020-08-06 Yannick Sigwalt GS/BDO12 */ /* This view provide the Cost Element Hierarchy PT-E from PPT in Parent/Child format */ /* Update: */ /* - V01.00.01 - Changed Filter on Hierarchy from PT-E-TOTAL to PT-E */ /* - V01.00.00 - Initial version */ /* =*/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G3;1441088570;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G3 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G3_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G3_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G3_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G3_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G3_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G3_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G3_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G6;1441140625;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G6 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G6] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G6] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G5_DemoSystem;1444512525;V ;VIEW;13500;/**/ /* View: V_FactActualCost_Short_YTD_G5_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87 in a YTD logic, but anonimized for DemoSystem purposes*/ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G6;1449368528;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G6 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G5_DemoSystem;1450748521;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;17430;"/**/ /* V01.04.00 2022-08-09 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_G5_DemoSystem ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G3;1451568655;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_PNLPT_TM1_CSC2;60;INFormation Mart as Interface;V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTE_ATTR;1451920294;V ;VIEW;19652;/**/ /* View: V_INTF_PNL_PT_DIM_CostElementByChartOfAccount_PTE_ATTR */ /**/ /* =*/ /* V01.00.01 2020-08-06 Yannick Sigwalt GS/BDO12 */ /* This view provide the Attribute for Cost Element Hierarchy PT-E from PPT */ /* The view is implemented as per the standard view definition for TM1 */ /* Update: */ /* - V01.00.01 - Changed Filter on Hierarchy from PT-E-TOTAL to PT-E */ /* - V01.00.00 - Initial version */ /* =*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G5_DemoSystem;1456060273;V ;VIEW;1784;
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G4;1457088627;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G4 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G4_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G4_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G4_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G4_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G4_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G4_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G4_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G7;1457140682;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G7] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G7] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G6;1460512582;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G6 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P99 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP_ATTR;1461996685;V ;VIEW;5275;/**/ /* View: V_INTF_COOM_Costs_DIM_OrganizationalOffice_CDP_ATTR */ /**/ /* = */ /* V01.00.02 2023-06-28 URA1FE & Patrik Just CI/DAV2.3 */ /* This view provides the attributes of Organization Office for CDP */ /* Data.CORE Outgoing Interface #0134 https://inside-docupedia.bosch.com/confluence/x/RAkyZg */ /* Implemented Soft Rules */ /* Restriction: */ /* Changes: */ /* V01.00.02: Replaced cte_OrganizationOfficeMaxStateTimeFrom with */ /* cte_OrganizationOfficeValidAtExecutionTime */ /* V01.00.01 : Initial version */ /* = */
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G7;1465368585;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G7 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G4;1467568712;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G4 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_REF_AccountHierarchy_RB_E_XBIT;1467920351;V ;VIEW;2290;/**/ /* View: V_INTF_PNL_REF_AccountHierarchy_RB_E_XBIT */ /**/ /*=*/ /* V01.00.03 2020-07-16 JUP8FE */ /* This view is to provide the custom RB-E-XBIT account hierarchy. */ /* Update: */ /* - V01.00.03: Add filter for RB-E-XIDCA nodes */ /* - V01.00.02: Replace by enhanced Accounting Model with ChartOfAccounts Bsuiness Key */ /* - V01.00.01: Replace GLAccountHierarchy_BSATM_G0_X by GL_AccountGlobalHierarchy_BSATM_G0_X */ /*=*/
INFM_COOM_COSTS_CSC2;12;INFormation Mart;V_FactActualCost_G4_DemoSystem;1472060330;V ;VIEW;1785;
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G5;1473088684;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G5 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G5_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G5_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G5_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G5_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G5_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G5_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G5_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G9;1473140739;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_G9 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G9] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G9] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G7;1476512639;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G7 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PCR in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_GSHRS_CSC2;98;INFormation Mart as Interface;V_INTF_InqueryTool;1477996742;V ;VIEW;2180;/**/ /* View: V_INTF_InqueryTool */ /**/ /**/ /* V01.00.04 2023-07-07 Sanja Mihalic BD/XAD3 and Aman Kumar BD/XAD2 */ /* View for [KPI Readiness HRS] */ /* Data.CORE Outgoing Interface #0204 https://inside-docupedia.bosch.com/confluence/x/H1C2fw */ /* Update: */ /* V01.00.04 2022-07-07 - Date type conversion change */ /* V01.00.03 2022-05-25 - Removed Column PleaseShareYourThoughts */ /* V01.00.02 2023-01-31 - Datatype for the column Rating Date */ /* V01.00.01 2022-04-04 - Mapping of the Column TicketType */ /* V01.00.00 2022-04-04 - initial */ /**/
INFI_Costs_TM1_CSC2;58;INFormation Mart as Interface;V_INTF_COOM_Costs_FACT_CostPlan_G9;1481368642;V ;VIEW;9813;"/**/ /* View: V_INTF_COOM_Costs_FACT_CostPlan_G9 */ /**/ /* =*/ /* V01.03.00 2022-08-17 Yannick Sigwalt GS/BDD1 & Tatjana Derdus CI/DAV2.3 */ /* This view provides plan cost fact data for LogisticCosts */ /* Data.CORE Outgoing Interface #0016 https://inside-docupedia.bosch.com/confluence/x/LjVfVQ */ /* it consumes the folling Soft rules */ --/* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Statistical indicator */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.03.00 - Reworked view to replace #FBI-SR-000000025 */ /* - mapping Planning view to Scenario */ /* - Added Filter on ValueType 01,02,10 */ /* V01.02.00 - Replace Dimension IDs by Business Keys */ /* V01.01.00 - Move to CSC2-Schema; Exclusion of Statistical Bookings */ /* V01.00.01 - Consolidation of periods >= 012 into period 012 */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G5;1483568769;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G5 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_GLPCA_I3;1486172590;V ;VIEW;9417;/**/ /* View: V_INTF_PNL_FACT_GLPCA_I3 */ /**/ /**/ /* V01.00.06 2022-03-07 Michal Erdman & Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view is to provide EC-PCA transaction data from GLPCA table for I3 GP1 source */ /* Outgoing Interface #0057 https://inside-docupedia.bosch.com/confluence/x/e8J9Vg */ /* History: */ /* - 01.00.06: change ProfitCenterGPMToProfitCenter_WSATE_XX_L to ProfitCenterGPMToProfitCenter_WSATM_MF_L */ /* - 01.00.05: implemented filter on RB_E_XBIT #FBI-SR-000000071 */ /* - 01.00.04: Add ECPCA Item HK and LoadDate for Persisted Fact Loading */ /* - 01.00.03: Replace relation source for Customer and ProfitCenter */ /* - 01.00.02: update bridge definition for Profit Center */ /* - 01.00.01: initial version with content */ /* - 01.00.00: initial version without content */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G6;1489088741;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;29281;"/* =*/ /* V01.00.02 2023-03-09 Yannick Sigwalt GS/BDD1 */ /* This view provides Plan Cost booking for R&D */ /* Data.CORE Outgoing Interface #0209 https://inside-docupedia.bosch.com/confluence/x/RoO6gg */ /* Consuming Soft Rules */ /* - #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* - #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* - #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw Profit center cost allocation */ /* - #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Business Unit & Division as was */ /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ /* - #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.02 - Added EndDating Satellite to join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] */ /* V01.00.01 - Changed join to Settlement rules to left join + added end dating satellite + Business Unit as Was */ /* - enhanced implementation of #FBI-SR-000000096 */ /* V01.00.00 - Initial version */ /* =*/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G6 ( @FiscalYear smallint ) RETURNS TABLE AS RETURN /* For Testing Purpose uncomment the following declaration statements */ --DECLARE @FiscalYear smallint = 2023; /* End of Declaration block for Testing purpose*/ with cte_CostCollectorWBSElement as ( select ccoll2wbse_wl.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_HK] ,wbse_wh.[WBSElement_BK] ,wbsea_ws.[ProjectType] ,ss_wbse2pc.[ProfitCenter_HK] ,coalesce(wbsebv_wh.[WBSElement_BK],wbsea_ws.[WBSElement]) as [WBSElement] ,left(wbsea_ws.[WBSElement],2) as [WBSElementPrefix] ,wbsea_ws.[FunctionalArea] as [WBSElementFunctionalArea] from [RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh inner join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G6_X] wbsea_ws on wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] and wbsea_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --and wbsea_ws.[FunctionalArea] = N'0500' inner join [RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl on ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( select wbse2pc_wl.[WBSElement_HK] ,wbse2pc_wl.[ProfitCenter_HK] from [RAWV_RB_CSC1].[WBSElementToProfitCenter_WLNK0] wbse2pc_wl inner join [RAWV_RB_CSC1].[WBSElementToProfitCenter_WSATE_G6_X] wbse2pc_ws on wbse2pc_ws.[WBSElementToProfitCenter_HK] = wbse2pc_wl.[WBSElementToProfitCenter_HK] and wbse2pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2pc on ss_wbse2pc.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join ( Select wbsesapi2biv_wl.[WBSElement_HK] , wbsesapi2biv_wl.[WBSElementBusinessView_WHUB0_HK] from [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WLNK0] wbsesapi2biv_wl inner join [RAWV_RB_CSC1].[WBSElementSAPInternalToBusinessInternalView_WSATE_G6_X] wbsesapi2biv_ws on wbsesapi2biv_ws.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] = wbsesapi2biv_wl.[WBSElementSAPInternalToBusinessInternalView_WLNK0_HK] and wbsesapi2biv_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_wbsesapi2biv on ss_wbsesapi2biv.[WBSElement_HK] = wbse_wh.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementBusinessView_WHUB0] wbsebv_wh on wbsebv_wh.[WBSElementBusinessView_WHUB0_HK] = ss_wbsesapi2biv.[WBSElementBusinessView_WHUB0_HK] ) ,cte_MinMaxPlanData as ( select min([MinFiscalYearPeriod]) as [MinFiscalYearPeriod] ,max([MaxFiscalYearPeriod]) as [MaxFiscalYearPeriod] from ( Select min(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MinFiscalYearPeriod] ,max(pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as [MaxFiscalYearPeriod] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] pcp_ws WHERE pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' UNION all Select min(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) ,max(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as int)) from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] pcs_ws WHERE pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) minmax ) ,cte_SettlementRules as ( select ccollsr_wl.[CostCollector_HK] ,ccollsr_wl.[CostCollectorSettlementRules_HK] ,ph_wh.[ProdHierarchy_HK] as [SettlementProductHierarchy_HK] ,ph_wh.[ProductHierarchyIDBK] as [SettlementProductHierarchy_BK] ,phdi_bs.[ProdHierarchyDimensionId] as [SettlementProdHierarchyDimensionId] ,copaps2pc_wl.[ProfitCenter_HK] as [SettlementProfitCenter_HK] ,pc_wh.[ProfitCenter_BK] as [SettlementProfitCenter_BK] ,pcdi_bs.[ProfitCenterDimensionId] as [SettlementProfitCenterDimensionId] ,wbsea_ws_settlement.[WBSElement] as [SettlementWBSElement] ,left(wbsea_ws_settlement.[WBSElement],2) as [SettlementWBSElementPrefix] ,ccollsr_ws.[Version] ,ccollsr_ws.[SettlementPercentageRate] ,ccollsr_ws.[SettlementTransaction] ,ccollsr_ws.[AccountAssignmentCategory] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) as [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo],[YearPeriodLastUse]) as [YearPeriodValidTo] from [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh inner join [RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl on ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] cross apply cte_MinMaxPlanData inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_G6_X] ccollsr_ws on ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] and ccollsr_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and ccollsr_ws.[Version] is not null and ccollsr_ws.[SettlementTransaction] = N'KOAP' and ccollsr_ws.[AccountAssignmentCategory] in (N'EO',N'KS',N'PR') and ( ccollsr_ws.[YearPeriodValidFrom] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ( ccollsr_ws.[YearPeriodValidFrom] <= cte_MinMaxPlanData.[MinFiscalYearPeriod] and (ccollsr_ws.[YearPeriodValidTo] >= cte_MinMaxPlanData.[MinFiscalYearPeriod] or ccollsr_ws.[YearPeriodValidTo] is null) ) ) left join ( select ccollsr2copab_wl.[CostCollectorSettlementRules_HK] ,ccollsr2copab_wl.[COPAInternalKeys_HK] from [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WLNK0] ccollsr2copab_wl inner join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToCOPABooking_WSATE_G6_L] ccollsr2copab_ws on ccollsr2copab_ws.[CostCollectorSettlementRulesToCOPABooking_HK] = ccollsr2copab_wl.[CostCollectorSettlementRulesToCOPABooking_HK] and ccollsr2copab_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_ccollsr2copab_wl on ss_ccollsr2copab_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_COPA_CSC2].[COPAInternalKeys_WHUB0] copaik_wh on copaik_wh.[COPAInternalKeys_HK] = ss_ccollsr2copab_wl.[COPAInternalKeys_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProductHierarchy_WLNK0] copaps2ph_wl on copaps2ph_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProdHierarchy_WHUB0] ph_wh on ph_wh.[ProdHierarchy_HK] = copaps2ph_wl.[ProdHierarchy_HK] left join [RAWV_COPA_CSC2].[COPAProfitabilitySegmentToProfitCenter_WLNK0] copaps2pc_wl on copaps2pc_wl.[COPAInternalKeys_HK] = copaik_wh.[COPAInternalKeys_HK] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = copaps2pc_wl.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProdHierarchyDimensionId_BSATC_XX_X] phdi_bs on phdi_bs.[ProdHierarchy_HK] = ph_wh.[ProdHierarchy_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] left join [RAWV_COOM_CSC1].[CostCollectorSettlementRulesToSettlementWBSElement_WLNK0] ccollsr2swbse_wl on ccollsr2swbse_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] left join [RAWV_RB_CSC1].[WBSElement_WHUB0] wbs_wh_settlement on wbs_wh_settlement.[WBSElement_HK] = ccollsr2swbse_wl.[WBSElement_HK] left join [RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_G6_X] wbsea_ws_settlement on wbsea_ws_settlement.[WBSElement_HK] = wbs_wh_settlement.[WBSElement_HK] and wbsea_ws_settlement.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ,cte_IsSettlementRuleAvailable as ( select distinct [CostCollector_HK] ,[Version] from cte_SettlementRules ) ,cte_data as ( SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcp_wl.[CostCollector_HK] as [CostColllector_HK] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcp_ws.[FiscalYear] as [PostingYear] ,cast((pcp_ws.[FiscalYear]*1000+cast(pcp_ws.[Period] as int)) as int) as [PostingYearPeriodId] ,pcp_ws.[Period] as [Period] ,CAST ( null as binary(20)) as [CostCollector_PartnerObject_HK] ,pcp_ws.[ValueType] ,pcp_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast(NULL as nvarchar(22)) as [PartnerObject] ,cast(NULL as nvarchar(2)) as [PartnerObjectWBSElementPrefix] ,cast(NULL as nvarchar(6)) as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] pcp_ws --on pcp_ws.[YearMonthCreation] between (@Yearcreation*100) and ( @Yearcreation *100 +12) on pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = @FiscalYear and pcp_ws.[ValueType] in (N'01',N'02',N'10') and pcp_ws.[Period] <= 12 and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] UNION ALL SELECT pv_wh.[SAPSystem] as [SourceSystem] ,sdi_wh.[DimensionId] as [ScenarioId] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [Version] ,pcs_wl.[CostCollector_PlannedObject_HK] as [CostColllector_HK] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_ws.[FiscalYear] as [PostingYear] ,(pcs_ws.[FiscalYear]*1000+cast(pcs_ws.[Period] as smallint)) as [PostingYearPeriodId] ,pcs_ws.[Period] as [Period] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_ws.[ValueType] ,pcs_ws.[TotalValueCOAreaCurrency] as [TotalAmountCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] as [TotalAmountObjectCurrency] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObject] ,ccollwbsElement_partner.[WBSElementPrefix] as [PartnerObjectWBSElementPrefix] ,at_wh_partner.[ActivityType_ID_BK] as [PartnerObjectActivityType] ,usrcoomdci.[DebitCreditCode] ,usrcoomsi.[StatisticalIndicator] FROM [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] pcs_ws on pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = @FiscalYear and pcs_ws.[ValueType] in (N'01',N'02',N'10') and pcs_ws.[Period] <= 12 and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdci cross apply [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] and pv_wh.[Version_ID_BK] <> '000' inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh on sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] left join cte_CostCollectorWBSElement ccollwbsElement_partner on ccollwbsElement_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccollat_wl_partner on ccollat_wl_partner.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] left join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_partner on at_wh_partner.[ActivityType_HK] = ccollat_wl_partner.[ActivityType_HK] ) Select cte_data.[SourceSystem] as [Sourcesystem] ,cte_data.[ScenarioId] as [ScenarioId] --,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') -- ,pc_wh.[ProfitCenter_HK] -- ,cte_SettlementRules.[SettlementProfitCenter_HK]) as [ProfitCenter_HK] -- #FBI-SR-000000099 ,coalesce(ss_pc2bdbu.[ProfitCenterDimId],0) as [SettlementProfitCenterDimId] ,COALESCE(cte_SettlementRules.[SettlementProdHierarchyDimensionId],0) as [SettlementProductHierarchyDimId] ,wbsedi_bs.[WBSElementDimensionId] as [WBSElementDimId] ,cebcadi_ws.[DimensionID] as [CostElementDimId] ,compcdi_bs.[DimensionId] as [CompanyCodeDimId] ,COALESCE(rbclsdi_bs.[LegalShareDimensionId],0) as [LegalShareDimId] ,CAST(COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) as bigint) as [ResourceTypeInternalAllocationDimId] ,CONCAT(cte_data.[DebitCreditCode],'_',cte_data.[StatisticalIndicator],'_', '0') as [JunkDimId] ,cte_data.[PostingYear] as [PostingYear] ,cte_data.[PostingYearPeriodId] as [PostingYearPeriodId] /* - #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period >=012 to 012 */ ,cast(IIF(cast(cte_data.[Period] as smallint) >= 12, N'012', cte_data.[Period]) as smallint) as [PostingPeriodId] ,coalesce(ccolldi_bs_partner.[DimensionId],0) as [PartnerObjectDimId] ,cte_data.[TotalAmountCOAreaCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountCOAreaCurrency] ,cte_data.[TotalAmountObjectCurrency] * COALESCE([SettlementPercentageRate],100) / 100 as [TotalAmountObjectCurrency] /* Below this line to ease up tracing */ ,compc_wh.[CompanyCode_BK] as [CompanyCode] ,IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_BK] ,cte_SettlementRules.[SettlementProfitCenter_BK]) as [SettlementProfitCenter_BK] -- #FBI-SR-000000099 ,cte_SettlementRules.[SettlementProductHierarchy_BK] as [SettlementProductHierarchy_BK] ,ccoll_wh.[CostCollectorObject_BK] ,ccollwbsElement_bo.[WBSElement_BK] as [WBSElementSAPInternalKey] ,ccollwbsElement_bo.[WBSElement] as [WBSElement] ,cebca_wh.[CostElement_ID_BK] as [CostElement] ,rbclsa_ws.[ShortDescription] as [LegalShare] ,cte_data.[Scenario_BK] as [Scenario] ,cte_data.[Version] ,cte_data.[ValueType] ,cte_data.[TotalAmountCOAreaCurrency] as [TotalAmountCOAreaCurrencyOriginal] ,cte_data.[TotalAmountObjectCurrency] as [TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,cte_data.[COBusinessTransaction] ,cte_data.[SAPDebitCreditCode] ,cte_data.[PartnerObject] ,cte_data.[PartnerObjectActivityType] ,ccollwbsElement_bo.[ProjectType] ,cte_SettlementRules.[SettlementWBSElementPrefix] ,cte_SettlementRules.[AccountAssignmentCategory] ,cte_SettlementRules.[SettlementTransaction] ,cte_SettlementRules.[YearPeriodValidFrom] ,cte_SettlementRules.[YearPeriodValidTo] ,usrrdrtap.[ResourceTypeAllocationType] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Own Value Added Costs' when 2 then 'Own Value Added Costs' when 3 then 'External Costs' when 4 then 'Own Value Added Costs' when 5 then 'Internal Services' when 6 then 'Internal Services' when 7 then 'Internal Services' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [ValueAddedTypeDescription] ,cast(case COALESCE(usrrdrtap.[ResourceTypeAllocationType],0) when 1 then 'Personel Costs' when 2 then 'Machine Costs' when 3 then 'Direct Costs' when 4 then 'Sample Costs' when 5 then 'Allocation' when 6 then 'Reimbursement' when 7 then 'Allocation' when 8 then 'Settlement' else 'Dummy' end as nvarchar(40)) as [InternalAllocationType] from cte_data inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = cte_data.[CostColllector_HK] inner join cte_CostCollectorWBSElement ccollwbsElement_bo on ccollwbsElement_bo.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] and ccollwbsElement_bo.[WBSElementFunctionalArea] = N'0500' left join cte_IsSettlementRuleAvailable on cte_IsSettlementRuleAvailable.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_IsSettlementRuleAvailable.[Version] = cte_data.[Version] left join cte_SettlementRules on cte_SettlementRules.[CostCollector_HK] = cte_data.[CostColllector_HK] and cte_SettlementRules.[Version] = cte_data.[Version] and cte_SettlementRules.[YearPeriodValidFrom] <= cte_data.[PostingYearPeriodId] and cte_SettlementRules.[YearPeriodValidTo] >= cte_data.[PostingYearPeriodId] left join [RAWV_RB_CSC1].[ProfitCenter_WHUB0] pc_wh on pc_wh.[ProfitCenter_HK] = ccollwbsElement_bo.[ProfitCenter_HK] left join [BUSV_RB_CSC1].[ProfitCenterDimensionId_BSATC_XX_X] pcdi_bs on pcdi_bs.[ProfitCenter_HK] = pc_wh.[ProfitCenter_HK] inner join [BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs on wbsedi_bs.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join ( Select wbse2compc_wl.[WBSElement_HK] ,wbse2compc_wl.[CompanyCode_HK] from [RAWV_RB_CSC1].[WBSElementToCompanyCode_WLNK0] wbse2compc_wl inner join [RAWV_RB_CSC1].[WBSElementToCompanyCode_WSATE_G6_X] wbse2compc_ws on wbse2compc_ws.[WBSElementToCompanyCode_HK] = wbse2compc_wl.[WBSElementToCompanyCode_HK] and wbse2compc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_wbse2compc on ss_wbse2compc.[WBSElement_HK] = ccollwbsElement_bo.[WBSElement_HK] left join [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh on compc_wh.[CompanyCode_HK] = ss_wbse2compc.[CompanyCode_HK] left join [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] compcdi_bs on compcdi_bs.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cte_data.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_ws on cebcadi_ws.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs_partner on ccolldi_bs_partner.[CostCollector_HK] = cte_data.[CostCollector_PartnerObject_HK] cross apply [BUSV_COOM_CSC1].[ufn_SR0000000082_RnD_ResourceTypeAllocationPlan] ( cte_data.[COBusinessTransaction] /* <@COBusinessTransaction, nvarchar(4),> */ ,cte_data.[SAPDebitCreditCode] /* <@SAPDebitCreditCode, nvarchar(1),> */ ,cebca_wh.[CostElement_ID_BK] /* <@CostElement, nvarchar(10),> */ ,COALESCE(cte_data.[PartnerObjectWBSElementPrefix],'') /* <@PartnerObjectWBSElementPrefix, nvarchar(2),> */ ,cte_data.[PartnerObjectActivityType] /* <@PartnerObjectActivityType, nvarchar(6),> */ ,ccollwbsElement_bo.[ProjectType] /* <@ProjectType, nvarchar(2),> */ ,cte_SettlementRules.[AccountAssignmentCategory] /* <@SettlementType, nvarchar(2),> */ ,COALESCE(cte_SettlementRules.[SettlementWBSElementPrefix],'') /* <@SettlementWBSElementPrefix, nvarchar(2),> */ ,cte_data.SourceSystem ) usrrdrtap /* start of time dependent assignment to Legal Share via Profit Center, Business Division, Company Code */ left join ( select pc2bd_wl.[ProfitCenter_HK] ,pc2bd_wl.[BusinessDivision_HK] ,pc2bd_ws.[StateDateFrom] ,pc2bd_ws.[StateDateTo] ,Year(pc2bd_ws.[StateDateFrom])*1000 + Month(pc2bd_ws.[StateDateFrom]) as [StateYearPeriodFrom] ,Year(pc2bd_ws.[StateDateTo])*1000 + IIF(Month(pc2bd_ws.[StateDateTo]) = 12, 16,Month(pc2bd_ws.[StateDateTo])) as [StateYearPeriodTo] from [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WLNK0] pc2bd_wl inner join [RAWV_RB_CSC1].[ProfitCenterToBusinessDivision_WSATM_M2_L] pc2bd_ws on pc2bd_ws.[ProfitCenterToBusinessDivision_HK] = pc2bd_wl.[ProfitCenterToBusinessDivision_HK] and pc2bd_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[BusinessDivision_WHUB0] bd_ws on bd_ws.[BusinessDivision_HK] = pc2bd_wl.[BusinessDivision_HK] ) as ss_pc2bd on ss_pc2bd.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and ss_pc2bd.[StateYearPeriodFrom] <= cte_data.[PostingYearPeriodId] and ss_pc2bd.[StateYearPeriodTo] >= cte_data.[PostingYearPeriodId] left join ( select compcle_wl.[CompanyCode_HK] ,compcle_wl.[LegalEntity_HK] from [RAWV_RB_CSC1].[CompanyCodeLegalEntity_WLNK0] compcle_wl inner join [RAWV_RB_CSC1].[CompanyCodetoLegalEntity_WSATE_M2_L] compc2le_ws on compc2le_ws.[CompanyCodeLegalEntity_HK] = compcle_wl.[CompanyCodeLegalEntity_HK] and compc2le_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[LegalEntity_WHUB0] le_wh on le_wh.[LegalEntity_HK] = compcle_wl.[LegalEntity_HK] ) as ss_le on ss_le.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] /* Retrieve Legal Share information */ left join ( select lsbcompced_bl.[BusinessDivision_HK] ,lsbcompced_bl.[CompanyCode_HK] ,lsbcompced_bl.[LegalEntity_HK] ,lsbcompced_bl.[LegalShare_HK] from [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BLNK0] lsbcompced_bl inner join [BUSV_RB_CSC1].[LegalShareByCompanyCodeLegalEntityDivision_BSATE_M2_L] lsbcompced_bs on lsbcompced_bs.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] = lsbcompced_bl.[LegalShareByCompanyCodeLegalEntityDivision_BLNK0_HK] and lsbcompced_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) as ss_lsbcompced on ss_lsbcompced.[BusinessDivision_HK] = ss_pc2bd.[BusinessDivision_HK] and ss_lsbcompced.[LegalEntity_HK] = ss_le.[LegalEntity_HK] and ss_lsbcompced.[CompanyCode_HK] = compc_wh.[CompanyCode_HK] left join [RAWV_RB_CSC1].[RBCustomer_WHUB0] rbc_wh on rbc_wh.[RBCustomer_HK] = ss_lsbcompced.[LegalShare_HK] left join [BUSV_Sales_MD_CSC2].[RBCustomerLegalShareDimensionId_BSATC_XX_X] rbclsdi_bs on rbclsdi_bs.[RBCustomer_HK] = rbc_wh.[RBCustomer_HK] left join [RAWV_RB_CSC1].[RBCustomerLegalShareAttribute_WSATM_M2_L] rbclsa_ws on rbclsa_ws.[RBCustomer_HK] = rbc_wh.RBCustomer_HK and rbclsa_ws.[Edition] = 'WORKING SET' and rbclsa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --BusinessUnit as was left join (select pcbbdbu_bl.[ProfitCenter_HK] as [ProfitCenter_HK] ,pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnitDimensionId] as [ProfitCenterDimId] ,Year(pcbbdbu_bs.[StateTimeFrom])*1000 + Month(pcbbdbu_bs.[StateTimeFrom]) as [StateYearPeriodFrom] ,Year(pcbbdbu_bs.[StateTimeTo])*1000 + Month(pcbbdbu_bs.[StateTimeTo]) as [StateYearPeriodTo] FROM [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0] pcbbdbu_bl inner join [BUSV_RB_CSC1].[ProfitCenterByBusinessDivisionBusinessUnit_BSATE_M2_X] pcbbdbu_bs on pcbbdbu_bs.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] = pcbbdbu_bl.[ProfitCenterByBusinessDivisionBusinessUnit_BLNK0_HK] and pcbbdbu_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' ) ss_pc2bdbu on ss_pc2bdbu.[ProfitCenter_HK] = IIF(cte_SettlementRules.[AccountAssignmentCategory] in (N'KS',N'PR') ,pc_wh.[ProfitCenter_HK] ,cte_SettlementRules.[SettlementProfitCenter_HK]) and cte_data.[PostingYearPeriodId] between ss_pc2bdbu.[StateYearPeriodFrom] and ss_pc2bdbu.[StateYearPeriodTo]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_GK;1489140796;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_GK */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_GK] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_GK] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_G9;1492512696;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_G9 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P74 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D4_wo_SR68;1493228720;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;18381;"/**/ /* V01.04.01B 2023-02-02 Yannick Sigwalt GS/BDD1 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000068 https://inside-docupedia.bosch.com/confluence/x/R2V2cQ BT - Select plan records with TransactionCurrency = Controlling Area */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.01B - Removed Reimplemented #FBI-SR-000000068 */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - Reimplemented #FBI-SR-000000068 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_D4_wo_SR68]( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi -- /* Implementation of #FBI-SR-000000068 */ --where pcp_ws.[TransactionCurrency] in ( Select distinct ca_ws.[CurrencyCode] -- from [RAWV_RB_CSC1].[ControllingArea_WHUB0] ca_wh -- inner join [RAWV_RB_CSC1].[ControllingArea_WSAT0_D4_L] ca_ws -- on ca_ws.[ControllingArea_HK] = ca_wh.[ControllingArea_HK] -- and ca_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- where ca_wh.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] -- ) UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CostElement;1497368699;V ;VIEW;1314;/**/ /* View: V_INTF_PNL_DIM_CostElement */ /**/ /* = */ /* V01.00.00 2022-08-22 Yannick Sigwalt GS/BDD1 */ /* Access Layer View for PnL Series for Cost Element */ /*Data.CORE Outgoing Interface #0044 https://inside-docupedia.bosch.com/confluence/x/W6l9Vg */ /* Empty view to get structural consistency in target application */ /* Restrictions: */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_G6;1499568826;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_G6 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_GLPCA_O5;1502172647;V ;VIEW;8903;/**/ /* View: V_INTF_PNL_FACT_GLPCA_O5 */ /**/ /**/ /* V01.00.06 2022-03-07 Michal Erdman & Yannick Sigwalt GS/BDD2 & Patrik Just CI/DAV2.3 */ /* This view is to provide EC-PCA transaction data from GLPCA table for O5 GP7 source */ /* Outgoing Interface #0057 https://inside-docupedia.bosch.com/confluence/x/e8J9Vg */ /* History: */ /* - 01.00.06: change ProfitCenterGPMToProfitCenter_WSATE_XX_L to ProfitCenterGPMToProfitCenter_WSATM_MF_L */ /* - 01.00.05: implemented filter on RB_E_XBIT #FBI-SR-000000071 */ /* - 01.00.04: Add ECPCA Item HK and LoadDate for Persisted Fact Loading */ /* - 01.00.03: Replace relation source for Customer and ProfitCenter */ /* - 01.00.02: update bridge definition for Profit Center */ /* - 01.00.01: initial version with content */ /* - 01.00.00: initial version without content */ /**/
INFI_xBI_Controlling_CSC2;117;INFormation Mart as Interface;V_CostActuals_V1_IFCT0_G7;1505088798;V ;VIEW;13837;/**/ /* View: V_CostActuals_V1_IFCT0_G7 */ /**/ /* =*/ /* V01.00.01 2023-03-24 Aman Kumar BD/XAD5 */ /* xBI Controlling Purchase Order for PCR */ /* Data.Core Outgoing Interface #298 https://inside-docupedia.bosch.com/confluence/x/L338l */ /* Restriction: */ /* -none */ /* */ /* Update: */ /* V01.00.01 - Added join contion to CustomerAttribute_WSAT0_G0_X with LoadEndDate */ /* - Join condition added with ChartsOfAccount to table GLAccount_WHUB0 */ /* V01.00.00 - Initial Version - Creation */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_A3;1505140853;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_A3 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_A3] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_A3] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_D0;1508460698;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_D0 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_GK;1508512753;V ;VIEW;11272;/**/ /* View: V_FactActualCost_Short_YTD_GK */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P77 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_CostElement_ATTR;1513368756;V ;VIEW;12509;/**/ /* View: V_INTF_PNL_DIM_CostElement_ATTR */ /**/ /* */ /* V01.00.01 2022-08-22 Yannick Sigwalt GS/BDD1 */ /* Access Layer View for PnL Series for Cost Element Attributes for TM1 */ /*Data.CORE Outgoing Interface #0045 https://inside-docupedia.bosch.com/confluence/x/sal9Vg */ /* Restriction: */ /* Only CostElement hierarchy 'RB-E' is used */ /* Changes: */ /* V01.00.01 - Remove ElementId from Description column for Capation_xx */ /* V01.00.00 - Initial version */ /* */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_S3;1515568883;V ;VIEW;2290;/**/ /* View: V_INTF_MD_Customer_S3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2020-02-22 - Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_SSAS_AnonymizeCostsData_V2;1520372831;TF;SQL_TABLE_VALUED_FUNCTION;7970;"/* =*/ /* V01.00.05 - 2022-02-22 - Waldemar Kessler CI/BTM-AC1 */ /* This function does anonymize data for the purposes on Costs Application DemoSystems */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /* =*/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[ufn_SSAS_AnonymizeCostsData_V2] ( -- Add the parameters for the function here @StringToBeAnonymized char(100) ) RETURNS @table TABLE ( -- Add the column definitions for the TABLE variable here StringAnonymized CHAR(100) ) AS BEGIN -- Fill the table variable with the rows for your result set DECLARE @StringAnonymized nvarchar(100) DECLARE @Tokens table (Id INT,OriginalString nvarchar(100), AnonymizedString nvarchar(100) ) DECLARE @i INTEGER; DECLARE @TokenCounter INTEGER IF CHARINDEX ('ArjP',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'ArjP', 'XxP'); IF CHARINDEX ('RBEF',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'RBEF', 'XxP'); IF CHARINDEX ('Aj',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Aj', 'Xx'); IF CHARINDEX ('983',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'983', 'XxP'); IF CHARINDEX ('Aranjuez',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Aranjuez', 'XxP'); IF CHARINDEX ('EB-ES',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'EB-ES', 'Xx-YY'); IF CHARINDEX ('GS/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GS/', 'Xx/'); IF CHARINDEX ('CI/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'CI/', 'Xx/'); IF CHARINDEX ('M/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'M/', 'Xx/'); /*Following changes are based on input from Conny & Dominic*/ IF CHARINDEX ('P81',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'P81', 'PXX'); IF CHARINDEX ('P87',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'P87', 'PXX'); IF CHARINDEX ('POE',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'POE', 'PXX'); IF CHARINDEX ('GS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GS', 'XX'); IF CHARINDEX ('PS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'PS', 'XX'); IF CHARINDEX ('AS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'AS', 'XX'); IF CHARINDEX ('Nuernberg',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nuernberg', 'Dummy1'); IF CHARINDEX ('N#rnberg',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'N#rnberg', 'Dummy1'); IF CHARINDEX ('Feuerbach',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Feuerbach', 'Dummy2'); IF CHARINDEX ('Schwbisch Gmnd',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Schwbisch Gmnd', 'Dummy3'); IF CHARINDEX ('Bietigheim',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Bietigheim', 'Dummy4'); IF CHARINDEX ('NuP1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'NuP1', 'Du1P'); IF CHARINDEX ('Nu1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nu1', 'Du1'); IF CHARINDEX ('Nue',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nue', 'Du1P'); IF CHARINDEX ('Nu',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nu', 'Du1'); IF CHARINDEX ('Fe',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Fe', 'Du2'); IF CHARINDEX ('Sgm',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Sgm', 'Du3'); IF CHARINDEX ('BASD',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'BASD', 'Du3'); IF CHARINDEX ('Bie',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Bie', 'Du4'); IF CHARINDEX ('Leitwerk',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Leitwerk', ''); IF CHARINDEX ('AM',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'AM', 'BM'); IF CHARINDEX ('ET',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'ET', 'IA'); IF CHARINDEX ('DI',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'DI', 'CE'); IF CHARINDEX ('TC',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'TC', 'YZ'); IF CHARINDEX ('GI',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GI', 'MN'); IF CHARINDEX ('2130',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2130', '1234'); IF CHARINDEX ('087C-G',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'087C-G', '123A-X'); IF CHARINDEX ('87',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'87', '23'); IF CHARINDEX ('43',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'43', '12'); IF CHARINDEX ('11',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'11', '24'); IF CHARINDEX ('2',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2', '3'); IF CHARINDEX ('8',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'8', '3'); IF CHARINDEX ('1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'1', '3'); IF CHARINDEX ('5',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'5', '6'); IF CHARINDEX ('2',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2', '1'); IF CHARINDEX ('4',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'4', '2'); /*Loop through the string to be anonymized, for each entry which is relevant to be anonymized in @Token table*/ Select @TokenCounter=count(1) from @Tokens SET @i = 1 SET @StringAnonymized = @StringToBeAnonymized WHILE @i <= @TokenCounter BEGIN SELECT TOP 1 @StringAnonymized = REPLACE(@StringAnonymized,OriginalString,AnonymizedString) FROM @Tokens WHERE Id=@i AND CHARINDEX(OriginalString,@StringToBeAnonymized) >0 SET @i = @i + 1; END; SET @StringAnonymized = IIF(@StringAnonymized IS NULL, @StringToBeAnonymized, @StringAnonymized ); INSERT INTO @table (StringAnonymized) SELECT @StringAnonymized RETURN END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_A4;1521140910;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_A4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_A4] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_A4] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_D7;1524460755;V ;VIEW;7385;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_DemoSystem;1524512810;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;4335;/**/ /* V01.01.01 2021-09-12 Andrs Szvs */ /* Fact View for Maintennace Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Changes: */ /* - V01.01.01 2021-09-12 Szivos Andras CI/BTM-AC1 Minor adjustment to use exiting Data.CORE function with OH filter */ /* - V01.01.00 2021-09-07 Szivos Andras CI/BTM-AC1 Implement Softrule #FBI-SR-000000025 Debit Credit & Statistical indicator */ /* - V01.00.04 2021-07-14 Szivos Andras CI/BTM-AC1 Change filtering on specific cost element group to be independent */ /* from specific cost element view */ /* - V01.00.03: 2021-11-23 Andrs Szvs Adjust after rework of plan costs with priority of planning sources in DataCore */ /* - V01.00.01: 2021-09-27 Andrs Szvs First documentation of view in SAP PowerDesginer */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V3_IFCT0_G4_DemoSystem ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN SELECT [CostCenterDimId] , [JunkDimID] , [PostingPeriodYearId] , [FiscalYear] , [CostElementDimId] , [TotalValueCOAreaCurrency] , [ControllingAreaCurrencyCode] , [TotalValueObjectCurrency] , [CurrencyCodeObjectCurrency] , [ActivityType] , [PartnerObjectId] , [SourceCostCenterDimId] , [SourceSystem] , [COBusinessTransaction] , [ValueType] , [ScenarioId] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G4] (@YearCreation, @Prioritization) gpc --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT cebcadis_bs.DimensionID as [CostElementbyControllingAreaDimId] from [BUSV_RB_CSC1].[CostElementByChartOfAccountsGlobalHierarchy_BSATM_G4_X] cebcoagh_bs INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementMappingControllingtoChartofAccounts_BLNK0] as cemca2coa_bl --Mapping of both cost element types on cemca2coa_bl.[CostElementByChartOfAccounts_HK] = cebcoagh_bs.[CostElementByChartOfAccounts_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadis_bs on cebcadis_bs.[CostElementByControllingArea_HK] = cemca2coa_bl.[CostElementByControllingArea_HK] WHERE 1 = 1 and cebcoagh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and cebcoagh_bs.Nodename_Root_BK = 'RB-E-BPR' and cebcoagh_bs.Level5_BK = 'RB-E-BPR4.211' ) vdce ON gpc.CostElementDimId = vdce.[CostElementbyControllingAreaDimId] --Filter only on one plant for demo purposes INNER JOIN ( SELECT DISTINCT ccdis.DimensionID FROM [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccpa_wl WITH (NOLOCK) INNER JOIN [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccpa_ws WITH (NOLOCK) ON ccpa_wl.[CostCenterPlantAssignment_HK] = ccpa_ws.[CostCenterPlantAssignment_HK] AND ccpa_ws.[LoadEndDate] = CAST('2999-12-31' AS DATETIME2) INNER JOIN [RAWV_RB_CSC1].[Plant_WHUB0] p_wh ON p_wh.[Plant_HK] = ccpa_wl.[Plant_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis ON ccdis.[CostCenter_HK] = ccpa_wl.[CostCenter_HK] WHERE p_wh.Plant_BK = '9830' ) ccpa_wl ON COALESCE(gpc.[CostCenterDimId], 0) = ccpa_wl.[DimensionID]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Customer_SL;1531568940;V ;VIEW;2303;/**/ /* View: V_INTF_MD_Customer_SL */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Ilja Frolov GS/BDD1 */ /* Interface view for transfer of end-of-previous-month customer master data to Optravis */ /* Data.CORE Outgoing Interface #0075 https://inside-docupedia.bosch.com/confluence/x/GDQRY */ /* Restrictions: */ /* - none */ /* Changes: */ /* - V01.00.01 - 2023-07-25 - Added link for Outgoing Interface */ /* - V01.00.00 - 2023-07-19 - Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_A3;1532180854;V ;VIEW;2388;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 13.12.2022 07:36:23 */ /**/ /**/ /* View: V_COCostActualLineItemDelta_A3 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G0_DemoSystem;1534172761;V ;VIEW;5317;/**/ /* View: V_FactActualCost_G0_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs on document item level booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it) */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_B4;1537140967;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_B4 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_B4] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_B4] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G0;1540460812;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G0 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_KSTAR;1543780657;V ;VIEW;1090;/**/ /* View: V_INTF_PNL_DIM_KSTAR */ /**/ /* = */ /* V 01.00.00 2020-10-23 Patrik Just CI/DAV2.3 */ /* Empty view to get structural consistency in target application */ /* Restrictions: */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_B2;1547568997;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_B2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_A4;1548180911;V ;VIEW;2046;/**/ /* View: V_COCostActualLineItemDelta_A4 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G4_DemoSystem;1550172818;V ;VIEW;5317;/**/ /* View: V_FactActualCost_G4_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs on document item level booked on Cost Centers from P81, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_DataCORECostsCostCenterHierarchy;1551500756;V ;VIEW;1730;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 28.06.2021 13:38:21 */ /**/ /**/ /* View: V_DataCORECostsCostCenterHierarchy */ /**/ /* =*/ /* V01.00.00 2021-06-28 Yannick Sigwalt GS/BDO12 */ /* This view provide the list of root nodes to be displayed in Cost Center Dimension for Cost */ /* for SSAS */ /* Only root nodes provided by this view will bw displayed in DimCostCenter */ /* Restriction */ /* This view is only to be used for CostCenter Hierachies for Costs */ /* Update: */ /* =*/
MetadataZone;27;;ProcessStepDeltaExport;1552060615;V ;VIEW;1061;/**/ /* View: ProcessStepDeltaExport */ /**/ /* =*/ /* V01.00.01 2020-02-06 Yannick Sigwalt GS/FBI2 */ /* This view is used to enable the delta loading out of satellite */ /* V01.00.01 changed access from table SatProcessStepDeltaExport to view ProcessStepDeltaExport */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_H1;1553141024;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_H1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_H1] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_H1] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G1;1556460869;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G1 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_InternalOrder;1561368927;V ;VIEW;1272;/**/ /* View: V_INTF_PNL_DIM_InternalOrder */ /**/ /* = */ /* V01.00.00 2022-08-22 Yannick Sigwalt GS/BDD1 */ /* Access Layer for PnL Series for Internal Orders for TM1 */ /* Data.CORE Outgoing Interface #0050 https://inside-docupedia.bosch.com/confluence/x/xbd9Vg */ /* Restrictions: */ /* - Empty view to get structural consistency in target application */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_C3;1563569054;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_C3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_H1;1564180968;V ;VIEW;2046;/**/ /* View: V_COCostActualLineItemDelta_H1 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G5_DemoSystem;1566172875;V ;VIEW;5318;/**/ /* View: V_FactActualCost_G5_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs on document item level booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_O1;1569141081;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2673;/**/ /* View: V_FactActualCost_Short_YTD_O1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_O1] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here SELECT cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodYearId] , cast((@postingPeriodYearId /1000) as int) AS [Year] , IIF(@postingPeriodYearId % 1000 >= 12,12, @postingPeriodYearId % 1000) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountObjectCurrency] ) as [TotalAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_O1] WHERE 1= 1 and [FiscalYearPostingPeriod] >= cast((@postingPeriodYearId /1000) as int) * 1000 and [FiscalYearPostingPeriod] <= cast((@postingPeriodYearId /1000) as int) * 1000 + IIF(@postingPeriodYearId % 1000 >= 12,16, @postingPeriodYearId % 1000) group by [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , DebitCreditIndicator ,COALESCE(Left(PartnerObject_Id_BK,2),'0') , [SourceCostCenterDimId] , [ObjectCurrencyCode] )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G2;1572460926;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G2 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_WBSElementSettlementRulesActual001;1573997084;P ;SQL_STORED_PROCEDURE;18304;"/* =*/ /* V01.00.02 2023-06-30 Philipp Staiger GS/BDD1 */ /* This procedure is used to test the validity of Settlement rules for RnD Analysis Cost Actual data. */ /* Test Case checks if for a relevant WBS Element Settlement Rules are available in the respective fiscal period */ /* or if the SettlementPercentageRates don't add up to 100%. */ /* It populates [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] with results of test case */ /* execution. */ /* Implemented Soft Rules */ /* Debit Credit & Statistical Indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Profit center cost allocation */ /* #FBI-SR-000000088 https://inside-docupedia.bosch.com/confluence/x/JVLGhw */ /* Convert Period >=012 to 012 */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg */ /* get Profit Center information for WBS-Element without settlement target */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk */ /* Update: */ /* V01.00.02 - Extended with test case for exceeding SettlementRulePercentage */ /* V01.00.01 - Changed output columns */ /* V01.00.00 - Initial version */ /* =*/ CREATE PROCEDURE MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_WBSElementSettlementRulesActual001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) AS BEGIN /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem NVARCHAR(15) = N'SAPPOE' --DECLARE @SourceSystemVar NVARCHAR(5) = N'G0' --DECLARE @Usecase NVARCHAR(50) = N'AL2_MERM_RnDTesting_PDM' --DECLARE @TestCase NVARCHAR(50) = N'WBSElementSettlementRulesActual001' --DECLARE @TargetDataBase NVARCHAR(100) = 'FBI_CORE_CORE_D' --DECLARE @TargetSchema NVARCHAR(256) = '' --DECLARE @TargetTable NVARCHAR(256) = '' --DECLARE @DeltaTimestampFrom DATETIME2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo DATETIME2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId BIGINT = 113 --DECLARE @ProcessStepId BIGINT = 790 --DECLARE @EntityId BIGINT = 124 --DECLARE @AuditTrailId BIGINT = -2 --DECLARE @ProcessStatusMessage NVARCHAR(4000) = null --DECLARE @RowsRead INT --DECLARE @RowsInserted INT --DECLARE @RowsUpdated INT --DECLARE @RowsDeleted INT --DECLARE @ErrorSeverity INT --DECLARE @ErrorState INT --DECLARE @ErrorProcedure NVARCHAR(128) --DECLARE @ErrorLine INT /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel INT = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnDTest_WBSElementSettlementRulesActual001]'; DECLARE @TestedElement NVARCHAR(100) = N'WBSElement'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FiscalYear INT = IIF(MONTH(GETDATE()) = 1, YEAR(GETDATE()) - 1, YEAR(GETDATE())) DECLARE @FiscalYearPeriod INT = @FiscalYear * 1000 + 1 SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DECLARE @SQL_3 NVARCHAR(MAX) = '' DECLARE @SQL_4 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #WBSElementList; CREATE TABLE #WBSElementList ( [SAPSystem] NVARCHAR(15) COLLATE Latin1_General_CS_AS NOT NULL ,[WBSElement_BK] INT NOT NULL ,[MessageId] INT ,[WBSElementDimId] BIGINT ,[PostingYearPeriodId] INT ,[ScenarioId] BIGINT ,[Version] NVARCHAR(3) ,[JunkDimId] NVARCHAR(6) ,[TotalAmountObjectCurrency] NUMERIC(38, 6) ,[RowId] INT IDENTITY(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)) --Get list of SettlementRule per CostCollector SET @SQL_1 = ( SELECT CONCAT(' WITH cte_SettlementRule AS ( SELECT ccollsr_wl.[CostCollector_HK] AS [CostCollector_HK] ,COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) AS [YearPeriodValidFrom] ,COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) AS [YearPeriodValidTo] ,ccollsr_ws.SettlementPercentageRate AS [SettlementPercentageRate] FROM [',@TargetDataBase,'].[RAWV_COOM_CSC1].[CostCollectorSettlementRules_WHUB0] ccollsr_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorSettlementRules_WLNK0] ccollsr_wl ON ccollsr_wl.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[CostCollectorSettlementRules_WSAT0_',@SourceSystemVar,'_X] ccollsr_ws ON ccollsr_ws.[CostCollectorSettlementRules_HK] = ccollsr_wh.[CostCollectorSettlementRules_HK] AND ccollsr_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND ccollsr_ws.[SettlementTransaction] = N''KOAO'' AND ccollsr_ws.[AccountAssignmentCategory] IN (N''EO'', N''KS'', N''PR'') AND COALESCE(ccollsr_ws.[YearPeriodValidFrom], [YearPeriodFirstUse]) IS NOT NULL AND COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) IS NOT NULL AND COALESCE(ccollsr_ws.[YearPeriodValidTo], [YearPeriodLastUse]) >= ',@FiscalYearPeriod,' ) ')); --Retrieve WBSElements from fact table for respective time period SET @SQL_2 = ( SELECT CONCAT(' ,cte_Cost AS ( SELECT ccoll_wh.[CostCollector_HK] AS [CostCollector_HK] ,wbse_wh.[SAPSystem] AS [SAPSystem] ,wbse_wh.[WBSElement_BK] AS [WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) AS [WBSElementDimensionId] ,CAST((cocali_ws.[FiscalYear] * 1000 + IIF(CAST(cocali_ws.[Period] AS INT) >= 12, 12, CAST(cocali_ws.[Period] AS INT))) AS INT) AS [PostingYearPeriodId] ,IIF(CAST(cocali_ws.[Period] AS SMALLINT) > 12, 12, CAST(cocali_ws.[Period] AS SMALLINT)) AS [PostingPeriodId] ,COALESCE( CONCAT( usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', COALESCE(LEFT(ccoll_wh.[CostCollectorObject_BK], 2), N''0'')) , ''0'') AS [JunkDimId] ,SUM(cocali_ws.[ObjectTotalAmount]) AS [TotalAmountObjectCurrency] FROM [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_',@SourceSystemVar,'_X] wbsea_ws ON wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] AND wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND wbsea_ws.[FunctionalArea] = ''0500'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl ON ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh ON ccoll_wh.[CostCollector_HK] = ccoll2wbse_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_',@SourceSystemVar,'] coca2bo_wl ON coca2bo_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_',@SourceSystemVar,'] cocali_wh ON cocali_wh.[COCostActualLineItem_HK] = coca2bo_wl.[COCostActualLineItem_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_',@SourceSystemVar,'_L] cocali_ws ON cocali_ws.[COCostActualLineItem_HK] = cocali_wh.[COCostActualLineItem_HK] AND cocali_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws.[FiscalYear] >= ',@FiscalYear,' CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (cocali_ws.[DebitCreditCode], cocali_ws.[COBusinessTransaction]) usrcoomdci CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (cocali_ws.[ValueType]) usrcoomsi LEFT OUTER JOIN [',@TargetDataBase,'].[BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs ON wbsedi_bs.[WBSElement_HK] = wbse_wh.[WBSElement_HK] GROUP BY ccoll_wh.[CostCollector_HK] ,wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) ,CAST((cocali_ws.[FiscalYear] * 1000 + IIF(CAST(cocali_ws.[Period] AS INT) >= 12, 12, CAST(cocali_ws.[Period] AS INT))) AS INT) ,IIF(CAST(cocali_ws.[Period] AS SMALLINT) > 12, 12, CAST(cocali_ws.[Period] AS SMALLINT)) ,COALESCE( CONCAT( usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', COALESCE(LEFT(ccoll_wh.[CostCollectorObject_BK], 2), N''0'')) , ''0'') ) ')); --Connect booked WBSElements with SettlementRules valid in the PostingPeriod --Filter for WBSELements without a valid SettlementRule --Filter for WBSElements where SettlementPercentageRate doesn't add up to 100% SET @SQL_3 = ( SELECT ' INSERT INTO #WBSElementList ([SAPSystem] ,[WBSElement_BK] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency]) -- SettlementRule is missing SELECT cte_Cost.[SAPSystem] AS [SourceSystem_PK] ,cte_Cost.[WBSElement_BK] AS [WBSElement_BK] ,11 AS [MessageId] ,cte_Cost.[WBSElementDimensionId] AS [WBSElementDimensionId] ,cte_Cost.[PostingYearPeriodId] AS [PostingYearPeriodId] ,cte_Cost.[PostingPeriodId] AS [ScenarioId] ,''ACT'' AS [Version] ,cte_Cost.[JunkDimId] AS [JunkDimId] ,cte_Cost.[TotalAmountObjectCurrency] AS [TotalAmountObjectCurrency] FROM cte_Cost LEFT OUTER JOIN cte_SettlementRule ON cte_SettlementRule.[CostCollector_HK] = cte_Cost.[CostCollector_HK] AND cte_Cost.[PostingYearPeriodId] BETWEEN cte_SettlementRule.[YearPeriodValidFrom] AND cte_SettlementRule.[YearPeriodValidTo] WHERE 1 = 1 AND cte_SettlementRule.[CostCollector_HK] IS NULL UNION ALL -- SettlementPercentageRate is incorrect SELECT cte_Cost.[SAPSystem] AS [SourceSystem_PK] ,cte_Cost.[WBSElement_BK] AS [WBSElement_BK] ,13 AS [MessageId] ,cte_Cost.[WBSElementDimensionId] AS [WBSElementDimensionId] ,cte_Cost.[PostingYearPeriodId] AS [PostingYearPeriodId] ,cte_Cost.[PostingPeriodId] AS [ScenarioId] ,''ACT'' AS [Version] ,cte_Cost.[JunkDimId] AS [JunkDimId] ,cte_Cost.[TotalAmountObjectCurrency] AS [TotalAmountObjectCurrency] FROM cte_Cost INNER JOIN cte_SettlementRule ON cte_SettlementRule.[CostCollector_HK] = cte_Cost.[CostCollector_HK] AND cte_Cost.[PostingYearPeriodId] BETWEEN cte_SettlementRule.[YearPeriodValidFrom] AND cte_SettlementRule.[YearPeriodValidTo] GROUP BY cte_Cost.[SAPSystem] ,cte_Cost.[WBSElement_BK] ,cte_Cost.[WBSElementDimensionId] ,cte_Cost.[PostingYearPeriodId] ,cte_Cost.[PostingPeriodId] ,cte_Cost.[JunkDimId] ,cte_Cost.[TotalAmountObjectCurrency] HAVING SUM(cte_SettlementRule.[SettlementPercentageRate]) <> 100 '); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1, @SQL_2, @SQL_3)); IF(@DebugLevel >= 12 ) BEGIN PRINT ' ='; PRINT CAST(@SQL AS NTEXT) PRINT ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (SELECT @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'S' --Success ,0 AS [MessageId] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,[WBSElement_BK] ,N'W' --Warning ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[TotalAmountObjectCurrency] ,@StoredProcedure from #WBSElementList END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementSettlementRules001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'E' --Success ,999 AS [MessageId] ,@StoredProcedure IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage DROP TABLE IF EXISTS #WBSElementList; RETURN @ReturnProcessStatusNumber END"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_InternalOrder_ATTR;1577368984;V ;VIEW;6235;/**/ /* View: V_INTF_PNL_DIM_InternalOrder_ATTR */ /**/ /* =*/ /* V01.00.00 2022-08-22 Yannick Sigwalt GS/BDD1 */ /* Access Layer for PnL Series for Internal Orders texts for TM1 */ /* Data.CORE Outgoing Interface #0051 https://inside-docupedia.bosch.com/confluence/x/YLh9Vg */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Restrictions: */ /* - Merged descriptions for B2,C3,G0,G1,G2,G3,G4,G5,G6,S3,SL */ /* Update: */ /*= */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G0;1579569111;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G0 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_A3;1580181025;V ;VIEW;3338;/**/ /* View: V_COPlanCostsDelta_A3 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G0_DemoSystem;1582172932;V ;VIEW;4564;/**/ /* View: V_FactActualCost_Short_G0_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it) */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G0_DemoSystem;1585141138;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13817;/**/ /* View: V_FactActualCost_Short_YTD_G0 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G0_DemoSystem] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here WITH base as ( SELECT [YearMonthCreation] , [FiscalYearPostingPeriod] AS [PostingPeriodYearId] , YEAR(LEFT([FiscalYearPostingPeriod],4)) AS [Year] , IIF([PostingPeriod]>12,12,[PostingPeriod]) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [TotalAmountObjectCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G0] WHERE [FiscalYearPostingPeriod] = @postingPeriodYearId ), CTE AS ( SELECT [PostingPeriodYearId] , [Year] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] = cast(SUM([TotalAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountCOAreaCurrency] = cast(SUM([FixedAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountCOAreaCurrency] = cast(SUM([VariableAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [TotalAmountObjectCurrency] = cast(SUM([TotalAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountObjectCurrency] = cast(SUM([FixedAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountObjectCurrency] = cast(SUM([VariableAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) FROM base --Added for DemoSystem WHERE [CostCenterDimId] IN ( SELECT ccdis.DimensionID AS CostCenterDimId FROM [RAWV_RB_CSC1].[CostCenter_WHUB0] AS ccent_wh INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis ON ccent_wh.[CostCenter_HK] = ccdis.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G0_X] ccentgh_bs ON ccentgh_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] AND ccentgh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND ccentgh_bs.[Level1_BK] = '6630C_ALL' -- DemoNode ) GROUP BY [Year] , [PostingPeriodYearId] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [ObjectCurrencyCode] , [SourceCostCenterDimId] ) , Names AS ( SELECT DISTINCT ym.[PostingPeriodYearId] , ym.[PostingPeriodId] , ym.[Year] , ym.[SourceSystem] , u.[CostCenterDimId] , u.[CostElementDimId] , u.[JunkDimID] , u.[SourceCostCenterDimId] , u.[ObjectCurrencyCode] FROM CTE ym CROSS APPLY ( SELECT DISTINCT t.[PostingPeriodYearId] , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t ) u ) , FirstAppearanceMonthOfYear AS ( SELECT DISTINCT MIN(t.[PostingPeriodId]) AS FirstPeriodAppearance , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t GROUP BY t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] ) , MaxMonthsWithRev AS ( SELECT DISTINCT n.* , CASE WHEN t.[TotalAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[TotalAmountCOAreaCurrency] END AS [TotalAmountCOAreaCurrency] , CASE WHEN t.[FixedAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[FixedAmountCOAreaCurrency] END AS [FixedAmountCOAreaCurrency] , CASE WHEN t.[VariableAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[VariableAmountCOAreaCurrency] END AS [VariableAmountCOAreaCurrency] , CASE WHEN t.[TotalAmountObjectCurrency] IS NULL THEN 0 ELSE t.[TotalAmountObjectCurrency] END AS [TotalAmountObjectCurrency] , CASE WHEN t.[FixedAmountObjectCurrency] IS NULL THEN 0 ELSE t.[FixedAmountObjectCurrency] END AS [FixedAmountObjectCurrency] , CASE WHEN t.[VariableAmountObjectCurrency] IS NULL THEN 0 ELSE t.[VariableAmountObjectCurrency] END AS [VariableAmountObjectCurrency] FROM Names n LEFT JOIN CTE t ON t.[PostingPeriodId] = n.[PostingPeriodId] AND t.[Year] = n.Year AND t.[SourceSystem] = n.SourceSystem AND t.[CostCenterDimId] = n.CostCenterDimId AND t.[CostElementDimId] = n.CostElementDimId AND t.[JunkDimID] = n.JunkDimID AND t.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND t.[ObjectCurrencyCode] = n.ObjectCurrencyCode INNER JOIN FirstAppearanceMonthOfYear famoy ON famoy.[Year] = n.Year AND famoy.[SourceSystem] = n.SourceSystem AND famoy.[CostCenterDimId] = n.CostCenterDimId AND famoy.[CostElementDimId] = n.CostElementDimId AND famoy.[JunkDimID] = n.JunkDimID AND famoy.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND famoy.[ObjectCurrencyCode] = n.ObjectCurrencyCode WHERE n.PostingPeriodId >= famoy.FirstPeriodAppearance ) , DistinctYearMonths AS ( SELECT DISTINCT a.* FROM ( SELECT t.PostingPeriodYearId , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] , t.[TotalAmountCOAreaCurrency] , t.[FixedAmountCOAreaCurrency] , t.[VariableAmountCOAreaCurrency] , t.[TotalAmountObjectCurrency] , t.[FixedAmountObjectCurrency] , t.[VariableAmountObjectCurrency] FROM CTE t UNION ALL SELECT m.PostingPeriodYearId , m.[PostingPeriodId] , m.[Year] , m.[SourceSystem] , m.[CostCenterDimId] , m.[CostElementDimId] , m.[JunkDimID] , m.[SourceCostCenterDimId] , m.[ObjectCurrencyCode] , m.[TotalAmountCOAreaCurrency] , m.[FixedAmountCOAreaCurrency] , m.[VariableAmountCOAreaCurrency] , m.[TotalAmountObjectCurrency] , m.[FixedAmountObjectCurrency] , m.[VariableAmountObjectCurrency] FROM MaxMonthsWithRev m ) a ) , YTD_CTE AS ( SELECT [PostingPeriodYearId] , [PostingPeriodId] , [Year] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountCOAreaCurrency] , SUM([FixedAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountCOAreaCurrency] , SUM([VariableAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountCOAreaCurrency] , SUM([TotalAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountObjectCurrency] , SUM([FixedAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountObjectCurrency] , SUM([VariableAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountObjectCurrency] FROM DistinctYearMonths dym ) SELECT ytd.[PostingPeriodYearId] , ytd.[PostingPeriodId] , ytd.[Year] , ytd.[SourceSystem] , ytd.[CostCenterDimId] , ytd.[CostElementDimId] , ytd.[JunkDimID] , ytd.[SourceCostCenterDimId] , ytd.[ObjectCurrencyCode] , ytd.[TotalAmountCOAreaCurrency] , ytd.[FixedAmountCOAreaCurrency] , ytd.[VariableAmountCOAreaCurrency] , ytd.[TotalAmountObjectCurrency] , ytd.[FixedAmountObjectCurrency] , ytd.[VariableAmountObjectCurrency] FROM YTD_CTE ytd LEFT JOIN CTE cte ON ytd.CostCenterDimId = cte.CostCenterDimId AND ytd.CostElementDimId = cte.CostElementDimId AND ytd.JunkDimID = cte.JunkDimID AND ytd.ObjectCurrencyCode = cte.ObjectCurrencyCode AND ytd.PostingPeriodYearId = cte.PostingPeriodYearId AND ytd.PostingPeriodId = cte.PostingPeriodId AND ytd.SourceCostCenterDimId = cte.SourceCostCenterDimId AND ytd.SourceSystem = cte.SourceSystem )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G4;1588460983;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G4 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_RKAUFNR;1591780828;V ;VIEW;1092;/**/ /* View: V_INTF_PNL_DIM_RKAUFNR */ /**/ /* = */ /* V 01.00.00 2020-10-23 Patrik Just CI/DAV2.3 */ /* Empty view to get structural consistency in target application */ /* Restrictions: */ /* - IBM PA Interface Description */ /* https://inside-docupedia.bosch.com/confluence/display/BID/IBM+PA+%7C+Interface+Description */ /* Update: */ /* - V01.00.00 Create dummy view without content */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_YTD_V2_O1;1595517113;V ;VIEW;11887;/**/ /* View: V_FactActualCost_Short_YTD_O1 */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G1;1595569168;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G1 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_A4;1596181082;V ;VIEW;3340;/**/ /* View: V_COPlanCostsDelta_A4 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G4_DemoSystem;1598172989;V ;VIEW;4564;/**/ /* View: V_FactActualCost_Short_G4_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it) */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G4_DemoSystem;1601141195;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13817;/**/ /* View: V_FactActualCost_Short_YTD_G4_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G4_DemoSystem] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here WITH base as ( SELECT [YearMonthCreation] , [FiscalYearPostingPeriod] AS [PostingPeriodYearId] , YEAR(LEFT([FiscalYearPostingPeriod],4)) AS [Year] , IIF([PostingPeriod]>12,12,[PostingPeriod]) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [TotalAmountObjectCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G4] WHERE [FiscalYearPostingPeriod] = @postingPeriodYearId ), CTE AS ( SELECT [PostingPeriodYearId] , [Year] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] = cast(SUM([TotalAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountCOAreaCurrency] = cast(SUM([FixedAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountCOAreaCurrency] = cast(SUM([VariableAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [TotalAmountObjectCurrency] = cast(SUM([TotalAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountObjectCurrency] = cast(SUM([FixedAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountObjectCurrency] = cast(SUM([VariableAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) FROM base --Added for DemoSystem WHERE [CostCenterDimId] IN ( SELECT ccdis.DimensionID AS CostCenterDimId FROM [RAWV_RB_CSC1].[CostCenter_WHUB0] AS ccent_wh INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis ON ccent_wh.[CostCenter_HK] = ccdis.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G0_X] ccentgh_bs ON ccentgh_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] AND ccentgh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND ccentgh_bs.[Level1_BK] = '6630C_ALL' -- DemoNode ) GROUP BY [Year] , [PostingPeriodYearId] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [ObjectCurrencyCode] , [SourceCostCenterDimId] ) , Names AS ( SELECT DISTINCT ym.[PostingPeriodYearId] , ym.[PostingPeriodId] , ym.[Year] , ym.[SourceSystem] , u.[CostCenterDimId] , u.[CostElementDimId] , u.[JunkDimID] , u.[SourceCostCenterDimId] , u.[ObjectCurrencyCode] FROM CTE ym CROSS APPLY ( SELECT DISTINCT t.[PostingPeriodYearId] , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t ) u ) , FirstAppearanceMonthOfYear AS ( SELECT DISTINCT MIN(t.[PostingPeriodId]) AS FirstPeriodAppearance , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t GROUP BY t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] ) , MaxMonthsWithRev AS ( SELECT DISTINCT n.* , CASE WHEN t.[TotalAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[TotalAmountCOAreaCurrency] END AS [TotalAmountCOAreaCurrency] , CASE WHEN t.[FixedAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[FixedAmountCOAreaCurrency] END AS [FixedAmountCOAreaCurrency] , CASE WHEN t.[VariableAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[VariableAmountCOAreaCurrency] END AS [VariableAmountCOAreaCurrency] , CASE WHEN t.[TotalAmountObjectCurrency] IS NULL THEN 0 ELSE t.[TotalAmountObjectCurrency] END AS [TotalAmountObjectCurrency] , CASE WHEN t.[FixedAmountObjectCurrency] IS NULL THEN 0 ELSE t.[FixedAmountObjectCurrency] END AS [FixedAmountObjectCurrency] , CASE WHEN t.[VariableAmountObjectCurrency] IS NULL THEN 0 ELSE t.[VariableAmountObjectCurrency] END AS [VariableAmountObjectCurrency] FROM Names n LEFT JOIN CTE t ON t.[PostingPeriodId] = n.[PostingPeriodId] AND t.[Year] = n.Year AND t.[SourceSystem] = n.SourceSystem AND t.[CostCenterDimId] = n.CostCenterDimId AND t.[CostElementDimId] = n.CostElementDimId AND t.[JunkDimID] = n.JunkDimID AND t.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND t.[ObjectCurrencyCode] = n.ObjectCurrencyCode INNER JOIN FirstAppearanceMonthOfYear famoy ON famoy.[Year] = n.Year AND famoy.[SourceSystem] = n.SourceSystem AND famoy.[CostCenterDimId] = n.CostCenterDimId AND famoy.[CostElementDimId] = n.CostElementDimId AND famoy.[JunkDimID] = n.JunkDimID AND famoy.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND famoy.[ObjectCurrencyCode] = n.ObjectCurrencyCode WHERE n.PostingPeriodId >= famoy.FirstPeriodAppearance ) , DistinctYearMonths AS ( SELECT DISTINCT a.* FROM ( SELECT t.PostingPeriodYearId , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] , t.[TotalAmountCOAreaCurrency] , t.[FixedAmountCOAreaCurrency] , t.[VariableAmountCOAreaCurrency] , t.[TotalAmountObjectCurrency] , t.[FixedAmountObjectCurrency] , t.[VariableAmountObjectCurrency] FROM CTE t UNION ALL SELECT m.PostingPeriodYearId , m.[PostingPeriodId] , m.[Year] , m.[SourceSystem] , m.[CostCenterDimId] , m.[CostElementDimId] , m.[JunkDimID] , m.[SourceCostCenterDimId] , m.[ObjectCurrencyCode] , m.[TotalAmountCOAreaCurrency] , m.[FixedAmountCOAreaCurrency] , m.[VariableAmountCOAreaCurrency] , m.[TotalAmountObjectCurrency] , m.[FixedAmountObjectCurrency] , m.[VariableAmountObjectCurrency] FROM MaxMonthsWithRev m ) a ) , YTD_CTE AS ( SELECT [PostingPeriodYearId] , [PostingPeriodId] , [Year] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountCOAreaCurrency] , SUM([FixedAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountCOAreaCurrency] , SUM([VariableAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountCOAreaCurrency] , SUM([TotalAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountObjectCurrency] , SUM([FixedAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountObjectCurrency] , SUM([VariableAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountObjectCurrency] FROM DistinctYearMonths dym ) SELECT ytd.[PostingPeriodYearId] , ytd.[PostingPeriodId] , ytd.[Year] , ytd.[SourceSystem] , ytd.[CostCenterDimId] , ytd.[CostElementDimId] , ytd.[JunkDimID] , ytd.[SourceCostCenterDimId] , ytd.[ObjectCurrencyCode] , ytd.[TotalAmountCOAreaCurrency] , ytd.[FixedAmountCOAreaCurrency] , ytd.[VariableAmountCOAreaCurrency] , ytd.[TotalAmountObjectCurrency] , ytd.[FixedAmountObjectCurrency] , ytd.[VariableAmountObjectCurrency] FROM YTD_CTE ytd LEFT JOIN CTE cte ON ytd.CostCenterDimId = cte.CostCenterDimId AND ytd.CostElementDimId = cte.CostElementDimId AND ytd.JunkDimID = cte.JunkDimID AND ytd.ObjectCurrencyCode = cte.ObjectCurrencyCode AND ytd.PostingPeriodYearId = cte.PostingPeriodYearId AND ytd.PostingPeriodId = cte.PostingPeriodId AND ytd.SourceCostCenterDimId = cte.SourceCostCenterDimId AND ytd.SourceSystem = cte.SourceSystem )
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREActivityTypeInSoftRules;1602417078;V ;VIEW;1613;/**/ /* View: V_DataCOREActivityTypeInSoftRules */ /**/ /* =*/ /* V01.00.00 2022-07-14 Yannick Sigwalt GS/BDD2 */ /* This view provides parameter to be used in Soft Rules based on Activity Type */ /* Restriction */ /* This view is only to be used in soft rules re+lated to Activity Type */ /* Update: */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G5;1604461040;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G5 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_OrganizationalOffice_V1_IDIM1;1606400892;V ;VIEW;18268;/**/ /* View: V_OrganizationalOffice_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2020-11-23 Yannick Sigwalt GS/BDO12 */ /* This view builds the Organizational Office Dimension for SSAS */ /* Restriction: */ /* - only the actual Parent/child hierarchy is provided */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D0;1607832940;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D0] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_D0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPTT' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_D0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_Test_G0;1610644981;V ;VIEW;1853;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G2;1611569225;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COPlanCostsDelta_H1;1612181139;V ;VIEW;3342;/**/ /* View: V_COPlanCostsDelta_H1 */ /**/ /* =*/ /* V01.00.00 2022-12-09 Jakub Kozlowski */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_xx_X] and */ /* [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_xx_X] to identify new CO plan cost records */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.00 - Copied from A2 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_G5_DemoSystem;1614173046;V ;VIEW;4565;/**/ /* View: V_FactActualCost_Short_G5_DemoSystem */ /**/ /**/ /* V01.00.06 2022-03-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P87, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.06 - Repaire JunkDimId (remove the SAP Scenario part from it) */ /* - V01.00.05 - Introduced a scrambling logic to all amounts + filter only on a specific Level1 CostCenterGroup */ /* - V01.00.01 - Initial Version - View copied from V01.03.02 V_FactActual_Costs_xx */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;fn_GetFactActualCost_Short_YTD_V2_G5_DemoSystem;1617141252;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;13817;/**/ /* View: V_FactActualCost_Short_YTD_G5_DemoSystem */ /**/ /**/ /* V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 in a YTD logic */ /* Changes: */ /* - V01.01.00 2022-11-02 Szivos Andras CI/BTM-AC1 Major bug fix, as combinations missing in a certain month were not*/ /* shown in YTD logic */ /* - V01.00.01 2022-09-12 Szivos Andras CI/BTM-AC1 some missing fields were added: YearMonthCreation, PostingPeriodId*/ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[fn_GetFactActualCost_Short_YTD_V2_G5_DemoSystem] ( -- Add the parameters for the function here @postingPeriodYearId INT ) RETURNS TABLE AS RETURN ( -- Add the SELECT statement with parameter references here WITH base as ( SELECT [YearMonthCreation] , [FiscalYearPostingPeriod] AS [PostingPeriodYearId] , YEAR(LEFT([FiscalYearPostingPeriod],4)) AS [Year] , IIF([PostingPeriod]>12,12,[PostingPeriod]) AS [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , REPLACE((CONCAT(DebitCreditIndicator,'_0_',COALESCE(Left(PartnerObject_Id_BK,2),'0'))), '_ACT','') as JunkDimID , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] , [FixedAmountCOAreaCurrency] , [VariableAmountCOAreaCurrency] , [TotalAmountObjectCurrency] , [FixedAmountObjectCurrency] , [VariableAmountObjectCurrency] FROM [INFM_Costs_CSC1].[COCostActual_V2_MFCT0_G5] WHERE [FiscalYearPostingPeriod] = @postingPeriodYearId ), CTE AS ( SELECT [PostingPeriodYearId] , [Year] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , [TotalAmountCOAreaCurrency] = cast(SUM([TotalAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountCOAreaCurrency] = cast(SUM([FixedAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountCOAreaCurrency] = cast(SUM([VariableAmountCOAreaCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [TotalAmountObjectCurrency] = cast(SUM([TotalAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [FixedAmountObjectCurrency] = cast(SUM([FixedAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) , [VariableAmountObjectCurrency] = cast(SUM([VariableAmountObjectCurrency]) as decimal(38,2)) *(1-(CAST(coalesce([CostCenterDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostCenterDimId], 0) as decimal)/10) )/10 *5) * (1+(CAST(coalesce([CostElementDimId], 0) as decimal)/10-FLOOR(CAST(coalesce([CostElementDimId], 0) as decimal)/10) )/10 *3) FROM base --Added for DemoSystem WHERE [CostCenterDimId] IN ( SELECT ccdis.DimensionID AS CostCenterDimId FROM [RAWV_RB_CSC1].[CostCenter_WHUB0] AS ccent_wh INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccdis ON ccent_wh.[CostCenter_HK] = ccdis.[CostCenter_HK] INNER JOIN [BUSV_RB_CSC1].[CostCenterGlobalHierarchy_BSATM_G0_X] ccentgh_bs ON ccentgh_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] AND ccentgh_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' AND ccentgh_bs.[Level1_BK] = '6630C_ALL' -- DemoNode ) GROUP BY [Year] , [PostingPeriodYearId] , [PostingPeriodId] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [ObjectCurrencyCode] , [SourceCostCenterDimId] ) , Names AS ( SELECT DISTINCT ym.[PostingPeriodYearId] , ym.[PostingPeriodId] , ym.[Year] , ym.[SourceSystem] , u.[CostCenterDimId] , u.[CostElementDimId] , u.[JunkDimID] , u.[SourceCostCenterDimId] , u.[ObjectCurrencyCode] FROM CTE ym CROSS APPLY ( SELECT DISTINCT t.[PostingPeriodYearId] , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t ) u ) , FirstAppearanceMonthOfYear AS ( SELECT DISTINCT MIN(t.[PostingPeriodId]) AS FirstPeriodAppearance , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] FROM CTE t GROUP BY t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] ) , MaxMonthsWithRev AS ( SELECT DISTINCT n.* , CASE WHEN t.[TotalAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[TotalAmountCOAreaCurrency] END AS [TotalAmountCOAreaCurrency] , CASE WHEN t.[FixedAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[FixedAmountCOAreaCurrency] END AS [FixedAmountCOAreaCurrency] , CASE WHEN t.[VariableAmountCOAreaCurrency] IS NULL THEN 0 ELSE t.[VariableAmountCOAreaCurrency] END AS [VariableAmountCOAreaCurrency] , CASE WHEN t.[TotalAmountObjectCurrency] IS NULL THEN 0 ELSE t.[TotalAmountObjectCurrency] END AS [TotalAmountObjectCurrency] , CASE WHEN t.[FixedAmountObjectCurrency] IS NULL THEN 0 ELSE t.[FixedAmountObjectCurrency] END AS [FixedAmountObjectCurrency] , CASE WHEN t.[VariableAmountObjectCurrency] IS NULL THEN 0 ELSE t.[VariableAmountObjectCurrency] END AS [VariableAmountObjectCurrency] FROM Names n LEFT JOIN CTE t ON t.[PostingPeriodId] = n.[PostingPeriodId] AND t.[Year] = n.Year AND t.[SourceSystem] = n.SourceSystem AND t.[CostCenterDimId] = n.CostCenterDimId AND t.[CostElementDimId] = n.CostElementDimId AND t.[JunkDimID] = n.JunkDimID AND t.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND t.[ObjectCurrencyCode] = n.ObjectCurrencyCode INNER JOIN FirstAppearanceMonthOfYear famoy ON famoy.[Year] = n.Year AND famoy.[SourceSystem] = n.SourceSystem AND famoy.[CostCenterDimId] = n.CostCenterDimId AND famoy.[CostElementDimId] = n.CostElementDimId AND famoy.[JunkDimID] = n.JunkDimID AND famoy.[SourceCostCenterDimId] = n.SourceCostCenterDimId AND famoy.[ObjectCurrencyCode] = n.ObjectCurrencyCode WHERE n.PostingPeriodId >= famoy.FirstPeriodAppearance ) , DistinctYearMonths AS ( SELECT DISTINCT a.* FROM ( SELECT t.PostingPeriodYearId , t.[PostingPeriodId] , t.[Year] , t.[SourceSystem] , t.[CostCenterDimId] , t.[CostElementDimId] , t.[JunkDimID] , t.[SourceCostCenterDimId] , t.[ObjectCurrencyCode] , t.[TotalAmountCOAreaCurrency] , t.[FixedAmountCOAreaCurrency] , t.[VariableAmountCOAreaCurrency] , t.[TotalAmountObjectCurrency] , t.[FixedAmountObjectCurrency] , t.[VariableAmountObjectCurrency] FROM CTE t UNION ALL SELECT m.PostingPeriodYearId , m.[PostingPeriodId] , m.[Year] , m.[SourceSystem] , m.[CostCenterDimId] , m.[CostElementDimId] , m.[JunkDimID] , m.[SourceCostCenterDimId] , m.[ObjectCurrencyCode] , m.[TotalAmountCOAreaCurrency] , m.[FixedAmountCOAreaCurrency] , m.[VariableAmountCOAreaCurrency] , m.[TotalAmountObjectCurrency] , m.[FixedAmountObjectCurrency] , m.[VariableAmountObjectCurrency] FROM MaxMonthsWithRev m ) a ) , YTD_CTE AS ( SELECT [PostingPeriodYearId] , [PostingPeriodId] , [Year] , [SourceSystem] , [CostCenterDimId] , [CostElementDimId] , [JunkDimID] , [SourceCostCenterDimId] , [ObjectCurrencyCode] , SUM([TotalAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountCOAreaCurrency] , SUM([FixedAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountCOAreaCurrency] , SUM([VariableAmountCOAreaCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountCOAreaCurrency] , SUM([TotalAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [TotalAmountObjectCurrency] , SUM([FixedAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [FixedAmountObjectCurrency] , SUM([VariableAmountObjectCurrency]) OVER (PARTITION BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [SourceCostCenterDimId], [ObjectCurrencyCode], [Year] ORDER BY [CostElementDimId], [CostCenterDimId], [JunkDimID], [ObjectCurrencyCode], [Year], [PostingPeriodId], [SourceCostCenterDimId] ROWS UNBOUNDED PRECEDING) AS [VariableAmountObjectCurrency] FROM DistinctYearMonths dym ) SELECT ytd.[PostingPeriodYearId] , ytd.[PostingPeriodId] , ytd.[Year] , ytd.[SourceSystem] , ytd.[CostCenterDimId] , ytd.[CostElementDimId] , ytd.[JunkDimID] , ytd.[SourceCostCenterDimId] , ytd.[ObjectCurrencyCode] , ytd.[TotalAmountCOAreaCurrency] , ytd.[FixedAmountCOAreaCurrency] , ytd.[VariableAmountCOAreaCurrency] , ytd.[TotalAmountObjectCurrency] , ytd.[FixedAmountObjectCurrency] , ytd.[VariableAmountObjectCurrency] FROM YTD_CTE ytd LEFT JOIN CTE cte ON ytd.CostCenterDimId = cte.CostCenterDimId AND ytd.CostElementDimId = cte.CostElementDimId AND ytd.JunkDimID = cte.JunkDimID AND ytd.ObjectCurrencyCode = cte.ObjectCurrencyCode AND ytd.PostingPeriodYearId = cte.PostingPeriodYearId AND ytd.PostingPeriodId = cte.PostingPeriodId AND ytd.SourceCostCenterDimId = cte.SourceCostCenterDimId AND ytd.SourceSystem = cte.SourceSystem )
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G6;1620461097;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G6 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_Dummy;1622400949;V ;VIEW;1159;/**/ /* View: V_BridgeSparePartToFact_IDIM1_Dummy */ /**/ /**/ /* V01.00.01 - 2020-12-14 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from POE */ /* Restrictions: */ /* - Only contains distinct dummy record */ /* Updates: */ /* - V01.00.01 - 2020-12-14 - Corrected view name */ /* - V01.00.00 - 2020-12-02 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D7;1623832997;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9867;CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D7] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP42' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP42' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP42' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_D7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP42' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_D7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_Test_G4;1626645038;V ;VIEW;1853;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G3;1627569282;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_RefCDPCompanyCodeDriver_WREF0;1628181196;V ;VIEW;2613;/**/ /* View: V_RefCDPCompanyCodeDriver_WREF0 */ /**/ /* =*/ /* V01.00.03 2022-11-29 Yannick Sigwalt GS/BDD1 & Patrik Just CI/DAV2.3 */ /* This view provides the necessary Company Codes for Cost Driver Planning application */ /* Restriction: */ /* Usage for Cost Driver Planning application only */ /* Changes: */ /* V01.00.03 - Added Filter on LoadEndDate when Querying [MEAV_DataCORE_CSC1].[DataCOREGenericParameter_WREFM_MF_L] */ /* V01.00.02 - reworked view to use parameter maintained in FBI-MDS */ /* V01.00.01 - Connect filter list with [MEAV_DataCORE_CSC1].[DataCOREGenericParameter_WREFM] */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CompanyCode_V1_IDIM1;1629509134;V ;VIEW;1851;/**/ /* View: V_CompanyCode_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-30 Michal Erdman */ /* This view provides Company Code with currency information */ /* Data.CORE Outgoing Interface #0220 https://inside-docupedia.bosch.com/confluence/x/hA2ehQ */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_G7;1636461154;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_G7 */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G0;1639833054;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G0] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPOE' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G0_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G4;1643569339;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G4 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostActual_O2;1644181253;V ;VIEW;8583;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 23.11.2022 15:52:06 */ /**/ /**/ /* View: V_INTF_CDP_Costs_FACT_CostActual_O2 */ /**/ /* = */ /* V01.00.00 2022-11-23 Jakub Kozlowski */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0068 https://inside-docupedia.bosch.com/confluence/x/n5KPWw */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Creation */ /* = */
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_MaterialGroup_M2;1645509191;V ;VIEW;1873;/**/ /* View: V_INTF_MD_MaterialGroup_M2 */ /**/ /* = */ /* V01.00.01 2022-05-20 Yannick Sigwalt GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of material group reference data to Optravis */ /* Restrictions: */ /* - only includes material group descriptions in English language */ /* - only includes material groups which have status 40 or 49 (Released or Discontinuation) */ /* Changes: */ /* V01.00.01 2022-05-20 Corrected name of queried table */ /* V01.00.00 2020-04-15 Initial version */ /* = */
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_GK;1652461211;V ;VIEW;7486;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_GK */ /**/ /* =*/ /* V01.00.01 2022-05-18 Yannick Sigwalt GS/BDD2 & Stephan Wund GS/BDD2 */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Corrected Coalesce for FiscalYear and Period */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_D7 */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ErrorReporting_WBSElementSettlementRules001_V1_MFCTS;1653997369;V ;VIEW;2418;/**/ /* View: V_ErrorReporting_WBSElementSettlementRules001_V1_MFCTS */ /**/ /* =*/ /* V01.00.00 2023-06-30 Philipp Staiger GS/BDD1 */ /* View implements the error reporting for RnD Analysis SettlementRules */ /* Data.CORE Outgoing Interface #0342 https://inside-docupedia.bosch.com/confluence/x/jxeVtQ */ /* Restriction: */ /* - none */ /* Update: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G1;1655833111;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9867;CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G1] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP45' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G1_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_Test_G4_DemoSystem;1658645152;V ;VIEW;3683;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G5;1659569396;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G5 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_O2;1660181310;V ;VIEW;12360;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 28.11.2022 13:42:17 */ /**/ /**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_O2 */ /**/ /* */ /* V01.02.02 2022-11-25 Jakub Kozlowski */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* Implemented Soft Rules */ /* Debit Credit & Statistical indicator */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.02.02 - Created */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefMTDYTD_V1_IREF0;1665493062;V ;VIEW;1234;/**/ /* View: V_RefMTDYTD_V1_IREF0 */ /**/ /**/ /* V01.00.01 - 2020-07-16 - Tatjana Derdus CI/DAV2.3 */ /* Hard-coded reference view for KPI naming in reporting */ /* Update: */ /* - V01.00.00: 2018-10-10 - SZA2SH - Initial version */ /* - V01.00.01: 2020-07-16 - DTD7FE - Renamed view & moved to scheme INFI_Costs_SSAS_CSC2 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G2;1671833168;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G2] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP72' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP72' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP72' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G2_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP72' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G2_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_Test_G5;1674645209;V ;VIEW;1853;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_G6;1675569453;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_G6 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_P06;1676181367;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;6506;"/**/ /* V01.00.01 - 2022-11-28 Ilja Frolov GS/BDD1 & Yannick Sigwalt GS/BDD2 */ /* Fact View for Costs Application - Plan Cost from CDP */ /* ##FBI-Interface-0000000145 https://inside-docupedia.bosch.com/confluence/x/eJGcZg */ /* This Function consumes the followoing soft rules */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - 01.00.01 Bugfix added mapping for non conform CostCenter and CostElement */ /* - 01.00.00 Creation */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_P06 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment for Testing Purpose */ --DECLARE @YearCreation as int = 2021; --DECLARE @Prioritization as bit = 0; /* End Uncomment for Testing Purpose */ With cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccentdi_bs.[DimensionID], 0) as [CostCenterDimId] -- ,cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc_ws.[DebitCreditCode], '_', N'0', '_',N'0'), '0') as [JunkDimID] ,(pc_ws.[FiscalYear]*1000 + pc_ws.[Period]) as [PostingPeriodYearId] ,pc_ws.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,N'EUR' as [ControllingAreaCurrencyCode] ,cast(pc_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,N'0000000000000000000000' as [PartnerObjectId] ,0 as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,N'CDP' as [SourceSystem] ,pc_ws.[COBusinessTransaction] as [COBusinessTransaction] ,NULL as [ValueType] ,sdi_bs.[DimensionId] as [ScenarioId] ,pc_ws.[FixedValueCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,(pc_ws.[TotalValueCOAreaCurrency] - pc_ws.[FixedValueCOAreaCurrency]) as [VariableAmountCOAreaCurrency] ,pc_ws.[FixedValueObjectCurrency] as [FixedAmountObjectCurrency] ,(pc_ws.[TotalValueObjectCurrency] - pc_ws.[FixedValueObjectCurrency]) as [VariableAmountObjectCurrency] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ FROM [RAWV_COOM_CSC1].[PlanCosts_WLNK0_P06] pc_wl inner join [RAWV_COOM_CSC1].[PlanCosts_WSATM_P06_X] pc_ws on pc_ws.[PlanCosts_HK] = pc_wl.[PlanCosts_HK] and pc_ws.[FiscalYear] = @YearCreation and pc_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = pc_wl.[CostCenter_HK] inner join [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh on at_wh.[ActivityType_HK] = pc_wl.[ActivityType_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc_wl.[CostElementByControllingArea_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pc_wl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent on v_sr_ccentnc2ccent.[CostCenter_HK] = ccent_wh.[CostCenter_HK] --#FBI-SR-000000069 left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] inner join [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce on cenc2ce.CostElementNonConform_HK = cebca_wh.[CostElementByControllingArea_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_whc on cebca_whc.CostElementByControllingArea_HK = cenc2ce.CostElementMaster_HK left join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_whc.[CostElementByControllingArea_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc_ws.[FiscalYear] and cte_prio.[Scenario] = s_wh.[Scenario_BK] and cte_prio.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = ccent_wh.[CostCenterID_BK] and N'CDP' like cte_prio.[SourceSystem]"
INFM_CONFDIM_CSC1;10;INFormation Mart;DimFiscalYearPeriod;1680725040;V ;VIEW;754;/**/ /* View: DimFiscalYearPeriod */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G3;1687833225;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G3] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP79' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP79' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP79' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G3_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP79' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G3_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_Dummy;1689213218;V ;VIEW;1913;/**/ /* View: V_SparePart_IDIM1_Dummy */ /**/ /*=*/ /* V01.02.00 - 2023-03-19 Tatjana Derdus CI/DAV2.3 */ /* SpareParts dimension created for the use case of reporting on maintenance costs */ /* Restrictions: */ /* - Only contains dummy records per Language Code */ /* Updates: */ /* - V01.02.00 - 2021-03-19 - Added MaterialGroup, MaterialGroupDescription, TermCode, TermCodeDescription */ /* - V01.01.00 - 2021-03-09 - Adjusted to use reference view for LanguageCode */ /* - V01.00.00 - 2020-12-02 - Initial version */ /*=*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_Test_G6;1690645266;V ;VIEW;1853;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_S3;1691569510;V ;VIEW;1593;/**/ /* View: V_INTF_MD_OrderReason_S3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G4;1703833282;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G4] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP81' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_OrderReason_SL;1707569567;V ;VIEW;1590;/**/ /* View: V_INTF_MD_OrderReason_SL */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE */ /* Interface view for transfer of order reason reference data to Optravis */ /* Data.CORE Outgoing Interface #0085 https://inside-docupedia.bosch.com/confluence/x/-6GHYw */ /* Restrictions: */ /* - only includes order reason description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version, copied from V_INTF_MD_OrderReason_G0 V01.00.00 */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G5;1719833339;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G5] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP87' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP87' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP87' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP87' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G5_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_B2;1723569624;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_B2 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_One_ECU_EVOB_CSC1;115;INFormation Mart as Interface;V_INTF_One_ECU_EVOB_REF_ExchangeRates;1724181538;V ;VIEW;2113;/**/ /* View: V_INTF_One_ECU_EVOB_REF_ExchangeRates */ /**/ /* = */ /* V01.00.00 2022-12-12 Ilja Frolov GS/BDO1 */ /* This view delivers the exchange rates from X to EURO to One ECU-EVOB */ /* Data.CORE Outgoing Interface #0297 https://inside-docupedia.bosch.com/confluence/x/h0Vol */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_GLPCA_S3;1729597400;V ;VIEW;9301;/**/ /* View: V_INTF_PNL_FACT_GLPCA_S3 */ /**/ /**/ /* V01.00.04 2021-07-26 Patrik Just CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* This view is to provide EC-PCA transaction data from GLPCA table for source system */ /* Outgoing Interface #0057 https://inside-docupedia.bosch.com/confluence/x/e8J9Vg */ /* Update: */ /* - 01.00.04: Removed Filter on ProfitCenter Status = 40 */ /* - 01.00.03: Update ProfitCenter selection due to new Satellite */ /* - 01.00.02: Change ProfitCenter filter condition: Remove end date 99999-12-31 */ /* - 01.00.01: [ECPCA_ItemToAccount_WLNK0] by [ECPCA_ItemToGLAccount_WLNK0] */ /* - 01.00.00: initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_D4;1731901637;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;18204;"/**/ /* V01.04.03 2023-05-30 Yannick Sigwalt GS/BDD1 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* #FBI-SR-000000068 https://inside-docupedia.bosch.com/confluence/x/R2V2cQ BT - Select plan records with TransactionCurrency = Controlling Area */ /* #FBI-SR-000000075 https://inside-docupedia.bosch.com/confluence/x/DhvbdQ Plan/CF Data source System Prioritization */ /* Update: */ /* - V01.04.03 - removal of #FBI-SR-000000068 */ /* - V01.04.02 - Corrected issue after model change */ /* - V01.04.01 - Performance changes */ /* - V01.04.00 - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - Reimplemented #FBI-SR-000000068 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_D4 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0 ; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) usrcoomsi -- /* Implementation of #FBI-SR-000000068 */ --where pcp_ws.[CurrencyCodeTransactionCurrency] in ( Select distinct ca_ws.[CurrencyCode] -- from [RAWV_RB_CSC1].[ControllingArea_WHUB0] ca_wh -- inner join [RAWV_RB_CSC1].[ControllingArea_WSAT0_D4_L] ca_ws -- on ca_ws.[ControllingArea_HK] = ca_wh.[ControllingArea_HK] -- and ca_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' -- where ca_wh.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] -- ) UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator ,usrcoomsi.[StatisticalIndicator] as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] and ss_prio.[Scenario] = pc.[Scenario_BK] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 = 1 and ( ( @Prioritization = 1 and ss_prio.[SourceSystem] = pc.[SourceSystem]) OR @Prioritization = 0 )"
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ErrorReporting_WBSElementActivityType001_V1_MFCT;1733997654;V ;VIEW;2462;/**/ /* View: V_ErrorReporting_WBSElementActivityType001_V1_MFCT */ /**/ /* =*/ /* V01.00.00 2023-06-06 Philipp Staiger GS/BDD1 */ /* View implements the error reporting for RnD Analysis ActivityType */ /* Data.CORE Outgoing Interface #0342 https://inside-docupedia.bosch.com/confluence/x/jxeVtQ */ /* Restriction: */ /* - none */ /* Update: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G6;1735833396;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9863;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G6] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP99' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP99' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP99' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G6_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP99' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G6_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_C3;1739569681;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_C3 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G0;1740181595;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G0 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_SSAS_AnonymizeRBEFData_V2_Backup;1744373629;TF;SQL_TABLE_VALUED_FUNCTION;3049;"/* =*/ /* V01.00.05 - 2022-02-22 - Waldemar Kessler CI/BTM-AC1 */ /* This function does anonymize data for the purposes on Costs Application DemoSystems */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version */ /* =*/ CREATE FUNCTION [INFI_Costs_SSAS_CSC2].[ufn_SSAS_AnonymizeRBEFData_V2] ( -- Add the parameters for the function here @StringToBeAnonymized NVARCHAR(100) ) RETURNS @table TABLE ( -- Add the column definitions for the TABLE variable here StringAnonymized NVARCHAR(100) ) AS BEGIN -- Declare the return variable here DECLARE @StringAnonymized nvarchar(100) DECLARE @Tokens table (OriginalString nvarchar(100), AnonymizedString nvarchar(100) ) IF CHARINDEX ('ArjP',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('ArjP', 'XxP'); IF CHARINDEX ('RBEF',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('RBEF', 'XxP'); IF CHARINDEX ('Aj',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('Aj', 'Xx'); IF CHARINDEX ('983',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('983', 'XxP'); IF CHARINDEX ('Aranjuez',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('Aranjuez', 'XxP'); IF CHARINDEX ('EB-ES',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('EB-ES', 'Xx-YY'); IF CHARINDEX ('GS/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('GS/', 'Xx/'); IF CHARINDEX ('CI/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('CI/', 'Xx/'); IF CHARINDEX ('M/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ('M/', 'Xx/'); /*Loop through the string to be anonymized, for each entry which is relevant to be anonymized in @Token table*/ --Select @TokenCounter=count(1) from @Tokens --SET @i = 1 --SET @StringAnonymized = @StringToBeAnonymized --WHILE @i <= @TokenCounter --BEGIN -- SELECT TOP 1 -- @StringAnonymized = -- REPLACE(@StringAnonymized,OriginalString,AnonymizedString) -- FROM @Tokens -- WHERE Id=@i AND -- CHARINDEX(OriginalString,@StringToBeAnonymized) >0 --SET @i = @i + 1; --END; --SET @StringAnonymized = IIF(@StringAnonymized IS NULL, @StringToBeAnonymized, @StringAnonymized ); SELECT TOP 1 @StringAnonymized = REPLACE(@StringToBeAnonymized,OriginalString,AnonymizedString) FROM @Tokens WHERE CHARINDEX(OriginalString,@StringToBeAnonymized) >0 SET @StringAnonymized = IIF(@StringAnonymized IS NULL, @StringToBeAnonymized, @StringAnonymized ); INSERT INTO @table (StringAnonymized) SELECT @StringAnonymized RETURN END"
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_WBSElementActivityTypeActual001;1749997711;P ;SQL_STORED_PROCEDURE;15098;"/* =*/ /* V01.00.01 2023-07-06 Philipp Staiger GS/BDD1 */ /* This procedure is used to test the validity of ActivityTypes for RnD Analysis Cost Actual data. */ /* Test Case checks if for a relevant WBS Element an incorrect ActivityType is used. */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case */ /* execution. */ /* Implemented Soft Rules */ /* Convert Period >=012 to 012 */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg */ /* Update: */ /* V01.00.01 - Added additional output columns */ /* - Switched to test case specific base table */ /* V01.00.00 - Initial version */ /* =*/ CREATE PROCEDURE MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_WBSElementActivityTypeActual001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) AS BEGIN /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem NVARCHAR(15) = N'SAPP45' --DECLARE @SourceSystemVar NVARCHAR(5) = N'G1' --DECLARE @Usecase NVARCHAR(50) = N'AL2_MERM_RnDTesting_PDM' --DECLARE @TestCase NVARCHAR(50) = N'RnDTest_WBSElementActivityTypeActual001' --DECLARE @TargetDataBase NVARCHAR(100) = 'FBI_CORE_CORE_D' --DECLARE @TargetSchema NVARCHAR(256) = '' --DECLARE @TargetTable NVARCHAR(256) = '' --DECLARE @DeltaTimestampFrom DATETIME2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo DATETIME2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId BIGINT = 113 --DECLARE @ProcessStepId BIGINT = 790 --DECLARE @EntityId BIGINT = 124 --DECLARE @AuditTrailId BIGINT = -2 --DECLARE @ProcessStatusMessage NVARCHAR(4000) = null --DECLARE @RowsRead INT --DECLARE @RowsInserted INT --DECLARE @RowsUpdated INT --DECLARE @RowsDeleted INT --DECLARE @ErrorSeverity INT --DECLARE @ErrorState INT --DECLARE @ErrorProcedure NVARCHAR(128) --DECLARE @ErrorLine INT /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel INT = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnDTest_WBSElementSettlementRulesActual001]'; DECLARE @TestedElement NVARCHAR(100) = N'WBSElement'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FiscalYear INT = IIF(MONTH(GETDATE()) = 1, YEAR(GETDATE()) - 1, YEAR(GETDATE())) DECLARE @FiscalYearPeriod INT = @FiscalYear * 1000 + 1 SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #WBSElementList; CREATE TABLE #WBSElementList ( [SAPSystem] NVARCHAR(15) COLLATE Latin1_General_CS_AS NOT NULL ,[WBSElement_BK] INT NOT NULL ,[MessageId] INT ,[WBSElementDimId] BIGINT ,[PostingYearPeriodId] INT ,[ScenarioId] BIGINT ,[Version] NVARCHAR(3) ,[JunkDimId] NVARCHAR(6) ,[ActivityType] NVARCHAR(6) ,[TotalAmountObjectCurrency] NUMERIC(38, 6) ,[RowId] INT IDENTITY(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)) --Get list of SettlementRule per CostCollector SET @SQL_1 = ( SELECT CONCAT(' INSERT INTO #WBSElementList ([SAPSystem] ,[WBSElement_BK] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency]) SELECT wbse_wh.[SAPSystem] AS [SAPSystem] ,wbse_wh.[WBSElement_BK] AS [WBSElement_BK] ,12 AS [MessageId] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) AS [WBSElementDimensionId] ,CAST(cocali_ws.[FiscalYear] * 1000 + IIF(CAST(cocali_ws.[Period] AS INT) >= 12, 12, CAST(cocali_ws.[Period] AS INT)) AS INT) AS [PostingPeriodYearId] ,CAST(cocali_ws.[Period] AS INT) AS [ScenarioId] ,''ACT'' AS [Version] ,COALESCE( CONCAT( usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', COALESCE(LEFT(ccoll_wh.[CostCollectorObject_BK], 2), N''0'')) , ''0'') AS [JunkDimId] ,at_wh_po.[ActivityType_ID_BK] AS [ActivityType] ,SUM(cocali_ws.[ObjectTotalAmount]) AS [TotalAmountObjectCurrency] FROM [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_',@SourceSystemVar,'_X] wbsea_ws ON wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] AND wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND wbsea_ws.[FunctionalArea] = ''0500'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl ON ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh ON ccoll_wh.[CostCollector_HK] = ccoll2wbse_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_',@SourceSystemVar,'] coca2bo_wl ON coca2bo_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_',@SourceSystemVar,'] cocali_wh ON cocali_wh.[COCostActualLineItem_HK] = coca2bo_wl.[COCostActualLineItem_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_',@SourceSystemVar,'_L] cocali_ws ON cocali_ws.[COCostActualLineItem_HK] = cocali_wh.[COCostActualLineItem_HK] AND cocali_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws.[FiscalYear] >= ',@FiscalYear,' INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WLNK0_',@SourceSystemVar,'] cocali2po_wl ON cocali2po_wl.[COCostActualLineItem_HK] = cocali_wh.[COCostActualLineItem_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.[CostCollector_HK] = cocali2po_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl_po ON ccoll2at_wl_po.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_po ON at_wh_po.[ActivityType_HK] = ccoll2at_wl_po.[ActivityType_HK] CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (cocali_ws.[DebitCreditCode], cocali_ws.[COBusinessTransaction]) usrcoomdci CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (cocali_ws.[ValueType]) usrcoomsi LEFT OUTER JOIN [',@TargetDataBase,'].[BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs ON wbsedi_bs.[WBSElement_HK] = wbse_wh.[WBSElement_HK] ')); SET @SQL_2 = ( SELECT ' WHERE 1 = 1 AND at_wh_po.[ActivityType_ID_BK] NOT IN ( ''STE'' ,''STE1'' ,''STE2'' ,''STE3'' ,''STE4'' ,''STE5'' ,''STE6'' ,''STE7'' ,''STE8'' ,''STE9'' ,''STE10'' ,''STE11'' ,''STE12'' ,''STE13'' ,''STE14'' ,''STE15'' ,''STE16'' ,''STE17'' ,''STE18'' ,''STE19'' ,''STE20'' ,''STE21'' ,''STE22'' ,''STE23'' ,''STE24'' ,''STE25'' ,''STE26'' ,''STE27'' ,''STE28'' ,''STE29'' ,''DSSTE'' ) GROUP BY wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) ,CAST(cocali_ws.[FiscalYear] * 1000 + IIF(CAST(cocali_ws.[Period] AS INT) >= 12, 12, CAST(cocali_ws.[Period] AS INT)) AS INT) ,CAST(cocali_ws.[Period] AS INT) ,COALESCE( CONCAT( usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', COALESCE(LEFT(ccoll_wh.[CostCollectorObject_BK], 2), N''0'')) , ''0'') ,at_wh_po.[ActivityType_ID_BK] '); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1, @SQL_2)); IF(@DebugLevel >= 12 ) BEGIN PRINT ' ='; PRINT CAST(@SQL AS NTEXT) PRINT ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (SELECT @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'S' --Success ,0 AS [MessageId] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,[WBSElement_BK] ,N'W' --Warning ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency] ,@StoredProcedure from #WBSElementList END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'E' --Success ,999 AS [MessageId] ,@StoredProcedure IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage DROP TABLE IF EXISTS #WBSElementList; RETURN @ReturnProcessStatusNumber END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G7;1751833453;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9867;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G7] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPCR' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPCR' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPCR' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPCR' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G7_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G0;1755569738;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G0 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Country;1755869322;V ;VIEW;1679;/**/ /* View: V_INTF_PNL_DIM_Country */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G1;1756181652;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G1 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_GLPCT_G0_Alpha;1756741511;V ;VIEW;7443;/**/ /* V00.00.02B 2021-10-22 Yannick Sigwalt GS/BDD2 */ /* This view is to provide EC-PCA Totals transaction data from GLPCT table for G0 sourc */ /* This view is based on the not finalized requirement of page: */ /* https://inside-docupedia.bosch.com/confluence/x/xT_kYQ */ /* To be Data.CORE Outgoing Interface #0157 https://inside-docupedia.bosch.com/confluence/x/W9bMc */ /* Restriction: */ /* This view is not to be used on production, it is a prototyp!! */ /* A Filter on the NWC GL Accounts is not yet implemented */ /* Update: */ /* V00.00.02B Changed composition of SOURCESYSTEM + AccountGroup */ /* V00.00.01B added AccountGroup + */ /**/
INFM_CONFDIM_CSC1;10;INFormation Mart;DimLanguageCode;1760777380;V ;VIEW;512;/**/ /* View: DimLanguageCode */ /**/
MERM_CORE_Testing_CSC1;128;;usp_CORETesting_RnDTest_WBSElementActivityTypePlan001;1765997768;P ;SQL_STORED_PROCEDURE;15230;"/* =*/ /* V01.00.01 2023-07-06 Philipp Staiger GS/BDD1 */ /* This procedure is used to test the validity of ActivityTypes for RnD Analysis Cost Plan data. */ /* Test Case checks if for a relevant WBS Element an incorrect ActivityType is used. */ /* It populates [MERM_CORE_Testing_CSC1].[TestCaseExecutionResultSnapshot_MFCTS] with results of test case */ /* execution. */ /* Implemented Soft Rules */ /* Convert Period >=012 to 012 */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg */ /* Update: */ /* V01.00.01 - Added additional output columns */ /* - Switched to test case specific base table */ /* V01.00.00 - Initial version */ /* =*/ CREATE PROCEDURE MERM_CORE_Testing_CSC1.usp_CORETesting_RnDTest_WBSElementActivityTypePlan001 ( @DeltaTimestampFrom datetime2,@DeltaTimestampTo datetime2,@SourceSystem nvarchar(15),@SourceSystemVar nvarchar(5),@Usecase nvarchar(50),@TestCase nvarchar(50),@TargetDataBase nvarchar(100),@TargetSchema nvarchar(256),@TargetTable nvarchar(256),@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) AS BEGIN /* Start definition of Parameter for test execution */ /* Comment/Uncomment for testing Purposes*/ --DECLARE @SourceSystem NVARCHAR(15) = N'SAPPOE' --DECLARE @SourceSystemVar NVARCHAR(5) = N'G0' --DECLARE @Usecase NVARCHAR(50) = N'AL2_MERM_RnDTesting_PDM' --DECLARE @TestCase NVARCHAR(50) = N'RnDTest_WBSElementActivityTypePlan001' --DECLARE @TargetDataBase NVARCHAR(100) = 'FBI_CORE_CORE_D' --DECLARE @TargetSchema NVARCHAR(256) = '' --DECLARE @TargetTable NVARCHAR(256) = '' --DECLARE @DeltaTimestampFrom DATETIME2 = '2023-03-13 07:54:58.6159860' --DECLARE @DeltaTimestampTo DATETIME2 = '2023-03-13 12:29:26.2008111' --!!! Very Important to test with valid interval and not valid until 2999-12-31 --DECLARE @LoadBatchId BIGINT = 113 --DECLARE @ProcessStepId BIGINT = 790 --DECLARE @EntityId BIGINT = 124 --DECLARE @AuditTrailId BIGINT = -2 --DECLARE @ProcessStatusMessage NVARCHAR(4000) = null --DECLARE @RowsRead INT --DECLARE @RowsInserted INT --DECLARE @RowsUpdated INT --DECLARE @RowsDeleted INT --DECLARE @ErrorSeverity INT --DECLARE @ErrorState INT --DECLARE @ErrorProcedure NVARCHAR(128) --DECLARE @ErrorLine INT /* End Comment/Uncomment for testing Purposes*/ --@DebugLevel = 0 -> no debug information --@DebugLevel = 1 -> Basic Printout --@DebugLevel = 9 -> additionally display of SQL -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -- !!!! keep in mind that DebugLevel must be reseted to 0 if the Procedure is to write data in target table!!!! -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! DECLARE @DebugLevel INT = 0; -- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! /* End definition of Parameter for test execution */ DECLARE @ReturnProcessStatusNumber INT = 0; DECLARE @StoredProcedure NVARCHAR(256) - N'[MERM_CORE_Testing_CSC1].[usp_CORETesting_RnDTest_WBSElementSettlementRulesActual001]'; DECLARE @TestedElement NVARCHAR(100) = N'WBSElement'; DECLARE @LoadTimestamp DATETIME2(2) = sysutcdatetime(); DECLARE @Counter INT ; DECLARE @YearMonth INT ; DECLARE @rowCounter INT = 0; DECLARE @FiscalYear INT = IIF(MONTH(GETDATE()) = 1, YEAR(GETDATE()) - 1, YEAR(GETDATE())) DECLARE @FiscalYearPeriod INT = @FiscalYear * 1000 + 1 SET @StoredProcedure = (SELECT CONCAT( '[',OBJECT_SCHEMA_NAME(@@PROCID) ,'].[' + OBJECT_NAME(@@PROCID) ,']')) SET @RowsRead = 0; SET @RowsInserted = 0; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_1 NVARCHAR(MAX) = '' DECLARE @SQL_2 NVARCHAR(MAX) = '' DROP TABLE IF EXISTS #WBSElementList; CREATE TABLE #WBSElementList ( [SAPSystem] NVARCHAR(15) COLLATE Latin1_General_CS_AS NOT NULL ,[WBSElement_BK] INT NOT NULL ,[MessageId] INT ,[WBSElementDimId] BIGINT ,[PostingYearPeriodId] INT ,[ScenarioId] BIGINT ,[Version] NVARCHAR(3) ,[JunkDimId] NVARCHAR(6) ,[ActivityType] NVARCHAR(6) ,[TotalAmountObjectCurrency] NUMERIC(38, 6) ,[RowId] INT IDENTITY(1,1) NOT NULL ); /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : build up sql for test case --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL = CAST('' AS NVARCHAR(MAX)) --Get list of SettlementRule per CostCollector SET @SQL_1 = ( SELECT CONCAT(' INSERT INTO #WBSElementList ([SAPSystem] ,[WBSElement_BK] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency]) SELECT wbse_wh.[SAPSystem] AS [SAPSystem] ,wbse_wh.[WBSElement_BK] AS [WBSElement_BK] ,12 AS [MessageId] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) AS [WBSElementDimensionId] ,CAST((pcs_ws.[FiscalYear] * 1000 + IIF(CAST(pcs_ws.[Period] AS INT) >= 12, 12, CAST(pcs_ws.[Period] AS INT))) AS INT) AS [PostingYearPeriodId] ,sdi_wh.[DimensionId] AS [ScenarioId] ,pv_wh.[Version_ID_BK] AS [Version] ,CONCAT(usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', ''0'') AS [JunkDimId] ,at_wh_po.[ActivityType_ID_BK] AS [ActivityType] ,SUM(pcs_ws.[TotalValueObjectCurrency]) AS [TotalAmountObjectCurrency] FROM [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElement_WHUB0] wbse_wh INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[WBSElementAttribute_WSAT0_',@SourceSystemVar,'_X] wbsea_ws ON wbsea_ws.[WBSElement_HK] = wbse_wh.[WBSElement_HK] AND wbsea_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND wbsea_ws.[FunctionalArea] = ''0500'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToWBSElement_WLNK0] ccoll2wbse_wl ON ccoll2wbse_wl.[WBSElement_HK] = wbse_wh.[WBSElement_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh ON ccoll_wh.[CostCollector_HK] = ccoll2wbse_wl.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl ON pcs_wl.[CostCollector_PlannedObject_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_',@SourceSystemVar,'_X] pcs_ws ON pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] AND pcs_ws.[FiscalYear] = ',@FiscalYear,' AND pcs_ws.[ValueType] IN (N''01'',N''02'',N''10'') AND pcs_ws.[Period] <= 12 AND pcs_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh ON pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] AND pv_wh.[Version_ID_BK] <> ''000'' INNER JOIN [',@TargetDataBase,'].[BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl ON pv2s_bl.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh ON s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] INNER JOIN [',@TargetDataBase,'].[BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_wh ON sdi_wh.[Scenario_HK] = s_wh.[Scenario_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner ON ccoll_wh_partner.[CostCollector_HK] = pcs_wl.[CostCollector_PartnerObject_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl_po ON ccoll2at_wl_po.[CostCollector_HK] = ccoll_wh_partner.[CostCollector_HK] INNER JOIN [',@TargetDataBase,'].[RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh_po ON at_wh_po.[ActivityType_HK] = ccoll2at_wl_po.[ActivityType_HK] CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode], pcs_ws.[COBusinessTransaction]) usrcoomdci CROSS APPLY [',@TargetDataBase,'].[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) usrcoomsi LEFT OUTER JOIN [',@TargetDataBase,'].[BUSV_RB_CSC1].[WBSElementDimensionId_BSATC_XX_X] wbsedi_bs ON wbsedi_bs.[WBSElement_HK] = wbse_wh.[WBSElement_HK] ')); SET @SQL_2 = ( SELECT ' WHERE 1 = 1 AND at_wh_po.[ActivityType_ID_BK] NOT IN ( ''STE'' ,''STE1'' ,''STE2'' ,''STE3'' ,''STE4'' ,''STE5'' ,''STE6'' ,''STE7'' ,''STE8'' ,''STE9'' ,''STE10'' ,''STE11'' ,''STE12'' ,''STE13'' ,''STE14'' ,''STE15'' ,''STE16'' ,''STE17'' ,''STE18'' ,''STE19'' ,''STE20'' ,''STE21'' ,''STE22'' ,''STE23'' ,''STE24'' ,''STE25'' ,''STE26'' ,''STE27'' ,''STE28'' ,''STE29'' ,''DSSTE'' ) GROUP BY wbse_wh.[SAPSystem] ,wbse_wh.[WBSElement_BK] ,COALESCE(wbsedi_bs.[WBSElementDimensionId], 0) ,CAST((pcs_ws.[FiscalYear] * 1000 + IIF(CAST(pcs_ws.[Period] AS INT) >= 12, 12, CAST(pcs_ws.[Period] AS INT))) AS INT) ,sdi_wh.[DimensionId] ,pv_wh.[Version_ID_BK] ,CONCAT(usrcoomdci.[DebitCreditCode], ''_'', usrcoomsi.[StatisticalIndicator], ''_'', ''0'') ,at_wh_po.[ActivityType_ID_BK] '); /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Execute Testcase and collect result --------------------------------------------------------------------------------------------------------------------------- */ BEGIN TRY -- BEGIN TRAN SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_1, @SQL_2)); IF(@DebugLevel >= 12 ) BEGIN PRINT ' ='; PRINT CAST(@SQL AS NTEXT) PRINT ' ='; END EXECUTE sp_executesql @SQL; SET @rowCounter = (SELECT @@ROWCOUNT); -- COMMIT TRAN /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : create log entry/entries --------------------------------------------------------------------------------------------------------------------------- */ SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || TestCase executed successfully with ', FORMAT(@rowCounter,'#,###', 'de-de') ,' records - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; IF (@rowCounter = 0) BEGIN INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'S' --Success ,0 AS [MessageId] ,@StoredProcedure END ELSE BEGIN /* Every single WBS Element will be logged in the result table/Fact */ INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,[SAPSystem] ,[RowId] ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,1 ,[WBSElement_BK] ,N'W' --Warning ,[MessageId] ,[WBSElementDimId] ,[PostingYearPeriodId] ,[ScenarioId] ,[Version] ,[JunkDimId] ,[ActivityType] ,[TotalAmountObjectCurrency] ,@StoredProcedure from #WBSElementList END --SET @RowsRead = @RowsRead + @rowCounter; --SET @RowsInserted = @RowsInserted + @rowCounter ; END TRY BEGIN CATCH PRINT 'In CATCH Block' IF(@@TRANCOUNT > 0) ROLLBACK TRAN; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage , '|| ', ERROR_MESSAGE(), ' || Error Occured during processing of TestCase <', @TestCase,'> - ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); SET @ErrorSeverity = 31; SET @ErrorState = 9; SET @ErrorProcedure = @StoredProcedure ; SET @ReturnProcessStatusNumber = 9; INSERT INTO [MERM_CORE_Testing_CSC1].[RnDTest_WBSElementActivityType001_MFCTS] ([UseCase_PK] ,[TestCase_PK] ,[SourceSystem_PK] ,[RowId] ,[LoadDate] ,[AuditId] ,[Element] ,[FailureCount] ,[Value_BK] ,[ResultCode] ,[MessageId] ,[StoredProcedure]) SELECT @Usecase ,@TestCase ,@SourceSystem ,1 ,@LoadTimestamp ,@AuditTrailId ,@TestedElement ,0 ,CAST(NULL AS NVARCHAR(100)) AS [Value_BK] ,N'E' --Success ,999 AS [MessageId] ,@StoredProcedure IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage; THROW; -- raise error to the client END CATCH; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; SET @ProcessStatusMessage = (SELECT CONCAT(@ProcessStatusMessage ,' || Finished processing of stored procedure ',FORMAT(SYSUTCDATETIME(),'yyyy-MM-dd hh:mm:ss.fffffff'))); IF(@DebugLevel >= 1 ) PRINT @ProcessStatusMessage DROP TABLE IF EXISTS #WBSElementList; RETURN @ReturnProcessStatusNumber END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G9;1767833510;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9865;CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_G9] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP74' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G9_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP74' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G9_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP74' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_G9_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP74' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_G9_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G1;1771569795;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G1 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G2;1772181709;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G2 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G5_Yannick;1777701681;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;18108;/**/ /* V01.04.01 2022-08-04 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G5_Yannick] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcp_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcp_ws.[ValueType] UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcs_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcs_ws.[ValueType] ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_B2;1781125636;V ;VIEW;10356;/**/ /* View: V_INTF_MonthlySalesTransactions_B2 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G0;1781997825;V ;VIEW;11842;"/**/ /* View: V_INTF_MonthlySalesTransactions_G0 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G2;1787569852;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G2 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G3;1788181766;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G3 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G5_Yannick2;1793701738;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;18169;/**/ /* V01.04.01 2022-08-04 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G5_Yannick2] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] ,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator --,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] --,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci -- ON rdci.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] -- AND rdci.[COBusinessTransaction] = pcp_ws.[COBusinessTransaction] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s -- ON rdci_s.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] -- AND rdci_s.[COBusinessTransaction] IS NULL --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi -- ON rsi.[ValueType] = pcp_ws.[ValueType] UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] ,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator --,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] --,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci -- ON rdci.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] -- AND rdci.[COBusinessTransaction] = pcs_ws.[COBusinessTransaction] --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s -- ON rdci_s.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] -- AND rdci_s.[COBusinessTransaction] IS NULL --LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi -- ON rsi.[ValueType] = pcs_ws.[ValueType] ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join cte_SourceSystem on cte_SourceSystem.[SourceSystem] = ccoll_wh.[SourceSystem_BK] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_PostActivityOutput_O2;1795849810;V ;VIEW;7507;/**/ /* View: V_INTF_CDP_Costs_FACT_PostActivityOutput_O2 */ /**/ /* =*/ /* V01.00.01 2023-01-18 Michal Erdman */ /* This view is to provide CO-OM activity Type Quantities for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #215 https://inside-docupedia.bosch.com/confluence/x/FcJnh */ /* Implemented Soft Rules */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.01: Fixed join to COActivityTypeTotals_WSATM table */ /* - V01.00.00: Initial version copied from V_INTF_CDP_Costs_FACT_PostActivityOutput_G0 */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_ErrorReporting_V1_MFCTS;1795901865;V ;VIEW;2254;/**/ /* View: V_ErrorReporting_V1_MFCTS */ /**/ /* =*/ /* V01.00.01 2023-06-14 Philipp Staiger GS/BDD1 */ /* View implement the error reporting for RnD Analysis */ /* it implements access layer */ /* Data.CORE Outgoing Interface #0342 https://inside-docupedia.bosch.com/confluence/x/jxeVtQ */ /* Restriction: */ /* - none */ /* Update: */ /* V01.00.01 - Added MessagePart columns */ /* V01.00.00 - Initial version */ /* =*/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G0;1797125693;V ;VIEW;10356;/**/ /* View: V_INTF_MonthlySalesTransactions_G0 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_B2;1797997882;V ;VIEW;11790;"/**/ /* View: V_INTF_MonthlySalesTransactions_B2 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G3;1803569909;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G3 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G4;1804181823;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G4 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_A2;1811849867;V ;VIEW;12207;/**/ /* View: V_CostsActualCost_V2_IFCT0_A2 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Urban Martin & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 - Created - copied from V_Costs Actual Cost_V2_IFCT0_D0 V01.00.05, commented out material section */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G1;1813125750;V ;VIEW;10358;/**/ /* View: V_INTF_MonthlySalesTransactions_G1 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_C3;1813997939;V ;VIEW;11788;"/**/ /* View: V_INTF_MonthlySalesTransactions_C3 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G4;1819569966;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G4 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G5;1820181880;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G5 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G0;1820637629;V ;VIEW;8357;"/**/ /* View: V_Equipment_V3_IDIM1_G0 */ /**/ /*=*/ /* V01.02.01 - 2020-10-15 Tatjana Derdus CI/DAV2.3 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-04-29 - Initial version */ /* - V01.01.00 - 2020-06-25 - Add EquipmentCategory, EquipmentCategoryDescription */ /* - V01.02.00 - 2020-09-07 - Remove FunctionalLocation information; Add FunctionalLocationDimId */ /* - V01.02.01 - 2020-10-15 - Add Dummy Record per LanguageCode */ /*=*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_B2;1827849924;V ;VIEW;12240;/**/ /* View: V_CostsActualCost_V2_IFCT0_B2 */ /**/ /**/ /* V01.00.02 - 2023-01-05 Michal Erdman & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model */ /* Copied from V_Costs Actual Cost_V2_IFCT0_G4 V01.00.04 as of 2021-09-03 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* V01.00.02 - Added new version of SR25 */ /* V01.00.01 - 2022-03-02 - restrictions to ValueTypes 03 and 04 */ /* V01.00.00 - 2021-11-02 - initial */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G2;1829125807;V ;VIEW;10358;/**/ /* View: V_INTF_MonthlySalesTransactions_G2 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
MEAM_DataCORE_CSC1;46;MEtA Mart;uspINFMDeltaLoadedByYearMonthCreation;1832094013;P ;SQL_STORED_PROCEDURE;8309;"/* =*/ /* V01.01.01 - 2023-08-09 Yannick Sigwalt GS/BDD1 */ /* Procedure marks a YearMonthCreation has been loaded */ /* Hint: */ /* - This Procedure is to be used by consuming application such as SSAS or */ /* other script creating persistent fact, for instance */ /* Updates: */ /* V01.01.01 - Added Handling of Plan specific satellite */ /* V01.01.00 - Added StartDateTime, EndDateTime and RowsInserted */ /* =*/ create procedure MEAM_DataCORE_CSC1.uspINFMDeltaLoadedByYearMonthCreation ( @SourceSystem varchar(10),@SourceOfData varchar(30),@ConsumerOfData varchar(30),@YearMonthCreation int,@StartDateTime datetime2 = NULL,@EndDateTime datetime2 = NULL,@RowsInserted int = NULL ) as /*---------------------------------------------------------------------------*/ /*-- Declare variable */ /*---------------------------------------------------------------------------*/ DECLARE @ReturnStatus INT; DECLARE @LoadEndDate Datetime2; DECLARE @UpdatedStatus INT; DECLARE @RowsUpdated INT; DECLARE @StatusNumber INT; DECLARE @StatusMessage NVARCHAR(4000); DECLARE @ErrorSeverity INT; DECLARE @ErrorState INT; DECLARE @ErrorProcedure NVARCHAR(128); DECLARE @ErrorLine INT; DECLARE @StartDateTime_upd Datetime2; DECLARE @EndDateTime_upd Datetime2; DECLARE @RowsInserted_upd INT; begin /*---------------------------------------------------------------------------*/ /*-- Set variable initial */ /*---------------------------------------------------------------------------*/ SET @ReturnStatus = 0; SET @LoadEndDate = SYSUTCDATETIME(); /*---------------------------------------------------------------------------*/ /*-- Validate input */ /*---------------------------------------------------------------------------*/ IF ( @SourceSystem is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a SourceSystem ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END IF ( @SourceOfData is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a SourceOfData ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END IF ( @ConsumerOfData is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a ConsumerOfData ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END IF ( @YearMonthCreation is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a @YearMonthCreation ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END /*---------------------------------------------------------------------------*/ /*-- Start Proceeding */ /*---------------------------------------------------------------------------*/ BEGIN TRY IF UPPER(@SourceOfData) LIKE '%PLAN%' BEGIN UPDATE ssbymc_bs set ssbymc_bs.[LoadEndDate] = @LoadEndDate ,ssbymc_bs.[StartDateTime] = @StartDateTime ,ssbymc_bs.[EndDateTime] = @EndDateTime ,ssbymc_bs.[RowsInserted] = @RowsInserted FROM [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] ssbymc_bs inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ss_bh.[SourceSystem_HK] = ssbymc_bs.[SourceSystem_HK] where ssbymc_bs.[LoadEndDate] ='2999-12-31 00:00:00.0000000' and ss_bh.[SourceSystem_BK] = @SourceSystem and ssbymc_bs.[SourceOfData] = @SourceOfData and ssbymc_bs.[ConsumerOfData] = @ConsumerOfData and ssbymc_bs.[YearMonthCreation] = @YearMonthCreation; END ELSE BEGIN UPDATE ssbymc_bs set ssbymc_bs.[LoadEndDate] = @LoadEndDate ,ssbymc_bs.[StartDateTime] = @StartDateTime ,ssbymc_bs.[EndDateTime] = @EndDateTime ,ssbymc_bs.[RowsInserted] = @RowsInserted FROM [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] ssbymc_bs inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ss_bh.[SourceSystem_HK] = ssbymc_bs.[SourceSystem_HK] where ssbymc_bs.[LoadEndDate] ='2999-12-31 00:00:00.0000000' and ss_bh.[SourceSystem_BK] = @SourceSystem and ssbymc_bs.[SourceOfData] = @SourceOfData and ssbymc_bs.[ConsumerOfData] = @ConsumerOfData and ssbymc_bs.[YearMonthCreation] = @YearMonthCreation; END /*---------------------------------------------------------------------*/ /*-- Get statistic information of rows. */ /*-- If DML was successfully executed. */ /*---------------------------------------------------------------------*/ /* Save the return values in local variables before they are cleaned */ SELECT @UpdatedStatus = @@ERROR ,@RowsUpdated = @@ROWCOUNT ; IF (@RowsUpdated = 0) BEGIN SET @ReturnStatus = 2; PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ No settings found for ' PRINT '@ SourceSytem : '+ @SourceSystem PRINT '@ SourceOfData : '+ @SourceOfData PRINT '@ ConsumerOfData : '+ @ConsumerOfData PRINT '@ YearMonthCreation: '+ Cast(@YearMonthCreation as char(20)) PRINT '@--------------------------------------------------------------------------------' PRINT '' END ELSE BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Period ' + cast(@YearMonthCreation as char(8)) + ' marked as loaded ' PRINT '@ SourceSytem : '+ @SourceSystem PRINT '@ SourceOfData : '+ @SourceOfData PRINT '@ ConsumerOfData : '+ @ConsumerOfData PRINT '@--------------------------------------------------------------------------------' PRINT '' END; END TRY BEGIN CATCH /*---------------------------------------------------------------------*/ /*-- Get error information of DML after fail. */ /*---------------------------------------------------------------------*/ SET @ReturnStatus = 8; SELECT @StatusNumber = ERROR_NUMBER() ,@StatusMessage = ERROR_MESSAGE() ,@ErrorSeverity = ERROR_SEVERITY() ,@ErrorState = ERROR_STATE() ,@ErrorProcedure = ERROR_PROCEDURE() ,@ErrorLine = ERROR_LINE() ; /*---------------------------------------------------------------------*/ /*-- If an error occured finish script. No exit with RETURN needed. */ /*---------------------------------------------------------------------*/ END CATCH RETURN @ReturnStatus end"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_A2;1833317841;V ;VIEW;2269;/**/ /* View: V_FactActualCost_D0 */ /**/ /**/ /* V01.00.01 2021-09-24 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PTT */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G5;1835570023;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G5 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Currency_ATTR;1835869607;V ;VIEW;1295;/**/ /* View: V_INTF_PNL_DIM_Currency_ATTR */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResultCostActual_V1_IFCT0_G6;1836181937;V ;VIEW;4988;/**/ /* View: V_PlantResultCostActual_V1_IFCT0_G6 */ /**/ /**/ /* V01.00.01 - 2022-11-25 Yannick Sigwalt GS/BDD1 */ /* Fact view for Plant Result Application - Cost Actual based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0229 - https://inside-docupedia.bosch.com/confluence/x/kdtlhg */ /* Consumed SoftRules */ /* Update: */ /* V01.00.01 - Reworked view to consumed New Persisted Fact instead of Data Vault Model */ /* V01.00.00 - initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G4;1836637686;V ;VIEW;8460;"/**/ /* View: V_Equipment_V3_IDIM1_G4 */ /**/ /*=*/ /* V01.02.01 - 2020-10-15 Tatjana Derdus CI/DAV2.3 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-03-24 - Initial version (Stephan Wund GS/FBI2) */ /* - V01.00.01 - 2020-04-09 - Use PrimaryLanguage Desc for Equipment, SO-Equipment, Func. Location */ /* - V01.01.00 - 2020-06-25 - Add EquipmentCategory, EquipmentCategoryDescription */ /* - V01.02.00 - 2020-09-07 - Remove FunctionalLocation information; Add FunctionalLocationDimId */ /* - V01.02.01 - 2020-10-15 - Add Dummy Record per LanguageCode */ /*=*/"
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_Material_C3;1839501782;V ;VIEW;9045;"/**/ /* View: V_INTF_MD_Material_C3 */ /**/ /* = */ /* V01.02.01B 2021-06-24 Karoline Adler GS/BDO12 & Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of end-of-previous-month material master data to Optravis */ /* Data.CORE Outgoing Interface #0007 https://inside-docupedia.bosch.com/confluence/x/DjFNXQ */ /* Restrictions: */ /* - only includes materials that are linked to CO-PA items */ /* - only includes material descriptions in English language */ /* - only includes ValuationClassIDs where ValuationType equals blank */ /* Changes: */ /* - V01.02.01 2021-06-24 Bugfix (filter on lines where ValuationType/BWTAR equals blank) */ /* - V01.02.00 2021-04-12 Adjusted to use new CO-PA model as a basis */ /* - V01.01.02 2021-03-04 Performance optimization */ /* - V01.01.01 2021-02-11 Bugfix (join of material valuation attributes) */ /* - V01.01.00 2021-02-10 Add Product Hierarchy descriptions; Add field SourceSystem; */ /* Join material valuation attributes via T001W */ /* - V01.00.01 2020-12-10 Fix join with material valuation data; rename plant column */ /* - V01.00.00 Initial version */ /* = */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeCostCenterToFact_V3_IDIM1;1840777665;V ;VIEW;376;/**/ /* View: V_BridgeCostCenterToFact_V3_IDIM1 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_B4;1843849981;V ;VIEW;12201;/**/ /* View: V_CostsActualCost_V2_IFCT0_B4 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Urban Martin & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 - Created - copied from V_Costs Actual Cost_V2_IFCT0_D0 V01.00.05, commented out material section */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G3;1845125864;V ;VIEW;10366;/**/ /* View: V_INTF_MonthlySalesTransactions_G3 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G1;1845998053;V ;VIEW;11786;"/**/ /* View: V_INTF_MonthlySalesTransactions_G1 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
STAG_CORE_F0;82;;V_STAG_COCostPlanManual_F0;1847937905;V ;VIEW;11114;/**/ /* View: V_STAG_COCostPlanManual_F0 */ /**/ /* =*/ /* V01.00.01 2022-03-10 Sanja Mihalic CI/XAD3 */ /* This view is use for loading Plan Data from CORE.Writer into DataVault */ /* This view implements the following Hard Rules */ /* #FBI-DV-HR-000000027 https://inside-docupedia.bosch.com/confluence/display/BID/%23FBI-DV-HR-000000027 */ /* Step 1 - In the case user uploaded several time the same combination, only take the newest combination ! */ /* Step 2 - Get the already loaded data into DV */ /* (Necessary to delete the last loaded data for the defined combination */ /* Step 3 - Prepare the data to be loaded into DV incl. Datatype conversion and data cleansing */ /* Step 4 - Merge altready loaded data and new data to be able to identify correct CDC Status */ /* Update: */ /* V01.00.01 2022-03-10 - Period coulmn from CORE.Writer cut to usual Period */ /* V01.00.00 2021-09-01 - initial */ /* Restriction: */ /* =*/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREPerFactHousekeeping;1847989960;V ;VIEW;1414;/**/ /* View: V_DataCOREPerFactHousekeeping */ /**/ /* =*/ /* V01.00.00 2022-11-02 Yannick Sigwalt GS/BDD1 */ /* This view provide the generic Parameter for range of years to be loaded if new data is coming */ /* Filter on Application, Element to receive the list of Costs PerFacts */ /* Restrictions: */ /* Update: */ /* =*/
MEAM_DataCORE_CSC1;46;MEtA Mart;uspINFMOverrideYearMonthCreation;1848094070;P ;SQL_STORED_PROCEDURE;15892;"/* =*/ /* V01.00.02 - 2023-08-11 Yannick Sigwalt GS/BDD1 */ /* Procedure is used to define which YearMonthCreation must be loaded */ /* Hint: */ /* - at least@SourceSystem, @SourceOfData and @YearMonthCreation */ /* must be provided */ /* - if @ConsumerOfData is empty, then an override entry for all the existing */ /* entries in [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] */ /* Updates: */ /* V01.00.02 - Added Handling of Plan specific satellite */ /* V01.00.01 - Added a check if record already exists in Target Satellite */ /* SourceSystemByYearMonthCreation_BSATM_XX_H prior to insertion */ /* of new record */ /* =*/ create procedure MEAM_DataCORE_CSC1.uspINFMOverrideYearMonthCreation ( @SourceSystem varchar(10),@SourceOfData varchar(30),@ConsumerOfData varchar(30),@YearMonthCreation int ) as /*---------------------------------------------------------------------------*/ /*-- Declare variable */ /*---------------------------------------------------------------------------*/ DECLARE @ReturnStatus INT; DECLARE @LoadDate Datetime2; DECLARE @LoadEndDate Datetime2; DECLARE @InsertStatus INT; DECLARE @RowsInserted INT; DECLARE @RowsInSettings INT; DECLARE @StatusNumber INT; DECLARE @StatusMessage NVARCHAR(4000); DECLARE @ErrorSeverity INT; DECLARE @ErrorState INT; DECLARE @ErrorProcedure NVARCHAR(128); DECLARE @ErrorLine INT; begin /*---------------------------------------------------------------------------*/ /*-- Set variable initial */ /*---------------------------------------------------------------------------*/ SET @ReturnStatus = 0; SET @LoadDate = SYSUTCDATETIME(); SET @LoadEndDate = CAST('2999-12-31' as datetime2); /*---------------------------------------------------------------------------*/ /*-- Validate input */ /*---------------------------------------------------------------------------*/ IF ( @SourceSystem is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a SourceSystem ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END IF ( @SourceOfData is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a SourceOfData ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END IF ( @YearMonthCreation is null) BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ Please provide a @YearMonthCreation ' PRINT '@--------------------------------------------------------------------------------' PRINT '' SET @ReturnStatus = 9; END if (@ConsumerOfData is null) BEGIN Set @RowsInSettings = ( Select COUNT(*) from [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] where [SourceSystem] = @SourceSystem and [SourceOfData] = @SourceOfData); END ELSE BEGIN Set @RowsInSettings = ( Select COUNT(*) from [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] where [SourceSystem] = @SourceSystem and [SourceOfData] = @SourceOfData and [ConsumerOfData] = @ConsumerOfData); END if ( @RowsInSettings = 0) BEGIN set @ReturnStatus = 8; PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ No settings found in [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] for' PRINT '@ SourceSytem : '+ @SourceSystem PRINT '@ SourceOfData : '+ @SourceOfData if (@ConsumerOfData is not null) BEGIN PRINT '@ ConsumerOfData : '+ @ConsumerOfData END PRINT '@--------------------------------------------------------------------------------' PRINT '' END /*---------------------------------------------------------------------------*/ /*-- Start processing */ /*---------------------------------------------------------------------------*/ BEGIN TRY if (@ReturnStatus = 0) BEGIN if (@ConsumerOfData is null) BEGIN /* Insert record(s) into [SourceSystemByYearMonthCreationPlan_BSATM_XX_H]*/ /* for each [ConsumerOfData] */ IF UPPER(@SourceOfData) LIKE '%PLAN%' BEGIN with cte_SourceOfData as (SELECT ss_bh.[SourceSystem_HK] as [SourceSystem_HK] ,ssbc.[SourceOfData] as [SourceOfData] ,ssbc.[ConsumerOfData] as [ConsumerOfData] FROM [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] ssbc inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ssbc.[SourceSystem] = ss_bh.[SourceSystem_BK] where ssbc.[SourceSystem] = @SourceSystem and ssbc.[SourceOfData] = @SourceOfData ) INSERT INTO [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] ([SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,[YearMonthCreation] ,[LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[User]) SELECT [SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,@YearMonthCreation ,@LoadDate ,-1 ,(select top (1) [EntityId] from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] ) ,@LoadEndDate ,CURRENT_USER FROM cte_SourceOfData where not exists ( select 1 from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] sat where sat.[SourceSystem_HK] = cte_SourceOfData.[SourceSystem_HK] and sat.[SourceOfData] = cte_SourceOfData.[SourceOfData] and sat.[ConsumerOfData] = cte_SourceOfData.[ConsumerOfData] and sat.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and sat.[YearMonthCreation] = @YearMonthCreation) ; END ELSE BEGIN /* Insert record(s) into [SourceSystemByYearMonthCreation_BSATM_XX_H] */ /* for each [ConsumerOfData] */ with cte_SourceOfData as (SELECT ss_bh.[SourceSystem_HK] as [SourceSystem_HK] ,ssbc.[SourceOfData] as [SourceOfData] ,ssbc.[ConsumerOfData] as [ConsumerOfData] FROM [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] ssbc inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ssbc.[SourceSystem] = ss_bh.[SourceSystem_BK] where ssbc.[SourceSystem] = @SourceSystem and ssbc.[SourceOfData] = @SourceOfData ) INSERT INTO [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] ([SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,[YearMonthCreation] ,[LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[User]) SELECT [SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,@YearMonthCreation ,@LoadDate ,-1 ,(select top (1) [EntityId] from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] ) ,@LoadEndDate ,CURRENT_USER FROM cte_SourceOfData where not exists ( select 1 from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] sat where sat.[SourceSystem_HK] = cte_SourceOfData.[SourceSystem_HK] and sat.[SourceOfData] = cte_SourceOfData.[SourceOfData] and sat.[ConsumerOfData] = cte_SourceOfData.[ConsumerOfData] and sat.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and sat.[YearMonthCreation] = @YearMonthCreation) ; END END ELSE BEGIN IF UPPER(@SourceOfData) LIKE '%PLAN%' BEGIN /* Insert record into [SourceSystemByYearMonthCreationPlan_BSATM_XX_H] */ /* for the provided [ConsumerOfData] */ with cte_SourceOfData as (SELECT ss_bh.[SourceSystem_HK] as [SourceSystem_HK] ,ssbc.[SourceOfData] as [SourceOfData] ,ssbc.[ConsumerOfData] as [ConsumerOfData] FROM [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] ssbc inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ssbc.[SourceSystem] = ss_bh.[SourceSystem_BK] where ssbc.[SourceSystem] = @SourceSystem and ssbc.[SourceOfData] = @SourceOfData and ssbc.[ConsumerOfData] = @ConsumerOfData ) INSERT INTO [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] ([SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,[YearMonthCreation] ,[LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[User]) SELECT [SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,@YearMonthCreation ,@LoadDate ,-1 ,(select top (1) [EntityId] from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] ) ,@LoadEndDate ,CURRENT_USER FROM cte_SourceOfData where not exists ( select 1 from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreationPlan_BSATM_XX_H] sat where sat.[SourceSystem_HK] = cte_SourceOfData.[SourceSystem_HK] and sat.[SourceOfData] = cte_SourceOfData.[SourceOfData] and sat.[ConsumerOfData] = cte_SourceOfData.[ConsumerOfData] and sat.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and sat.[YearMonthCreation] = @YearMonthCreation) ; END ELSE BEGIN /* Insert record into [SourceSystemByYearMonthCreation_BSATM_XX_H] */ /* for the provided [ConsumerOfData] */ with cte_SourceOfData as (SELECT ss_bh.[SourceSystem_HK] as [SourceSystem_HK] ,ssbc.[SourceOfData] as [SourceOfData] ,ssbc.[ConsumerOfData] as [ConsumerOfData] FROM [MEAV_DataCORE_CSC1].[SourceSystemSourceConsumer_BREF0] ssbc inner join [MEAV_DataCORE_CSC1].[SourceSystem_BHUB0] ss_bh on ssbc.[SourceSystem] = ss_bh.[SourceSystem_BK] where ssbc.[SourceSystem] = @SourceSystem and ssbc.[SourceOfData] = @SourceOfData and ssbc.[ConsumerOfData] = @ConsumerOfData ) INSERT INTO [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] ([SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,[YearMonthCreation] ,[LoadDate] ,[AuditId] ,[EntityId] ,[LoadEndDate] ,[User]) SELECT [SourceSystem_HK] ,[SourceOfData] ,[ConsumerOfData] ,@YearMonthCreation ,@LoadDate ,-1 ,(select top (1) [EntityId] from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] ) ,@LoadEndDate ,CURRENT_USER FROM cte_SourceOfData where not exists ( select 1 from [MEAV_DataCORE_CSC1].[SourceSystemByYearMonthCreation_BSATM_XX_H] sat where sat.[SourceSystem_HK] = cte_SourceOfData.[SourceSystem_HK] and sat.[SourceOfData] = cte_SourceOfData.[SourceOfData] and sat.[ConsumerOfData] = cte_SourceOfData.[ConsumerOfData] and sat.[LoadEndDate] = '2999-12-31 00:00:00.0000000' and sat.[YearMonthCreation] = @YearMonthCreation) ; END END /*---------------------------------------------------------------------*/ /*-- Get statistic information of rows. */ /*-- If DML was successfully executed. */ /*---------------------------------------------------------------------*/ /* Save the return values in local variables before they are cleaned */ SELECT @InsertStatus = @@ERROR ,@RowsInserted = @@ROWCOUNT ; IF (@RowsInserted = 0) BEGIN SET @ReturnStatus = 2; PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ No record inserted for ' PRINT '@ SourceSytem : '+ @SourceSystem PRINT '@ SourceOfData : '+ @SourceOfData if (@ConsumerOfData is not null) BEGIN PRINT '@ ConsumerOfData : '+ @ConsumerOfData END PRINT '@ YearMonthCreation: '+ Cast(@YearMonthCreation as char(20)) PRINT '@--------------------------------------------------------------------------------' PRINT '' END ELSE BEGIN PRINT '' PRINT '@--------------------------------------------------------------------------------' PRINT '@ '+ Cast(@RowsInserted as char(5)) + ' record(s) inserted for ' PRINT '@ SourceSytem : '+ @SourceSystem PRINT '@ SourceOfData : '+ @SourceOfData if (@ConsumerOfData is not null) BEGIN PRINT '@ ConsumerOfData : '+ @ConsumerOfData END PRINT '@ YearMonthCreation: '+ Cast(@YearMonthCreation as char(20)) PRINT '@--------------------------------------------------------------------------------' PRINT '' END END END TRY BEGIN CATCH /*---------------------------------------------------------------------*/ /*-- Get error information of DML after fail. */ /*---------------------------------------------------------------------*/ SET @ReturnStatus = 8; SELECT @StatusNumber = ERROR_NUMBER() ,@StatusMessage = ERROR_MESSAGE() ,@ErrorSeverity = ERROR_SEVERITY() ,@ErrorState = ERROR_STATE() ,@ErrorProcedure = ERROR_PROCEDURE() ,@ErrorLine = ERROR_LINE() ; PRINT ' @ ERROR :' + @StatusMessage /*---------------------------------------------------------------------*/ /*-- If an error occured finish script. No exit with RETURN needed. */ /*---------------------------------------------------------------------*/ END CATCH RETURN @ReturnStatus end"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_Test_G0;1850645836;V ;VIEW;1797;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_G6;1851570080;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_G6 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G0;1852181994;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-25 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G0 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G5;1852637743;V ;VIEW;8460;"/**/ /* View: V_Equipment_V3_IDIM1_G5 */ /**/ /*=*/ /* V01.02.01 - 2020-10-15 Tatjana Derdus CI/DAV2.3 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-03-24 - Initial version (Stephan Wund GS/FBI2) */ /* - V01.00.01 - 2020-04-09 - Use PrimaryLanguage Desc for Equipment, SO-Equipment, Func. Location */ /* - V01.01.00 - 2020-06-25 - Add EquipmentCategory, EquipmentCategoryDescription */ /* - V01.02.00 - 2020-09-07 - Remove FunctionalLocation information; Add FunctionalLocationDimId */ /* - V01.02.01 - 2020-10-15 - Add Dummy Record per LanguageCode */ /*=*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeCostElementToFact_V3_IDIM1;1856777722;V ;VIEW;396;/**/ /* View: V_BridgeCostElementToFact_V3_IDIM1 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G0;1859850038;V ;VIEW;12843;/**/ /* View: V_CostsActualCost_V2_IFCT0_G0 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G4;1861125921;V ;VIEW;10366;/**/ /* View: V_INTF_MonthlySalesTransactions_G4 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G2;1861998110;V ;VIEW;11801;"/**/ /* View: V_INTF_MonthlySalesTransactions_G2 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_A2;1863990017;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_A2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_A2;1865317955;V ;VIEW;1033;
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_Test_G4;1866645893;V ;VIEW;1797;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_S3;1867570137;V ;VIEW;1966;/**/ /* View: V_INTF_MD_SalesDocumentType_S3 */ /**/ /* = */ /* V01.01.01 2023-07-25 URA1FE, Tatjana Derdus CI/DAV2.3 */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.01.01 2023-07-25 Added link for Outgoing Interface, removed distinct */ /* - V01.01.00 2020-04-15 Adapted SQL query to also include sales document types for which */ /* no English description is maintained (ShortText is NULL) */ /* - V01.00.00 2020-04-12 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G1;1868182051;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-25 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G1 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G1_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G1_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G6;1868637800;V ;VIEW;8357;"/**/ /* View: V_Equipment_V3_IDIM1_G6 */ /**/ /*=*/ /* V01.02.01 - 2020-10-15 Tatjana Derdus CI/DAV2.3 */ /* Equipment dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2020-04-29 - Initial version */ /* - V01.01.00 - 2020-06-25 - Add EquipmentCategory, EquipmentCategoryDescription */ /* - V01.02.00 - 2020-09-07 - Remove FunctionalLocation information; Add FunctionalLocationDimId */ /* - V01.02.01 - 2020-10-15 - Add Dummy Record per LanguageCode */ /*=*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G1;1875850095;V ;VIEW;12844;/**/ /* View: V_CostsActualCost_V2_IFCT0_G1 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G5;1877125978;V ;VIEW;10358;/**/ /* View: V_INTF_MonthlySalesTransactions_G5 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G3;1877998167;V ;VIEW;11785;"/**/ /* View: V_INTF_MonthlySalesTransactions_G3 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_B2;1879990074;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_B2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_FBI_MDS_CSC2;30;INFormation Mart as Interface;V_INFI_MDS_MD_ProfitCenter;1881213902;V ;VIEW;4413;/**/ /* View: V_INFI_MDS_MD_ProfitCenter */ /**/ /* =*/ /* V01.01.00 2021-03-23 Yannick Sigwalt GS/BDO12 */ /* Interface view to provideFBI_MDS the Basis for ProfitCenter and BusinessUnit maintenance */ /* Update: */ /* V01.01.00: combined ProfitCenter BK with Edition to ease up Master Data Maintenance on FBI-MDS */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_Test_G4_DemoSystem;1882645950;V ;VIEW;3815;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_SalesDocumentType_SL;1883570194;V ;VIEW;1827;/**/ /* View: V_INTF_MD_SalesDocumentType_SL */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE */ /* Interface view for transfer of sales document type reference data to Optravis */ /* Data.CORE Outgoing Interface #0086 https://inside-docupedia.bosch.com/confluence/x/d6KHYw */ /* Restrictions: */ /* - only includes sales document type short text in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface, removed distinct */ /* - V01.00.00 Initial version, copied from V_INTF_MD_SalesDocumentType_G0 V01.00.00 */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_OrganizationalView;1883869778;V ;VIEW;1390;/**/ /* View: V_INTF_PNL_DIM_OrganizationalView */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G2;1884182108;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-25 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G2 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G2_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G2_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeCostsJunkToFact_V4_IDIM1;1887554008;V ;VIEW;1005;/**/ /* View: V_BridgeCostsJunkToFact_V4_IDIM1 */ /**/ /**/ /* V01.00.00 - 2021-12-16 Martin Urban CI/XTD2 */ /* Bridge holding unique values for Dim Costs Junk */ /* Restrictions: */ /* Updates: */ /* - V01.00.00 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G2;1891850152;V ;VIEW;12800;/**/ /* View: V_CostsActualCost_V2_IFCT0_G2 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G6;1893126035;V ;VIEW;10358;/**/ /* View: V_INTF_MonthlySalesTransactions_G6 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G4;1893998224;V ;VIEW;11786;"/**/ /* View: V_INTF_MonthlySalesTransactions_G4 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_IDIM1_Dummy;1894401918;V ;VIEW;1501;/**/ /* View: V_MalfunctionNotification_IDIM1_Dummy */ /**/ /*=*/ /* V01.00.00 - 2021-01-15 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.00.00: 2021-01-15 Initial version */ /*=*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_B4;1895990131;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_B4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_Test_G5;1898646007;V ;VIEW;1797;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_B2;1899570251;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_B2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_OrganizationalView_ATTR;1899869835;V ;VIEW;2701;/**/ /* View: V_INTF_PNL_DIM_OrganizationalView_ATTR */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G3;1900182165;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-17 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G3 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G3_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G3_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostCenter_V5_IDIM1_Backup;1901562158;V ;VIEW;102044;/**/ /* View: V_CostCenter_V5_IDIM1 */ /**/ /**/ /* V01.06.06 2022-09-30 Michal Erdman & Jakub Kozlowski & Yannick Sigwalt GS/BDD2 & URA1FE */ /* Dimension for CostCenter for Costs Application for SSAS */ /* Data.CORE Outgoing Interface #0066 https://inside-docupedia.bosch.com/confluence/x/jE_IWg */ /* Restrictions */ /* - none */ /* Update: */ /* V01.06.06 2022-09-30 - performance optimization and description fix */ /* V01.06.05 2022-09-14 - Added Cost Center Hierarchies from P77, PTE, PEI */ /* Replaced CROSS JOINS with INNER JOINS for better readibility */ /* V01.06.04 2022-09-14 - Adjusted CostCenter hierarchy desriptions to use original language */ /* descriptions, if available (else use descriptions in default language 'DE' or 'EN') */ /* V01.06.03 Added additional joins to CostCenterGlobalHierarchy_BSATM_D7_X] to transform */ /* Non Conform Cost Center to Conform Cost Center */ /* V01.06.02 Added Cost Center Hierarchies from PCE, PC4, PR1, PTW, P42 and P74 */ /* V01.06.01 Added Cost Center Hierarchies from PTT, PS0, P45, P72, P79 and P99 */ /* V01.06.00 -Removed fields: ControllingAreaCode, OrganizationalLevelId, ValidFrom, ValidTo, */ /* CostCenterCategory, LogicalSystem, BWN, Edition, AlternateHierarchyArea, */ /* LockIndicatorForPlanPrimaryCosts,LockIndicatorForPlanSecondarycosts, CostCenterResponsible*/ /* SEGMENT, Segment2, Segment3, CostCenterType, CostCenterArea, ProductLevel1, ProductLevel2,*/ /* PrincipalLocation, WithPersonnel, BusinessUnit, CostCoordinator, ControllingDepartment, */ /* ConcatenateOrganizationalOfficeAndDescription, ResponsibleUserId, ResponsibleUserDomain, */ /* AdditionalLevels */ /* - added new data field: Functional Area */ /* V01.05.05 2022-02-23 FRI3SH added filter to not retrieve hierarchy for PT2 & Responsible Org. Office */ /* V01.05.04 2021-09-02 FRI3SH aded hierarchy PlantManagementAreaId --> Level 1, */ /* MainDepartmentId --> Level 2, */ /* DepartmentId --> Level 3, */ /* CostCenterGroupId --> Level 4, */ /* ShopfloorId --> Level 5, */ /* V01.05.03 2021-09-02 SYA8FE */ /* V01.05.03 Swicthed to V_DataCOREDimensionHierarchy for flexible hierarchy selection */ /* Added column HierarchySourceSystem to make hierarchy unique */ /* V01.05.02 Corrected issue with Organizational Office Description when 1 description is only valid */ /* 1 day and the new record is valid from that same day #70927 */ /* Added filtered hierarchies from P81 and P87 */ /* V01.05.01 Changed the way, hierarchy levels, both CostCenter and OrganizationalOffice are filled up */ /* Updated field calculation for Hierarchylevel */ /* Replaced fixed LanguageCode through [MEAM_DataCORE_CSC1].[V_DataCOREDimensionLanguageCode] */ /* V01.05.00 Added Organizational Office Hierarchy, updated ConcatenateCostCenterCodeAndDepartment */ /* Enhanced CostCenter Hierarchy Levels up to 14 level to match Org.Office hier */ /* Reworked view to separate basis attribute into a distinct cte and reorganized fields */ /* V01.04.00 Added Field as of User Story 34095 */ /* Resp.Org.-office, Cost Center Type, Cost Center Category, Overhead Group */ /* with personnel, Area (Production, QM,...), Principal Location */ /* implemented #FBI-SR-000000043 related to Business Division */ /* https://inside-docupedia.bosch.com/confluence/display/BID/%23FBI-SR-000000043 */ /* V01.03.00 Switched to new Hierarchical Satellite (Language + Fill up of Description) */ /* V01.03.00 Added Currency from Controlling Area instead of fixed value */ /* V01.02.01 Added COareaCurrency amd Rename CURRENCY to CompanyCodeCurrency */ /* V01.02.00 Added new attributes from FBI_MDS */ /* V01.01.01 Removed filter on assigned hierarchy level 1 */ /* V01.01.00 Added BusinessDivision, Plant and ResponsibleUserId from FBI-MDS */ /* V01.01.00 Added Text for Company Code from REF-MDS PT2 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsJunk_V3_IDIM1;1903554065;V ;VIEW;3807;/**/ /* View: V_CostsJunk_V3_IDIM1 */ /**/ /*=*/ /* V01.00.02 - 2021-12-16 Martin Urban CI/XTD2 */ /* Junk Dimension for Costs, this view will be replace by V_CostsJunk_V4_IDIM1 */ /* Data.CORE Outgoing Interface #0188 for successor view V_CostsJunk_V4_IDIM1 */ /* https://inside-docupedia.bosch.com/confluence/x/a6SReg */ /* - Update: */ /* V01.00.02 - View reverted back to initial version */ /* V01.00.01 - Removed fields [SAPVersion], [Scenario], [ScenarioDescription], [ScenarioType] */ /* V01.00.00 - Created */ /*=*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G3;1907850209;V ;VIEW;12799;/**/ /* View: V_CostsActualCost_V2_IFCT0_G3 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_QMAP_CSC2;91;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_S3;1909126092;V ;VIEW;10356;/**/ /* View: V_INTF_MonthlySalesTransactions_S3 */ /**/ /* =*/ /* V01.00.02 2022-02-03 Sanja Mihalic CI/XAD3 */ /* Interface view for transfer of monthly sales transactions data to QMAP */ /* Data.CORE Outgoing Interface #0164 https://inside-docupedia.bosch.com/confluence/x/Vy0Scg */ /* This view consumes the following Soft Rules */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.00.02 2022-02-03 - [Material] column trimed to 10 characters */ /* - V01.00.01 2021-12-13 - Filter to column [RecordType] added, source for [Material] changed to [WWR04] */ /* - V01.00.00 2021-09-01 Yannick Sigwalt GS/BDD02 & Martin Urban CI/XTD2 */ /* Copied from [INFI_Optravis_CSC2].[V_INTF_MonthlySalesTransactions_G0] V01.06.01 2021-06-21 */ /* + Enhanced with columns [RecordType] */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_D0;1911990188;V ;VIEW;1954;/**/ /* View: V_COCostActualLineItemDelta_D0 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_FBI_MDS_CSC2;30;INFormation Mart as Interface;V_INFI_MDS_MD_CountryDescription;1913773875;V ;VIEW;1084;/**/ /* View: V_INFI_MDS_MD_CountryDescription */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_Test_G6;1914646064;V ;VIEW;1797;
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_C3;1915570308;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_C3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G4;1916182222;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-17 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G4 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_G3_DemoSystem;1922926022;V ;VIEW;1920;
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G4;1923850266;V ;VIEW;12824;/**/ /* View: V_CostsActualCost_V2_IFCT0_G4 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;V_INTF_MD_Country_MF;1924410125;V ;VIEW;3154;"/**/ /* View: V_INTF_MD_Country_MF */ /**/ /* */ /* V01.00.01 2021-10-28 Hui Yang CI/XEF1 */ /* Interface view to provide country and regions master data from FBI-MDS to GS Accounting */ /* Data.CORE Outgoing Interface #0177 https://inside-docupedia.bosch.com/confluence/x/zhmbdQ */ /* Updates: */ /* - V01.00.01 2021-10-28 YAH8FE Added countries which are groupped under ""Invalid"" */ /* Restrictions: */ /* - only includes country code and short text description in English language */ /* Changes: */ /* */"
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G6;1925998338;V ;VIEW;11786;"/**/ /* View: V_INTF_MonthlySalesTransactions_G6 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_D1;1927990245;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_D1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G1;1929370238;V ;VIEW;2513;/**/ /* View: V_FactActualCostMaintenanceOrder_G1 */ /**/ /**/ /* V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P45 */ /* Changes: */ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_D7;1931570365;V ;VIEW;1628;/**/ /* View: V_INTF_MD_ValuationClass_D7 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Tatjana Derdus CI/BTM-AC2 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G5;1932182279;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-17 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G5 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G5_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G5_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostElement_V4_IDIM1_Backup;1933562272;V ;VIEW;42098;/**/ /* View: V_CostElement_V4_IDIM1 */ /**/ /**/ /* V01.00.09 2022-09-30 Michal Erdman & Jakub Kozlowski & Yannick Sigwalt GS/BDD2 */ /* & Michal Erdman & Tatjana Derdus CI/BTM-AC1 */ /* Conformed Dimension for CostElement for SSAS Costs Model with filtering from MDS */ /* Data.CORE Outgoing Interface #0212 https://inside-docupedia.bosch.com/confluence/x/X8lagw */ /* Restriction: */ /* - None */ /* Update: */ /* V01.00.09 2022-09-30 - performance optimization and description fix */ /* V01.00.08 2022-09-19 - Added GK, O1, O2 */ /* - Changed CROSS JOIN to INNER JOIN in cte_cebcoahier for better */ /* readibility (as the cross join was in practice an inner join) */ /* V01.00.07 2022-09-14 - Adjusted CostElement hierarchy desriptions to use original language */ /* descriptions, if available (else use descriptions in default language */ /* 'DE' or 'EN') */ /* V01.00.06 2022-09-02 - Removed COALESCE function while retrieving the Hierarchy Level */ /* New logic LevelX, LevelXDescription, ConcatenateLevelXAndDescription */ /* V01.00.05 2022-08-30 - Added A2, B4, D1, D4, D7, G9 */ /* V01.00.04 2022-07-12 - Optimized querying on Hierarchies */ /* - Implemened consumption of V_DataCOREDimensionLanguageCode for Language*/ /* V01.00.03 2022-07-06 - Fix description from other sources */ /* V01.00.02 2022-05-23 - Rework of view due to naming conventions */ /* V01.00.01 2022-05-16 - adding B2, D0, G0, G1, G2, G3, G6, G7 */ /* V01.00.00 2022-03-31 - initial */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D4;1937598141;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9865;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_D4] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPPC4' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_D4_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G5;1939850323;V ;VIEW;12844;/**/ /* View: V_CostsActualCost_V2_IFCT0_G5 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_ActivityType_V1_IDIM1;1940410182;V ;VIEW;1612;/**/ /* View: V_ActivityType_V1_IDIM1 */ /**/ /**/ /* V01.00.03 2021-10-27 Martin Urban */ /* Dimensional View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0178 https://inside-docupedia.bosch.com/confluence/x/4hcbdg */ /* View based on [INFI_Costs_TM1_CSC1].[V_INTF_COOM_Costs_DIM_ActivityType] */ /* Update: */ /* */ /**/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_S3;1941998395;V ;VIEW;12940;"/**/ /* View: V_INTF_MonthlySalesTransactions_S3 */ /**/ /* =*/ /* V01.07.00 2023-06-27 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.07.00 reworked view due to performance issue on D and bug #119572 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_D3;1943990302;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_D3 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G2;1945370295;V ;VIEW;2511;/**/ /* View: V_FactActualCostMaintenanceOrder_G2 */ /**/ /**/ /* V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P72 */ /* Changes: */ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G0;1947570422;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G0 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Product;1947870006;V ;VIEW;1320;/**/ /* View: V_INTF_PNL_DIM_Product */ /**/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;ufn_PlantResultCostPlan_V1_IFCT0_G6;1948182336;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;16442;"/**/ /* V01.00.00 2022-11-25 Yannick Sigwalt (GS/BDD1) & Hui Yang (CI/XEF1) */ /* Fact View for Result Plant Application - Cost Plan based on SAP ERP CO-OM data */ /* Data.CORE Outgoing Interface #0230 https://inside-docupedia.bosch.com/confluence/x/S5iOhg */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.00.00 - initial version */ /**/ create function INFI_PlantResult_TM1_CSC2.ufn_PlantResultCostPlan_V1_IFCT0_G6 ( @PostingYear int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment below for testing purpose */ --DECLARE @YearCreation int = 2022; --DECLARE @Prioritization bit = 0; /* Stop Uncommenting for testing purpose */ with cte_PlanCost as ( select pcp_wl.[CostCollector_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcp_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcp_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcp_ws.[TotalQuantity] - pcp_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcp_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcp_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G6_X] pcp_ws on cast(concat(pcp_ws.[FiscalYear],right(pcp_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear* 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcp_ws.[DebitCreditCode],pcp_ws.[COBusinessTransaction]) usrcoomdbi UNION ALL select pcs_wl.[CostCollector_PlannedObject_HK] as [CostCollector_HK] ,pv_wh.[SAPSystem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] ,cast((pcs_ws.[TotalQuantity]) as decimal(38,2)) as [TotalQuantity] ,cast((pcs_ws.[FixedQuantity]) as decimal(38,2)) as [FixedQuantity] ,cast((pcs_ws.[TotalQuantity] - pcs_ws.[FixedQuantity]) as decimal(38,2)) as [VariableQuantity] ,pcs_ws.[UnitOfMeasure] as [UnitOfMeasure] ,pcs_ws.[YearMonthCreation] ,usrcoomdbi.[DebitCreditCode] as [DebitCreditCode] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G6_X] pcs_ws on cast(concat(pcs_ws.[FiscalYear],right(pcs_ws.[Period], 2)) as int) BETWEEN (@PostingYear * 100 + 1 ) and (@PostingYear * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.PlanningVersionToScenario_HK and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (pcs_ws.[DebitCreditCode],pcs_ws.[COBusinessTransaction]) usrcoomdbi ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccent_wh.[ControllingArea_ID_BK] ,ccent_wh.[CostCenter_HK] ,ccent_wh.[CostCenterID_BK] ,ss_p.[Plant_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join ( select distinct ccentpa_wl.[CostCenter_HK] ,p_wh.[Plant_BK] from [RAWV_RB_CSC1].[CostCenterPlantAssignment_WLNK0] ccentpa_wl inner join [RAWV_RB_CSC1].[CostCenterPlantAssignment_WSATE_MF_X] ccentpa_ws on ccentpa_ws.[CostCenterPlantAssignment_HK] = ccentpa_wl.[CostCenterPlantAssignment_HK] and ccentpa_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[Plant_WHUB0] p_wh on p_wh.[Plant_HK] = ccentpa_wl.[Plant_HK] where 1=1 and p_wh.[Plant_HK] != 0xDA39A3EE5E6B4B0D3255BFEF95601890AFD80709 ) as ss_p on ss_p.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_ccoll2at as ( select ccoll_wh.[CostCollector_HK] ,at_wh.[ControllingAreaID_BK] ,at_wh.[ActivityType_ID_BK] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh Inner join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] ) , cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Anchors---------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[YearMonthCreation] as [YearMonthCreation] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[SourceSystem] as [SourceSystem] ,pc.[Scenario_BK] as [Scenario] ,pc.[SAPVersion] as [SAPPlanningVersion] ,cast('PL_'+cte_ccoll2ccent.[Plant_BK] as nvarchar (7)) as [PlantId] ,cte_ccoll2ccent.[ControllingArea_ID_BK]+'/'+ cte_ccoll2ccent.[CostCenterID_BK] as [CostCenterId] ,cebca_wh.ControllingArea_ID_BK+'/'+ cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cte_ccoll2at.[ActivityType_ID_BK] as [ActivityType] ,ccoll_wh_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,left(ccoll_wh_partner.[CostCollectorObject_BK], 2) as [PartnerObjectType] ,cte_ccoll2ccentSource.[ControllingArea_ID_BK]+'/'+cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[DebitCreditCode] as [DebitCredit] ,pc.[ValueType] as [ValueType] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[CurrencyCodeCOAreaCurrency] as [COAreaCurrencyCode] ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.FixedAmountCOAreaCurrency as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[CurrencyCodeObjectCurrency] as [ObjectCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] ,pc.[UnitOfMeasure] as [UnitOfMeasure] ,pc.[TotalQuantity] as [TotalQuantity] ,pc.[FixedQuantity] as [FixedQuantity] ,pc.[VariableQuantity] as [VariableQuantity] FROM cte_PlanCost pc inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pc.[CostCollector_HK] inner join cte_prio on cte_prio.[FiscalYear] = pc.[FiscalYear] and cte_prio.[Scenario] = pc.[Scenario_BK] and cte_prio.[ControllingArea] = cte_ccoll2ccent.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = cte_ccoll2ccent.[CostCenterID_BK] and cte_ccoll2ccent.[SourceSytem] like cte_prio.[SourceSystem] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pc.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_partner on ccoll_wh_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent cte_ccoll2ccentSource on cte_ccoll2ccentSource.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] left join cte_ccoll2at on cte_ccoll2at.[CostCollector_HK] = pc.[CostCollector_HK]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsJunk_V4_IDIM1;1951554236;V ;VIEW;3258;/**/ /* View: V_CostsJunk_V4_IDIM1 */ /**/ /*=*/ /* V01.00.02 - 2021-12-20 Yannick Sigwalt GS/BDD2 & Martin Urban CI/XTD2 */ /* Junk Dimension for Costs */ /* Data.CORE Outgoing Interface #0188 https://inside-docupedia.bosch.com/confluence/x/a6SReg */ /* Copied from INFI_Costs_SSAS_CSC2.V_CostsJunk_V3_IDIM1 */ /* - Update: */ /* V01.00.02 - Removed obsolete reference to Ref_PlanVersion_WREF0 */ /* V01.00.00 - Created */ /*=*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_GK;1953598198;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;9865;create function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_CostCenterBookings_for_Maintenance_V2_IFCT0_Test_GK] (@year int) RETURNS TABLE AS RETURN with CostCollectorActivityType_WLNK0 as ( select ccat_wl.[CostCollector_HK] ,ccat_wl.[ActivityType_HK] from [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccat_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = ccat_wl.[CostCollector_HK] ) ,CostCollectorCostCenter_WLNK0 as ( select cccc_wl.[CostCollector_HK] ,cccc_wl.[CostCenter_HK] from [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] cccc_wl inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] cc_wh on cc_wh.[CostCollector_HK] = cccc_wl.[CostCollector_HK] ) ,PlanCostsPrimary_WSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP77' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_GK_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCostsSecondary_WSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[DebitCreditCode] as [SAPDebitCreditCode] ,'SAPP77' as [SourceSystemREDLake] ,[TotalValueCOAreaCurrency] ,[CurrencyCodeCOAreaCurrency] ,[TotalValueObjectCurrency] ,[CurrencyCodeObjectCurrency] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_GK_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Primary_DebCreditAndStat_BSATM as ( select [PlanCostsPrimary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP77' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsPrimaryDebCreditAndStat_BSATM_GK_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCosts_Secondary_DebCreditAndStat_BSATM as ( select [PlanCostsSecondary_HK] ,[FiscalYear] ,[Period] ,[COBusinessTransaction] ,[ValueType] ,[SAPDebitCreditCode] ,'SAPP77' as [SourceSystemREDLake] ,[DebitCreditCode] ,[StatisticalIndicator] from [BUSV_COOM_CSC2].[PlanCostsSecondaryDebCreditAndStat_BSATM_GK_X] where [YearMonthCreation] BETWEEN CONCAT(@year,'01') and CONCAT(@year,'12') and [LoadEndDate] = CAST('2999-12-31 00:00:00.000' AS DATETIME2) ) ,PlanCost as ( select pcpl.[PlanCostsPrimary_HK] as [HK] ,pcpl.[CostCollector_HK] ,pcpl.[PlaningVersion_HK] ,pcpl.[CostElementByControllingArea_HK] ,NULL as [CostCollector_PartnerObject_HK] ,pcp_ws.[FiscalYear] ,pcp_ws.[Period] ,pcp_ws.[COBusinessTransaction] ,pcp_ws.[ValueType] ,pcp_ws.[SAPDebitCreditCode] ,pcp_ws.[SourceSystemREDLake] ,pcp_ws.[TotalValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] ,pcp_ws.[TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] ,pcpdcss.[DebitCreditCode] ,pcpdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcpl inner join PlanCostsPrimary_WSATM pcp_ws on pcpl.[PlanCostsPrimary_HK] = pcp_ws.[PlanCostsPrimary_HK] inner join PlanCosts_Primary_DebCreditAndStat_BSATM pcpdcss on pcpl.[PlanCostsPrimary_HK] = pcpdcss.[PlanCostsPrimary_HK] and pcp_ws.[FiscalYear] = pcpdcss.[FiscalYear] and pcp_ws.[Period] = pcpdcss.[Period] and pcp_ws.[COBusinessTransaction] = pcpdcss.[COBusinessTransaction] and pcp_ws.[ValueType] = pcpdcss.[ValueType] and pcp_ws.[SAPDebitCreditCode] = pcpdcss.[SAPDebitCreditCode] union all select pcsl.[PlanCostsSecondary_HK] as HK ,pcsl.[CostCollector_PlannedObject_HK] as CostCollector_HK ,pcsl.[PlaningVersion_HK] ,pcsl.[CostElementByControllingArea_HK] ,pcsl.[CostCollector_PartnerObject_HK] ,pcs_ws.[FiscalYear] ,pcs_ws.[Period] ,pcs_ws.[COBusinessTransaction] ,pcs_ws.[ValueType] ,pcs_ws.[SAPDebitCreditCode] ,pcs_ws.[SourceSystemREDLake] ,pcs_ws.[TotalValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] ,pcs_ws.[TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] ,pcsdcss.[DebitCreditCode] ,pcsdcss.[StatisticalIndicator] from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcsl inner join PlanCostsSecondary_WSATM pcs_ws on pcsl.[PlanCostsSecondary_HK] = pcs_ws.[PlanCostsSecondary_HK] inner join PlanCosts_Secondary_DebCreditAndStat_BSATM pcsdcss on pcsl.[PlanCostsSecondary_HK] = pcsdcss.[PlanCostsSecondary_HK] and pcs_ws.[FiscalYear] = pcsdcss.[FiscalYear] and pcs_ws.[Period] = pcsdcss.[Period] and pcs_ws.[COBusinessTransaction] = pcsdcss.[COBusinessTransaction] and pcs_ws.[ValueType] = pcsdcss.[ValueType] and pcs_ws.[SAPDebitCreditCode] = pcsdcss.[SAPDebitCreditCode] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccdis.[DimensionID], 0) as [CostCenterDimId] -- ,cch.[CostCenterID_BK] as [CostCenterID] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_',coalesce(case when ccolh_partner.[CostCollectorObject_BK] <> ' ' then Left(ccolh_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] -- ,pc.[DebitCreditIndicator] as [DebitCreditIndicatorId] -- ,pc.[StatisticalIndicator] as [StatisticalIndicatorId] -- ,pvh.[Version_ID_BK] as [PlanningVersionId] -- ,left(ccolh_partner.[CostCollectorObject_BK],2) as [PartnerObjectTypeId] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] -- ,pc.[Period] as [Period] ,coalesce(cecadis.[DimensionID], 0) as [CostElementDimId] -- ,cecah.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(pc.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] -- ,pc.[ObjectCurrencyTotalValue] as [ObjectCurrencyTotalValue] ,cast(pc.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,ath.[ActivityType_ID_BK] as [ActivityType] ,ccolh_partner.[CostCollectorObject_BK] as [PartnerObjectId] -- ,NULL as [PartnerObjectDescription] ,pc.[SourceSystemREDLake] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,isnull(did.[DimensionId],0) as [ScenarioId] FROM PlanCost pc left join RAWV_RB_CSC1.CostCollector_WHUB0 ccolh_partner on pc.CostCollector_PartnerObject_HK = ccolh_partner.CostCollector_HK inner join CostCollectorCostCenter_WLNK0 ccccl on pc.CostCollector_HK = ccccl.CostCollector_HK inner join RAWV_RB_CSC1.CostCenter_WHUB0 cch on ccccl.CostCenter_HK = cch.CostCenter_HK left join CostCollectorActivityType_WLNK0 ccatl on pc.CostCollector_HK = ccatl.CostCollector_HK left join RAWV_RB_CSC1.ActivityType_WHUB0 ath on ath.ActivityType_HK = ccatl.ActivityType_HK inner join RAWV_RB_CSC1.CostElementbyControllingArea_WHUB0 cecah on pc.CostElementByControllingArea_HK = cecah.CostElementByControllingArea_HK inner join RAWV_RB_CSC1.PlanningVersion_WHUB0 pvh on pc.PlaningVersion_HK = pvh.PlaningVersion_HK inner join BUSV_FBI_OH_CSC1.CostCenterDimensionID_BSATC_XX_X ccdis on cch.CostCenter_HK = ccdis.CostCenter_HK inner join BUSV_FBI_OH_CSC1.CostElementbyControllingArea_DimensionID_BSATC_XX_X cecadis on cecah.CostElementByControllingArea_HK = cecadis.CostElementByControllingArea_HK inner join ( select rsdi_wr.[DimensionId] ,[PlanningVersion_SAP_ID_BK] as [PlaningVersion_BK] ,[SourceSystem] from [RAWV_RB_CSC1].[Ref_PlanVersion_WREF0] rpv_wr inner join [RAWV_RB_CSC1].[RefScenarioDimensionId_WREF0] rsdi_wr on rpv_wr.[Scenario] = rsdi_wr.[Scenario_PK] ) did on did.[PlaningVersion_BK] = pvh.[Version_ID_BK] and did.[SourceSystem] = pc.[SourceSystemREDLake] --Select only cost elements under hierarchy node 'RB-E-BPR4.211' --> maintenance relevant cost elements INNER JOIN ( SELECT DISTINCT [CostElementbyControllingAreaDimId] FROM [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] WHERE [Level5] = 'RB-E-BPR4.211' AND [HierarchySetName_BK_Root] = 'RB-E-BPR' ) vdce ON cecadis.[DimensionID] = vdce.[CostElementbyControllingAreaDimId]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G6;1955850380;V ;VIEW;12844;/**/ /* View: V_CostsActualCost_V2_IFCT0_G6 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_D7;1957998452;V ;VIEW;11632;/**/ /* View: V_INTF_MonthlySalesTransactions_D7 */ /**/ /* =*/ /* V01.00.02 2023-02-21 Tatjana Derdus BD/BTM-AC1 */ /* Interface view for transfer of monthly sales transactions data from ETAS to Optravis */ /* Data.CORE Outgoing Interface #0325 https://inside-docupedia.bosch.com/confluence/x/UCGznQ */ /* This view consumes the following Soft Rules: */ /* - #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of Optravis), cf. #FBI-SR-000000066 */ /* Changes: */ /* - V01.00.02 - 2023-02-21 - Fixed bug in case when condition related to [TotalNetSales] */ /* - V01.00.01 - 2023-02-02 - Added filter to RecordType between 'B' and 'Z' */ /* - V01.00.00 - 2023-01-12 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_D4;1959990359;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_D4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_B2;1961370352;V ;VIEW;2263;/**/ /* View: V_FactActualCost_B2 */ /**/ /**/ /* V01.00.01 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G1;1963570479;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G1 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G7;1971850437;V ;VIEW;12844;/**/ /* View: V_CostsActualCost_V2_IFCT0_G7 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_GSSGA_CSC2;83;INFormation Mart as Interface;V_CostElement_V3_IDIM1;1972410296;V ;VIEW;6211;/**/ /* View: V_CostElement_V3_IDIM1 */ /**/ /**/ /* V01.00.03 2021-10-27 Martin Urban */ /* Dimensional View for GS Trust SGnA */ /* Data.CORE Outgoing Interface #0179 https://inside-docupedia.bosch.com/confluence/x/Vhgbdg */ /* View based on [INFI_Costs_SSAS_CSC2].[V_CostElement_V3_IDIM1] */ /* Update: */ /* */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_D7;1975990416;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_D7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G1;1977370409;V ;VIEW;3183;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G1 */ /*=*/ /**/ /* V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from P45 */ /* Changes: */ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G2;1979570536;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G2 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_REDLake_EDMFAC_CSC1;107;INFormation Mart as Interface;V_INTF_REDLakeEDM_REF_ExchangeRates;1980182450;V ;VIEW;1737;/**/ /* View: V_INTF_REDLakeEDM_REF_ExchangeRates */ /**/ /* = */ /* V01.00.02 2022-12-07 Ilja Frolov GS/BDD2 */ /* This view delivers the exchange rates to REDLake EDM */ /* Data.CORE Outgoing Interface #0244 https://inside-docupedia.bosch.com/confluence/x/gSXiiQ */ /* Update: */ /* - V01.00.02 - Removed Filter for UsedExchangeRateType */ /* - V01.00.01 - Added Filter for UsedExchangeRateType */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GCT;1983502295;V ;VIEW;3475;/**/ /* View: V_INTF_PNL_DIM_GCT */ /**/ /* =*/ /* V01.00.00 2021-06-24 Yannick Sigwalt GS/BDO12 */ /* Interface provides Parent/Child Hierarchy for GCT (Global Customer Team Dimension */ /* Data.CORE Outgoing Interface #0121 https://inside-docupedia.bosch.com/confluence/x/tjDtZQ */ /* Update: */ /* Restriction: */ /* - none */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_F0;1983554350;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;5604;"/**/ /* V01.00.00 - 2021-12-20 Yannick Sigwalt GS/BDD2 */ /* Fact View for Costs Application - Plan Cost from CDP */ /* ##FBI-Interface-0000000160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This Function uses the Plan Prioritization */ /* Update: */ /* - 01.00.00 Creation */ /**/ create function INFI_Costs_SSAS_CSC2.ufn_GetPlanCost_V3_IFCT0_F0 ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN /* Uncomment for Testing Purpose */ --DECLARE @YearCreation as int = 2021; --DECLARE @Prioritization as bit = 1; /* End Uncomment for Testing Purpose */ With cte_prio as ( select [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,IIF(@Prioritization = 0,cast(N'%' as nvarchar(15)),[SourceSystem]) as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ coalesce(ccentdi_bs.[DimensionID], 0) as [CostCenterDimId] -- ,coalesce(ccent_wh.[CostCenterID_BK], 0) as [CostCenterId] ,coalesce(concat (cocpm_ws.[DebitCreditCode], '_', N'0' ,'_',N'0'), '0') as [JunkDimID] -- ,pd_ws.[DebitCreditCode] as [DebitCreditIndicatorId] -- ,sc_wh.[Scenario_BK] as [Scenario_BK] ,(cocpm_ws.[FiscalYear]*1000 + cocpm_ws.[Period]) as [PostingPeriodYearId] ,cocpm_ws.[FiscalYear] as [FiscalYear] -- ,pd_ws.[Period] as [Period] ,coalesce(cebcadi_bs.[DimensionID], 0) as [CostElementDimId] -- ,cebca_wh.[CostElement_ID_BK] as [CostElementId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,cast(cocpm_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,N'EUR' as [ControllingAreaCurrencyCode] ,cast(cocpm_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,cocpm_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,NULL as [ActivityType] ,N'0000000000000000000000' as [PartnerObjectId] ,0 as [SourceCostCenterDimId] ,N'Manual_Input' as [SourceSystem] ,NULL as [COBusinessTransaction] ,NULL as [ValueType] ,sdi_bs.[DimensionId] as [ScenarioId] ,cast((cocpm_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((cocpm_ws.[TotalValueCOAreaCurrency] - cocpm_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(cocpm_ws.[FixedValueObjectCurrency] as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(cocpm_ws.[TotalValueObjectCurrency] - cocpm_ws.[FixedValueObjectCurrency] as decimal(38,2)) as [VariableAmountObjectCurrency] FROM [RAWV_COOM_CSC1].[COCostPlanManual_WLNK0_F0] cocpm_wl inner join [FBI_CORE_CORE_P].[RAWV_COOM_CSC1].[COCostPlanManual_WSATM_F0_X] cocpm_ws on cocpm_ws.[COCostPlanManual_HK] = cocpm_wl.[COCostPlanManual_HK] and cocpm_ws.[FiscalYear] = @YearCreation and cocpm_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = cocpm_wl.[CostCenter_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = cocpm_wl.[CostElementByControllingArea_HK] inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = cocpm_wl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] inner join cte_prio on cte_prio.[FiscalYear] = cocpm_ws.[FiscalYear] and cte_prio.[Scenario] = s_wh.[Scenario_BK] and cte_prio.[ControllingArea] = ccent_wh.[ControllingArea_ID_BK] and cte_prio.[CostCenter] = ccent_wh.[CostCenterID_BK] and N'Manual' like cte_prio.[SourceSystem]"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_G9;1987850494;V ;VIEW;12842;/**/ /* View: V_CostsActualCost_V2_IFCT0_G9 */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
MEAM_DataCORE_CSC1;46;MEtA Mart;V_DataCOREDimensionHierarchy;1988566518;V ;VIEW;6507;"/**/ /* View: V_DataCOREDimensionHierarchy */ /**/ /* =*/ /* V01.02.00 2023-03-22 Yannick Sigwalt GS/BDD1 & Hui Yang CI/XEF1 & Tatjana Derdus CI/BTM-AC1 */ /* This view provide the list of root nodes to be displayed in Dimension */ /* This view implements the soft rule #FBI-SR-000000072 https://inside-docupedia.bosch.com/confluence/x/6ogNcg */ /* Filter on Application, Element and Attribute to receive the list of root nodes of hierarchy to */ /* be processed in the dimension */ /* Attribute = 1 mean that the Entry is to be used in attribute dimensions for TM1 */ /* Restriction */ /* This view is only to be used in Dimension related to Hierachies */ /* Update: */ /* V01.02.00 - Optimized query by using new consolidated satellite for Global Hierarchy Attributes */ /* V01.01.00 - added column [OrigLanguageCode] (only filled for application 'CostSSAS') */ /* V01.00.02 - added the condition [LoadEndDate] = '2999-12-31 00:00:00.0000000' for reading data from MDS */ /* V01.00.01 - added: select from MDS when the records are not invalid in DataCORE reference tabe; */ /* - added the column ""LoadDate"" and ""Source"" */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_IDIM1_G4;1990402260;V ;VIEW;4967;"/**/ /* View: V_MalfunctionNotification_IDIM1_G4 */ /**/ /*=*/ /* V01.02.00 - 2021-01-18 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G0;1991990473;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G0 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G2;1993370466;V ;VIEW;3183;/*=*/ /* View: V_FactActualCost_CostCenterBookings_For_MaintenanceOrder_G2 */ /*=*/ /**/ /* V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Cost Centers from P72 */ /* Changes: */ /* - V01.00.00 2022-08-10 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G3;1995570593;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_GCT_ATTR;1999502352;V ;VIEW;3823;/**/ /* View: V_INTF_PNL_DIM_GCT_ATTR */ /**/ /* =*/ /* V01.00.00 2021-06-24 Yannick Sigwalt GS/BDO12 */ /* Interface provides Attibute for GCT (Global Customer Team Dimension */ /* Data.CORE Outgoing Interface #0122 https://inside-docupedia.bosch.com/confluence/x/qjHtZQ */ /* Update: */ /* Restriction: */ /* - none */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_GK;2003850551;V ;VIEW;12842;/**/ /* View: V_CostsActualCost_V2_IFCT0_GK */ /**/ /**/ /* V01.00.06 - 2023-01-05 Michal Erdman & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, copied from V_Costs Actual Cost_V2_IFCT0_G1 */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.06 - Added new version of SR25 */ /* - V01.00.05 - restrictions to ValueTypes 03 and 04 */ /* - V01.00.04 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.03 - Added columns SourceCostCenterId_BK & SourceCostCenterDimId */ /* - V01.00.02 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Reworked Non-Conform CostCenter Solution */ /* - V01.00.01 - adding lookup of ConformedCostCenter for CostCenterDimId */ /* - V01.00.00 - adding LoadEndDate selection to BSATs */ /**/
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_DimProduct_V4;2005998623;V ;VIEW;16589;"/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 04.07.2023 12:00:28 */ /**/ /**/ /* View: V_INTF_PNL_GM1_DimProduct_V4 */ /**/ /* */ /* V01.00.05 2023-07-04 URA1FE, FRI3SH, DTD7FE */ /* This view provides the product hierarchy and material data for Profit&Loss.GM1Analysis */ /* Moreover this view extracts some master data from facts data, which is not recommended */ /* Data.CORE Outgoing Interface #0174 https://inside-docupedia.bosch.com/confluence/x/3BnAcw */ /* Changes: */ /* - V01.00.05 Added cte_MaterialByDivisionAndProfitCenterRanked to ensure iGPM Rank; */ /* Added adjusted view name suffix to ""V4"" */ /* Added SupplementaryProductHierarchy and ProductHierarchyDescription */ /* - V01.00.04 Added MaterialDescription; Adjusted view name suffix to ""V3"" */ /* - V01.00.03 Added products from iGPM; Adjusted view name suffix to ""V2"" */ /* - V01.00.02 Added fields [ProductHierarchySubClassDescriptionInEnglish] and */ /* [ProductHierarchyClassDescriptionInEnglish] */ /* - V01.00.01 Removed PERIO and MaterialByDivisionAndProfitCenter_rank, added field WW02 */ /* - V01.00.00 Created View - initial version */ /* */"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_IDIM1_G5;2006402317;V ;VIEW;4967;"/**/ /* View: V_MalfunctionNotification_IDIM1_G5 */ /**/ /*=*/ /* V01.02.00 - 2021-01-18 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G1;2007990530;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G1 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_D7;2009370523;V ;VIEW;2263;/**/ /* View: V_FactActualCost_D7 */ /**/ /**/ /* V01.00.01 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs booked on Cost Centers from P42 */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G4;2011570650;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G4 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_RefMonthScenario_V1_IREF0;2012078454;V ;VIEW;5258;/**/ /* View: V_RefMonthScenario_V1_IREF0 */ /**/ /**/ /* V01.01.02B - 2022-01-25 - Yannick Sigwalt GS/BDD2 & Tatjana Derdus CI/DAV2.3 */ /* Reference view for Months/Scenarios in reporting */ /* Data.CORE Outgoing Interface #0189 https://inside-docupedia.bosch.com/confluence/x/NSzmeg*/ /* Restriction: */ /* Only booked value + all 12 months are return at the moment */ /* Update: */ /* - V01.01.02B: - Removed Filter to display everything. Mapping Version to Scenarion must be maintained by Overhead First */ /* - V01.01.02: - Reworked view to get rid of obsolete Reference table */ /* - V01.01.01: - Renamed view & moved to scheme INFI_Costs_SSAS_CSC2 */ /* - V01.01.00: - Re-work to prevent the usage of hardcoded values */ /* - V01.00.00: - Initial version */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;ufn_CostPlan_V1_IFCT0_G5_DemoSystem;2012182564;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;3166;"/**/ /* V01.00.01 2022-12-09 Szivos Andras CI/BTM-AC1 */ /* Fact view for Research & Development Plan Costs booked on Projects from P87 with anomynized data for DemoSystem Purposes */ /* Changes: */ /* - V01.00.01 2022-12-09 Szivos Andras CI/BTM-AC1 Correct scheme to ""[INFI_RnDAnalysis_SSAS_CSC2]"" */ /* - V01.00.00 2022-11-11 Szivos Andras CI/BTM-AC1 Original version created */ /**/ create function INFI_RnDAnalysis_SSAS_CSC2.ufn_CostPlan_V1_IFCT0_G5_DemoSystem ( @FiscalYear int ) RETURNS TABLE AS RETURN SELECT [Sourcesystem] ,[ScenarioId] ,[SettlementProfitCenterDimId] ,[SettlementProductHierarchyDimId] ,[WBSElementDimId] ,[CostElementDimId] ,[CompanyCodeDimId] ,[LegalShareDimId] ,[ResourceTypeInternalAllocationDimId] ,[JunkDimId] ,[PostingYear] ,[PostingYearPeriodId] ,[PostingPeriodId] ,[PartnerObjectDimId] ,[TotalAmountCOAreaCurrency] *(1-(CAST([SettlementProfitCenterDimId] as decimal)/10-FLOOR(CAST([SettlementProfitCenterDimId] as decimal)/10) )/10 *5) * (1+(CAST([CompanyCodeDimId] as decimal)/10-FLOOR(CAST([CompanyCodeDimId] as decimal)/10) )/10 *3) as [TotalAmountCOAreaCurrency] ,[TotalAmountObjectCurrency] *(1-(CAST([SettlementProfitCenterDimId] as decimal)/10-FLOOR(CAST([SettlementProfitCenterDimId] as decimal)/10) )/10 *5) * (1+(CAST([CompanyCodeDimId] as decimal)/10-FLOOR(CAST([CompanyCodeDimId] as decimal)/10) )/10 *3) as [TotalAmountObjectCurrency] ,[CompanyCode] ,[SettlementProfitCenter_BK] ,[SettlementProductHierarchy_BK] ,[CostCollectorObject_BK] ,[WBSElementSAPInternalKey] ,[WBSElement] ,[CostElement] ,[LegalShare] ,[Scenario] ,[Version] ,[ValueType] ,[TotalAmountCOAreaCurrencyOriginal] ,[TotalAmountObjectCurrencyOriginal] ,[SettlementPercentageRate] ,[COBusinessTransaction] ,[SAPDebitCreditCode] ,[PartnerObject] ,[PartnerObjectActivityType] ,[ProjectType] ,[SettlementWBSElementPrefix] ,[AccountAssignmentCategory] ,[SettlementTransaction] ,[YearPeriodValidFrom] ,[YearPeriodValidTo] ,[ResourceTypeAllocationType] ,[ValueAddedTypeDescription] ,[InternalAllocationType] FROM [INFI_RnDAnalysis_SSAS_CSC2].[ufn_CostPlan_V1_IFCT0_G5] (@FiscalYear) fact --Select only projects from one company code INNER JOIN (SELECT ccdi_bs.DimensionId FROM [BUSV_FBI_OH_CSC1].[CompanyCodeDimensionID_BSATC_XX_X] ccdi_bs INNER JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] cc_wh on cc_wh.CompanyCode_HK = ccdi_bs.CompanyCode_HK WHERE cc_wh.CompanyCode_BK LIKE ('9417') ) ccdi_bs_demo -->RBOS-PS Company Code ON ccdi_bs_demo.DimensionId = fact.CompanyCodeDimId"
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ActivityType;2012638313;V ;VIEW;1629;/**/ /* View: V_INTF_COOM_Costs_DIM_ActivityType */ /**/ /* =*/ /* V01.01.00 2020-10-14 Tatjana Derdus CI/DAV2.3 */ /* This view provides the parent child hierarchy of ActivityType for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.01.00 - Replace Dimension IDs by Business Keys */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G4_Yannick;2017702536;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;19153;/**/ /* V01.04.00B 2022-08-04 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.04.00B - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G4_Yannick] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) ,cte_PlanCost as ( select cte_ccoll2ccent.[SourceSytem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] --,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] --,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] --,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,cte_ccoll2ccent.[CostCenter_BK] as [CostCenter_BK_Planned] ,cte_ccoll2ccent.[ControllingArea_BK] as [ControllingArea_BK_Planned] ,cte_ccoll2ccent.[CostCenterDimensionId] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G4_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] --inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl -- on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] --inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh -- on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] --inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs -- on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = cte_ccoll2ccent.[CostCollector_HK] --coll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcp_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcp_ws.[ValueType] UNION ALL select --ccoll_wh.[SourceSystem_BK] as [SourceSystem] cte_ccoll2ccent.[SourceSytem] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] --,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] --,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] --,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,cte_ccoll2ccent.[CostCenter_BK] as [CostCenter_BK_Planned] ,cte_ccoll2ccent.[ControllingArea_BK] as [ControllingArea_BK_Planned] ,cte_ccoll2ccent.[CostCenterDimensionId] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G4_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' --inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] --inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl -- on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] --inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh -- on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] --inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs -- on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join cte_ccoll2ccent on cte_ccoll2ccent.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = cte_ccoll2ccent.[CostCollector_HK] --ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcs_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcs_ws.[ValueType] ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G0;2018314450;V ;VIEW;1610;"/**/ /* View: V_BridgeSparePartToFact_IDIM1_G0 */ /**/ /**/ /* V01.02.01 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from POE */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G0] */ /* Updates: */ /* - V01.02.01 - Replaced PerFact */ /* - V01.02.00 - Adjusted to use source system specific MaterialDimId */ /* - V01.01.02 - Corrected view name */ /* - V01.01.01 - Added ""distinct"" */ /* - V01.01.00 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_CostsActualCost_V2_IFCT0_O1;2019850608;V ;VIEW;12197;/**/ /* View: V_CostsActualCost_V2_IFCT0_O1 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Urban Martin & Yannick Sigwalt & Stephan Wund GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* Fact view for Costs Application - Actual Cost based on re-designed data model, */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 - Created - copied from V_Costs Actual Cost_V2_IFCT0_D0 V01.00.05, commented out material section */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_B2;2019902663;V ;VIEW;29730;/**/ /* View: V_CostActual_V1_IFCT0_B2 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_SSAS_AnonymizeCostsData;2021126491;FN;SQL_SCALAR_FUNCTION;7830;"/* =*/ /* V01.00.05 - 2022-02-22 - Andras Szivos CI/BTM-AC1 */ /* This function does anonymize data for the purposes on Costs Application DemoSystems */ /* Restriction: View for demo purposes only, restricted by CostCenterGlobalHierarchy. */ /* Update: */ /* - V01.00.01 - Initial Version - Function copied from V01.00.01 ufn_SSAS_AnonymizeRBEFData */ /* =*/ create function INFI_Costs_SSAS_CSC2.ufn_SSAS_AnonymizeCostsData ( @StringToBeAnonymized char(100) ) RETURNS nvarchar(100) AS BEGIN -- Declare the return variable here DECLARE @StringAnonymized nvarchar(100) DECLARE @Tokens table (Id INT,OriginalString nvarchar(100), AnonymizedString nvarchar(100) ) DECLARE @i INTEGER; DECLARE @TokenCounter INTEGER IF CHARINDEX ('ArjP',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'ArjP', 'XxP'); IF CHARINDEX ('RBEF',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'RBEF', 'XxP'); IF CHARINDEX ('Aj',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Aj', 'Xx'); IF CHARINDEX ('983',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'983', 'XxP'); IF CHARINDEX ('Aranjuez',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Aranjuez', 'XxP'); IF CHARINDEX ('EB-ES',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'EB-ES', 'Xx-YY'); IF CHARINDEX ('GS/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GS/', 'Xx/'); IF CHARINDEX ('CI/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'CI/', 'Xx/'); IF CHARINDEX ('M/',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'M/', 'Xx/'); /*Following changes are based on input from Conny & Dominic*/ IF CHARINDEX ('P81',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'P81', 'PXX'); IF CHARINDEX ('P87',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'P87', 'PXX'); IF CHARINDEX ('POE',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'POE', 'PXX'); IF CHARINDEX ('GS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GS', 'XX'); IF CHARINDEX ('PS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'PS', 'XX'); IF CHARINDEX ('AS',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'AS', 'XX'); IF CHARINDEX ('Nuernberg',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nuernberg', 'Dummy1'); IF CHARINDEX ('N#rnberg',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'N#rnberg', 'Dummy1'); IF CHARINDEX ('Feuerbach',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Feuerbach', 'Dummy2'); IF CHARINDEX ('Schwbisch Gmnd',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Schwbisch Gmnd', 'Dummy3'); IF CHARINDEX ('Bietigheim',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Bietigheim', 'Dummy4'); IF CHARINDEX ('NuP1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'NuP1', 'Du1P'); IF CHARINDEX ('Nu1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nu1', 'Du1'); IF CHARINDEX ('Nue',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nue', 'Du1P'); IF CHARINDEX ('Nu',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Nu', 'Du1'); IF CHARINDEX ('Fe',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Fe', 'Du2'); IF CHARINDEX ('Sgm',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Sgm', 'Du3'); IF CHARINDEX ('BASD',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'BASD', 'Du3'); IF CHARINDEX ('Bie',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Bie', 'Du4'); IF CHARINDEX ('Leitwerk',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'Leitwerk', ''); IF CHARINDEX ('AM',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'AM', 'BM'); IF CHARINDEX ('ET',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'ET', 'IA'); IF CHARINDEX ('DI',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'DI', 'CE'); IF CHARINDEX ('TC',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'TC', 'YZ'); IF CHARINDEX ('GI',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'GI', 'MN'); IF CHARINDEX ('2130',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2130', '1234'); IF CHARINDEX ('087C-G',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'087C-G', '123A-X'); IF CHARINDEX ('87',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'87', '23'); IF CHARINDEX ('43',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'43', '12'); IF CHARINDEX ('11',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'11', '24'); IF CHARINDEX ('2',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2', '3'); IF CHARINDEX ('8',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'8', '3'); IF CHARINDEX ('1',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'1', '3'); IF CHARINDEX ('5',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'5', '6'); IF CHARINDEX ('2',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'2', '1'); IF CHARINDEX ('4',@StringToBeAnonymized) > 0 INSERT INTO @Tokens VALUES ((Select count(1) from @Tokens)+1,'4', '2'); /*Loop through the string to be anonymized, for each entry which is relevant to be anonymized in @Token table*/ Select @TokenCounter=count(1) from @Tokens SET @i = 1 SET @StringAnonymized = @StringToBeAnonymized WHILE @i <= @TokenCounter BEGIN SELECT TOP 1 @StringAnonymized = REPLACE(@StringAnonymized,OriginalString,AnonymizedString) FROM @Tokens WHERE Id=@i AND CHARINDEX(OriginalString,@StringToBeAnonymized) >0 SET @i = @i + 1; END; SELECT @StringAnonymized = IIF(@StringAnonymized IS NULL, @StringToBeAnonymized, @StringAnonymized ); RETURN @StringAnonymized; --DROP TABLE @Tokens; END"
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_B2;2021998680;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_B2 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_IDIM1_G6;2022402374;V ;VIEW;4967;"/**/ /* View: V_MalfunctionNotification_IDIM1_G6 */ /**/ /*=*/ /* V01.02.00 - 2021-01-18 - Tatjana Derdus CI/DAV2.3 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.02.00: 2021-01-18 Add filter to first if more than one Notification Cause */ /* - V01.01.00: 2021-01-15 Data type fix; Add filter to first if more than one Notification Item */ /* - V01.00.00: 2020-11-25 Initial version */ /*=*/"
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G2;2023990587;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G2 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_COREWriter_PnL_CSC1;62;INFormation Mart as Interface;V_INTF_GLAccountMappingAS2POETableIsReadyForInput;2024446336;V ;VIEW;1177;/**/ /* View: V_INTF_GLAccountMappingAS2POETableIsReadyForInput */ /**/ /* =*/ /* V01.00.00 2020-08-19 Patrik Just CI/DAV2.3 */ /* This view provide CORE.Writer the information if it may enter data into the target table or not */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_B2;2025370580;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_B2 */ /**/ /**/ /* V01.00.01 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from PS0 */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G5;2027570707;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G5 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_ActivityType_ATTR;2028638370;V ;VIEW;2597;"/**/ /* View: V_INTF_COOM_Costs_DIM_ActivityType_ATTR */ /**/ /* =*/ /* V01.01.00 2020-10-14 Tatjana Derdus CI/DAV2.3 */ /* This view provides the attributes of ActivityType for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.00.02 - Adapted column name ""Attribute"" to ""Attribut"" */ /* V01.01.00 - Replace Dimension IDs by Business Keys */ /* =*/"
INFM_Costs_CSC1;70;INFormation Mart;usp_DeltaLoad_INTF_CostActual_FACT_V1;2028898645;P ;SQL_STORED_PROCEDURE;33269;"/* =*/ /* V01.00.10 2023-01-26 Yannick Sigwalt GS/BDD1, Stephan Wund GS/BDD2 & Ilja Frolov GS/BDD2 & Sanja Mihalic CI/XAD3 */ /* This procedure populates the persisted fact for Costs Analysis */ /* Data.CORE Outgoing Interface #0005 - https://inside-docupedia.bosch.com/confluence/x/XDVPV */ /* It populates all CO_CostActual_PerFact_xx_Temp for each month, and afterwards through switch partition feature */ /* the data is moved to CO_CostActual_PerFact_xx where the data are read by Cost Analysis */ /* Update: */ /* - V01.00.10 - Added new version of SR000000025 */ /* - V01.00.09 - Reversed condition for systems w/o material objects now only system with Material Hub populated */ /* - V01.00.08 - Added if condition for systems w/o material objects */ /* - V01.00.07 - restrictions to ValueTypes 03 and 04, adjustment of Junk DimID */ /* - V01.00.06 - Added conformed CostElement */ /* - V01.00.05 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.00.04 - Enabled selection via Source Objects for all Sourcesystems */ /* - V01.00.03 - Reworked creation of SQL Statement now using select & CONCAT instead of + to create statement */ /* - V01.00.02 - Implemented Non-Conform CostCenter Solution for P42 */ /* - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency*/ /* - V01.00.01 - improved Formating of SQL code */ /* - Enhanced Coding to Identify Source Cost Center for Cost Actuals */ /* Restriction: */ /* =*/ create procedure INFM_Costs_CSC1.usp_DeltaLoad_INTF_CostActual_FACT_V1 ( @SourceSystem varchar(10),@SourceSystemVar varchar(10),@SourceOfData varchar(30),@ConsumerOfData varchar(30),@LoadTimestamp datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* Start definition of Parameeter for test execution */ /* Comment/Uncomment for testng Purposes*/ --DECLARE @SourceSystem varchar(10) = 'SAPP81' --DECLARE @SourceSystemVar varchar(10) = 'G4' --DECLARE @SourceOfData varchar(30) = 'COCostActual_V2'; --DECLARE @ConsumerOfData varchar(30) = 'PerFact_COCostActual' --DECLARE @LoadTimestamp datetime2 = sysutcdatetime() --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End definition of Parameeter for test execution */ DECLARE @Counter INT ; DECLARE @maxCounter INT ; DECLARE @minCounter INT ; DECLARE @RC INT ; DECLARE @YearMonth INT ; DECLARE @DateTimeStart DATETIME2(7); DECLARE @DateTimeEnd DATETIME2(7); DECLARE @rowCounter INT = 0; DECLARE @RowsInsertedPartition INT = 0; DROP TABLE IF EXISTS #PartitionList; ----------------------------------------------- --START: section only for testing ----------------------------------------------- --Select [YearMonthCreation] --INTO #PartitionList --FROM --( -- SELECT 202108 [YearMonthCreation] -- --Union -- --SELECT 202108 [YearMonthCreation] -- --Union -- --SELECT 202003 [YearMonthCreation] -- --Union -- --SELECT 202004 [YearMonthCreation] -- --Union -- --SELECT 202005 [YearMonthCreation] -- --Union -- --SELECT 202006 [YearMonthCreation] --) T ----------------------------------------------- --END: section only for testing ----------------------------------------------- SET @RowsRead = 0; SET @RowsInserted = 0; SELECT DISTINCT [YearMonthCreation] INTO #PartitionList FROM [MEAM_DataCORE_CSC1].[V_DeltaLoadSourceSystemByYearMonthCreation] Where 1= 1 AND [SourceSystem] = @SourceSystemVar AND [SourceOfData] = @SourceOfData AND [ConsumerOfData] = @ConsumerOfData ORDER BY [YearMonthCreation] ASC ; Select @Counter = COUNT(*) FROM #PartitionList; IF ( @Counter > 0 ) BEGIN SET @maxCounter = (SELECT COUNT(1) AS CountRows FROM #PartitionList) SET @minCounter = 1 WHILE (@minCounter <= @maxCounter) BEGIN SET @DateTimeStart = SYSUTCDATETIME() SET @YearMonth = (SELECT TOP(1) [YearMonthCreation] FROM #PartitionList) Declare @TruncateSQL NVARCHAR(500) = 'Truncate Table [INFM_Costs_CSC1].[CO_CostActual_PerFact_' + @SourceSystemVar + '_Temp] ;' EXECUTE sp_executesql @TruncateSQL; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_CostCenter NVARCHAR(MAX) = '' DECLARE @SQL_ActualBookedObjectLink NVARCHAR(MAX) = '' DECLARE @SQL_Header NVARCHAR(MAX) = '' DECLARE @SQL_LineItemHub NVARCHAR(MAX) = '' DECLARE @SQL_PartnerObject NVARCHAR(MAX) = '' DECLARE @SQL_Material NVARCHAR(MAX) = '' DECLARE @SQL_SourceObject NVARCHAR(MAX) = '' DECLARE @SQL_InsertFact NVARCHAR(MAX) = '' /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Collect the required cost centers. --------------------------------------------------------------------------------------------------------------------------- */ IF @SourceSystemVar in ('D7') /* Special case P42 translation non-Conform CostCenter to Conform CostCenter */ BEGIN SET @SQL_CostCenter = ( select CONCAT(' SELECT ccoll_wh.[CostCollector_HK] ,ccoll_wh.[CostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccentc_wh.[CostCenterID_BK] AS [CostCenterID_BK] ,ccent_wh.[CostCenterID_BK] AS [NonConformCostCenterID_BK] ,ccentdi_bs.[DimensionID] AS [CostCenterDimensionId] ,ss_at.[ActivityType_ID_BK] AS [ActivityType_ID_BK] into #CostCenter FROM [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl ON ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] inner join [BUSV_RB_CSC1].[V_SR_CostCenterNonConformToCostCenter] v_sr_ccentnc2ccent on v_sr_ccentnc2ccent.[CostCenter_HK] = ccent_wh.[CostCenter_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccentc_wh ON ccentc_wh.[CostCenter_HK] = v_sr_ccentnc2ccent.[CostCenterConform_HK] LEFT JOIN ( select /* New 2020-02-28 SYA8FE */ at_wh.[ActivityType_ID_BK] ,ccoll2at_wl.[CostCollector_HK] FROM [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl ON ccoll2at_wl.[ActivityType_HK] = at_wh.[ActivityType_HK] ) ss_at ON ss_at.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs ON ccentdi_bs.[CostCenter_HK] = ccentc_wh.[CostCenter_HK] ; ALTER TABLE #CostCenter ALTER COLUMN CostCollector_HK BINARY(20) NOT NULL ; ALTER TABLE #CostCenter ADD CONSTRAINT C_IX_CostCenter_CostCollector_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([CostCollector_HK]) ; ' )); END ELSE BEGIN SET @SQL_CostCenter = ( select CONCAT(' SELECT ccoll_wh.[CostCollector_HK] ,ccoll_wh.[CostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent_wh.[CostCenterID_BK] AS [CostCenterID_BK] ,ccent_wh.[CostCenterID_BK] AS [NonConformCostCenterID_BK] ,ccentdi_bs.[DimensionID] AS [CostCenterDimensionId] ,ss_at.[ActivityType_ID_BK] AS [ActivityType_ID_BK] into #CostCenter FROM [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl ON ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] LEFT JOIN ( select /* New 2020-02-28 SYA8FE */ at_wh.[ActivityType_ID_BK] ,ccoll2at_wl.[CostCollector_HK] FROM [RAWV_RB_CSC1].[ActivityType_WHUB0] at_wh INNER JOIN [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl ON ccoll2at_wl.[ActivityType_HK] = at_wh.[ActivityType_HK] ) ss_at ON ss_at.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs ON ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ; ALTER TABLE #CostCenter ALTER COLUMN CostCollector_HK BINARY(20) NOT NULL ; ALTER TABLE #CostCenter ADD CONSTRAINT C_IX_CostCenter_CostCollector_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([CostCollector_HK]) ; ')); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required Links. --------------------------------------------------------------------------------------------------------------------------- */ IF @SourceSystemVar in ('D7') /* Special case P42 translation non-Conform CostElement to Conform CostElement */ BEGIN Set @SQL_ActualBookedObjectLink = ( select CONCAT(' SELECT coca2bo_wl.[COCostActualLineItem_HK] ,coca2bo_wl.[COCostActualHeader_HK] ,ccent.[BookedObjectCostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent.[ActivityType_ID_BK] AS [ActivityType] ,cebcadi_bs.[DimensionID] AS [CostElementDimId] ,ccent.[CostCenterDimensionId] ,ccent.[CostCenterID_BK] ,ccent.[NonConformCostCenterID_BK] ,cebca_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] INTO #BookedObjectLink FROM [RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_' , @SourceSystemVar , '] AS coca2bo_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WSATE_' , @SourceSystemVar , '_L] AS coca2bo_ws ON coca2bo_ws.[COCostActualToBookedObject_HK] = coca2bo_wl.[COCostActualToBookedObject_HK] AND coca2bo_ws.[YearMonthCreation] = ', CAST( @YearMonth as VARCHAR(6)) , ' AND coca2bo_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh ON compc_wh.[CompanyCode_HK] = coca2bo_wl.[CompanyCode_HK] INNER JOIN [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh ON cebca_wh.[CostElementByControllingArea_HK] = coca2bo_wl.[CostElementByControllingArea_HK] INNER JOIN [BUSV_RB_CSC1].[CostElementNonConformToCostElement_BLNKS] cenc2ce_bl ON cenc2ce_bl.[CostElementNonConform_HK] = cebca_wh.[CostElementByControllingArea_HK] INNER JOIN RAWV_RB_CSC1.[CostElementbyControllingArea_WHUB0] cebca_wh_c ON cebca_wh_c.[CostElementByControllingArea_HK] = cenc2ce_bl.[CostElementMaster_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs ON cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh_c.[CostElementByControllingArea_HK] INNER JOIN #CostCenter ccent ON ccent.[CostCollector_HK] = coca2bo_wl.[CostCollector_HK] ; ALTER TABLE #BookedObjectLink ADD CONSTRAINT C_IX_COCostActualToBookedObject_LINKS_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK],[COCostActualHeader_HK]) ; ')); END ELSE BEGIN Set @SQL_ActualBookedObjectLink = ( select CONCAT(' SELECT coca2bo_wl.[COCostActualLineItem_HK] ,coca2bo_wl.[COCostActualHeader_HK] ,ccent.[BookedObjectCostCollectorObject_BK] AS [BookedObjectCostCollectorObject_BK] ,ccent.[ActivityType_ID_BK] AS [ActivityType] ,cebcadi_bs.[DimensionID] AS [CostElementDimId] ,ccent.[CostCenterDimensionId] ,ccent.[CostCenterID_BK] ,ccent.[NonConformCostCenterID_BK] ,cebca_wh.[CostElement_ID_BK] ,compc_wh.[CompanyCode_BK] INTO #BookedObjectLink FROM [RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_' , @SourceSystemVar , '] AS coca2bo_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WSATE_' , @SourceSystemVar , '_L] AS coca2bo_ws ON coca2bo_ws.[COCostActualToBookedObject_HK] = coca2bo_wl.[COCostActualToBookedObject_HK] AND coca2bo_ws.[YearMonthCreation] = ', CAST( @YearMonth as VARCHAR(6)) , ' AND coca2bo_ws.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CompanyCode_WHUB0] compc_wh ON compc_wh.[CompanyCode_HK] = coca2bo_wl.[CompanyCode_HK] INNER JOIN [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh ON cebca_wh.[CostElementByControllingArea_HK] = coca2bo_wl.[CostElementByControllingArea_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs ON cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] INNER JOIN #CostCenter ccent ON ccent.[CostCollector_HK] = coca2bo_wl.[CostCollector_HK] ; ALTER TABLE #BookedObjectLink ADD CONSTRAINT C_IX_COCostActualToBookedObject_LINKS_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK],[COCostActualHeader_HK]) ; ')); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_Header = ( select CONCAT(' With cte as ( Select Distinct [COCostActualHeader_HK] from #BookedObjectLink ) SELECT cocah_ws0.[COCostActualHeader_HK] , cocah_ws0.[PostingDate] , cocah_ws0.[DocumentDate] , cocah_ws0.[SAPCreationTimestampUTC] , cocah_ws0.[IsReversalBooking] , cocah_ws0.[IsReversedBooking] , cocah_ws0.[ControllingAreaCurrencyCode] , cocah_ws0.[YearMonthCreation] , cocahdi_bs.[DimensionId] AS [DocumentNumberDimId] , concat(cocah_ws0.[FiscalYear],cocah_ws0.[PeriodFrom]) AS [PostingPeriodYearId] , cast(cocah_ws0.[PeriodFrom] as int) AS [PostingPeriodId] INTO #TempHeaderItems FROM cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualHeader_WSAT0_' , @SourceSystemVar , '_L] cocah_ws0 ON cocah_ws0.[COCostActualHeader_HK] = cte.[COCostActualHeader_HK] AND cocah_ws0.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocah_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [BUSV_COOM_CSC1].[COCostActualHeaderDimensionId_BSATC_' , @SourceSystemVar , '_X] cocahdi_bs ON cocahdi_bs.[COCostActualHeader_HK] = cte.[COCostActualHeader_HK] ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_HEADERITEMS_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualHeader_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the HUB objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_LineItemHub = ( select CONCAT(' SELECT cocali_wh.[COCostActualLineItem_HK] AS [COCostActualLineItem_HK] , cocali_wh.[COCostActualHeader_BK] AS [DocumentNumberId] , cocali_wh.[COCostActualLineItem_BK] AS [DocumentItemId] , cocali_wh.[ControllingArea_BK] AS [ControllingArea_BK] , cocalidi_bs.[DimensionId] AS [DocumentItemDimId] INTO #LineItemHub FROM #BookedObjectLink bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_' ,@SourceSystemVar , '] cocali_wh ON cocali_wh.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] AND cocali_wh.[SAPSystem] = ''' , @SourceSystem , ''' INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' , @SourceSystemVar , '_L] cocali_ws0 ON cocali_ws0.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] AND cocali_ws0.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws0.[ValueType] in ('''+'03'+''','''+'04'+''') INNER JOIN [BUSV_COOM_CSC1].[COCostActualLineItemDimensionId_BSATC_' , @SourceSystemVar , '_X] cocalidi_bs ON cocalidi_bs.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] ; ALTER TABLE #LineItemHub ADD CONSTRAINT C_IX_BookingCOCostActualLineItem_HUB_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_PartnerObject = ( select CONCAT(' SELECT cocali2po_wl.[COCostActualLineItem_HK] AS [COCostActualLineItem_HK] , ccoll_wh_po.[CostCollectorObject_BK] AS [CostCollectorObject_BK] , ccolldi_bs.[DimensionId] AS [PartnerObjectDimId] INTO #PartnerAndBookedObject FROM [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WLNK0_' , @SourceSystemVar , '] cocali2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WSATE_' , @SourceSystemVar , '_L] cocali2po_wse ON cocali2po_wse.[COCostActualLineItemToPartnerObject_HK] = cocali2po_wl.[COCostActualLineItemToPartnerObject_HK] and cocali2po_wse.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2po_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN #LineItemHub as hub ON hub.[COCostActualLineItem_HK] = cocali2po_wl.[COCostActualLineItem_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.[CostCollector_HK] = cocali2po_wl.[CostCollector_HK] INNER JOIN [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs ON ccolldi_bs.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] ; ALTER TABLE #PartnerAndBookedObject ADD CONSTRAINT C_IX_COCostActualLineItemToPartnerObject_WLNK0_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- STEP 6 : Collect the booked material objects. --------------------------------------------------------------------------------------------------------------------------- */ /* Updated V01.00.09 */ IF @SourceSystemVar in ('B2','G0','G1','G2','G3','G4','G5','G6','G7','G9','GK') /* Added only BBM systems as only these have harmonized Material Number*/ BEGIN Set @SQL_Material = ( select CONCAT(' SELECT cocali2m_wl.[COCostActualLineItem_HK] ,mdi_bs.[DimensionId] INTO #Material FROM [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WLNK0_' , @SourceSystemVar , '] cocali2m_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WSATE_' , @SourceSystemVar , '_L] cocali2m_wse ON cocali2m_wse.[COCostActualLineItemToMaterial_HK] = cocali2m_wl.[COCostActualLineItemToMaterial_HK] AND cocali2m_wse.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2m_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN #LineItemHub as hub ON hub.[COCostActualLineItem_HK] = cocali2m_wl.[COCostActualLineItem_HK] INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = cocali2m_wl.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_XX_X] mdi_bs ON mdi_bs.[Material_HK] = m_wh.[Material_HK] ; ALTER TABLE #Material ADD CONSTRAINT C_IX_COCostActualLineItemToMaterial_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); END ELSE BEGIN Set @SQL_Material = ( select ' SELECT CAST(NULL as BINARY(20)) AS [COCostActualLineItem_HK] ,CAST (NULL AS BIGINT) [DimensionId] INTO #Material; '); END /* --------------------------------------------------------------------------------------------------------------------------- STEP 7 : Collect the Source objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_SourceObject = ( select CONCAT( ' SELECT cocali2so_wl.[COCostActualLineItem_HK] as [COCostActualLineItem_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenterSource_BK] ,ccentdi_bs.[DimensionID] as [CostCenterSourceDimId] INTO #CostCenterSource FROM [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WLNK0_' , @SourceSystemVar , '] cocali2so_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToSourceObject_WSATE_' , @SourceSystemVar , '_L] cocali2so_wse_l ON cocali2so_wse_l.[COCostActualLineItemToSourceObject_HK] = cocali2so_wl.[COCostActualLineItemToSourceObject_HK] AND cocali2so_wse_l.[YearMonthCreation] = ' , CAST( @YearMonth as VARCHAR(6)) , ' AND cocali2so_wse_l.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN #LineItemHub as hub on hub.[COCostActualLineItem_HK] = cocali2so_wl.[COCostActualLineItem_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_so ON ccoll_wh_so.[CostCollector_HK] = cocali2so_wl.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccoll2ccent_wl on ccoll2ccent_wl.[CostCollector_HK] = ccoll_wh_so.[CostCollector_HK] INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccoll2ccent_wl.[CostCenter_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ; ALTER TABLE #CostCenterSource ADD CONSTRAINT C_IX_COCostActualLineItemToSource_WLNK0_' , @SourceSystemVar , ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ')); /* --------------------------------------------------------------------------------------------------------------------------- INSERT result set into TEMP Fact-Table. This result set will then be SWITCHED into the target Fact-Table. Example... [BUSV_COOM_CSC2].[ActualCost_BRG_G5_Temp] will be switched to [BUSV_COOM_CSC2].[ActualCost_BRG_G5] --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_InsertFact = ( select CONCAT(' INSERT INTO [INFM_Costs_CSC1].[CO_CostActual_PerFact_' , @SourceSystemVar , '_Temp] SELECT CAST(''', CAST(@LoadTimestamp AS NVARCHAR(MAX)) , ''' AS DATETIME2) AS [LoadDate] ,' , CAST(@AuditTrailId AS NVARCHAR(MAX)), ' AS [AuditId] ,' , CAST(@EntityId AS NVARCHAR(MAX)), ' AS [EntityId] , cocali_ws0.[YearMonthCreation] AS [YearMonthCreation] , convert(int,convert(char(8),cast(header.[SAPCreationTimestampUTC] as date),112)) AS [EntryDate] , header.[DocumentNumberDimId] AS [DocumentNumberDimId] , cocali_wh.[DocumentItemDimId] AS [DocumentItemDimId] , ''' , @SourceSystem , ''' AS [SourceSystem] ,cocali_wh.[ControllingArea_BK] AS [COArea] ,bo.[CostElement_ID_BK] AS [CostElementId_BK] ,bo.[CostCenterID_BK] AS [CostCenterId_BK] /*,bo.[NonConformCostCenterID_BK] AS [NonConformCostCenterId_BK]*/ ,bo.[CompanyCode_BK] AS [CompanyCode_BK] ,cocali_wh.[DocumentNumberId] AS [DocumentNumberId] ,cocali_wh.[DocumentItemId] AS [DocumentItemId] ,COALESCE( CONCAT ( COALESCE(usrcoomdbi.[DebitCreditCode],''U'') , ''_'' , COALESCE(usrcoomsi.[StatisticalIndicator],''0'') , ''_'' , Coalesce(LEFT(prt.CostCollectorObject_BK,2),N''0'') ) , ''0'' ) AS [JunkDimID] ,cocali_ws0.[DebitCreditCode] AS [DebitCreditIndicator] ,cocali_ws0.[ValueType] AS [ValueType] ,header.PostingPeriodYearId AS [PostingPeriodYearId] ,header.PostingPeriodId AS [PostingPeriodId] ,COALESCE(bo.CostElementDimId, 0) AS [CostElementDimId] ,Coalesce(bo.CostCenterDimensionId,0) AS [CostCenterDimId] ,Coalesce(prt.PartnerObjectDimId, 0) AS [PartnerObjectDimId] ,prt.[CostCollectorObject_BK] AS [PartnerObjectId] ,material.[DimensionId] AS [MaterialDimId] ,header.[DocumentDate] AS [DocumentDate] ,header.[PostingDate] AS [PostingDate] ,bo.[ActivityType] AS [ActivityType] ,cocali_ws0.[COBusinessTransaction] AS [COBusinessTransaction] ,header.[IsReversedBooking] AS [DocumentWasReversed] ,header.[IsReversalBooking] AS [DocumentisReversalDocument] ,cocali_ws0.[ControllingAreaTotalAmount] AS [TotalAmountCOAreaCurrency] ,cocali_ws0.[ControllingAreaFixedAmount] AS [FixedAmountCOAreaCurrency] ,cocali_ws0.[TransactionTotalAmount] AS [TotalAmountTransactionCurrency] ,cocali_ws0.[TransactionCurrency] AS [TransactionCurrencyCode] ,cocali_ws0.[ObjectTotalAmount] AS [TotalAmountObjectCurrency] ,cocali_ws0.[ControllingAreaTotalPriceVarianceAmount] AS [ControllingAreaTotalPriceVarianceAmount] ,cocali_ws0.[ControllingAreaFixedPriceVarianceAmount] AS [ControllingAreaFixedPriceVarianceAmount] ,cocali_ws0.[ObjectCurrency] AS [ObjectCurrencyCode] ,cocali_ws0.[TotalQuantity] AS [TotalQuantity] ,cocali_ws0.[FixedQuantity] AS [FixedQuantity] ,cocali_ws0.[UnitofMeasure] AS [UnitOfMeasure] ,ccents.[CostCenterSource_BK] AS [SourceCostCenterId_BK] ,COALESCE(ccents.[CostCenterSourceDimId],0) AS [SourceCostCenterDimId] ,(cocali_ws0.[ControllingAreaTotalAmount] - cocali_ws0.[ControllingAreaFixedAmount]) AS [VariableAmountCOAreaCurrency] ,IIF(cocali_ws0.[ControllingAreaTotalAmount] <> 0,cocali_ws0.[ControllingAreaFixedAmount] / cocali_ws0.[ControllingAreaTotalAmount] * cocali_ws0.[ObjectTotalAmount],0) AS [FixedAmountObjectCurrency] ,IIF(cocali_ws0.[ControllingAreaTotalAmount] <> 0 and cocali_ws0.[ControllingAreaFixedAmount] <> 0 ,cocali_ws0.[ObjectTotalAmount] - cocali_ws0.[ControllingAreaFixedAmount] / cocali_ws0.[ControllingAreaTotalAmount] * cocali_ws0.[ObjectTotalAmount] ,cocali_ws0.[ObjectTotalAmount]) AS [VariableAmountObjectCurrency] FROM #BookedObjectLink bo INNER JOIN #LineItemHub cocali_wh ON cocali_wh.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' , @SourceSystemVar , '_L] cocali_ws0 ON cocali_ws0.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] AND cocali_ws0.[YearMonthCreation] = ' , CAST( @YearMonth as NVARCHAR(6)) , ' AND cocali_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' AND cocali_ws0.[ValueType] in ('''+'03'+''','''+'04'+''') INNER JOIN #TempHeaderItems header ON header.[COCostActualHeader_HK] = bo.[COCostActualHeader_HK] LEFT OUTER JOIN #PartnerAndBookedObject prt ON prt.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #Material material ON material.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #CostCenterSource ccents on ccents.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (cocali_ws0.[DebitCreditCode],cocali_ws0.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (cocali_ws0.[ValueType]) usrcoomsi ; ')); SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = (SELECT CONCAT( @SQL_CostCenter , @SQL_ActualBookedObjectLink , @SQL_Header , @SQL_LineItemHub , @SQL_PartnerObject , @SQL_Material , @SQL_SourceObject , @SQL_InsertFact) ); EXECUTE sp_executesql @SQL; SET @DateTimeEnd = SYSUTCDATETIME(); SET @rowCounter = 0; DECLARE @PartitionNumber INT ; SELECT @PartitionNumber = [partition_number] , @RowsInsertedPartition = [rows] FROM sys.partitions as par WHERE ( par.object_id = OBJECT_ID('INFM_Costs_CSC1.CO_CostActual_PerFact_' + @SourceSystemVar + '_Temp') ) And ([rows] > 0 ); DECLARE @return_value int ; IF ( @PartitionNumber IS NOT NULL ) BEGIN SET @TruncateSQL = ' TRUNCATE TABLE [INFM_Costs_CSC1].[CO_CostActual_PerFact_' + @SourceSystemVar + '] WITH (PARTITIONS(' + Cast(@PartitionNumber as varchar(4)) + ')) ; ALTER TABLE [INFM_Costs_CSC1].[CO_CostActual_PerFact_' + @SourceSystemVar + '_Temp] SWITCH PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' TO [INFM_Costs_CSC1].[CO_CostActual_PerFact_' + @SourceSystemVar + '] PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' ; ' EXECUTE sp_executesql @TruncateSQL; /* Call the procedure to inform the successful loading of the data for the selected partition*/ EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar ,@SourceOfData = @SourceOfData ,@ConsumerOfData = @ConsumerOfData ,@YearMonthCreation = @YearMonth ,@StartDateTime = @DateTimeStart ,@EndDateTime = @DateTimeEnd ,@RowsInserted = @RowsInsertedPartition ; END IF ( @PartitionNumber IS NULL ) /* Call the procedure to inform the successful loading of the data for the selected partition*/ EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar ,@SourceOfData = @SourceOfData ,@ConsumerOfData = @ConsumerOfData ,@YearMonthCreation = @YearMonth ,@StartDateTime = @DateTimeStart ,@EndDateTime = @DateTimeEnd ,@RowsInserted = @RowsInsertedPartition ; SET @minCounter = @minCounter + 1 ; SET @rowCounter = @RowsInsertedPartition ; DELETE TOP(1) FROM #PartitionList ; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; END DROP TABLE #PartitionList ; END END"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G4;2034314507;V ;VIEW;1610;"/**/ /* View: V_BridgeSparePartToFact_IDIM1_G4 */ /**/ /**/ /* V01.02.01 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P81 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G4] */ /* Updates: */ /* - V01.02.01 - Replaced PerFact */ /* - V01.02.00 - Adjusted to use source system specific MaterialDimId */ /* - V01.01.02 - Corrected view name */ /* - V01.01.01 - Added ""distinct"" */ /* - V01.01.00 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G0;2035850665;V ;VIEW;15261;"/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G0 */ /**/ /**/ /* V01.01.01 - 2023-01-05 Michal Erdman & Sanja Mihalic CI/XTD3 & Tatjana Derdus CI/DAV2.3 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.01.01 - Added new version of SR25 */ /* - V01.01.00 Adjusted query (incl. link to equipment via left join); no structural changes to view */ /* - V01.00.01 Adjusted to new CO-OM model #75714 - Sanja Mihalic CI/XTD3 (2021-08-09) */ /* - V01.00.00 Copied from V_MaintenanceActualCost_V2_IFCT0_G5 V01.00.00 (2020-05-04) */ /**/"
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G0;2035902720;V ;VIEW;29727;/**/ /* View: V_CostActual_V1_IFCT0_G0 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Scenario;2036410524;V ;VIEW;2387;"/**/ /* View: V_INTF_PNL_DIM_Scenario */ /**/ /* =*/ /* V01.00.01 2021-10-28 Hui Yang CI/XEF1 */ /* Interface provides hierarchy of Scenario for TM1 */ /* Outgoing interface #0153 https://inside-docupedia.bosch.com/confluence/x/Tqjqa */ /* Update: */ /* - V01.00.01 2021-10-28 YAH8FE Set top level ""Scenario_Totel"" to ""Null"" and filtered ""Scenario_Total"" */ /* Restriction: */ /* - none */ /* =*/"
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G0;2037998737;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G0 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_CostCenter;2038402431;V ;VIEW;17894;/**/ /* View: V_INTF_COOM_Costs_DIM_CostCenter */ /**/ /* =*/ /* V01.01.00 2020-11-20 Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* This view provides the parent child hierarchy of CostCenter for TM1 */ /* The following softrules are implemented in this view */ /* #FBI-SR-000000047 https://inside-docupedia.bosch.com/confluence/x/wpM8Wg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.01.00 - Added CostCenter Hierarchy along Organization Office */ /* -Switched CostCenter from RBW-CORE to RB-B */ /* V01.00.00 - Initial version based on predeccessor view [INFI_HR_TM1_CSC2]. */ /* [V_INTF_HR_DIM_CostCenter] (V01.00.02), Replaced DimIDs by BKs. */ /* =*/
INFM_CONFDIM_CSC1;10;INFormation Mart;DimDate;2039678314;V ;VIEW;1072;/**/ /* View: DimDate */ /**/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G3;2039990644;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G3 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCost_Short_D7;2041370637;V ;VIEW;1721;/**/ /* View: V_FactActualCost_Short_D7 */ /**/ /**/ /* V01.00.01 2022-08-10 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs aggregated booked on Cost Centers from P42 */ /* Changes: */ /* Restriction: */ /**/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_G6;2043570764;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_G6 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFM_Costs_CSC1;70;INFormation Mart;usp_DeltaLoad_INTF_CostMaintenance_FACT_V1;2044898702;P ;SQL_STORED_PROCEDURE;27455;"/* =*/ /* V01.00.01 2023-01-26 YannicK Sigwalt GS/BDD2 & Sanja Mihalic CI/XTD3 */ /* This procedure populates teh persisted fact for Costs Maintenance */ /* It populates all CO_CostMaintenance_PerFact_xx_Temp for each month, and afterwards through switch partition feature */ /* the data is moved to CO_CostMaintenance_PerFact_xx where the data are read by Cost Maintenance */ /* Data.CORE Outgoing Interface #0263 https://inside-docupedia.bosch.com/confluence/x/8YGJo */ /* Consumed Soft Rules */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw - Debit Credit & Statistical indicator */ /* Restriction: */ /* Update: */ /* V01.00.01 -Added new version of SR000000025 */ /* =*/ create procedure INFM_Costs_CSC1.usp_DeltaLoad_INTF_CostMaintenance_FACT_V1 ( @SourceSystem varchar(10),@SourceSystemVar varchar(10),@SourceOfData varchar(30),@ConsumerOfData varchar(30),@LoadTimestamp datetime2,@LoadBatchId bigint,@ProcessStepId bigint = 0,@EntityId bigint = 0,@AuditTrailId bigint = 0,@ProcessStatusMessage nvarchar(4000) = null out,@RowsRead int out,@RowsInserted int out,@RowsUpdated int out,@RowsDeleted int out,@ErrorSeverity int out,@ErrorState int out,@ErrorProcedure nvarchar(128) out,@ErrorLine int out ) as BEGIN /* Start definition of Parameeter for test execution */ /* Comment/Uncomment for testng Purposes*/ --DECLARE @SourceSystem varchar(10) = 'SAPP81' --DECLARE @SourceSystemVar varchar(10) = 'G4' --DECLARE @SourceOfData varchar(30) = 'COCostActual_V2'; --DECLARE @ConsumerOfData varchar(30) = 'PerFact_CostMaintenance' --DECLARE @LoadTimestamp datetime2 = sysutcdatetime() --DECLARE @LoadBatchId bigint = 112 --DECLARE @ProcessStepId bigint = 0 --DECLARE @EntityId bigint = 0 --DECLARE @AuditTrailId bigint = 0 --DECLARE @ProcessStatusMessage nvarchar(4000) = null --DECLARE @RowsRead int --DECLARE @RowsInserted int --DECLARE @RowsUpdated int --DECLARE @RowsDeleted int --DECLARE @ErrorSeverity int --DECLARE @ErrorState int --DECLARE @ErrorProcedure nvarchar(128) --DECLARE @ErrorLine int /* End definition of Parameeter for test execution */ DECLARE @Counter INT ; DECLARE @maxCounter INT ; DECLARE @minCounter INT ; DECLARE @RC INT ; DECLARE @YearMonth INT ; DECLARE @DateTimeStart DATETIME2(7); DECLARE @DateTimeEnd DATETIME2(7); DECLARE @rowCounter INT = 0; DECLARE @RowsInsertedPartition INT = 0; ----------------------------------------------- --START: section only for testing ----------------------------------------------- /* --Sample Test Select [YearMonthCreation] INTO #PartitionList FROM ( SELECT 201801 [YearMonthCreation] UNION SELECT 201802 [YearMonthCreation] ) T */ ----------------------------------------------- --END: section only for testing ----------------------------------------------- SET @RowsRead = 0; SET @RowsInserted = 0; DROP TABLE IF EXISTS #PartitionList ; SELECT DISTINCT [YearMonthCreation] INTO #PartitionList FROM [MEAM_DataCORE_CSC1].[V_DeltaLoadSourceSystemByYearMonthCreation] Where 1= 1 AND [SourceSystem] = @SourceSystemVar AND [SourceOfData] = @SourceOfData AND [ConsumerOfData] = @ConsumerOfData ORDER BY [YearMonthCreation] ASC ; Select @Counter = COUNT(*) FROM #PartitionList; IF ( @Counter > 0 ) BEGIN SET @maxCounter = (SELECT COUNT(1) AS CountRows FROM #PartitionList) SET @minCounter = 1 WHILE (@minCounter <= @maxCounter) BEGIN SET @DateTimeStart = SYSUTCDATETIME() SET @YearMonth = (SELECT TOP(1) [YearMonthCreation] FROM #PartitionList) Declare @TruncateSQL NVARCHAR(500) = 'Truncate Table [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_' + @SourceSystemVar + '_Temp] ;' EXECUTE sp_executesql @TruncateSQL; DECLARE @SQL NVARCHAR(MAX) = '' DECLARE @SQL_CostCenterMaintenanceOrders NVARCHAR(MAX) = '' DECLARE @SQL_BookedObjectLink NVARCHAR(MAX) = '' DECLARE @SQL_MaintenanceOrders NVARCHAR(MAX) = '' DECLARE @SQL_TempHeaderItems NVARCHAR(MAX) = '' DECLARE @SQL_PartnerObject NVARCHAR(MAX) = '' DECLARE @SQL_PartnerAndBookedObject NVARCHAR(MAX) = '' DECLARE @SQL_PurchaseOrderObject NVARCHAR(MAX) = '' DECLARE @SQL_Material NVARCHAR(MAX) = '' DECLARE @SQL_InsertFact NVARCHAR(MAX) = '' /* --------------------------------------------------------------------------------------------------------------------------- STEP 1 : Collect the required cost centers , maintenenace orders --------------------------------------------------------------------------------------------------------------------------- */ SET @SQL_CostCenterMaintenanceOrders = ' SELECT mo2ccoll_wl.[MaintenanceOrder_HK] ,mo2ccoll_wl.[CostCollector_HK] Into #CostCenterMaintenanceOrders FROM [RAWV_COOM_CSC1].[MaintenanceOrder_WHUB0] mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCollector_WLNK0] as mo2ccoll_wl ON ''' + @SourceSystem + ''' = mo_wh.[SAPSystem] AND mo2ccoll_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_bo ON ccoll_wh_bo.[CostCollector_HK] = mo2ccoll_wl.[CostCollector_HK] ; ALTER TABLE #CostCenterMaintenanceOrders ADD CONSTRAINT C_IX_CostCenterMaintenanceOrders_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([CostCollector_HK],[MaintenanceOrder_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 2 : Collect the required Links. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_BookedObjectLink = ' SELECT coca2bo_wl.[COCostActualLineItem_HK] ,coca2bo_wl.[COCostActualHeader_HK] ,coca2bo_wl.[CostElementByControllingArea_HK] ,coca2bo_wl.[CostCollector_HK] ,ord.[MaintenanceOrder_HK] Into #BookedObjectLink FROM #CostCenterMaintenanceOrders ord INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WLNK0_' + @SourceSystemVar + '] AS coca2bo_wl ON coca2bo_wl.[CostCollector_HK] = ord.[CostCollector_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualToBookedObject_WSATE_' + @SourceSystemVar + '_L] AS coca2bo_wse_l ON coca2bo_wse_l.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND coca2bo_wse_l.[COCostActualToBookedObject_HK] = coca2bo_wl.[COCostActualToBookedObject_HK] AND coca2bo_wse_l.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' ; ALTER TABLE #BookedObjectLink ADD CONSTRAINT C_IX_COCostActualToBookedObject_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK],[COCostActualHeader_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 3 : Collect the required Equipments,Responsible Cost Centers,basic settlement Cost Centers. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_MaintenanceOrders = /*' Create table #MaintenenaceOrders ( [MaintenanceOrder_HK] binary(20) NOT NULL, [EquipmentDimId] INT NOT NULL, [ResponsibleCostCenterDimId] INT NOT NULL, [CostCenterforBasicSettlementDimId] INT NOT NULL ); ALTER TABLE #MaintenenaceOrders ADD CONSTRAINT C_IX_MaintenenaceOrders_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([MaintenanceOrder_HK]) ;*/ ' With cte_MO as ( SELECT Distinct [MaintenanceOrder_HK] FROM #BookedObjectLink ) SELECT [MaintenanceOrder_HK] ,COALESCE( [Equipment_HK] , 0 ) AS [EquipmentDimId] ,COALESCE( [Responsible_HK] , 0 ) AS [ResponsibleCostCenterDimId] ,COALESCE( [BasicSettlement_HK] , 0) AS [CostCenterforBasicSettlementDimId] INTO #MaintenanceOrders FROM ( SELECT mo2io_wl.[MaintenanceOrder_HK] ,COALESCE(edi_bs_x.[DimensionId], 0) AS [Ref_HK] ,''Equipment_HK'' AS [OrderType] FROM cte_MO mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToInternalOrder_WLNK0] as mo2io_wl ON mo2io_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrder_WHUB0] io_wh ON io_wh.[InternalOrder_HK] = mo2io_wl.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WLNK0] io2e_wl ON io2e_wl.[InternalOrder_HK] = io_wh.[InternalOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[InternalOrderToEquipment_WSATE_' + @SourceSystemVar + '_X] io2e_ws_x ON io2e_ws_x.[InternalOrderToEquipment_HK] = io2e_wl.[InternalOrderToEquipment_HK] and io2e_ws_x.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_Production_MD_CSC1].[Equipment_WHUB0] e_wh ON e_wh.[Equipment_HK] = io2e_wl.[Equipment_HK] INNER JOIN [BUSV_Production_MD_CSC1].[Equipment_DimensionId_BSATC_XX_X] edi_bs_x ON edi_bs_x.[Equipment_HK] = e_wh.[Equipment_HK] Union All SELECT mo2rccent_wl.[MaintenanceOrder_HK] ,COALESCE(ccentdi_bs_x.DimensionID, 0) AS [Ref_HK] ,''Responsible_HK'' AS [OrderType] FROM cte_MO mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WLNK0] as mo2rccent_wl ON mo2rccent_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToResponsibleCostCenter_WSATE_' + @SourceSystemVar + '_X] mo2rccent_ws_x ON mo2rccent_ws_x.[MaintenanceOrderToResponsibleCostCenter_HK] = mo2rccent_wl.[MaintenanceOrderToResponsibleCostCenter_HK] and mo2rccent_ws_x.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = mo2rccent_wl.[ResponsibleCostCenter_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x ON ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] Union All SELECT mo2ccentbs_wl.[MaintenanceOrder_HK] ,COALESCE(ccentdi_bs_x.DimensionID, 0) AS [Ref_HK] ,''BasicSettlement_HK'' AS [OrderType] FROM cte_MO mo_wh INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WLNK0] as mo2ccentbs_wl ON mo2ccentbs_wl.[MaintenanceOrder_HK] = mo_wh.[MaintenanceOrder_HK] INNER JOIN [RAWV_COOM_CSC1].[MaintenanceOrderToCostCenterBasicSettlement_WSATE_' + @SourceSystemVar + '_X] mo2ccentbs_ws_x ON mo2ccentbs_ws_x.[MaintenanceOrderToCostCenterBasicSettlement_HK] = mo2ccentbs_wl.[MaintenanceOrderToCostCenterBasicSettlement_HK] and mo2ccentbs_ws_x.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh ON ccent_wh.[CostCenter_HK] = mo2ccentbs_wl.[CostCenterBasicSettlement_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs_x ON ccentdi_bs_x.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) AS S PIVOT ( MAX(Ref_HK) FOR [OrderType] IN ([Equipment_HK],[Responsible_HK],[BasicSettlement_HK]) ) AS PVT ; ALTER TABLE #MaintenanceOrders ADD CONSTRAINT C_IX_MaintenanceOrders_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([MaintenanceOrder_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 4 : Collect the Header related fields for the selected partition. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_TempHeaderItems = ' ;With cte_Header as ( SELECT Distinct [COCostActualHeader_HK] FROM #BookedObjectLink ) SELECT cocah_ws0.[COCostActualHeader_HK] ,cocah_ws0.[PostingDate] ,cocah_ws0.[DocumentDate] ,CAST(cocah_ws0.[DateTimeDocumentWasCreated] AS DATE ) AS [EntryDate] ,cocah_ws0.[IsReversalBooking] ,cocah_ws0.[IsReversedBooking] ,cocah_ws0.[ControllingAreaCurrencyCode] ,cocahdi_bs.[DimensionId] AS [DocumentNumberDimId] INTO #TempHeaderItems FROM cte_Header cte INNER JOIN [RAWV_COOM_CSC1].[COCostActualHeader_WSAT0_' + @SourceSystemVar + '_L] cocah_ws0 ON cocah_ws0.[COCostActualHeader_HK] = cte.[COCostActualHeader_HK] AND cocah_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocah_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [BUSV_COOM_CSC1].[COCostActualHeaderDimensionId_BSATC_' + @SourceSystemVar + '_X] cocahdi_bs ON cocahdi_bs.[COCostActualHeader_HK] = cocah_ws0.[COCostActualHeader_HK] ; ALTER TABLE #TempHeaderItems ADD CONSTRAINT C_IX_COCostActualHeader_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualHeader_HK]) ; ' /* --------------------------------------------------------------------------------------------------------------------------- STEP 5 : Collect the Partner objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_PartnerAndBookedObject = ' SELECT cocali2po_wl.[COCostActualLineItem_HK] ,ccoll_wh_po.[CostCollectorObject_BK] ,COALESCE(ccolldi_bs.[DimensionId],0) AS [PartnerObjectDimId] INTO #PartnerAndBookedObject FROM [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WLNK0_' + @SourceSystemVar + '] cocali2po_wl INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPartnerObject_WSATE_' + @SourceSystemVar + '_L] cocali2po_wse ON cocali2po_wse.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocali2po_wse.[COCostActualLineItemToPartnerObject_HK] = cocali2po_wl.[COCostActualLineItemToPartnerObject_HK] AND cocali2po_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN #BookedObjectLink as bol ON bol.[COCostActualLineItem_HK] = cocali2po_wl.[COCostActualLineItem_HK] INNER JOIN [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh_po ON ccoll_wh_po.[CostCollector_HK] = cocali2po_wl.[CostCollector_HK] INNER JOIN [BUSV_RB_CSC1].[CostCollectorDimensionId_BSATC_XX_X] ccolldi_bs ON ccolldi_bs.[CostCollector_HK] = ccoll_wh_po.[CostCollector_HK] ; ALTER TABLE #PartnerAndBookedObject ADD CONSTRAINT C_IX_COCostActualPartnerObject_WLNK0_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- STEP 6 : Collect the Purchase order objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_PurchaseOrderObject = ' SELECT cocali2po_wl.[COCostActualLineItem_HK] ,COALESCE(polidis_bs.[DimensionId],0) AS [PurchaseOrderLineItemDimId] INTO #PurchaseOrderObject FROM #BookedObjectLink as bol INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPurchaseOrder_WLNK0_' + @SourceSystemVar + '] cocali2po_wl ON cocali2po_wl.[COCostActualLineItem_HK] = bol.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToPurchaseOrder_WSATE_' + @SourceSystemVar + '_L] cocali2po_wse ON cocali2po_wse.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocali2po_wse.[COCostActualLineItemToPurchaseOrder_HK] = cocali2po_wl.[COCostActualLineItemToPurchaseOrder_HK] AND cocali2po_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_PUR_CSC2].[PurchaseOrderLineItem_WHUB0] poli_wh ON poli_wh.[PurchaseOrderLineItem_HK] = cocali2po_wl.[PurchaseOrderLineItem_HK] INNER JOIN [BUSV_PUR_CSC2].[PurchaseOrderLineItemDimensionId_BSATC_XX_X] polidis_bs ON polidis_bs.[PurchaseOrderLineItem_HK] = poli_wh.[PurchaseOrderLineItem_HK] ; ALTER TABLE #PurchaseOrderObject ADD CONSTRAINT C_IX_COCostActualurchaseOrder_WLNK0_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; '; /* --------------------------------------------------------------------------------------------------------------------------- STEP 7 : Collect the Material objects. --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_Material = ' SELECT cocali2m_wl.[COCostActualLineItem_HK] ,COALESCE(mdi_bs.[DimensionId],0) AS [MaterialDimId] INTO #Material FROM #BookedObjectLink bol INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WLNK0_' + @SourceSystemVar + '] cocali2m_wl ON cocali2m_wl.[COCostActualLineItem_HK] = bol.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItemToMaterial_WSATE_' + @SourceSystemVar + '_L] cocali2m_wse ON cocali2m_wse.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocali2m_wse.[COCostActualLineItemToMaterial_HK] = cocali2m_wl.[COCostActualLineItemToMaterial_HK] AND cocali2m_wse.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [RAWV_RB_CSC1].[Material_WHUB0] m_wh ON m_wh.[Material_HK] = cocali2m_wl.[Material_HK] INNER JOIN [BUSV_RB_CSC1].[MaterialDimensionId_BSATC_' + @SourceSystemVar + '_X] mdi_bs ON mdi_bs.[Material_HK] = m_wh.[Material_HK] ; ALTER TABLE #Material ADD CONSTRAINT C_IX_COCostActualMaterial_MT_D_' + @SourceSystemVar + ' PRIMARY KEY CLUSTERED ([COCostActualLineItem_HK]) ; ' ; /* --------------------------------------------------------------------------------------------------------------------------- INSERT result set into TEMP Fact-Table. This result set will then be SWITCHED into the target Fact-Table. Example... [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G5_Temp] will be switched to [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G5] --------------------------------------------------------------------------------------------------------------------------- */ Set @SQL_InsertFact = ' INSERT INTO [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_' + @SourceSystemVar + '_Temp] SELECT CAST(''' + CAST(@LoadTimestamp AS NVARCHAR(MAX)) + ''' AS DATETIME2) AS [LoadDate] ,' + CAST(@AuditTrailId AS NVARCHAR(MAX))+ ' AS [AuditId] ,' + CAST(@EntityId AS NVARCHAR(MAX))+ ' AS [EntityId] ,' + CAST( @YearMonth as VARCHAR(6)) + ' AS [YearMonthCreation] ,iomodi_bs.[DimensionId] AS [MaintenanceOrderDimId] ,cocah_ws0.[DocumentNumberDimId] AS [COActualCostsDocumentNumberDimId] ,cocalidi_bs.[DimensionId] AS [COActualCostsDocumentItemDimId] ,cocali_wh.[COCostActualHeader_BK] AS [COActualCostsDocumentNumberId] ,cocali_wh.[COCostActualLineItem_BK] AS [COActualCostsDocumentItemId] , ''' + @SourceSystem + ''' AS [SourceSystem] ,COALESCE(cebcadi_bs.[DimensionID],0) AS [CostElementbyControllingAreaDimId] ,COALESCE(MO.[ResponsibleCostCenterDimId], 0) AS [ResponsibleCostCenterDimId] ,COALESCE(MO.[CostCenterforBasicSettlementDimId], 0) AS [CostCenterforBasicSettlementDimId] ,COALESCE(MO.[EquipmentDimId], 0) AS [EquipmentDimId] ,COALESCE( CONCAT ( COALESCE(usrcoomdbi.[DebitCreditCode],''U'') , ''_'' , COALESCE(usrcoomsi.[StatisticalIndicator],''0'') , ''_'' , Coalesce(LEFT(prt.CostCollectorObject_BK,2),N''0'') ) , ''0'' ) AS [JunkDimID] ,CONCAT(cocali_ws0.[FiscalYear],cocali_ws0.[Period]) AS [PostingPeriodYearId] ,CAST(convert (char(8),cocah_ws0.[EntryDate],112) AS int) AS [EntryDateId] ,COALESCE(m.[MaterialDimId], 0) AS [MaterialDimId] ,COALESCE(prt.[PartnerObjectDimId], 0) AS [PartnerObjectDimId] ,COALESCE(pur.[PurchaseOrderLineItemDimId], 0) AS [PurchaseOrderLineItemDimId] ,Coalesce(cocali_ws0.[OffsettingAccountNumber],'''') AS [OffsetAccount] ,cocah_ws0.[EntryDate] AS [EntryDate] ,cocah_ws0.[DocumentDate] AS [DocumentDate] ,cocah_ws0.[PostingDate] AS [PostingDate] ,cocali_ws0.[COBusinessTransaction] AS [COBusinessTransaction] ,COALESCE(cocah_ws0.[IsReversedBooking],'''') AS [DocumentWasReversed] ,COALESCE(cocah_ws0.[IsReversalBooking],'''') AS [DocumentisReversalDocument] ,cocali_ws0.[ControllingAreaTotalAmount] AS [TotalAmountCOAreaCurrency] ,cocali_ws0.[ControllingAreaFixedAmount] AS [FixedAmountCOAreaCurrency] ,cocah_ws0.[ControllingAreaCurrencyCode] AS [COAreaCurrencyCode] ,cocali_ws0.[TransactionTotalAmount] AS [TotalAmountTransactionCurrency] ,cocali_ws0.[TransactionCurrency] AS [TransactionCurrencyCode] ,cocali_ws0.[ObjectTotalAmount] AS [TotalAmountObjectCurrency] ,cocali_ws0.[ObjectCurrency] AS [ObjectCurrencyCode] ,cocali_ws0.[EnteredTotalQuantity] AS [TotalQuantity] ,cocali_ws0.[EnteredFixedQuantity] AS [FixedQuantity] ,COALESCE(cocali_ws0.[UnitOfEntry],'''') AS [UnitOfMeasure] FROM #BookedObjectLink bo INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WHUB0_' + @SourceSystemVar + '] cocali_wh ON cocali_wh.[SAPSystem] = ''' + @SourceSystem + ''' AND cocali_wh.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] INNER JOIN [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_' + @SourceSystemVar + '_L] cocali_ws0 ON cocali_ws0.[YearMonthCreation] = ' + CAST( @YearMonth as VARCHAR(6)) + ' AND cocali_ws0.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] AND cocali_ws0.[LoadEndDate] = ''2999-12-31 00:00:00.0000000'' INNER JOIN [BUSV_COOM_CSC1].[COCostActualLineItemDimensionId_BSATC_' + @SourceSystemVar + '_X] cocalidi_bs ON cocalidi_bs.[COCostActualLineItem_HK] = cocali_wh.[COCostActualLineItem_HK] INNER JOIN [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs ON cebcadi_bs.[CostElementByControllingArea_HK] = bo.[CostElementByControllingArea_HK] INNER JOIN #TempHeaderItems cocah_ws0 ON cocah_ws0.[COCostActualHeader_HK] = bo.[COCostActualHeader_HK] LEFT OUTER JOIN #MaintenanceOrders MO ON MO.[MaintenanceOrder_HK] = bo.[MaintenanceOrder_HK] INNER JOIN [BUSV_COOM_CSC1].[MaintenanceOrderDimensionId_BSATC_XX_X] iomodi_bs ON iomodi_bs.[MaintenanceOrder_HK] = bo.[MaintenanceOrder_HK] LEFT OUTER JOIN #PartnerAndBookedObject prt ON prt.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #PurchaseOrderObject pur ON pur.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] LEFT OUTER JOIN #Material m ON m.[COCostActualLineItem_HK] = bo.[COCostActualLineItem_HK] CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] (cocali_ws0.[DebitCreditCode],cocali_ws0.[COBusinessTransaction]) usrcoomdbi CROSS APPLY [BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (cocali_ws0.[ValueType]) usrcoomsi ; ' SET @SQL = CAST('' AS NVARCHAR(MAX)); Set @SQL = @SQL + @SQL_CostCenterMaintenanceOrders + @SQL_BookedObjectLink + @SQL_MaintenanceOrders + @SQL_TempHeaderItems + @SQL_PartnerAndBookedObject + @SQL_PurchaseOrderObject + @SQL_Material + @SQL_InsertFact ; EXECUTE sp_executesql @SQL; SET @DateTimeEnd = SYSUTCDATETIME(); SET @rowCounter = 0; DECLARE @PartitionNumber INT ; SELECT @PartitionNumber = [partition_number] , @RowsInsertedPartition = [rows] FROM sys.partitions as par WHERE ( par.object_id = OBJECT_ID('INFM_Costs_CSC1.CO_CostMaintenance_PerFact_' + @SourceSystemVar + '_Temp') ) And ([rows] > 0 ); DECLARE @return_value int ; IF ( @PartitionNumber IS NOT NULL ) BEGIN SET @TruncateSQL = ' TRUNCATE TABLE [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_' + @SourceSystemVar + '] WITH (PARTITIONS(' + Cast(@PartitionNumber as varchar(4)) + ')) ; ALTER TABLE [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_' + @SourceSystemVar + '_Temp] SWITCH PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' TO [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_' + @SourceSystemVar + '] PARTITION ' + Cast(@PartitionNumber as varchar(4)) + ' ; ' EXECUTE sp_executesql @TruncateSQL; /* Call the procedure to inform the successful loading of the data for the selected partition*/ EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar ,@SourceOfData = @SourceOfData ,@ConsumerOfData = @ConsumerOfData ,@YearMonthCreation = @YearMonth ,@StartDateTime = @DateTimeStart ,@EndDateTime = @DateTimeEnd ,@RowsInserted = @RowsInsertedPartition ; END IF ( @PartitionNumber IS NULL ) /* Call the procedure to inform the successful loading of the data for the selected partition*/ EXEC @return_value = [MEAM_DataCORE_CSC1].[uspINFMDeltaLoadedByYearMonthCreation] @SourceSystem = @SourceSystemVar ,@SourceOfData = @SourceOfData ,@ConsumerOfData = @ConsumerOfData ,@YearMonthCreation = @YearMonth ,@StartDateTime = @DateTimeStart ,@EndDateTime = @DateTimeEnd ,@RowsInserted = @RowsInsertedPartition ; SET @minCounter = @minCounter + 1 ; SET @rowCounter = @RowsInsertedPartition ; DELETE TOP(1) FROM #PartitionList ; IF ( @rowCounter IS NULL ) SET @rowCounter = 0; SET @RowsRead = @RowsRead + @rowCounter ; SET @RowsInserted = @RowsInserted + @rowCounter ; END DROP TABLE IF EXISTS #PartitionList ; END END"
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_REF_GCT;2047502523;V ;VIEW;8196;/**/ /* View: V_INTF_PNL_REF_GCT */ /**/ /* =*/ /* V01.00.00 2021-06-24 Yannick Sigwalt GS/BDO12 */ /* Interface provides a reference for mapping PnL Series Data to GCT (Global Customer Team) Dimension */ /* Data.CORE Outgoing Interface #0123 https://inside-docupedia.bosch.com/confluence/x/pTLtZQ */ /* Update: */ /* Restriction: */ /* - none */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G5;2050314564;V ;VIEW;1610;"/**/ /* View: V_BridgeSparePartToFact_IDIM1_G5 */ /**/ /**/ /* V01.02.01 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P87 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G5] */ /* Updates: */ /* - V01.02.01 - Replaced PerFact */ /* - V01.02.00 - Adjusted to use source system specific MaterialDimId */ /* - V01.01.02 - Corrected view name */ /* - V01.01.01 - Added ""distinct"" */ /* - V01.01.00 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G1;2051850722;V ;VIEW;15060;/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G1 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Stephan Wund GS/BDD2 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 Initial version copied from V_MaintenanceActualCost_V2_IFCT0_G0 */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G1;2051902777;V ;VIEW;29727;/**/ /* View: V_CostActual_V1_IFCT0_G1 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_Scenario_ATTR;2052410581;V ;VIEW;1858;"/**/ /* View: V_INTF_PNL_DIM_Scenario_ATTR */ /**/ /* =*/ /* V01.00.00 2021-08-12 Hui Yang CI/XEF1 */ /* Interface provides attributes for Scenario for TM1 */ /* Outgoing interface #0152 https://inside-docupedia.bosch.com/confluence/x/u6fqa */ /* Update: */ /* - V01.00.01 2021-10-28 YAH8FE filtered ""Scenario_Total"" */ /* Restriction: */ /* - none */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_SSAS_AnonymizeRBEFData;2053126605;FN;SQL_SCALAR_FUNCTION;1683;"/* =*/ /* V01.00.01 - 2021-09-24 - Andras Szivos CI/BTM-AC1 */ /* This function does anonymize data from RBEF for the purposes on Maintenance DemoSystem */ /* Update: */ /* Restriction: */ /* =*/ create function INFI_Costs_SSAS_CSC2.ufn_SSAS_AnonymizeRBEFData ( @StringToBeAnonymized char(100) ) RETURNS nvarchar(100) AS BEGIN -- Declare the return variable here DECLARE @StringAnonymized nvarchar(100) DECLARE @Tokens table (OriginalString nvarchar(100), AnonymizedString nvarchar(100) ) INSERT INTO @Tokens VALUES ('ArjP', 'XxP'); INSERT INTO @Tokens VALUES ('RBEF', 'XxP'); INSERT INTO @Tokens VALUES ('Aj', 'Xx'); INSERT INTO @Tokens VALUES ('983', 'XxP'); INSERT INTO @Tokens VALUES ('Aranjuez', 'XxP'); INSERT INTO @Tokens VALUES ('EB-ES', 'Xx-YY'); INSERT INTO @Tokens VALUES ('GS/', 'Xx/'); INSERT INTO @Tokens VALUES ('CI/', 'Xx/'); INSERT INTO @Tokens VALUES ('M/', 'Xx/'); SELECT TOP 1 @StringAnonymized = REPLACE(@StringToBeAnonymized,OriginalString,AnonymizedString) FROM @Tokens WHERE CHARINDEX(OriginalString,@StringToBeAnonymized) >0 SELECT @StringAnonymized = IIF(@StringAnonymized IS NULL, @StringToBeAnonymized, @StringAnonymized ); RETURN @StringAnonymized; --DROP TABLE @Tokens; END"
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G1;2053998794;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G1 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G4;2055990701;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G4 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_COREWriter_PnL_CSC1;62;INFormation Mart as Interface;V_INTF_GLAccountMappingAS2POE_ValidationPOEAccount;2056446450;V ;VIEW;1005;/**/ /* View: V_INTF_GLAccountMappingAS2POE_ValidationPOEAccount */ /**/ /* =*/ /* V01.00.00 2020-08-19 Patrik Just CI/DAV2.3 */ /* This view provide CORE.Writer the information about valid GL Accounts from POE source */ /* Restriction: */ /* - */ /* Changes: */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G3;2057982608;V ;VIEW;3320;/**/ /* View: V_FunctionalLocation_IDIM1_G3 */ /**/ /*=*/ /* V01.00.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* Functional Location dimension created for the use case of reporting on maintenance costs */ /* Update: */ /* - V01.00.00 - 2021-11-09 - Initial version copied from V_Functional Location_IDIM1_G0 */ /*=*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_S3;2059570821;V ;VIEW;1627;/**/ /* View: V_INTF_MD_ValuationClass_S3 */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE, Adler Karoline GS/BDO12 */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version */ /* = */
INFI_GSAccounting_CSC1;78;INFormation Mart as Interface;ufn_getExchangeRateSourceCurrencyToEuro;2060898759;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;2495;/**/ /* Database name: @DB_DATA_VAULT_SQL */ /* DBMS name: Microsoft SQL Server 2016 - Bosch */ /* Created on: 26.01.2023 07:05:25 */ /**/ /**/ /* V01.00.00 2023-01-26 Tina Fritz (GS/PBI-GE) */ /* This table valued function implements the following soft rule to provide the latest exchange rate from source currency to Euro: */ /* #FBI-SR-000000107 https://inside-docupedia.bosch.com/confluence/x/3z0go */ /* It's intended to be used also directly by consuming applications like PowerBI, that's why this TVF is located in Access Layer. */ /* Update: */ /* - V01.00.00 - Created (2023-01-26, frt3ka) */ /**/ create function INFI_GSAccounting_CSC1.ufn_getExchangeRateSourceCurrencyToEuro ( @SourceCurrency nvarchar(11),@ExchangeRateDate date,@ExchangeRateType nvarchar(4) ) RETURNS TABLE AS RETURN with cte_Exrates as ( SELECT TOP(1) convert(date, COALESCE([ExchangeRateStateTimeFrom], @ExchangeRateDate), 112) as [ExchangeRateDate] ,[RateType] ,[ExchangeRateForUsage] ,[FactorForUsage] FROM [MEAM_DataCORE_CSC1].[V_DataCOREDimensionExchangeRateType] vdcdert LEFT JOIN [BUSV_Reference_CSC1].[V_SR_CurrencyMgmtRates] vsrmr ON vsrmr.[ExchangeRateType] = vdcdert.[ExchangeRateType] AND vsrmr.[TargetCurrency] = 'EUR' AND vsrmr.[ExchangeRateStateTimeFrom] <= @ExchangeRateDate AND vsrmr.[SourceCurrency] = @SourceCurrency AND vsrmr.[ExchangeRateType] = @ExchangeRateType ORDER BY [ExchangeRateStateTimeFrom] DESC ) SELECT CASE WHEN @SourceCurrency = N'EUR' THEN 1 ELSE cast((CASE WHEN [RateType] = N'P' THEN [ExchangeRateForUsage] ELSE 1 / [ExchangeRateForUsage] END) * [FactorForUsage] as numeric(38,20)) END as ExchangeRateSourceCurrencyToEuro , [ExchangeRateDate] as ExchangeRateDateUsed FROM cte_Exrates
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeCostsJunkToFact_V3_IDIM1;2064778463;V ;VIEW;363;/**/ /* View: V_BridgeCostsJunkToFact_V3_IDIM1 */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;ufn_GetPlanCost_V3_IFCT0_G0_Yannick;2065702707;IF;SQL_INLINE_TABLE_VALUED_FUNCTION;18236;/**/ /* V01.04.00B 2022-08-04 Yannick Sigwalt GS/BDD2 & Michal Erdman & Martin Urban CI/XTD2 */ /* Fact View for Costs Application */ /* Data.CORE Outgoing Interface #0160 https://inside-docupedia.bosch.com/confluence/x/9uWpcQ */ /* This view implements the following soft rule: */ /* #FBI-SR-000000025 https://inside-docupedia.bosch.com/confluence/x/TUN-Mw */ /* Update: */ /* - V01.04.00B - Reworked Function because of bad performance of usage of udf for #FBI-SR-000000025 */ /* - V01.03.03 - implemented new udf for #FBI-SR-000000025 Credit & Statistical indicator */ /* - Added Filter on Value Type 01, 02 and 10 */ /* - V01.03.02 - Added join to PlanningVersionToScenario_BSAT0_MF_X */ /* - V01.03.01 - Simplified field JunkDimID of cte_PlanCost */ /* - V01.03.00 - Enhanced with @CostCenter and @Prioritization parameter, removed PlanCosts_Primary_DebCreditAndStat_BSATM */ /* and PlanCosts_Secondary_DebCreditAndStat_BSATM satellite */ /* - V01.02.01 - Updated Formula for Variable Amount ObjectCurrency */ /* - V01.02.00 - Added Variable Amount COAreaCurrency + Fixed Amount ObjectCurrency + Variable Amount ObjectCurrency */ /* - Aggregated and harmonized documentation for View and usp */ /**/ CREATE function [INFI_Costs_SSAS_CSC2].[ufn_GetPlanCost_V3_IFCT0_G0_Yannick] ( @YearCreation int,@Prioritization bit = 0 ) RETURNS TABLE AS RETURN with cte_PlanCost as ( select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcp_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,cast(NULL as binary(20)) as [CostCollector_PartnerObject_HK] ,cast(NULL as binary(20)) as [CostCollector_SourceObject_HK] ,pcp_ws.[FiscalYear] as [FiscalYear] ,pcp_ws.[Period] as [Period] ,pcp_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcp_ws.[ValueType] as [ValueType] ,pcp_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcp_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcp_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcp_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcp_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcp_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcp_ws.[TotalValueCOAreaCurrency] - pcp_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcp_ws.[TotalValueCOAreaCurrency] <> 0,pcp_ws.[TotalValueObjectCurrency] - pcp_ws.[FixedValueCOAreaCurrency] / pcp_ws.[TotalValueCOAreaCurrency] * pcp_ws.[TotalValueObjectCurrency],pcp_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcp_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsPrimary_WLNK0] pcp_wl inner join [RAWV_COOM_CSC1].[PlanCostsPrimary_WSATM_G0_X] pcp_ws on pcp_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcp_ws.[PlanCostsPrimary_HK] = pcp_wl.[PlanCostsPrimary_HK] and pcp_ws.[ValueType] in ('01','02','10') and pcp_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcp_wl.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcp_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcp_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcp_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcp_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcp_ws.[ValueType] UNION ALL select ccoll_wh.[SourceSystem_BK] as [SourceSystem] ,s_wh.[Scenario_BK] as [Scenario_BK] ,sdi_bs.[DimensionId] as [ScenarioDimensionId] ,pv_wh.[Version_ID_BK] as [SAPVersion] ,pcs_wl.[CostElementByControllingArea_HK] as [CostElementByControllingArea_HK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK_Planned] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK_Planned] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] ,at_wh.[ActivityType_ID_BK] as [ActivityType] ,cebca_wh.[CostElement_ID_BK] as [CostElementId] ,cebcadi_bs.[DimensionID] as [CostElementDimId] ,pcs_wl.[CostCollector_PartnerObject_HK] as [CostCollector_PartnerObject_HK] ,pcs_wl.[CostCollector_SourceObject_HK] as [CostCollector_SourceObject_HK] ,pcs_ws.[FiscalYear] as [FiscalYear] ,pcs_ws.[Period] as [Period] ,pcs_ws.[COBusinessTransaction] as [COBusinessTransaction] ,pcs_ws.[ValueType] as [ValueType] ,pcs_ws.[DebitCreditCode] as [SAPDebitCreditCode] ,cast( pcs_ws.[TotalValueCOAreaCurrency] as decimal(38,2)) as [TotalValueCOAreaCurrency] ,cast( pcs_ws.[FixedValueCOAreaCurrency] as decimal(38,2)) as [FixedValueCOAreaCurrency] ,pcs_ws.[CurrencyCodeCOAreaCurrency] as [CurrencyCodeCOAreaCurrency] ,cast(pcs_ws.[TotalValueObjectCurrency] as decimal(38,2)) as [TotalValueObjectCurrency] ,pcs_ws.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,cast((pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [FixedAmountCOAreaCurrency] ,cast((pcs_ws.[TotalValueCOAreaCurrency] - pcs_ws.[FixedValueCOAreaCurrency]) as decimal(38,2)) as [VariableAmountCOAreaCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],0) as decimal(38,2)) as [FixedAmountObjectCurrency] ,cast(IIF( pcs_ws.[TotalValueCOAreaCurrency] <> 0,pcs_ws.[TotalValueObjectCurrency] - pcs_ws.[FixedValueCOAreaCurrency] / pcs_ws.[TotalValueCOAreaCurrency] * pcs_ws.[TotalValueObjectCurrency],pcs_ws.[TotalValueObjectCurrency]) as decimal(38,2)) as [VariableAmountObjectCurrency] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_DebitCreditIndicator] ([DebitCreditCode],[COBusinessTransaction]) as [DebitCreditCode] --,[BUSV_COOM_CSC1].[ufn_SR_COOM_StatisticalIndicator] (pcs_ws.[ValueType]) as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator ,COALESCE(rdci.[DebitCreditCode],rdci_s.[DebitCreditCode],'U') as [DebitCreditCode] ,COALESCE(rsi.[StatisticalIndicator] ,'0') as [StatisticalIndicator] -- #FBI-SR-000000025 Credit & Statistical indicator from [RAWV_COOM_CSC1].[PlanCostsSecondary_WLNK0] pcs_wl inner join [RAWV_COOM_CSC1].[PlanCostsSecondary_WSATM_G0_X] pcs_ws on pcs_ws.[YearMonthCreation] BETWEEN (@YearCreation * 100 + 1 ) and (@YearCreation * 100 + 12) and pcs_ws.[PlanCostsSecondary_HK] = pcs_wl.[PlanCostsSecondary_HK] and pcs_ws.[ValueType] in ('01','02','10') and pcs_ws.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh on ccoll_wh.[CostCollector_HK] = pcs_wl.[CostCollector_PlannedObject_HK] inner join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] inner join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] inner join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] inner join [RAWV_RB_CSC1].[PlanningVersion_WHUB0] pv_wh on pv_wh.[PlaningVersion_HK] = pcs_wl.[PlaningVersion_HK] inner join [BUSV_COOM_CSC1].[PlanningVersionToScenario_BLNK0] pv2s_bl on pv2s_bl.[PlaningVersion_HK] = pv_wh.[PlaningVersion_HK] inner join BUSV_COOM_CSC1.[PlanningVersionToScenario_BSAT0_MF_X] pv2s_bs on pv2s_bs.[PlanningVersionToScenario_HK] = pv2s_bl.[PlanningVersionToScenario_HK] and pv2s_bs.[LoadEndDate] = '2999-12-31 00:00:00.0000000' inner join [RAWV_Global_MD_CSC1].[Scenario_WHUB0] s_wh on s_wh.[Scenario_HK] = pv2s_bl.[Scenario_HK] inner join [BUSV_Global_MD_CSC1].[ScenarioDimensionId_BSATC_XX_X] sdi_bs on sdi_bs.[Scenario_HK] = s_wh.[Scenario_HK] inner join [RAWV_RB_CSC1].[CostElementbyControllingArea_WHUB0] cebca_wh on cebca_wh.[CostElementByControllingArea_HK] = pcs_wl.[CostElementByControllingArea_HK] inner join [BUSV_FBI_OH_CSC1].[CostElementbyControllingArea_DimensionID_BSATC_XX_X] cebcadi_bs on cebcadi_bs.[CostElementByControllingArea_HK] = cebca_wh.[CostElementByControllingArea_HK] left join [RAWV_RB_CSC1].[CostCollectorToActivityType_WLNK0] ccoll2at_wl on ccoll2at_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join RAWV_RB_CSC1.ActivityType_WHUB0 at_wh on at_wh.[ActivityType_HK] = ccoll2at_wl.[ActivityType_HK] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci ON rdci.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci.[COBusinessTransaction] = pcs_ws.[COBusinessTransaction] LEFT OUTER JOIN [RAWV_RB_CSC1].[RefDebCredIndicator] rdci_s ON rdci_s.[SAPDebitCreditCode] = pcs_ws.[DebitCreditCode] AND rdci_s.[COBusinessTransaction] IS NULL LEFT OUTER JOIN [RAWV_RB_CSC1].[RefStatIndicator] rsi ON rsi.[ValueType] = pcs_ws.[ValueType] ) ,cte_SourceSystem as ( select top(1) [SourceSystem] from cte_PlanCost ) ,cte_ccoll2ccent as ( select ccoll_wh.[CostCollector_HK] ,ccoll_wh.[SourceSystem_BK] as [SourceSytem] ,ccoll_wh.[CostCollectorObject_BK] as [CostCollectorObject_BK] ,ccent_wh.[ControllingArea_ID_BK] as [ControllingArea_BK] ,ccent_wh.[CostCenterID_BK] as [CostCenter_BK] ,ccentdi_bs.[DimensionID] as [CostCenterDimensionId] from [RAWV_RB_CSC1].[CostCollector_WHUB0] ccoll_wh -- on ccoll_wh.[SourceSystem_BK] = cte_SourceSystem.[SourceSystem] left join [RAWV_RB_CSC1].[CostCollectorCostCenter_WLNK0] ccollccent_wl on ccollccent_wl.[CostCollector_HK] = ccoll_wh.[CostCollector_HK] left join [RAWV_RB_CSC1].[CostCenter_WHUB0] ccent_wh on ccent_wh.[CostCenter_HK] = ccollccent_wl.[CostCenter_HK] left join [BUSV_FBI_OH_CSC1].[CostCenterDimensionID_BSATC_XX_X] ccentdi_bs on ccentdi_bs.[CostCenter_HK] = ccent_wh.[CostCenter_HK] ) SELECT /* Dimension-Ancors----------------------------------------------------------------------*/ /* The following fields are used to link to Dimensions */ /* Commented lines can be used to display the clear content (BK instead of DimID) */ pc.[CostCenterDimensionId] as [CostCenterDimId] ,coalesce(concat (pc.[DebitCreditCode], '_', pc.[StatisticalIndicator], '_' ,coalesce(case when ccoll_partner.[CostCollectorObject_BK] <> ' ' then left(ccoll_partner.[CostCollectorObject_BK],2) else NULL end ,N'0')), '0') as [JunkDimID] ,concat(pc.[FiscalYear],pc.[Period]) as [PostingPeriodYearId] ,pc.[FiscalYear] as [FiscalYear] ,pc.[CostElementDimId] as [CostElementDimId] /* Facts---------------------------------------------------------------------------------*/ /* The following fields are used in Fact Table */ ,pc.[TotalValueCOAreaCurrency] as [TotalValueCOAreaCurrency] ,pc.[CurrencyCodeCOAreaCurrency] as [ControllingAreaCurrencyCode] ,pc.[TotalValueObjectCurrency] as [TotalValueObjectCurrency] ,pc.[CurrencyCodeObjectCurrency] as [CurrencyCodeObjectCurrency] ,pc.[ActivityType] as [ActivityType] ,ccoll_partner.[CostCollectorObject_BK] as [PartnerObjectId] ,COALESCE(ccoll_source.[CostCenterDimensionId],0) as [SourceCostCenterDimId] --,cte_ccoll2ccentSource.[CostCenterID_BK] as [SourceCostCenterID] ,pc.[SourceSystem] as [SourceSystem] ,pc.[COBusinessTransaction] as [COBusinessTransaction] ,pc.[ValueType] as [ValueType] ,pc.[ScenarioDimensionId] as [ScenarioId] ,pc.[FixedAmountCOAreaCurrency] as [FixedAmountCOAreaCurrency] ,pc.[VariableAmountCOAreaCurrency] as [VariableAmountCOAreaCurrency] ,pc.[FixedAmountObjectCurrency] as [FixedAmountObjectCurrency] ,pc.[VariableAmountObjectCurrency] as [VariableAmountObjectCurrency] FROM cte_PlanCost pc inner join (select distinct [FiscalYear] ,[Scenario] ,[ControllingArea] ,[CostCenter] ,cte_SourceSystem.[SourceSystem] as [SourceSystem] from [BUSV_COOM_CSC1].[V_SR_COPlanPrioritizedSourceSystemByScenarioYearCostCenter] v_sr_coppssbsyccent cross join cte_SourceSystem where ( @Prioritization = 1 and v_sr_coppssbsyccent.[SourceSystem] = cte_SourceSystem.[SourceSystem]) OR @Prioritization = 0 ) ss_prio on ss_prio.[FiscalYear] = pc.[FiscalYear] and ss_prio.[ControllingArea] = pc.[ControllingArea_BK_Planned] and ss_prio.[CostCenter] = pc.[CostCenter_BK_Planned] --and pc.[SourceSystem] = ss_prio.[SourceSystem] left join cte_ccoll2ccent ccoll_partner on ccoll_partner.[CostCollector_HK] = pc.[CostCollector_PartnerObject_HK] left join cte_ccoll2ccent ccoll_source on ccoll_source.[CostCollector_HK] = pc.[CostCollector_SourceObject_HK] where 1 =1 and pc.[Scenario_BK] = ss_prio.[Scenario]
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeSparePartToFact_IDIM1_G6;2066314621;V ;VIEW;1610;"/**/ /* View: V_BridgeSparePartToFact_IDIM1_G6 */ /**/ /**/ /* V01.02.01 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for SpareParts holding unique values for MaterialDimId of SpareParts from P99 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G6] */ /* Updates: */ /* - V01.02.01 - Replaced PerFact */ /* - V01.02.00 - Adjusted to use source system specific MaterialDimId */ /* - V01.01.02 - Corrected view name */ /* - V01.01.01 - Added ""distinct"" */ /* - V01.01.00 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G2;2067850779;V ;VIEW;15060;/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G2 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Stephan Wund GS/BDD2 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 Initial version copied from V_MaintenanceActualCost_V2_IFCT0_G0 */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G2;2067902834;V ;VIEW;29727;/**/ /* View: V_CostActual_V1_IFCT0_G2 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_Costs_FACT_CostPlan_P06;2068462693;V ;VIEW;4327;/**/ /* View: V_INTF_CDP_Costs_FACT_CostPlan_P06 */ /**/ /* = */ /* V 01.00.03 2021-12-15 ADK6BUE GS/BDD2 */ /* This view is to provide CO-OM Cost Plan data for Cost Driver Planning application (CDP) */ /* ##FBI-Interface-0000000154 https://inside-docupedia.bosch.com/confluence/x/FmjyaQ */ /* #FBI-SR-000000069 https://inside-docupedia.bosch.com/confluence/x/rdapcQ */ /* Update: */ /* - 01.00.00 Creation */ /* - 01.00.01 Softrule V_SR_CostCenterNonConformToCostCenter included */ /* - 01.00.02 Format of PostingPeriodYearId adapted */ /* - 01.00.03 Format of PostingPeriodYearId adapted (*100) */ /* = */
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_A2;2068566803;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_A2 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_A2] */ /* */
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G2;2069998851;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G2 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G5;2071990758;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G5 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Optravis_CSC1;64;INFormation Mart as Interface;V_INTF_MD_ValuationClass_SL;2075570878;V ;VIEW;1629;/**/ /* View: V_INTF_MD_ValuationClass_SL */ /**/ /* = */ /* V01.00.01 2023-07-25 URA1FE */ /* Interface view for transfer of valuation class master data to Optravis */ /* Data.CORE Outgoing Interface #0087 https://inside-docupedia.bosch.com/confluence/x/2JuIYw */ /* Restrictions: */ /* - only includes valuation class description in English language */ /* Changes: */ /* - V01.00.01 Added link for Outgoing Interface */ /* - V01.00.00 Initial version, copied from V_INTF_MD_ValuationClass_G0 V01.00.00 */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_BridgeMaintenanceOrderToFact_V2_IDIM1;2078682503;V ;VIEW;768;/**/ /* View: V_BridgeMaintenanceOrderToFact_V2_IDIM1 */ /**/ /**/ /* V01.00.00 - 2020-03-30 Tatjana Derdus CI/DAV2.3 */ /* Bridge table for Maintenance Order. Holding unique values for MaintenenceOrderDimId. */ /* - Update: */ /**/
INFI_Costs_CDP_CSC1;68;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_Plant_CDP_ATTR;2082418788;V ;VIEW;2735;/**/ /* View: V_INTF_COOM_Costs_DIM_Plant_CDP_ATTR */ /**/ /* =*/ /* V01.00.04 2022-09-01 Ismail Okadia GS/TET3-NA */ /* This view provides the attributes of Plant for CDP */ /* Data.CORE Outgoing Interface #0136https://inside-docupedia.bosch.com/confluence/x/VgkyZg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.04 - Column Plant_BK aliased now with Element */ /* V01.00.03 - Implemented attributes CompanyCode and Status as additional attributes */ /* V01.00.02 - Implemented FBI Guidelines for View Design */ /* - Updated view due to changed in underlaying Raw Vault Model */ /* V01.00.01 - Added Attribute BWN Bosch Werknummer */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G3;2083850836;V ;VIEW;15062;/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G3 */ /**/ /**/ /* V01.00.01 - 2023-01-05 Michal Erdman & Stephan Wund GS/BDD2 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.00.01 - Added new version of SR25 */ /* - V01.00.00 Initial version copied from V_MaintenanceActualCost_V2_IFCT0_G0 */ /**/
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G3;2083902891;V ;VIEW;29727;/**/ /* View: V_CostActual_V1_IFCT0_G3 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_BusinessDevision_V1_IDIM1;2084462750;V ;VIEW;1274;/**/ /* View: V_BusinessDevision_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Business Devision for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface #0224 https://inside-docupedia.bosch.com/confluence/x/18Uxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_B2;2084566860;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_B2 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_B2] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FunctionalLocation_IDIM1_G4_DemoSystem;2085126719;V ;VIEW;1999;/**/ /* View: V_FunctionalLocation_IDIM1_G4_DemoSystem */ /**/ /* =*/ /* V01.00.05 - 2022-02-22 - Andras Szivos CI/BTM-AC1 */ /* Dimension view for Equipment master data, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by specific plant . */ /* Update: */ /* - V01.00.05 -Enhancement of view with a function to anonymize data entries with better anonymization functnion */ /* - V01.00.02 -Enhancement of view with a function to anonymize data entries of Ajp */ /* - V01.00.01 - Initial Version - View is based on [INFI_Costs_SSAS_CSC2].[V_Functional_Location_IDIM1_G4] */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G3;2085998908;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G3 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G6;2087990815;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G6 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessView;2089214643;V ;VIEW;3518;/**/ /* View: V_INTF_PNL_DIM_BusinessView */ /**/ /* = */ /* V01.01.04 2021-03-05 Patrik Just CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* This view formats the ProfitCenter Hierarchy for the consumption through TM1 */ /* - 01.01.04 Swicthed to correct ProfitCenter Hierarchy view */ /* - 01.01.03 Minor Correction */ /* - 01.01.02 Add function for unique ParentChild relations */ /* - 01.01.00 Added Prefix for GB and Business Unit */ /* - 01.01.00 Added Dummy Node for GB and BU */ /* - 01.01.00 Added Dummy Node for Dimension */ /* = */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MalfunctionNotification_V2_IDIM1_G3;2089982722;V ;VIEW;7279;/**/ /* View: V_MalfunctionNotification_V2_IDIM1_G3 */ /**/ /*=*/ /* V01.09.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* MalfunctionNotification dimension created for the use case of reporting on maintenance costs */ /* Restriction: */ /* Update: */ /* - V01.00.00: 2020-11-25 Initial version copied from V_Malfunction Notification_V2_IDIM1_G0 */ /*=*/
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_MonthlySalesTransactions_G5;2091570935;V ;VIEW;11901;"/**/ /* View: V_INTF_MonthlySalesTransactions_G5 */ /**/ /* =*/ /* V01.07.01 2023-07-31 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* Data.CORE Outgoing Interface #0004 https://inside-docupedia.bosch.com/confluence/x/nfwnV */ /* This view consumes the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/x/0MFYaQ */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.07.01 Added column ""TotalNetSales"" */ /* - V01.07.00 Data souce of BaseUnit is changed, column name of Quantity to QuantityInPieces, */ /* new column QuantityBaseUnit is added, according to #151313 */ /* - V01.06.01 Merged Quantity and Amount Records into 1 single record (INC000020225056) */ /* - V01.06.00 Added SoftRule FBI-SR-000000066 */ /* Added Filter on [CurrencyTypeOfOperatingConcern] = '02' for Quantities */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G4;2098314735;V ;VIEW;4097;/**/ /* View: V_SparePart_IDIM1_G4 */ /**/ /**/ /* V01.03.02 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P81 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G4] */ /* Updates: */ /* - V01.03.02 - Replaced PerFact */ /* - V01.03.01 - Fixed join error in case of leading zeros for TermCode (cast TermCode as Int) */ /* - V01.03.00 - Filled MaterialGroupDescription, TermCodeDescription based on PT2 ref. data */ /* - V01.02.00 - Added MaterialGroup, MaterialGroupDescription, TermCode, TermCodeDescription */ /* - V01.01.00 - Use source system specific MaterialDimId and ref. view for LanguageCode */ /* - V01.00.01 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G4;2099850893;V ;VIEW;15228;"/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G4 */ /**/ /**/ /* V01.01.03 - 2023-01-05 Michal Erdman & Sanja Mihalic CI/XTD3 & Tatjana Derdus CI/DAV2.3 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.01.03 - Added new version of SR25 */ /* - V01.01.00 Adjusted query (incl. link to equipment via left join); no structural changes */ /* - V01.00.01 Adjusted to new CO-OM model #75714 */ /* - V01.00.00 Initial version (2020-03-24) */ /**/"
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G4;2099902948;V ;VIEW;30169;/**/ /* View: V_CostActual_V1_IFCT0_G4 */ /**/ /* =*/ /* V01.00.05 2023-06-07 Michal Erdman & Ilja Frolov FRI3SH & Yannick Sigwalt */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.04 - Added additional BKs */ /* V01.00.03 - Added #FBI-SR-000000096 */ /* V01.00.02 - Added logic & documentation for #FBI-SR-000000099 */ /* V01.00.01 - Added documentation for #FBI-SR-000000095 */ /* V01.00.00 - Initial version */ /* =*/
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_CompanyCode_V1_IDIM1;2100462807;V ;VIEW;1351;/**/ /* View: V_CompanyCode_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Company Code for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface # 0223 https://inside-docupedia.bosch.com/confluence/x/wcUxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_B4;2100566917;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_B4 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_B4] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_Equipment_V3_IDIM1_G4_DemoSystem;2101126776;V ;VIEW;4839;/**/ /* View: V_Equipment_V3_IDIM1_G4_DemoSystem */ /**/ /* =*/ /* V01.00.05 - 2022-02-22 - Andras Szivos CI/BTM-AC1 */ /* Dimension view for Equipment master data, but anonimized for DemoSystem purposes */ /* Restriction: View for demo purposes only, restricted by specific plant . */ /* Update: */ /* - V01.00.05 -Enhancement of view with a function to anonymize data entries with better anonymization functnion */ /* - V01.00.02 -Enhancement of view with a function to anonymize data entries of Ajp */ /* - V01.00.01 - Initial Version - View is based on [INFI_Costs_SSAS_CSC2].[V_Equipment_G4_IDIM1] */ /* =*/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G4;2101998965;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G4 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G7;2103990872;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G7 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_DIM_BusinessView_ATTR;2105214700;V ;VIEW;2376;/**/ /* View: V_INTF_PNL_DIM_BusinessView_ATTR */ /**/ /* =*/ /* V01.00.02 2021-03-05 Patrik Just CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* This view shows the texts for the ProfitCenter */ /* - V01.00.02 used new View for ProfitCenter Hierarchy */ /* - V01.00.01 replace text source ProfitCenterText_WSATM_M2_X by ProfitCenterDescription_WSATM_M2_X */ /* - V01.00.00 source for ProfitCenter Text is still open */ /* =*/
INFI_PlantResult_TM1_CSC2;112;INFormation Mart as Interface;V_PlantResult_PnL_COPA_V1_IFCT0_V2;2107570992;V ;VIEW;10239;/**/ /* View: V_PlantResult_PnL_COPA_V1_IFCT0_V2 */ /**/ /* =*/ /* V01.00.01 2023-07-26 URA1FE */ /* Transactional data for TM1 PlantResult based on the PnLSeries persised fact INTF_PNL_FACT_COPA_CS_V2 */ /* Outgoing Interface #0355 https://inside-docupedia.bosch.com/confluence/x/Q13ttg */ /* Restrictions: AUFK internal orders in AUART are enhanced only for NameOfValueField VVR54 and VVR52 */ /* Changes */ /* - 01.00.01 - Corrected cte_InternalOrder join and added AUART from InternalOrder for specific */ /* Valuefields */ /* - 01.00.00 - Created */ /* =*/
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_Scenario;2108638655;V ;VIEW;1575;/**/ /* View: V_INTF_COOM_Costs_DIM_Scenario */ /**/ /* =*/ /* V01.01.00 2020-06-15 Tatjana Derdus CI/DAV2.3 */ /* This view provides the parent child hierarchy of Scenario for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.01.00 - Replace Dimension IDs by Business Keys */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G5;2114314792;V ;VIEW;4097;/**/ /* View: V_SparePart_IDIM1_G5 */ /**/ /**/ /* V01.03.02 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P87 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G5] */ /* Updates: */ /* - V01.03.02 - Replaced PerFact */ /* - V01.03.01 - Fixed join error in case of leading zeros for TermCode (cast TermCode as Int) */ /* - V01.03.00 - Filled MaterialGroupDescription, TermCodeDescription based on PT2 ref. data */ /* - V01.02.00 - Added MaterialGroup, MaterialGroupDescription, TermCode, TermCodeDescription */ /* - V01.01.00 - Use source system specific MaterialDimId and ref. view for LanguageCode */ /* - V01.00.01 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G5;2115850950;V ;VIEW;15235;"/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G5 */ /**/ /**/ /* V01.01.01 - 2023-01-05 Michal Erdman & Sanja Mihalic CI/XTD3 & Tatjana Derdus CI/DAV2.3 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.01.01 - Added new version of SR25 */ /* - V01.01.00 Adjusted query (incl. link to equipment via left join); no structural changes */ /* - V01.00.01 Adjusted to new CO-OM model #75714 */ /* - V01.00.00 Initial version (2020-03-24) */ /**/"
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G5;2115903005;V ;VIEW;30166;/**/ /* View: V_CostActual_V1_IFCT0_G5 */ /**/ /* =*/ /* V01.00.05 2023-06-07 Michal Erdman & Ilja Frolov FRI3SH & Yannick Sigwalt */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.05 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.04 - Added additionals BKs */ /* V01.00.03 - Added #FBI-SR-000000096 */ /* V01.00.02 - Added logic & documentation for #FBI-SR-000000099 */ /* V01.00.01 - Added documentation for #FBI-SR-000000095 */ /* V01.00.00 - Initial version */ /* =*/
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_Currency_V1_IDIM1;2116462864;V ;VIEW;1396;/**/ /* View: V_Currency_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Currency Code for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface #0225 https://inside-docupedia.bosch.com/confluence/x/38Uxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_D0;2116566974;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_D0 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_D0] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G0;2117126833;V ;VIEW;2634;/**/ /* View: V_FactActualCostMaintenanceOrder_G0 */ /**/ /**/ /* V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P99 */ /* Changes: */ /* - V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 Clean up of SQL code */ /* - V01.00.00 2021-09-24 Szivos Andras CI/BTM-AC1 Original version created */ /**/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G5;2117999022;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G5 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_G9;2119990929;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_G9 */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G3;2121982836;V ;VIEW;3549;/**/ /* View: V_SparePart_IDIM1_G3 */ /**/ /**/ /* V01.00.00 - 2021-11-09 Stephan Wund GS/BDD2 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P79 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G3] */ /* Updates: */ /* - V01.00.00 - Initial version copied from V_Spare Part_IDIM1_G0 */ /**/
INFI_PNL_GM1_SSAS_CSC2;95;INFormation Mart as Interface;V_INTF_PNL_GM1_CustomerOrderHierachy_GCT_V1;2123571049;V ;VIEW;14637;/**/ /* View: V_INTF_PNL_GM1_CustomerOrderHierachy_GCT_V1 */ /**/ /* */ /* V01.00.01b 2023-07-19 URA1FE & Ilja Frolov GS/BDD2 */ /* This view merges RB Customer External, RB Customer Internal Hierarchy and GCT information together */ /* If one level in the hierarchy is empty the next available parent is used. */ /* Data.CORE Outgoing Interface #0168 https://inside-docupedia.bosch.com/confluence/x/Ult8cg */ /* Changes: */ /* - V01.00.01 Enhanced view with REF_GCT, only valid records (Status 40) are shown */ /* Removed DataCOREGenericParameter_WREFM subselect, because it creates non SARGable queries */ /* and ONLY the edition 'WORKING SET' is required */ /* - V01.00.00 Created View - initial version */ /* */
INFI_Costs_TM1_CSC1;57;INFormation Mart as Interface;V_INTF_COOM_Costs_DIM_Scenario_ATTR;2124638712;V ;VIEW;3398;"/**/ /* View: V_INTF_COOM_Costs_DIM_Scenario_ATTR */ /**/ /* =*/ /* V01.01.00 2020-10-14 Tatjana Derdus CI/DAV2.3 */ /* This view provides the attributes of Scenario for TM1 */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* V01.00.01 - SQL notation adjustment for better readability */ /* V01.00.02 - Adapted column name ""Attribute"" to ""Attribut"" */ /* V01.01.00 - Replace Dimension IDs by Business Keys */ /* =*/"
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_SparePart_IDIM1_G6;2130314849;V ;VIEW;4097;/**/ /* View: V_SparePart_IDIM1_G6 */ /**/ /**/ /* V01.03.02 - 2021-09-10 Sigwalt Yannick GS/BDD2 Tatjana Derdus CI/DAV2.3 */ /* SpareParts dimension created for the use case of reporting on maintenance costs from P99 */ /* Restrictions: */ /* - Limited to materials persisted in fact [INFM_Costs_CSC1].[CO_CostMaintenance_PerFact_G6] */ /* Updates: */ /* - V01.03.02 - Replaced PerFact */ /* - V01.03.01 - Fixed join error in case of leading zeros for TermCode (cast TermCode as Int) */ /* - V01.03.00 - Filled MaterialGroupDescription, TermCodeDescription based on PT2 ref. data */ /* - V01.02.00 - Added MaterialGroup, MaterialGroupDescription, TermCode, TermCodeDescription */ /* - V01.01.00 - Use source system specific MaterialDimId and ref. view for LanguageCode */ /* - V01.00.01 - Removed dummy records from view */ /* - V01.00.00 - Initial version */ /**/
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_MaintenanceActualCost_V2_IFCT0_G6;2131851007;V ;VIEW;15266;"/**/ /* View: V_MaintenanceActualCost_V2_IFCT0_G6 */ /**/ /**/ /* V01.01.01 - 2023-01-05 Michal Erdman & Sanja Mihalic CI/XTD3 & Tatjana Derdus CI/DAV2.3 */ /* New view for Costs.Maintenance based on optimized data Objects */ /* Update: */ /* - V01.01.01 - Added new version of SR25 */ /* - V01.01.00 Adjusted query (incl. link to equipment via left join); no structural changes to view */ /* - V01.00.01 Adjusted to new CO-OM model #75714 */ /* - V01.00.00 Copied from V_MaintenanceActualCost_V2_IFCT0_G5 V01.00.00 (2020-05-04) */ /**/"
INFI_RnDAnalysis_SSAS_CSC2;99;INFormation Mart as Interface;V_CostActual_V1_IFCT0_G6;2131903062;V ;VIEW;29725;/**/ /* View: V_CostActual_V1_IFCT0_G6 */ /**/ /* =*/ /* V01.00.01 2023-06-07 Michal Erdman */ /* This view provides information, which R&D projects received costs */ /* Data.CORE Outgoing Interface #0202 https://inside-docupedia.bosch.com/confluence/x/80k4fw */ /* #FBI-SR-000000025: https://inside-docupedia.bosch.com/confluence/x/TUN-Mw Debit Credit & Statistical indicator */ /* #FBI-SR-000000082 https://inside-docupedia.bosch.com/confluence/x/eTdCfQ Determination of Cost Types and Resource Assignment */ /* #FBI-SR-000000089 https://inside-docupedia.bosch.com/confluence/x/z02wiQ Legal Share derivation out of company code and profit center */ /* #FBI-SR-000000092 https://inside-docupedia.bosch.com/confluence/x/HFKnig Derivation Cost Center Cost Types */ /* #FBI-SR-000000095 https://inside-docupedia.bosch.com/confluence/x/TItEjg Identify BusinessUnit as was */ /* #FBI-SR-000000096 https://inside-docupedia.bosch.com/confluence/x/fyp8jg Convert Period > 12 to 12 */ /* #FBI-SR-000000099 https://inside-docupedia.bosch.com/confluence/x/Mh7Dk Profit Center information for WBS without settlement target */ /* BR #FBI-CO-000000001: https://inside-docupedia.bosch.com/confluence/x/a4V-K */ /* BR #FBI-CO-000000002: https://inside-docupedia.bosch.com/confluence/x/z4Z-K */ /* BR #FBI-CO-000000003: https://inside-docupedia.bosch.com/confluence/x/1Ih-K */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.01 - Updated description of ValueAddedTypeDescription and InternalAllocationType */ /* V01.00.00 - Initial version (copied from G4) */ /* =*/
INFI_CIVS_CSC1;105;INFormation Mart as Interface;V_Material_V1_IDIM1;2132462921;V ;VIEW;3487;/**/ /* View: V_Material_V1_IDIM1 */ /**/ /* =*/ /* V01.00.00 2022-05-04 FRI3SH */ /* This view provides the Material Code for the application CIVS (Central Inventory */ /* Valuation Solution) of GS. This Dimension is referenced via linked Server by Core Light */ /* Data.CORE Outgoing Interface # 0226 https://inside-docupedia.bosch.com/confluence/x/D8Yxhg */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.00 - Initial version */ /* =*/
INFI_Costs_CDP_CSC2;69;INFormation Mart as Interface;V_INTF_CDP_CostActual_V2_IFCT0_D3;2132567031;V ;VIEW;3974;/**/ /* View: V_INTF_CDP_CostActual_V2_IFCT0_D3 */ /**/ /* = */ /* V01.00.00 2023-03-15 Ismail Okadia GS/TET3-NA */ /* This view is to provide CO-OM Cost Actuals data for Cost Driver Planning application (CDP) */ /* Data.CORE Outgoing Interface #0337 https://inside-docupedia.bosch.com/confluence/x/RBnSqQ */ /* Implemented Soft Rules */ /* Filter Cost Actual Fact Data by Company Code Positive List */ /* #FBI-SR-000000057 https://inside-docupedia.bosch.com/confluence/x/fFf1Yw */ /* Update: */ /* V01.00.00 Recreated view on top of persisted Fact [COCostActual_V2_MFCT0_D3] */ /* */
INFI_Costs_SSAS_CSC2;51;INFormation Mart as Interface;V_FactActualCostMaintenanceOrder_G3;2133126890;V ;VIEW;2353;/**/ /* View: V_FactActualCostMaintenanceOrder_G3 */ /**/ /**/ /* V01.00.03 2021-11-23 Szivos Andras CI/BTM-AC1 */ /* Fact view for Costs Maintenance Order booked on Maintenance Orders from P79 */ /* Changes: */ /* Restriction: */ /**/
INFI_RnDAnalysis_SSAS_CSC1;103;INFormation Mart as Interface;V_PartnerObject_V1_IDIM1_G6;2133999079;V ;VIEW;4694;/**/ /* View: V_PartnerObject_V1_IDIM1_G6 */ /**/ /* =*/ /* V01.00.03 2023-07-06 Yannick Sigwalt GS/BDD1 & Ilja Frolov FRI3SH */ /* This view provides information, which which Partner Objects */ /*(Cost Center, WBS-Element, Internal Order etc.) are related to the R&D cost bookings */ /* Data.CORE Outgoing Interface #0214 https://inside-docupedia.bosch.com/confluence/x/7bVnh */ /* #FBI-SR-000000055:https://inside-docupedia.bosch.com/confluence/x/L7SyYg */ /* #FBI-CO-000000056:https://inside-docupedia.bosch.com/confluence/x/bhqJiw */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.03 - added alternative way to get meaningfull WBS element in the case teh WBS Element */ /* is not maintained on MCR side */ /* V01.00.02 - Optimized Query and implemented EndDating Satellite */ /* V01.00.01 - Reviewd added Documentation for BR % SR */ /* V01.00.00 - Initial version */ /* =*/
MEAV_DataCORE_CSC1;47;MEtA Vault;V_COCostActualLineItemDelta_GK;2135990986;V ;VIEW;2045;/**/ /* View: V_COCostActualLineItemDelta_GK */ /**/ /* =*/ /* V01.00.02 2022-11-02 Yannick Sigwalt, GS/BDD1 */ /* This view reads all the loaded records from [RAWV_COOM_CSC1].[COCostActualLineItem_WSAT0_xx_L] */ /* to identify new CO actuals cost line item */ /* Restriction: */ /* - none */ /* Update: */ /* - V01.00.02 - Reworked SQL */ /* =*/
INFI_TM1_CSC2;9;INFormation Mart as Interface;V_INTF_PNL_FACT_PnL_SL;2139571106;V ;VIEW;7316;"/**/ /* View: V_INTF_PNL_FACT_PnL_SL */ /**/ /* =*/ /* V01.00.10 2023-07-20 Hui Yang BD/XSP4, Ilja Frolov GS/BDD1, Jakub Kozlowski & Yannick Sigwalt GS/BDD1 */ /* This view provides Fact ""ACDOCA_PNL"" S4 Profit & Loss Accounts for PnLSeries */ /* Data.CORE Outgoing Interface #0250 https://inside-docupedia.bosch.com/confluence/x/UqQTj */ /* Restriction: */ /* none */ /* Changes: */ /* V01.00.10 - 2023-07-20 Removed column ""CustomerBillTo"", added column ""CustomerSoldTo"" */ /* V01.00.09 - 2023-05-31 Modified filter for ""Documenttype"" */ /* V01.00.08 - 2023-05-26 Modified the caculation logic for columns ""AmountVarCompanyCodeCurrency"" and ""AmountVarTransactionCurrency"" */ /* V01.00.07 - 2023-05-24 Modified filter for ""Documenttype"" */ /* V01.00.06 - 2023-05-16 Added filter for columns ""LogicalSystem"" and ""Documenttype"" */ /* V01.00.05 - 2023-04-24 Added column ""DocumentType"" */ /* V01.00.04 - 2023-03-15 Changed to internal WBS Element */ /* V01.00.03 - 2023-01-13 Hui Yang: Added new attribute ""SourceTimeStamp"" and renamed ""TimeStamp"" to ""LoadTimeStamp"" */ /* V01.00.02 - Jakub Kozlowski: Added Round function to [AmountFixCompanyCodeCurrency] and [AmountFixTransactionCurrency] */ /* V01.00.01 - Added missing Filter */ /* V01.00.00 - Initial version */ /* =*/"
INFI_Optravis_CSC2;63;INFormation Mart as Interface;V_INTF_PnL_B2;2142995061;V ;VIEW;15101;"/**/ /* View: V_INTF_PnL_B2 */ /**/ /* =*/ /* V01.09.00 2023-03-07 Hui Yang BD/XSP4 & Tatjana Derdus CI/DAV2.3 & Yannick Sigwalt GS/BDO12 */ /* Interface view for transfer of monthly sales transactions data to Optravis */ /* This view implements the following Soft Rules */ /* #FBI-SR-000000066 https://inside-docupedia.bosch.com/confluence/pages/viewpage.action?pageId=1767424464 */ /* Restrictions: */ /* - Restricted to certain company codes (legal entities in the scope of BBM) */ /* Changes: */ /* - V01.09.00 Corrected field Plant */ /* - V01.08.00 Performance Optimization Ilja Frolov GS/BDD1 2023-03-03 */ /* - V01.07.00 Added field Plant */ /* - V01.06.00 Softrule V_SR_CompanyCodeForOptravis_V1 included */ /* - V01.05.00 Reworked view to use new CO-PA RAWVault and added Field ProfitCenter */ /* - V01.04.00 Added column SourceSystem (2021-02-10) */ /* - V01.03.00 Rename MaterialOrig to Material; Add SalesDocumentType (2020-12-16) */ /* - V01.02.00 Adjust TotalNetSales calculation based on changed customer requirement */ /* Use new MDS-based tables for CompanyCodeScope definition (2020-11-11) */ /* - V01.01.00 Replace WWR04 by ARTNR as source for MaterialOrig (2020-10-19) */ /* - V01.00.01 Re-worked based on refined customer requirement (2020-09-30) */ /* - V01.00.00 Initial version (2020-09-03) */ /* =*/"
